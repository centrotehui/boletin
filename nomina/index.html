<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Nómina Tehui v3.9 - Profesional RD</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Colores institucionales Centro Educativo Tehui */
            --primary: #1565C0; --primary-light: #1E88E5; --primary-dark: #0D47A1;
            --secondary: #FF9800; --accent: #4CAF50;
            --tehui-red: #E53935; --tehui-yellow: #FDD835; --tehui-green: #43A047; --tehui-blue: #42A5F5; --tehui-orange: #FB8C00;
            --bg-main: #f5f7fa; --bg-card: #ffffff; --bg-sidebar: linear-gradient(180deg, #1565C0 0%, #0D47A1 100%);
            --text-primary: #1a1f24; --text-secondary: #5c6975; --text-muted: #8b95a1;
            --border: #e0e4e8; --border-light: #f0f2f5;
            --success: #43A047; --warning: #FDD835; --danger: #E53935; --info: #42A5F5; --purple: #7E57C2;
            --shadow: 0 2px 8px rgba(21, 101, 192, 0.08); --shadow-md: 0 4px 16px rgba(21, 101, 192, 0.12);
            --radius: 8px; --radius-lg: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg-main); color: var(--text-primary); font-size: 13px; line-height: 1.5; }
        
        /* Layout */
        .app { display: flex; min-height: 100vh; }
        .sidebar { width: 240px; background: var(--bg-sidebar); position: fixed; height: 100vh; overflow-y: auto; z-index: 100; }
        .sidebar::-webkit-scrollbar { width: 4px; }
        .sidebar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 2px; }
        .sidebar-header { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.05); }
        .logo { display: flex; align-items: center; gap: 12px; color: white; }
        .logo-icon { width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center; background: white; padding: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .logo-icon img { width: 100%; height: 100%; object-fit: contain; }
        .logo h1 { font-size: 13px; font-weight: 700; line-height: 1.3; }
        .logo span { font-size: 10px; color: rgba(255,255,255,0.7); display: block; margin-top: 2px; }
        
        .nav { padding: 12px 8px; }
        .nav-group { margin-bottom: 16px; }
        .nav-label { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: rgba(255,255,255,0.5); padding: 0 10px; margin-bottom: 6px; }
        .nav-item { display: flex; align-items: center; gap: 8px; padding: 9px 12px; border-radius: 8px; color: rgba(255,255,255,0.75); font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.2s; margin-bottom: 2px; }
        .nav-item:hover { background: rgba(255,255,255,0.12); color: white; }
        .nav-item.active { background: rgba(255,255,255,0.2); color: white; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.1); }
        .nav-item svg { width: 16px; height: 16px; flex-shrink: 0; }
        .nav-badge { background: var(--tehui-red); color: white; font-size: 9px; padding: 2px 6px; border-radius: 10px; margin-left: auto; font-weight: 600; }
        
        .main { flex: 1; margin-left: 240px; overflow-x: hidden; }
        .topbar { background: var(--bg-card); padding: 12px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; }
        .topbar-left h2 { font-size: 16px; font-weight: 700; }
        .topbar-left p { font-size: 11px; color: var(--text-secondary); }
        .topbar-right { display: flex; gap: 8px; }
        .page { padding: 16px 20px; overflow-x: auto; }
        
        /* Buttons - Colores Tehui */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 5px; padding: 8px 14px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; border: none; font-family: inherit; transition: all 0.2s; white-space: nowrap; }
        .btn-primary { background: linear-gradient(135deg, var(--primary-light), var(--primary)); color: white; box-shadow: 0 2px 8px rgba(30, 136, 229, 0.3); }
        .btn-primary:hover { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(30, 136, 229, 0.4); }
        .btn-secondary { background: white; color: var(--text-primary); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--bg-main); border-color: var(--primary-light); }
        .btn-success { background: linear-gradient(135deg, var(--tehui-green), #388E3C); color: white; box-shadow: 0 2px 8px rgba(67, 160, 71, 0.3); }
        .btn-success:hover { transform: translateY(-1px); }
        .btn-danger { background: linear-gradient(135deg, var(--tehui-red), #C62828); color: white; }
        .btn-warning { background: linear-gradient(135deg, var(--tehui-yellow), #F9A825); color: #333; }
        .btn-info { background: linear-gradient(135deg, var(--tehui-blue), #1E88E5); color: white; }
        .btn-purple { background: linear-gradient(135deg, var(--purple), #5E35B1); color: white; }
        .btn-orange { background: linear-gradient(135deg, var(--tehui-orange), #EF6C00); color: white; box-shadow: 0 2px 8px rgba(251, 140, 0, 0.3); }
        .btn-sm { padding: 6px 10px; font-size: 11px; }
        .btn-xs { padding: 4px 8px; font-size: 10px; }
        .btn-icon { padding: 6px; width: 30px; height: 30px; }
        .btn-group { display: flex; gap: 4px; }
        
        /* Cards */
        .card { background: var(--bg-card); border-radius: var(--radius-lg); box-shadow: var(--shadow); border: 1px solid var(--border-light); margin-bottom: 16px; overflow: hidden; }
        .card-header { padding: 12px 16px; border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-size: 13px; font-weight: 700; display: flex; align-items: center; gap: 6px; }
        .card-body { padding: 16px; overflow: auto; }
        .card-footer { padding: 12px 16px; border-top: 1px solid var(--border-light); background: var(--bg-main); }
        
        /* Stats - Colores Tehui */
        .stats { display: grid; grid-template-columns: repeat(6, 1fr); gap: 14px; margin-bottom: 16px; }
        .stat { background: var(--bg-card); border-radius: var(--radius-lg); padding: 16px; box-shadow: var(--shadow); border: 1px solid var(--border-light); transition: all 0.2s; }
        .stat:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .stat-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .stat-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .stat-icon.green { background: linear-gradient(135deg, rgba(67,160,71,0.15), rgba(67,160,71,0.05)); color: var(--tehui-green); }
        .stat-icon.blue { background: linear-gradient(135deg, rgba(66,165,245,0.15), rgba(66,165,245,0.05)); color: var(--tehui-blue); }
        .stat-icon.orange { background: linear-gradient(135deg, rgba(251,140,0,0.15), rgba(251,140,0,0.05)); color: var(--tehui-orange); }
        .stat-icon.red { background: linear-gradient(135deg, rgba(229,57,53,0.15), rgba(229,57,53,0.05)); color: var(--tehui-red); }
        .stat-icon.purple { background: linear-gradient(135deg, rgba(126,87,194,0.15), rgba(126,87,194,0.05)); color: var(--purple); }
        .stat-icon.yellow { background: linear-gradient(135deg, rgba(253,216,53,0.2), rgba(253,216,53,0.05)); color: #F9A825; }
        .stat-label { font-size: 10px; color: var(--text-secondary); font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; }
        .stat-value { font-size: 20px; font-weight: 800; color: var(--text-primary); }
        .stat-sub { font-size: 10px; color: var(--text-muted); margin-top: 3px; }
        
        /* Tables */
        .table-wrap { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        th { text-align: left; padding: 8px 10px; font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.3px; color: var(--text-secondary); background: var(--bg-main); border-bottom: 2px solid var(--border); white-space: nowrap; }
        td { padding: 8px 10px; border-bottom: 1px solid var(--border-light); vertical-align: middle; }
        tr:hover td { background: rgba(0,0,0,0.01); }
        .sticky-col { position: sticky; left: 0; background: var(--bg-card); z-index: 1; }
        
        .emp-cell { display: flex; align-items: center; gap: 8px; min-width: 180px; }
        .emp-avatar { width: 28px; height: 28px; border-radius: 6px; background: linear-gradient(135deg, var(--primary-light), var(--primary)); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 10px; flex-shrink: 0; }
        .emp-name { font-weight: 600; font-size: 11px; white-space: nowrap; }
        .emp-sub { font-size: 9px; color: var(--text-muted); }
        
        .badge { display: inline-flex; padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: 600; }
        .badge-success { background: rgba(25,135,84,0.1); color: var(--success); }
        .badge-warning { background: rgba(255,193,7,0.15); color: #997404; }
        .badge-danger { background: rgba(220,53,69,0.1); color: var(--danger); }
        .badge-info { background: rgba(13,202,240,0.1); color: #055160; }
        .badge-purple { background: rgba(111,66,193,0.1); color: var(--purple); }
        .badge-secondary { background: var(--bg-main); color: var(--text-secondary); }
        
        .money { font-family: 'JetBrains Mono', monospace; font-size: 11px; }
        .money.pos { color: var(--success); }
        .money.neg { color: var(--danger); }
        
        .actions { display: flex; gap: 3px; }
        .action-btn { width: 24px; height: 24px; border-radius: 4px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; background: var(--bg-main); color: var(--text-secondary); transition: all 0.15s; }
        .action-btn:hover { background: var(--primary-light); color: white; }
        .action-btn.danger:hover { background: var(--danger); }
        .action-btn svg { width: 12px; height: 12px; }
        
        /* Forms */
        .form-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .form-grid-3 { grid-template-columns: repeat(3, 1fr); }
        .form-grid-2 { grid-template-columns: repeat(2, 1fr); }
        .form-group { }
        .form-group.full { grid-column: 1 / -1; }
        .form-group.span-2 { grid-column: span 2; }
        .form-group.span-3 { grid-column: span 3; }
        .form-label { display: block; font-size: 10px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; text-transform: uppercase; }
        .form-control { width: 100%; padding: 7px 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 12px; font-family: inherit; transition: border-color 0.15s; }
        .form-control:focus { outline: none; border-color: var(--primary-light); box-shadow: 0 0 0 2px rgba(25,135,84,0.1); }
        .form-control.sm { padding: 5px 8px; font-size: 11px; }
        .form-help { font-size: 9px; color: var(--text-muted); margin-top: 2px; }
        .form-row { display: flex; gap: 8px; align-items: flex-end; }
        
        /* Modal */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal { background: var(--bg-card); border-radius: var(--radius-lg); width: 100%; max-width: 500px; max-height: 90vh; display: flex; flex-direction: column; }
        .modal.md { max-width: 650px; }
        .modal.lg { max-width: 850px; }
        .modal.xl { max-width: 1100px; }
        .modal-header { padding: 12px 16px; border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .modal-title { font-size: 14px; font-weight: 700; }
        .modal-close { width: 28px; height: 28px; border-radius: 6px; border: none; background: var(--bg-main); cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .modal-close:hover { background: var(--danger); color: white; }
        .modal-body { padding: 16px; overflow-y: auto; flex: 1; }
        .modal-footer { padding: 12px 16px; border-top: 1px solid var(--border-light); display: flex; justify-content: flex-end; gap: 8px; background: var(--bg-main); flex-shrink: 0; }
        
        /* Tabs */
        .tabs { display: flex; gap: 2px; background: var(--bg-main); padding: 3px; border-radius: 6px; margin-bottom: 16px; flex-wrap: wrap; }
        .tab { padding: 6px 12px; font-size: 11px; font-weight: 600; cursor: pointer; border: none; background: transparent; color: var(--text-secondary); border-radius: 4px; transition: all 0.15s; white-space: nowrap; }
        .tab:hover { color: var(--primary); }
        .tab.active { background: var(--bg-card); color: var(--primary); box-shadow: var(--shadow); }
        
        /* Config */
        .config-section { border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-bottom: 12px; }
        .config-title { font-size: 11px; font-weight: 700; color: var(--primary); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
        .config-row { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid var(--border-light); font-size: 11px; }
        .config-row:last-child { border-bottom: none; }
        .config-input { width: 80px; padding: 4px 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 11px; text-align: right; font-family: 'JetBrains Mono', monospace; }
        
        /* Alert */
        .alert { padding: 10px 12px; border-radius: 6px; margin-bottom: 12px; display: flex; align-items: flex-start; gap: 8px; font-size: 11px; }
        .alert svg { flex-shrink: 0; width: 14px; height: 14px; margin-top: 1px; }
        .alert-info { background: rgba(13,202,240,0.1); border: 1px solid rgba(13,202,240,0.2); color: #055160; }
        .alert-warning { background: rgba(255,193,7,0.1); border: 1px solid rgba(255,193,7,0.2); color: #664d03; }
        .alert-success { background: rgba(25,135,84,0.1); border: 1px solid rgba(25,135,84,0.2); color: var(--success); }
        .alert-danger { background: rgba(220,53,69,0.1); border: 1px solid rgba(220,53,69,0.2); color: var(--danger); }
        
        /* Inline input */
        .inline-input { padding: 3px 5px; border: 1px solid var(--border); border-radius: 3px; font-size: 10px; width: 55px; text-align: right; font-family: 'JetBrains Mono', monospace; }
        .inline-input:focus { outline: none; border-color: var(--primary-light); }
        
        /* Summary */
        .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 16px; }
        .summary-box { background: var(--bg-main); border-radius: 8px; padding: 12px; }
        .summary-title { font-size: 10px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px; }
        .summary-row { display: flex; justify-content: space-between; padding: 4px 0; font-size: 10px; border-bottom: 1px dashed var(--border); }
        .summary-row:last-child { border-bottom: none; font-weight: 700; padding-top: 6px; margin-top: 4px; border-top: 2px solid var(--border); font-size: 11px; }
        
        .dept-row { background: linear-gradient(90deg, rgba(15,81,50,0.05), transparent); }
        .dept-row td { font-weight: 700; color: var(--primary); border-bottom: 2px solid var(--primary-light); }
        
        /* Progress */
        .progress { height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--primary-light); border-radius: 2px; }
        
        /* Empty */
        .empty { text-align: center; padding: 40px 20px; color: var(--text-secondary); }
        .empty svg { width: 48px; height: 48px; margin-bottom: 12px; opacity: 0.3; }
        .empty h3 { font-size: 14px; margin-bottom: 4px; color: var(--text-primary); }
        .empty p { font-size: 12px; }
        
        /* SVG size control */
        svg { max-width: 100%; height: auto; }
        .card-body svg:not(.stat-icon svg):not(.action-btn svg) { width: 16px; height: 16px; }
        .card-header svg { width: 16px; height: 16px; }
        .stat-icon svg { width: 18px; height: 18px; }
        
        /* Toast */
        .toasts { position: fixed; bottom: 16px; right: 16px; z-index: 2000; }
        .toast { padding: 10px 14px; border-radius: 8px; background: var(--bg-card); box-shadow: var(--shadow-md); display: flex; align-items: center; gap: 8px; margin-top: 8px; min-width: 220px; font-size: 12px; animation: slideIn 0.2s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(40px); } }
        .toast.success { border-left: 3px solid var(--success); }
        .toast.error { border-left: 3px solid var(--danger); }
        .toast.warning { border-left: 3px solid var(--warning); }
        
        /* Loading */
        .loading { position: fixed; inset: 0; background: rgba(255,255,255,0.9); display: flex; align-items: center; justify-content: center; z-index: 3000; }
        .spinner { width: 32px; height: 32px; border: 3px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.6s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* SharePoint connection styles */
        .sp-connected { background: rgba(76, 175, 80, 0.1); color: #4caf50; }
        .sp-disconnected { background: rgba(255, 152, 0, 0.1); color: #ff9800; }
        .sync-spin { animation: spin 1s linear infinite; }
        
        /* Search */
        .search-wrap { position: relative; margin-bottom: 12px; }
        .search-input { width: 100%; padding: 8px 12px 8px 32px; border: 1px solid var(--border); border-radius: 6px; font-size: 12px; }
        .search-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-muted); width: 14px; height: 14px; }
        
        .filters { display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 12px; }
        .filter { padding: 4px 10px; border-radius: 12px; font-size: 10px; font-weight: 600; cursor: pointer; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-secondary); transition: all 0.15s; }
        .filter:hover { border-color: var(--primary-light); color: var(--primary); }
        .filter.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        /* Print */
        .print-only { display: none; }
        .volante { border: 1px solid #333; padding: 15px; margin-bottom: 15px; page-break-inside: avoid; font-size: 10px; }
        .volante-header { display: flex; justify-content: space-between; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 10px; }
        .volante-empresa h2 { font-size: 13px; margin-bottom: 2px; }
        .volante-empresa p { font-size: 9px; color: #666; }
        .volante-periodo { text-align: right; }
        .volante-periodo strong { display: block; font-size: 11px; }
        .volante-empleado { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; background: #f5f5f5; padding: 10px; margin-bottom: 10px; border-radius: 4px; }
        .volante-campo label { font-size: 8px; color: #666; text-transform: uppercase; display: block; }
        .volante-campo span { font-weight: 600; font-size: 10px; }
        .volante-detalle { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 10px; }
        .volante-seccion h4 { font-size: 10px; background: #e0e0e0; padding: 4px 6px; margin-bottom: 4px; }
        .volante-linea { display: flex; justify-content: space-between; padding: 2px 4px; font-size: 9px; border-bottom: 1px dotted #ccc; }
        .volante-linea:last-child { border-bottom: none; }
        .volante-linea.total { background: #f0f0f0; font-weight: bold; border-top: 1px solid #333; margin-top: 4px; padding-top: 4px; }
        .volante-neto { background: var(--primary); color: white; padding: 10px; text-align: center; border-radius: 4px; margin: 10px 0; }
        .volante-neto label { font-size: 9px; opacity: 0.9; }
        .volante-neto span { display: block; font-size: 18px; font-weight: bold; font-family: 'JetBrains Mono', monospace; }
        .volante-firmas { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 20px; }
        .volante-firma { text-align: center; }
        .volante-firma-linea { border-top: 1px solid #333; margin-top: 25px; padding-top: 4px; font-size: 9px; }
        
        /* Responsive */
        @media (max-width: 1400px) { .stats { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 1000px) { .stats { grid-template-columns: repeat(2, 1fr); } .form-grid { grid-template-columns: repeat(2, 1fr); } .summary-grid { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .sidebar { display: none; } .main { margin-left: 0; } .stats { grid-template-columns: 1fr; } .form-grid { grid-template-columns: 1fr; } }
        
        @media print {
            body * { visibility: hidden; }
            .print-area, .print-area * { visibility: visible; }
            .print-area { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none !important; }
            @page { margin: 10mm; }
        }
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useMemo, useCallback } = React;

// =====================================================
// CONFIGURACIÓN DE SHAREPOINT
// =====================================================
const SHAREPOINT_CONFIG = {
    clientId: '2133c50e-ffb4-4793-af2b-385d451b997b', // Client ID de Azure de Tehui
    authority: 'https://login.microsoftonline.com/tehui.onmicrosoft.com', // Tenant de Tehui
    redirectUri: window.location.href.split('?')[0], // Usa la URL actual
    scopes: ['User.Read', 'Sites.ReadWrite.All', 'Files.ReadWrite.All'],
    siteName: 'SistemaBoletinTehui',
    siteUrl: 'tehui.sharepoint.com:/sites/SistemaBoletinTehui',
    listas: {
        empleados: 'NominaEmpleados',
        prestamos: 'NominaPrestamos',
        licencias: 'NominaLicencias',
        nominas: 'NominasHistorial',
        config: 'NominaConfiguracion'
    },
    enabled: true
};

// Cargar MSAL dinámicamente
const loadMSAL = () => {
    return new Promise((resolve, reject) => {
        if (window.msal) { resolve(window.msal); return; }
        const script = document.createElement('script');
        script.src = 'https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js';
        script.onload = () => resolve(window.msal);
        script.onerror = reject;
        document.head.appendChild(script);
    });
};

let msalInstance = null;
let currentAccount = null;

const initMSAL = async () => {
    if (msalInstance) return msalInstance;
    try {
        const msal = await loadMSAL();
        msalInstance = new msal.PublicClientApplication({
            auth: {
                clientId: SHAREPOINT_CONFIG.clientId,
                authority: SHAREPOINT_CONFIG.authority,
                redirectUri: SHAREPOINT_CONFIG.redirectUri
            },
            cache: { cacheLocation: 'localStorage', storeAuthStateInCookie: true }
        });
        await msalInstance.initialize();
        
        // Manejar respuesta de redirección
        try {
            const response = await msalInstance.handleRedirectPromise();
            if (response) {
                currentAccount = response.account;
            }
        } catch (e) {
            console.log('No redirect response');
        }
        
        const accounts = msalInstance.getAllAccounts();
        if (accounts.length > 0) currentAccount = accounts[0];
        return msalInstance;
    } catch (e) {
        console.error('Error inicializando MSAL:', e);
        return null;
    }
};

const loginMicrosoft = async () => {
    try {
        const instance = await initMSAL();
        if (!instance) return null;
        const response = await instance.loginPopup({ scopes: SHAREPOINT_CONFIG.scopes });
        currentAccount = response.account;
        return response.account;
    } catch (e) {
        console.error('Error en login:', e);
        return null;
    }
};

const logoutMicrosoft = async () => {
    try {
        const instance = await initMSAL();
        if (instance && currentAccount) {
            await instance.logoutPopup({ account: currentAccount });
            currentAccount = null;
        }
    } catch (e) {
        console.error('Error en logout:', e);
    }
};

const getAccessToken = async () => {
    try {
        const instance = await initMSAL();
        if (!instance || !currentAccount) return null;
        const response = await instance.acquireTokenSilent({
            scopes: SHAREPOINT_CONFIG.scopes,
            account: currentAccount
        });
        return response.accessToken;
    } catch (e) {
        try {
            const instance = await initMSAL();
            const response = await instance.acquireTokenPopup({ scopes: SHAREPOINT_CONFIG.scopes });
            return response.accessToken;
        } catch (e2) {
            console.error('Error obteniendo token:', e2);
            return null;
        }
    }
};

const getSharePointSiteId = async (token) => {
    try {
        const response = await fetch(
            `https://graph.microsoft.com/v1.0/sites/${SHAREPOINT_CONFIG.siteUrl}`,
            { headers: { 'Authorization': `Bearer ${token}` } }
        );
        if (!response.ok) return null;
        const data = await response.json();
        return data.id;
    } catch (e) {
        console.error('Error obteniendo siteId:', e);
        return null;
    }
};

const getOrCreateList = async (token, siteId, listName, columns) => {
    try {
        // Buscar lista existente
        const searchResponse = await fetch(
            `https://graph.microsoft.com/v1.0/sites/${siteId}/lists?$filter=displayName eq '${listName}'`,
            { headers: { 'Authorization': `Bearer ${token}` } }
        );
        if (searchResponse.ok) {
            const data = await searchResponse.json();
            if (data.value && data.value.length > 0) return data.value[0].id;
        }
        
        // Crear lista si no existe
        const createResponse = await fetch(
            `https://graph.microsoft.com/v1.0/sites/${siteId}/lists`,
            {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    displayName: listName,
                    columns: columns,
                    list: { template: 'genericList' }
                })
            }
        );
        if (createResponse.ok) {
            const newList = await createResponse.json();
            return newList.id;
        }
        return null;
    } catch (e) {
        console.error('Error con lista:', e);
        return null;
    }
};

// Columnas para cada lista
const COLUMNAS_EMPLEADOS = [
    { name: 'Cedula', text: {} },
    { name: 'Departamento', text: {} },
    { name: 'Cargo', text: {} },
    { name: 'SalarioBase', number: {} },
    { name: 'FechaIngreso', dateTime: {} },
    { name: 'Activo', boolean: {} },
    { name: 'DatosJSON', text: { allowMultipleLines: true } }
];

const COLUMNAS_PRESTAMOS = [
    { name: 'EmpleadoId', number: {} },
    { name: 'Monto', number: {} },
    { name: 'Cuotas', number: {} },
    { name: 'Saldo', number: {} },
    { name: 'Activo', boolean: {} },
    { name: 'DatosJSON', text: { allowMultipleLines: true } }
];

const COLUMNAS_LICENCIAS = [
    { name: 'EmpleadoId', number: {} },
    { name: 'Tipo', text: {} },
    { name: 'FechaInicio', dateTime: {} },
    { name: 'FechaFin', dateTime: {} },
    { name: 'DatosJSON', text: { allowMultipleLines: true } }
];

const COLUMNAS_NOMINAS = [
    { name: 'Periodo', text: {} },
    { name: 'FechaGeneracion', dateTime: {} },
    { name: 'TotalNeto', number: {} },
    { name: 'Estado', text: {} },
    { name: 'DatosJSON', text: { allowMultipleLines: true } }
];

const COLUMNAS_CONFIG = [
    { name: 'TipoConfig', text: {} },
    { name: 'DatosJSON', text: { allowMultipleLines: true } }
];

// Funciones CRUD SharePoint
const guardarEmpleadoSP = async (empleado) => {
    if (!SHAREPOINT_CONFIG.enabled) return false;
    const token = await getAccessToken();
    if (!token) return false;
    try {
        const siteId = await getSharePointSiteId(token);
        if (!siteId) return false;
        const listId = await getOrCreateList(token, siteId, SHAREPOINT_CONFIG.listas.empleados, COLUMNAS_EMPLEADOS);
        if (!listId) return false;
        
        const campos = {
            fields: {
                Title: empleado.nombre,
                Cedula: empleado.cedula || '',
                Departamento: empleado.departamento,
                Cargo: empleado.cargo || '',
                SalarioBase: empleado.salarioBase,
                Activo: empleado.activo,
                DatosJSON: JSON.stringify(empleado)
            }
        };
        
        // Buscar si existe
        const searchUrl = `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items?$filter=fields/Cedula eq '${empleado.cedula}'&$expand=fields`;
        const searchResp = await fetch(searchUrl, { headers: { 'Authorization': `Bearer ${token}` } });
        const searchData = await searchResp.json();
        
        if (searchData.value && searchData.value.length > 0) {
            // Actualizar
            await fetch(
                `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items/${searchData.value[0].id}`,
                { method: 'PATCH', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(campos) }
            );
        } else {
            // Crear
            await fetch(
                `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items`,
                { method: 'POST', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(campos) }
            );
        }
        return true;
    } catch (e) {
        console.error('Error guardando empleado:', e);
        return false;
    }
};

const cargarEmpleadosSP = async () => {
    if (!SHAREPOINT_CONFIG.enabled) return [];
    const token = await getAccessToken();
    if (!token) return [];
    try {
        const siteId = await getSharePointSiteId(token);
        if (!siteId) return [];
        const listId = await getOrCreateList(token, siteId, SHAREPOINT_CONFIG.listas.empleados, COLUMNAS_EMPLEADOS);
        if (!listId) return [];
        
        const response = await fetch(
            `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items?$expand=fields&$top=500`,
            { headers: { 'Authorization': `Bearer ${token}` } }
        );
        if (!response.ok) return [];
        const data = await response.json();
        
        return (data.value || []).map(item => {
            try {
                const emp = JSON.parse(item.fields.DatosJSON || '{}');
                emp._spId = item.id;
                return emp;
            } catch { return null; }
        }).filter(Boolean);
    } catch (e) {
        console.error('Error cargando empleados:', e);
        return [];
    }
};

const guardarPrestamoSP = async (prestamo) => {
    if (!SHAREPOINT_CONFIG.enabled) return false;
    const token = await getAccessToken();
    if (!token) return false;
    try {
        const siteId = await getSharePointSiteId(token);
        if (!siteId) return false;
        const listId = await getOrCreateList(token, siteId, SHAREPOINT_CONFIG.listas.prestamos, COLUMNAS_PRESTAMOS);
        if (!listId) return false;
        
        const campos = {
            fields: {
                Title: `Préstamo ${prestamo.id}`,
                EmpleadoId: prestamo.empleadoId,
                Monto: prestamo.monto,
                Cuotas: prestamo.cuotas,
                Saldo: prestamo.saldo,
                Activo: prestamo.activo,
                DatosJSON: JSON.stringify(prestamo)
            }
        };
        
        if (prestamo._spId) {
            await fetch(
                `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items/${prestamo._spId}`,
                { method: 'PATCH', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(campos) }
            );
        } else {
            await fetch(
                `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items`,
                { method: 'POST', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(campos) }
            );
        }
        return true;
    } catch (e) {
        console.error('Error guardando préstamo:', e);
        return false;
    }
};

const cargarPrestamosSP = async () => {
    if (!SHAREPOINT_CONFIG.enabled) return [];
    const token = await getAccessToken();
    if (!token) return [];
    try {
        const siteId = await getSharePointSiteId(token);
        if (!siteId) return [];
        const listId = await getOrCreateList(token, siteId, SHAREPOINT_CONFIG.listas.prestamos, COLUMNAS_PRESTAMOS);
        if (!listId) return [];
        
        const response = await fetch(
            `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items?$expand=fields&$top=500`,
            { headers: { 'Authorization': `Bearer ${token}` } }
        );
        if (!response.ok) return [];
        const data = await response.json();
        
        return (data.value || []).map(item => {
            try {
                const p = JSON.parse(item.fields.DatosJSON || '{}');
                p._spId = item.id;
                return p;
            } catch { return null; }
        }).filter(Boolean);
    } catch (e) {
        console.error('Error cargando préstamos:', e);
        return [];
    }
};

const guardarNominaSP = async (nomina) => {
    if (!SHAREPOINT_CONFIG.enabled) return false;
    const token = await getAccessToken();
    if (!token) return false;
    try {
        const siteId = await getSharePointSiteId(token);
        if (!siteId) return false;
        const listId = await getOrCreateList(token, siteId, SHAREPOINT_CONFIG.listas.nominas, COLUMNAS_NOMINAS);
        if (!listId) return false;
        
        const periodoTxt = `${nomina.periodo.tipo === 'quincenal' ? 'Q' + nomina.periodo.quincena + ' ' : ''}${nomina.periodo.mes}/${nomina.periodo.año}`;
        const totalNeto = nomina.detalles.reduce((s, d) => s + d.neto, 0);
        
        const campos = {
            fields: {
                Title: `Nómina ${periodoTxt}`,
                Periodo: periodoTxt,
                FechaGeneracion: nomina.fecha,
                TotalNeto: totalNeto,
                Estado: nomina.estado,
                DatosJSON: JSON.stringify(nomina)
            }
        };
        
        await fetch(
            `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items`,
            { method: 'POST', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(campos) }
        );
        return true;
    } catch (e) {
        console.error('Error guardando nómina:', e);
        return false;
    }
};

const cargarNominasSP = async () => {
    if (!SHAREPOINT_CONFIG.enabled) return [];
    const token = await getAccessToken();
    if (!token) return [];
    try {
        const siteId = await getSharePointSiteId(token);
        if (!siteId) return [];
        const listId = await getOrCreateList(token, siteId, SHAREPOINT_CONFIG.listas.nominas, COLUMNAS_NOMINAS);
        if (!listId) return [];
        
        const response = await fetch(
            `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items?$expand=fields&$top=100&$orderby=fields/FechaGeneracion desc`,
            { headers: { 'Authorization': `Bearer ${token}` } }
        );
        if (!response.ok) return [];
        const data = await response.json();
        
        return (data.value || []).map(item => {
            try {
                const n = JSON.parse(item.fields.DatosJSON || '{}');
                n._spId = item.id;
                return n;
            } catch { return null; }
        }).filter(Boolean);
    } catch (e) {
        console.error('Error cargando nóminas:', e);
        return [];
    }
};

const guardarConfigSP = async (tipoConfig, datos) => {
    if (!SHAREPOINT_CONFIG.enabled) return false;
    const token = await getAccessToken();
    if (!token) return false;
    try {
        const siteId = await getSharePointSiteId(token);
        if (!siteId) return false;
        const listId = await getOrCreateList(token, siteId, SHAREPOINT_CONFIG.listas.config, COLUMNAS_CONFIG);
        if (!listId) return false;
        
        const campos = {
            fields: {
                Title: tipoConfig,
                TipoConfig: tipoConfig,
                DatosJSON: JSON.stringify(datos)
            }
        };
        
        // Buscar si existe
        const searchUrl = `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items?$filter=fields/TipoConfig eq '${tipoConfig}'&$expand=fields`;
        const searchResp = await fetch(searchUrl, { headers: { 'Authorization': `Bearer ${token}` } });
        const searchData = await searchResp.json();
        
        if (searchData.value && searchData.value.length > 0) {
            await fetch(
                `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items/${searchData.value[0].id}`,
                { method: 'PATCH', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(campos) }
            );
        } else {
            await fetch(
                `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items`,
                { method: 'POST', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(campos) }
            );
        }
        return true;
    } catch (e) {
        console.error('Error guardando config:', e);
        return false;
    }
};

const cargarConfigSP = async (tipoConfig) => {
    if (!SHAREPOINT_CONFIG.enabled) return null;
    const token = await getAccessToken();
    if (!token) return null;
    try {
        const siteId = await getSharePointSiteId(token);
        if (!siteId) return null;
        const listId = await getOrCreateList(token, siteId, SHAREPOINT_CONFIG.listas.config, COLUMNAS_CONFIG);
        if (!listId) return null;
        
        const searchUrl = `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items?$filter=fields/TipoConfig eq '${tipoConfig}'&$expand=fields`;
        const response = await fetch(searchUrl, { headers: { 'Authorization': `Bearer ${token}` } });
        if (!response.ok) return null;
        const data = await response.json();
        
        if (data.value && data.value.length > 0) {
            return JSON.parse(data.value[0].fields.DatosJSON || '{}');
        }
        return null;
    } catch (e) {
        console.error('Error cargando config:', e);
        return null;
    }
};

// =====================================================
// CONFIGURACIÓN INICIAL - LEYES LABORALES RD 2025
// =====================================================
const CONFIG_DEFAULT = {
    tss: {
        afpEmpleado: 2.87, sfsEmpleado: 3.04,
        afpEmpleador: 7.10, sfsEmpleador: 7.09,
        infotep: 1.00, riesgoLaboral: 1.20,
        topeAfp: 485070, topeSfs: 485070,
        pdssPerCapita: 1100  // RD$ 1,100 mensual por dependiente adicional en SFS
    },
    isr: [
        { min: 0, max: 416220, tasa: 0, fijo: 0 },
        { min: 416220.01, max: 624329, tasa: 15, fijo: 0 },
        { min: 624329.01, max: 867123, tasa: 20, fijo: 31216.35 },
        { min: 867123.01, max: Infinity, tasa: 25, fijo: 79775.15 }
    ],
    general: {
        diasMes: 23.83,
        salarioMinimo: 21000,
        horasExtra35: 35,  // Horas 9-44 semanal
        horasExtra100: 100, // Más de 44, feriados, domingos
        vacacionesDias: 14,
        regaliaMes: 12
    },
    empresa: {
        nombre: 'Centro Educativo de Formación Integral Tehui',
        rnc: '133-03246-5',
        direccion: 'Carretera Don Pedro No. 140, Esq. Las Orquideas',
        telefono: '809-000-0000',
        representante: 'GRUPO PAIDOS, SRL'
    },
    liquidacion: {
        preavisoMeses: { 3: 7, 6: 14, 12: 28 }, // días según antigüedad en meses
        cesantiaDias: { 3: 6, 6: 13, 12: 21, 60: 23 } // días por año según antigüedad
    }
};

// Valores predeterminados para configuración (se pueden modificar en Mantenimiento)
const DEPARTAMENTOS_DEFAULT = ['ADMINISTRACION', 'ASISTENTE', 'DOCENTE', 'MAESTRA INTEGRADORA', 'PROFESOR', 'PSICOLOGIA', 'MANTENIMIENTO', 'COCINA', 'TRANSPORTE', 'SEGURIDAD'];
const BANCOS_DEFAULT = ['Banco Popular Dominicano', 'BHD León', 'Banreservas', 'Scotiabank', 'Banco Santa Cruz', 'Banco Promerica', 'Asociación Popular', 'Banco BDI', 'Banco Caribe', 'Banco Vimenca'];
const TIPOS_CONTRATO_DEFAULT = ['Indefinido', 'Temporal', 'Por Obra', 'Pasantía', 'Prueba'];
const TIPOS_LICENCIA_DEFAULT = ['Maternidad', 'Paternidad', 'Médica', 'Sin Sueldo', 'Duelo', 'Matrimonio', 'Vacaciones'];
const TIPOS_REMUNERACION_DEFAULT = ['Normal', 'Trabajador ocasional (no fijo)', 'Asalariado por hora/día/semana'];
const CARGOS_DEFAULT = ['Docente', 'Asistente', 'Administrativa', 'Psicóloga', 'Mantenimiento', 'Representante', 'Coordinador', 'Director', 'Secretaria', 'Conserje'];
const MESES = ['', 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

// =====================================================
// FUNCIONES DE CÁLCULO
// =====================================================
const round2 = n => Math.round(n * 100) / 100;
const formatMoney = n => new Intl.NumberFormat('es-DO', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n || 0);
const formatDate = d => d ? new Date(d).toLocaleDateString('es-DO') : '-';
const getInitials = name => name?.split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase() || '??';

const calcularAntiguedad = (fechaIngreso) => {
    if (!fechaIngreso) return { años: 0, meses: 0, dias: 0 };
    const inicio = new Date(fechaIngreso);
    const hoy = new Date();
    let años = hoy.getFullYear() - inicio.getFullYear();
    let meses = hoy.getMonth() - inicio.getMonth();
    let dias = hoy.getDate() - inicio.getDate();
    if (dias < 0) { meses--; dias += 30; }
    if (meses < 0) { años--; meses += 12; }
    return { años, meses: años * 12 + meses, dias };
};

const calcularTSS = (salario, config) => {
    const topeAfp = Math.min(salario, config.tss.topeAfp);
    const topeSfs = Math.min(salario, config.tss.topeSfs);
    return {
        afpEmp: round2(topeAfp * config.tss.afpEmpleado / 100),
        sfsEmp: round2(topeSfs * config.tss.sfsEmpleado / 100),
        afpPat: round2(topeAfp * config.tss.afpEmpleador / 100),
        sfsPat: round2(topeSfs * config.tss.sfsEmpleador / 100),
        infotep: round2(salario * config.tss.infotep / 100),
        riesgo: round2(salario * config.tss.riesgoLaboral / 100)
    };
};

const calcularISR = (salarioAnualNeto, config) => {
    // En RD los dependientes NO afectan el ISR
    for (const t of config.isr) {
        if (salarioAnualNeto >= t.min && salarioAnualNeto <= t.max) {
            if (t.tasa === 0) return 0;
            return round2((((salarioAnualNeto - t.min) * t.tasa / 100) + t.fijo) / 12);
        }
    }
    return 0;
};

const calcularSalarioDiario = (salarioMensual, config) => round2(salarioMensual / config.general.diasMes);
const calcularSalarioHora = (salarioMensual, config) => round2(calcularSalarioDiario(salarioMensual, config) / 8);

const calcularHorasExtras = (salarioMensual, horas35, horas100, config) => {
    const salarioHora = calcularSalarioHora(salarioMensual, config);
    const extra35 = round2(horas35 * salarioHora * (1 + config.general.horasExtra35 / 100));
    const extra100 = round2(horas100 * salarioHora * (1 + config.general.horasExtra100 / 100));
    return { extra35, extra100, total: round2(extra35 + extra100) };
};

const calcularVacaciones = (salarioMensual, diasVacaciones, config) => {
    const salarioDiario = calcularSalarioDiario(salarioMensual, config);
    return round2(salarioDiario * diasVacaciones);
};

const calcularRegalia = (salarioPromedio, mesesTrabajados) => {
    // Regalía = (Salario promedio / 12) * meses trabajados en el año
    return round2((salarioPromedio / 12) * Math.min(mesesTrabajados, 12));
};

const calcularPreaviso = (salarioMensual, mesesAntiguedad, config) => {
    const salarioDiario = calcularSalarioDiario(salarioMensual, config);
    let dias = 0;
    if (mesesAntiguedad >= 12) dias = 28;
    else if (mesesAntiguedad >= 6) dias = 14;
    else if (mesesAntiguedad >= 3) dias = 7;
    return { dias, monto: round2(salarioDiario * dias) };
};

const calcularCesantia = (salarioMensual, mesesAntiguedad, config) => {
    const salarioDiario = calcularSalarioDiario(salarioMensual, config);
    let diasPorAño = 0;
    if (mesesAntiguedad >= 60) diasPorAño = 23;
    else if (mesesAntiguedad >= 12) diasPorAño = 21;
    else if (mesesAntiguedad >= 6) diasPorAño = 13;
    else if (mesesAntiguedad >= 3) diasPorAño = 6;
    const años = mesesAntiguedad / 12;
    const dias = round2(diasPorAño * años);
    return { diasPorAño, dias, monto: round2(salarioDiario * dias) };
};

const calcularLiquidacion = (empleado, config, motivoSalida = 'despido') => {
    const { meses } = calcularAntiguedad(empleado.fechaIngreso);
    const salario = empleado.salarioBase;
    const salarioDiario = calcularSalarioDiario(salario, config);
    
    // Preaviso (solo si aplica según motivo)
    const preaviso = motivoSalida === 'despido' ? calcularPreaviso(salario, meses, config) : { dias: 0, monto: 0 };
    
    // Cesantía (solo despido injustificado)
    const cesantia = motivoSalida === 'despido' ? calcularCesantia(salario, meses, config) : { dias: 0, monto: 0 };
    
    // Vacaciones no disfrutadas
    const diasVacacionesAcum = Math.floor((meses / 12) * config.general.vacacionesDias);
    const diasVacacionesPend = diasVacacionesAcum - (empleado.vacacionesDisfrutadas || 0);
    const vacaciones = round2(salarioDiario * Math.max(0, diasVacacionesPend));
    
    // Salario pendiente (proporcional del mes)
    const diasPendientes = new Date().getDate();
    const salarioPendiente = round2(salarioDiario * diasPendientes);
    
    // Regalía proporcional
    const mesActual = new Date().getMonth() + 1;
    const regalia = calcularRegalia(salario, mesActual);
    
    return {
        preaviso, cesantia, vacaciones, salarioPendiente, regalia,
        total: round2(preaviso.monto + cesantia.monto + vacaciones + salarioPendiente + regalia)
    };
};

// =====================================================
// ICONOS SVG
// =====================================================
const Icons = {
    Dashboard: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="7" height="9" rx="1"/><rect x="14" y="3" width="7" height="5" rx="1"/><rect x="14" y="12" width="7" height="9" rx="1"/><rect x="3" y="16" width="7" height="5" rx="1"/></svg>,
    Users: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
    Dollar: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
    FileText: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
    Settings: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
    Plus: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
    Edit: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
    Trash: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3,6 5,6 21,6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
    X: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
    Search: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
    Download: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
    Printer: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6,9 6,2 18,2 18,9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>,
    Calendar: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
    Check: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20,6 9,17 4,12"/></svg>,
    Clock: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>,
    CreditCard: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>,
    AlertCircle: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
    Info: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>,
    Gift: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20,12 20,22 4,22 4,12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>,
    Umbrella: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M23 12a11.05 11.05 0 0 0-22 0zm-5 7a3 3 0 0 1-6 0v-7"/></svg>,
    UserMinus: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="23" y1="11" x2="17" y2="11"/></svg>,
    UserCheck: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><polyline points="17,11 19,13 23,9"/></svg>,
    FileSpreadsheet: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="8" y1="13" x2="16" y2="13"/><line x1="8" y1="17" x2="16" y2="17"/><line x1="10" y1="9" x2="10" y2="21"/></svg>,
    Receipt: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1z"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="8" y1="10" x2="16" y2="10"/><line x1="8" y1="14" x2="12" y2="14"/></svg>,
    Save: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17,21 17,13 7,13 7,21"/><polyline points="7,3 7,8 15,8"/></svg>,
    Eye: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
    Award: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21,13.89 7,23 12,20 17,23 15.79,13.88"/></svg>,
    Briefcase: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>,
    Home: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>,
    Activity: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/></svg>,
    Cloud: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>,
    CloudOff: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="1" y1="1" x2="23" y2="23"/><path d="M7 17H4a4 4 0 0 1 0-8c.5 0 .97.09 1.41.26M16 17h2a5 5 0 0 0 .95-9.9"/><path d="M8.3 8.3A5.98 5.98 0 0 1 16 6c.5 0 .97.06 1.43.17"/></svg>,
    Refresh: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23,4 23,10 17,10"/><polyline points="1,20 1,14 7,14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>,
    LogIn: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10,17 15,12 10,7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>,
    LogOut: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
    Lock: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
    User: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
    Database: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
    Tool: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>,
};

// =====================================================
// COMPONENTES UI
// =====================================================
const Toast = ({ msg, type, onClose }) => {
    useEffect(() => { const t = setTimeout(onClose, 3000); return () => clearTimeout(t); }, []);
    return <div className={`toast ${type}`}><span>{msg}</span></div>;
};

const Modal = ({ open, onClose, title, children, footer, size }) => {
    if (!open) return null;
    return (
        <div className="modal-backdrop" onClick={onClose}>
            <div className={`modal ${size || ''}`} onClick={e => e.stopPropagation()}>
                <div className="modal-header">
                    <span className="modal-title">{title}</span>
                    <button className="modal-close" onClick={onClose}><Icons.X /></button>
                </div>
                <div className="modal-body">{children}</div>
                {footer && <div className="modal-footer">{footer}</div>}
            </div>
        </div>
    );
};

// =====================================================
// COMPONENTE VOLANTE DE PAGO
// =====================================================
const Volante = ({ emp, det, periodo, config }) => {
    const periodoTxt = periodo.tipo === 'quincenal' 
        ? `${periodo.quincena === 1 ? '01-15' : '16-' + new Date(periodo.año, periodo.mes, 0).getDate()} de ${MESES[periodo.mes]} ${periodo.año}`
        : `${MESES[periodo.mes]} ${periodo.año}`;
    
    return (
        <div className="volante">
            <div className="volante-header">
                <div className="volante-empresa">
                    <h2>{config.empresa.nombre}</h2>
                    <p>{config.empresa.direccion}</p>
                    <p>RNC: {config.empresa.rnc}</p>
                </div>
                <div className="volante-periodo">
                    <strong>VOLANTE DE PAGO</strong>
                    <span>Período: {periodoTxt}</span>
                </div>
            </div>
            
            <div className="volante-empleado">
                <div className="volante-campo"><label>Nombre</label><span>{emp.nombre}</span></div>
                <div className="volante-campo"><label>{emp.tipoDocumento === 'pasaporte' ? 'Pasaporte' : 'Cédula'}</label><span>{emp.documento}</span></div>
                <div className="volante-campo"><label>NSS</label><span>{emp.nss || 'N/A'}</span></div>
                <div className="volante-campo"><label>Departamento</label><span>{emp.departamento}</span></div>
            </div>
            
            <div className="volante-detalle">
                <div className="volante-seccion">
                    <h4>INGRESOS</h4>
                    <div className="volante-linea"><span>Salario Base</span><span>RD$ {formatMoney(det.salarioBase)}</span></div>
                    {det.horasExtra > 0 && <div className="volante-linea"><span>Horas Extras</span><span>RD$ {formatMoney(det.horasExtra)}</span></div>}
                    {det.bonificacion > 0 && <div className="volante-linea"><span>Bonificación</span><span>RD$ {formatMoney(det.bonificacion)}</span></div>}
                    {det.comisiones > 0 && <div className="volante-linea"><span>Comisiones</span><span>RD$ {formatMoney(det.comisiones)}</span></div>}
                    {det.incentivos > 0 && <div className="volante-linea"><span>Incentivos</span><span>RD$ {formatMoney(det.incentivos)}</span></div>}
                    {det.viaticos > 0 && <div className="volante-linea"><span>Viáticos</span><span>RD$ {formatMoney(det.viaticos)}</span></div>}
                    {det.vacaciones > 0 && <div className="volante-linea"><span>Vacaciones</span><span>RD$ {formatMoney(det.vacaciones)}</span></div>}
                    {det.regalia > 0 && <div className="volante-linea"><span>Regalía Pascual</span><span>RD$ {formatMoney(det.regalia)}</span></div>}
                    {det.otrosIng > 0 && <div className="volante-linea"><span>Otros Ingresos</span><span>RD$ {formatMoney(det.otrosIng)}</span></div>}
                    <div className="volante-linea total"><span>TOTAL INGRESOS</span><span>RD$ {formatMoney(det.totalIng)}</span></div>
                </div>
                
                <div className="volante-seccion">
                    <h4>DEDUCCIONES</h4>
                    <div className="volante-linea"><span>AFP ({config.tss.afpEmpleado}%)</span><span>RD$ {formatMoney(det.afpEmp)}</span></div>
                    <div className="volante-linea"><span>SFS ({config.tss.sfsEmpleado}%)</span><span>RD$ {formatMoney(det.sfsEmp)}</span></div>
                    {det.isr > 0 && <div className="volante-linea"><span>ISR</span><span>RD$ {formatMoney(det.isr)}</span></div>}
                    {det.pdss > 0 && <div className="volante-linea"><span>PDSS Adicional</span><span>RD$ {formatMoney(det.pdss)}</span></div>}
                    {det.descAusencias > 0 && (
                        <div className="volante-linea" style={{flexDirection:'column', alignItems:'stretch'}}>
                            <div style={{display:'flex', justifyContent:'space-between'}}>
                                <span>Desc. Ausencias ({det.diasAus} {det.diasAus === 1 ? 'día' : 'días'})</span>
                                <span>RD$ {formatMoney(det.descAusencias)}</span>
                            </div>
                            {det.fechasAus && det.fechasAus.length > 0 && (
                                <div style={{fontSize:'9px', color:'var(--text-secondary)', marginTop:'2px', paddingLeft:'8px'}}>
                                    Días: {det.fechasAus.map(f => {
                                        const [año, mes, dia] = f.split('-');
                                        return `${parseInt(dia)}/${mes}`;
                                    }).join(', ')}
                                </div>
                            )}
                        </div>
                    )}
                    {det.descTardanzas > 0 && <div className="volante-linea"><span>Desc. Tardanzas</span><span>RD$ {formatMoney(det.descTardanzas)}</span></div>}
                    {det.cuotaPrestamo > 0 && <div className="volante-linea"><span>Cuota Préstamo</span><span>RD$ {formatMoney(det.cuotaPrestamo)}</span></div>}
                    {det.cooperativa > 0 && <div className="volante-linea"><span>Cooperativa</span><span>RD$ {formatMoney(det.cooperativa)}</span></div>}
                    {det.seguroPrivado > 0 && <div className="volante-linea"><span>Seguro Médico</span><span>RD$ {formatMoney(det.seguroPrivado)}</span></div>}
                    {det.embargo > 0 && <div className="volante-linea"><span>Embargo/Pensión</span><span>RD$ {formatMoney(det.embargo)}</span></div>}
                    {det.otrasDed > 0 && <div className="volante-linea"><span>Otras Deducciones</span><span>RD$ {formatMoney(det.otrasDed)}</span></div>}
                    <div className="volante-linea total"><span>TOTAL DEDUCCIONES</span><span>RD$ {formatMoney(det.totalDed)}</span></div>
                </div>
            </div>
            
            <div className="volante-neto">
                <label>NETO A RECIBIR</label>
                <span>RD$ {formatMoney(det.neto)}</span>
            </div>
            
            <div className="volante-firmas">
                <div className="volante-firma"><div className="volante-firma-linea">Firma del Empleado</div></div>
                <div className="volante-firma"><div className="volante-firma-linea">Fecha de Recibido</div></div>
            </div>
        </div>
    );
};

// =====================================================
// CONFIGURACIÓN DE USUARIOS
// =====================================================
const USUARIOS_SISTEMA = {
    admin: { password: 'Tehui@2026', rol: 'admin', nombre: 'Administrador' },
    consulta: { password: 'Ver2026$', rol: 'consulta', nombre: 'Usuario Consulta' }
};

// =====================================================
// APLICACIÓN PRINCIPAL
// =====================================================

const App = () => {
    // =====================================================
    // AUTENTICACIÓN DE USUARIO
    // =====================================================
    const [usuarioActual, setUsuarioActual] = useState(() => {
        try {
            const saved = sessionStorage.getItem('tehui_nomina_session');
            return saved ? JSON.parse(saved) : null;
        } catch { return null; }
    });
    const [loginForm, setLoginForm] = useState({ usuario: '', password: '', error: '' });
    const [mostrarCambioPassword, setMostrarCambioPassword] = useState(false);
    const [cambioPasswordForm, setCambioPasswordForm] = useState({ actual: '', nueva: '', confirmar: '', error: '' });

    // Función para cambiar contraseña (solo muestra mensaje informativo)
    const handleCambioPassword = (e) => {
        e.preventDefault();
        const { actual, nueva, confirmar } = cambioPasswordForm;
        
        if (!actual || !nueva || !confirmar) {
            setCambioPasswordForm(prev => ({ ...prev, error: 'Todos los campos son requeridos' }));
            return;
        }
        if (nueva !== confirmar) {
            setCambioPasswordForm(prev => ({ ...prev, error: 'Las contraseñas no coinciden' }));
            return;
        }
        if (nueva.length < 6) {
            setCambioPasswordForm(prev => ({ ...prev, error: 'La contraseña debe tener al menos 6 caracteres' }));
            return;
        }
        
        // Simular cambio exitoso (en producción se conectaría a un backend)
        alert('Funcionalidad de cambio de contraseña: En un entorno de producción, esto actualizaría la contraseña en el servidor.');
        setMostrarCambioPassword(false);
        setCambioPasswordForm({ actual: '', nueva: '', confirmar: '', error: '' });
    };

    // Login de usuario del sistema
    const handleUserLogin = (e) => {
        e.preventDefault();
        const { usuario, password } = loginForm;
        const userKey = usuario.toLowerCase().trim();
        const user = USUARIOS_SISTEMA[userKey];
        
        if (user && user.password === password) {
            const session = { usuario: userKey, rol: user.rol, nombre: user.nombre };
            setUsuarioActual(session);
            sessionStorage.setItem('tehui_nomina_session', JSON.stringify(session));
            setLoginForm({ usuario: '', password: '', error: '' });
        } else {
            setLoginForm(prev => ({ ...prev, error: 'Usuario o contraseña incorrectos' }));
        }
    };

    // Logout de usuario del sistema
    const handleUserLogout = () => {
        if (window.confirm('¿Está seguro que desea cerrar sesión?')) {
            setUsuarioActual(null);
            sessionStorage.removeItem('tehui_nomina_session');
        }
    };

    // Estados de UI
    const [toasts, setToasts] = useState([]);
    const [loading, setLoading] = useState(false);
    
    // Funciones de Toast
    const toast = (msg, type = 'info') => setToasts(p => [...p, { id: Date.now(), msg, type }]);
    const removeToast = id => setToasts(p => p.filter(t => t.id !== id));
    
    // Estados
    const [view, setView] = useState('dashboard');
    const [config, setConfig] = useState(CONFIG_DEFAULT);
    const [empleados, setEmpleados] = useState([]);
    const [prestamos, setPrestamos] = useState([]);
    const [licencias, setLicencias] = useState([]);
    const [nominas, setNominas] = useState([]);
    const [datosInicializados, setDatosInicializados] = useState(false); // Flag para evitar sobrescribir localStorage al inicio
    const [currentNomina, setCurrentNomina] = useState(null);
    const [nominaEdits, setNominaEdits] = useState({});
    const [searchTerm, setSearchTerm] = useState('');
    const [filterDept, setFilterDept] = useState('TODOS');
    
    // Estados de Configuración del Sistema (Mantenimiento)
    const [catalogos, setCatalogos] = useState({
        departamentos: DEPARTAMENTOS_DEFAULT,
        bancos: BANCOS_DEFAULT,
        tiposContrato: TIPOS_CONTRATO_DEFAULT,
        tiposLicencia: TIPOS_LICENCIA_DEFAULT,
        tiposRemuneracion: TIPOS_REMUNERACION_DEFAULT,
        cargos: CARGOS_DEFAULT
    });
    const [catalogoActivo, setCatalogoActivo] = useState('departamentos');
    const [nuevoItem, setNuevoItem] = useState('');
    const [editandoItem, setEditandoItem] = useState(null);
    
    // Accesos rápidos a catálogos
    const DEPARTAMENTOS = catalogos.departamentos;
    const BANCOS = catalogos.bancos;
    const TIPOS_CONTRATO = catalogos.tiposContrato;
    const TIPOS_LICENCIA = catalogos.tiposLicencia;
    const TIPOS_REMUNERACION = catalogos.tiposRemuneracion;
    const CARGOS = catalogos.cargos;
    
    // Estados SharePoint
    const [msUser, setMsUser] = useState(null);
    const [syncStatus, setSyncStatus] = useState({ syncing: false, lastSync: null, error: null });
    const [spConnected, setSpConnected] = useState(false);
    
    // Modales
    const [modals, setModals] = useState({
        empleado: false, prestamo: false, licencia: false, liquidacion: false,
        volantes: false, constancia: false, config: false, ausencias: false
    });
    const [editingEmp, setEditingEmp] = useState(null);
    const [selectedEmp, setSelectedEmp] = useState(null);
    const [selectedVolante, setSelectedVolante] = useState(null);
    const [ausenciasEmpId, setAusenciasEmpId] = useState(null); // Empleado seleccionado para registrar ausencias
    
    // Forms
    const empFormInit = { nombre: '', tipoDocumento: 'cedula', documento: '', nss: '', departamento: 'DOCENTE', cargo: '', salarioBase: '', tipoRemuneracion: 'Normal', fechaIngreso: '', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 };
    const [empForm, setEmpForm] = useState(empFormInit);
    const [prestamoForm, setPrestamoForm] = useState({ empleadoId: '', monto: '', cuotas: '', desc: '', fecha: '' });
    const [licenciaForm, setLicenciaForm] = useState({ empleadoId: '', tipo: 'Vacaciones', fechaInicio: '', fechaFin: '', conPago: true, notas: '' });
    const [periodo, setPeriodo] = useState({ tipo: 'quincenal', mes: new Date().getMonth() + 1, año: new Date().getFullYear(), quincena: new Date().getDate() <= 15 ? 1 : 2 });
    const [liquidacionData, setLiquidacionData] = useState(null);

    // Init
    useEffect(() => { 
        initMSAL().then(() => {
            if (currentAccount) {
                setMsUser(currentAccount);
                setSpConnected(true);
                cargarDatosSharePoint();
            } else {
                cargarDatosLocales();
            }
        });
    }, []);

    // Login Microsoft
    const handleLogin = async () => {
        setLoading(true);
        try {
            const account = await loginMicrosoft();
            if (account) {
                setMsUser(account);
                setSpConnected(true);
                toast('Conectado a Microsoft 365', 'success');
                await cargarDatosSharePoint();
            } else {
                toast('No se pudo conectar', 'error');
            }
        } catch (e) {
            toast('Error al conectar: ' + e.message, 'error');
        }
        setLoading(false);
    };

    // Logout Microsoft
    const handleLogout = async () => {
        await logoutMicrosoft();
        setMsUser(null);
        setSpConnected(false);
        toast('Sesión cerrada', 'warning');
    };

    // Cargar datos desde SharePoint
    const cargarDatosSharePoint = async () => {
        setLoading(true);
        setSyncStatus(s => ({ ...s, syncing: true, error: null }));
        try {
            // Cargar configuración
            const configSP = await cargarConfigSP('ConfigTSS');
            if (configSP) setConfig(prev => ({ ...prev, ...configSP }));
            
            // Cargar empleados
            const empsSP = await cargarEmpleadosSP();
            if (empsSP.length > 0) {
                setEmpleados(empsSP);
            } else {
                cargarDatosLocales(); // Si no hay datos en SP, cargar demo
                return; // cargarDatosLocales ya setea datosInicializados
            }
            
            // Cargar préstamos
            const prestsSP = await cargarPrestamosSP();
            setPrestamos(prestsSP);
            
            // Cargar nóminas
            const nominasSP = await cargarNominasSP();
            setNominas(nominasSP);
            
            setSyncStatus({ syncing: false, lastSync: new Date(), error: null });
            setDatosInicializados(true); // Habilitar guardado automático
            toast('Datos sincronizados con SharePoint', 'success');
        } catch (e) {
            setSyncStatus(s => ({ ...s, syncing: false, error: e.message }));
            toast('Error al cargar datos: ' + e.message, 'error');
            cargarDatosLocales();
            return; // cargarDatosLocales ya setea datosInicializados
        }
        setLoading(false);
    };

    // Sincronizar todo con SharePoint
    const sincronizarConSharePoint = async () => {
        if (!spConnected) {
            toast('Conecte con Microsoft primero', 'warning');
            return;
        }
        
        setLoading(true);
        setSyncStatus(s => ({ ...s, syncing: true }));
        let exitos = 0, errores = 0;
        
        try {
            // Guardar configuración
            if (await guardarConfigSP('ConfigTSS', config)) exitos++;
            else errores++;
            
            // Guardar empleados
            for (const emp of empleados) {
                if (await guardarEmpleadoSP(emp)) exitos++;
                else errores++;
            }
            
            // Guardar préstamos
            for (const p of prestamos) {
                if (await guardarPrestamoSP(p)) exitos++;
                else errores++;
            }
            
            setSyncStatus({ syncing: false, lastSync: new Date(), error: null });
            toast(`Sincronización completa: ${exitos} exitosos, ${errores} errores`, exitos > errores ? 'success' : 'warning');
        } catch (e) {
            setSyncStatus(s => ({ ...s, syncing: false, error: e.message }));
            toast('Error en sincronización: ' + e.message, 'error');
        }
        setLoading(false);
    };

    // === PERSISTENCIA LOCAL (localStorage) ===
    const STORAGE_KEYS = {
        empleados: 'nominaTehui_empleados',
        prestamos: 'nominaTehui_prestamos',
        licencias: 'nominaTehui_licencias',
        nominas: 'nominaTehui_nominas',
        config: 'nominaTehui_config',
        catalogos: 'nominaTehui_catalogos'
    };

    const guardarEnLocal = (key, data) => {
        try {
            localStorage.setItem(key, JSON.stringify(data));
            return true;
        } catch (e) {
            console.error('Error guardando en localStorage:', e);
            return false;
        }
    };

    const cargarDeLocal = (key) => {
        try {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        } catch (e) {
            console.error('Error cargando de localStorage:', e);
            return null;
        }
    };

    // Cargar datos locales (empleados reales del Centro Tehui - SUIR TSS)
    const cargarDatosLocales = () => {
        setLoading(true);
        setTimeout(() => {
            // Intentar cargar de localStorage primero
            const empsLocal = cargarDeLocal(STORAGE_KEYS.empleados);
            const prestsLocal = cargarDeLocal(STORAGE_KEYS.prestamos);
            const licsLocal = cargarDeLocal(STORAGE_KEYS.licencias);
            const nominasLocal = cargarDeLocal(STORAGE_KEYS.nominas);
            const configLocal = cargarDeLocal(STORAGE_KEYS.config);
            const catalogosLocal = cargarDeLocal(STORAGE_KEYS.catalogos);

            // Si hay datos en localStorage, usarlos
            if (empsLocal && empsLocal.length > 0) {
                console.log('Cargando datos de localStorage...');
                setEmpleados(empsLocal);
                setPrestamos(prestsLocal || []);
                setLicencias(licsLocal || []);
                setNominas(nominasLocal || []);
                if (configLocal) setConfig(configLocal);
                if (catalogosLocal) setCatalogos(catalogosLocal);
                setLoading(false);
                console.log('Habilitando persistencia automática...');
                setDatosInicializados(true); // Habilitar guardado automático
                toast('Datos cargados de almacenamiento local', 'success');
                return;
            }

            // Si no hay datos en localStorage, usar los datos por defecto
            const emps = [
                { id: 1, nombre: 'Carreño Leon, Maria De Jesús', tipoDocumento: 'cedula', documento: '881-9021577-1', nss: '19021577-1', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 18000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-05-06', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 2, nombre: 'Castillo Matta, Zeneida', tipoDocumento: 'cedula', documento: '031-0175106-7', nss: '03715559-5', departamento: 'ASISTENTE', cargo: 'Asistente', salarioBase: 6500, tipoRemuneracion: 'Trabajador ocasional (no fijo)', fechaIngreso: '2024-03-06', tipoContrato: 'Temporal', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 3, nombre: 'Fuentes De Garcia, Cary Roxana', tipoDocumento: 'cedula', documento: '881-8396764-2', nss: '18396764-2', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 20000, tipoRemuneracion: 'Normal', fechaIngreso: '2024-03-06', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 4, nombre: 'Garcia Fuentes, Roxana Josefina', tipoDocumento: 'pasaporte', documento: '0104587395', nss: '', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 25000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-08-05', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 5, nombre: 'Hernandez Cabrera, Ramona Altagracia', tipoDocumento: 'cedula', documento: '094-0020547-3', nss: '05699203-1', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 20000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-10-03', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 6, nombre: 'Jimaquen Garcia, Lucelis Beatriz', tipoDocumento: 'cedula', documento: '402-3169217-5', nss: '18621595-0', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 19000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-08-05', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 7, nombre: 'Jimenez Cuevas, Ingrid Ivelisse', tipoDocumento: 'cedula', documento: '224-0007033-4', nss: '05571827-1', departamento: 'ASISTENTE', cargo: 'Asistente', salarioBase: 15000, tipoRemuneracion: 'Asalariado por hora/día/semana', fechaIngreso: '2025-10-29', tipoContrato: 'Por obra', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 8, nombre: 'Jimenez Tavarez, Javier Arturo', tipoDocumento: 'cedula', documento: '031-0243772-4', nss: '03503956-2', departamento: 'MANTENIMIENTO', cargo: 'Mantenimiento', salarioBase: 10000, tipoRemuneracion: 'Trabajador ocasional (no fijo)', fechaIngreso: '2024-03-06', tipoContrato: 'Temporal', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 9, nombre: 'Lucena Villalobos, Yusmary Chiquinquira', tipoDocumento: 'cedula', documento: '881-8217801-7', nss: '18217801-7', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 19000, tipoRemuneracion: 'Normal', fechaIngreso: '2024-03-06', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 10, nombre: 'Medina, Melissa', tipoDocumento: 'cedula', documento: '039-0024840-6', nss: '07527950-2', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 18000, tipoRemuneracion: 'Normal', fechaIngreso: '2024-11-11', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 11, nombre: 'Mencia Mencia, Alba Iris', tipoDocumento: 'cedula', documento: '402-2237446-0', nss: '07683312-7', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 25000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-09-22', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 12, nombre: 'Millan, Diorelys Del Valle', tipoDocumento: 'pasaporte', documento: '54868674', nss: '', departamento: 'ASISTENTE', cargo: 'Asistente', salarioBase: 18000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-10-03', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 13, nombre: 'Nuñez Sosa, Denzel Gabriel', tipoDocumento: 'cedula', documento: '402-1000810-4', nss: '07395851-2', departamento: 'MANTENIMIENTO', cargo: 'Mantenimiento', salarioBase: 11428.47, tipoRemuneracion: 'Asalariado por hora/día/semana', fechaIngreso: '2025-09-02', tipoContrato: 'Por obra', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 14, nombre: 'Paulino Paulino, Gabriela', tipoDocumento: 'cedula', documento: '402-0961340-1', nss: '17867486-3', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2024-03-06', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 15, nombre: 'Peralta Mendoza, Daniela', tipoDocumento: 'cedula', documento: '402-1922127-8', nss: '09098043-1', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2024-03-06', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 16, nombre: 'Perez Ramos, Valerin Mariel', tipoDocumento: 'cedula', documento: '402-2631749-9', nss: '16110843-2', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 18000, tipoRemuneracion: 'Normal', fechaIngreso: '2024-03-06', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 17, nombre: 'Pichardo Quezada, Ana Rosa', tipoDocumento: 'cedula', documento: '031-0343936-4', nss: '03632048-7', departamento: 'ADMINISTRACION', cargo: 'Administrativa', salarioBase: 10000, tipoRemuneracion: 'Trabajador ocasional (no fijo)', fechaIngreso: '2026-01-07', tipoContrato: 'Temporal', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 18, nombre: 'Ramos Santana, Emely Altagracia', tipoDocumento: 'cedula', documento: '402-1546613-3', nss: '17399380-7', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2024-03-06', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 19, nombre: 'Ramos Santana, Yudelca Altagracia', tipoDocumento: 'cedula', documento: '032-0031709-1', nss: '03713540-7', departamento: 'ADMINISTRACION', cargo: 'Administrativa', salarioBase: 25000, tipoRemuneracion: 'Normal', fechaIngreso: '2024-03-06', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 20, nombre: 'Rodriguez Reyes, Daniela Isabel', tipoDocumento: 'cedula', documento: '402-1106253-0', nss: '06687131-1', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2025-10-09', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 21, nombre: 'Rodriguez Rodriguez, Gabriel De Jesus', tipoDocumento: 'cedula', documento: '031-0073915-4', nss: '03657548-3', departamento: 'ADMINISTRACION', cargo: 'Representante', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2024-07-17', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 22, nombre: 'Rosario Vasquez, Luisa Estebania', tipoDocumento: 'cedula', documento: '402-2280604-0', nss: '13781314-0', departamento: 'PSICOLOGIA', cargo: 'Psicóloga', salarioBase: 25000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-11-01', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 23, nombre: 'Sanchez De Colmenares, Flor Maria', tipoDocumento: 'cedula', documento: '881-8543727-7', nss: '18543727-7', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2024-03-06', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 24, nombre: 'Tavarez Felipe, Yubelkys Altagracia', tipoDocumento: 'cedula', documento: '031-0410964-4', nss: '03679280-1', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 25000, tipoRemuneracion: 'Normal', fechaIngreso: '2024-09-23', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 25, nombre: 'Vivas Cuencas, Lisbia Coromoto', tipoDocumento: 'cedula', documento: '881-8270308-0', nss: '18270308-0', departamento: 'DOCENTE', cargo: 'Docente', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2024-10-08', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 26, nombre: 'Jimaquen Cabrera, Mayorka Delfina', tipoDocumento: 'cedula', documento: '031-0408757-6', nss: '03361275-0', departamento: 'ASISTENTE', cargo: 'Asistente', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2024-03-06', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
                { id: 27, nombre: 'Olivares Contreras De Rodriguez, Erika Cristina', tipoDocumento: 'cedula', documento: '031-0306511-0', nss: '03296898-1', departamento: 'ADMINISTRACION', cargo: 'Administrativa', salarioBase: 20000, tipoRemuneracion: 'Normal', fechaIngreso: '2026-01-13', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0 },
            ];
            const prests = [];
            const lics = [];
            setEmpleados(emps);
            setPrestamos(prests);
            setLicencias(lics);
            setLoading(false);
            setDatosInicializados(true); // Habilitar guardado automático
            toast('Sistema cargado correctamente', 'success');
        }, 500);
    };

    // Helpers
    const openModal = name => setModals(m => ({ ...m, [name]: true }));
    const closeModal = name => setModals(m => ({ ...m, [name]: false }));
    const getPrestamosPend = empId => prestamos.filter(p => p.empleadoId === empId && p.activo && p.saldo > 0);

    // Funciones para manejar ausencias
    const abrirModalAusencias = (empId) => {
        setAusenciasEmpId(empId);
        openModal('ausencias');
    };

    const toggleFechaAusencia = (fecha) => {
        if (!ausenciasEmpId) return;
        setNominaEdits(prev => {
            const current = prev[ausenciasEmpId] || {};
            const fechasAus = current.fechasAus || [];
            const existe = fechasAus.includes(fecha);
            const nuevasFechas = existe 
                ? fechasAus.filter(f => f !== fecha) 
                : [...fechasAus, fecha].sort();
            return {
                ...prev,
                [ausenciasEmpId]: {
                    ...current,
                    fechasAus: nuevasFechas,
                    diasAus: nuevasFechas.length
                }
            };
        });
    };

    const getFechasDelPeriodo = () => {
        const { mes, año, tipo, quincena } = periodo;
        const fechas = [];
        const diasEnMes = new Date(año, mes, 0).getDate();
        
        let inicio, fin;
        if (tipo === 'quincenal') {
            inicio = quincena === 1 ? 1 : 16;
            fin = quincena === 1 ? 15 : diasEnMes;
        } else {
            inicio = 1;
            fin = diasEnMes;
        }
        
        for (let d = inicio; d <= fin; d++) {
            const fecha = new Date(año, mes - 1, d);
            const diaSemana = fecha.getDay();
            // Solo días laborables (lunes a viernes)
            if (diaSemana !== 0 && diaSemana !== 6) {
                fechas.push(`${año}-${String(mes).padStart(2,'0')}-${String(d).padStart(2,'0')}`);
            }
        }
        return fechas;
    };

    const formatFechaCorta = (fecha) => {
        const [año, mes, dia] = fecha.split('-');
        const meses = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
        return `${parseInt(dia)} ${meses[parseInt(mes)-1]}`;
    };

    const getDiaSemana = (fecha) => {
        const dias = ['Dom','Lun','Mar','Mié','Jue','Vie','Sáb'];
        return dias[new Date(fecha).getDay()];
    };

    // Guardar automáticamente cuando cambien los datos (solo después de inicialización)
    React.useEffect(() => {
        if (datosInicializados && empleados.length > 0) {
            console.log('Guardando empleados en localStorage:', empleados.length);
            guardarEnLocal(STORAGE_KEYS.empleados, empleados);
        }
    }, [empleados, datosInicializados]);

    React.useEffect(() => {
        if (datosInicializados) {
            console.log('Guardando préstamos en localStorage:', prestamos.length);
            guardarEnLocal(STORAGE_KEYS.prestamos, prestamos);
        }
    }, [prestamos, datosInicializados]);

    React.useEffect(() => {
        if (datosInicializados) {
            console.log('Guardando licencias en localStorage:', licencias.length);
            guardarEnLocal(STORAGE_KEYS.licencias, licencias);
        }
    }, [licencias, datosInicializados]);

    React.useEffect(() => {
        if (datosInicializados && nominas.length > 0) {
            console.log('Guardando nóminas en localStorage:', nominas.length);
            guardarEnLocal(STORAGE_KEYS.nominas, nominas);
        }
    }, [nominas, datosInicializados]);

    React.useEffect(() => {
        if (datosInicializados) {
            console.log('Guardando config en localStorage');
            guardarEnLocal(STORAGE_KEYS.config, config);
        }
    }, [config, datosInicializados]);

    React.useEffect(() => {
        if (datosInicializados) {
            console.log('Guardando catálogos en localStorage');
            guardarEnLocal(STORAGE_KEYS.catalogos, catalogos);
        }
    }, [catalogos, datosInicializados]);

    // Función para restaurar datos por defecto (limpia localStorage)
    const restaurarDatosPorDefecto = () => {
        if (confirm('¿Está seguro de restaurar los datos por defecto? Se perderán todos los cambios guardados localmente.')) {
            Object.values(STORAGE_KEYS).forEach(key => localStorage.removeItem(key));
            window.location.reload();
        }
    };

    const getTotalCuotas = empId => getPrestamosPend(empId).reduce((s, p) => s + p.cuotaMensual, 0);

    // CRUD Empleados
    const guardarEmpleado = async () => {
        if (!empForm.nombre || !empForm.salarioBase) { toast('Complete los campos requeridos', 'error'); return; }
        const data = { ...empForm, salarioBase: parseFloat(empForm.salarioBase), pdss: parseFloat(empForm.pdss) || 0, cooperativa: parseFloat(empForm.cooperativa) || 0, seguroPrivado: parseFloat(empForm.seguroPrivado) || 0, embargo: parseFloat(empForm.embargo) || 0 };
        
        if (editingEmp) {
            const updated = { ...data, id: editingEmp.id, _spId: editingEmp._spId };
            setEmpleados(p => p.map(e => e.id === editingEmp.id ? updated : e));
            if (spConnected) await guardarEmpleadoSP(updated);
            toast('Empleado actualizado', 'success');
        } else {
            const newEmp = { ...data, id: Math.max(...empleados.map(e => e.id), 0) + 1 };
            setEmpleados(p => [...p, newEmp]);
            if (spConnected) await guardarEmpleadoSP(newEmp);
            toast('Empleado agregado', 'success');
        }
        closeModal('empleado');
        setEditingEmp(null);
        setEmpForm(empFormInit);
    };

    const editarEmpleado = emp => { setEditingEmp(emp); setEmpForm({ ...emp }); openModal('empleado'); };
    const eliminarEmpleado = id => { if (confirm('¿Eliminar empleado?')) { setEmpleados(p => p.filter(e => e.id !== id)); toast('Empleado eliminado', 'warning'); } };

    // CRUD Préstamos
    const guardarPrestamo = async () => {
        if (!prestamoForm.empleadoId || !prestamoForm.monto || !prestamoForm.cuotas) { toast('Complete los campos', 'error'); return; }
        const monto = parseFloat(prestamoForm.monto);
        const cuotas = parseInt(prestamoForm.cuotas);
        const nuevoPrestamo = {
            id: Date.now(), empleadoId: parseInt(prestamoForm.empleadoId), monto, cuotas, cuotasPagadas: 0,
            cuotaMensual: round2(monto / cuotas), saldo: monto, desc: prestamoForm.desc || 'Préstamo',
            fecha: prestamoForm.fecha || new Date().toISOString().split('T')[0], activo: true
        };
        setPrestamos(p => [...p, nuevoPrestamo]);
        if (spConnected) await guardarPrestamoSP(nuevoPrestamo);
        toast('Préstamo registrado', 'success');
        closeModal('prestamo');
        setPrestamoForm({ empleadoId: '', monto: '', cuotas: '', desc: '', fecha: '' });
    };

    // CRUD Licencias
    const guardarLicencia = () => {
        if (!licenciaForm.empleadoId || !licenciaForm.fechaInicio) { toast('Complete los campos', 'error'); return; }
        setLicencias(p => [...p, { ...licenciaForm, id: Date.now(), empleadoId: parseInt(licenciaForm.empleadoId) }]);
        toast('Licencia registrada', 'success');
        closeModal('licencia');
        setLicenciaForm({ empleadoId: '', tipo: 'Vacaciones', fechaInicio: '', fechaFin: '', conPago: true, notas: '' });
    };

    // Generar Nómina
    const generarNomina = () => {
        // Verificar si existe una nómina para el mismo período
        const codigoNuevo = `${periodo.año}${periodo.mes.toString().padStart(2,'0')}${periodo.tipo === 'quincenal' ? periodo.quincena : '0'}`;
        const existente = nominas.find(n => {
            const codigoExistente = `${n.periodo.año}${n.periodo.mes.toString().padStart(2,'0')}${n.periodo.tipo === 'quincenal' ? n.periodo.quincena : '0'}`;
            return codigoExistente === codigoNuevo && (n.estado === 'guardada' || n.estado === 'procesada');
        });
        
        if (existente) {
            // Preguntar si quiere editar la existente
            if (window.confirm(`Ya existe una nómina procesada para este período (Código: ${codigoNuevo}).\n\n¿Desea EDITARLA para hacer correcciones?\n\nLos cambios sobrescribirán la nómina anterior.`)) {
                editarNomina(existente);
                return;
            }
            return;
        }
        
        const activos = empleados.filter(e => e.activo);
        if (activos.length === 0) {
            toast('No hay empleados activos para generar la nómina', 'error');
            return;
        }
        
        const divisor = periodo.tipo === 'quincenal' ? 2 : 1;
        const esRegalia = periodo.mes === 12 && (periodo.tipo === 'mensual' || periodo.quincena === 2);
        const edits = {};

        const detalles = activos.map(emp => {
            // IMPORTANTE: Calcular TSS sobre salario MENSUAL completo (para aplicar topes correctamente)
            const tssMensual = calcularTSS(emp.salarioBase, config);
            
            // Calcular ISR sobre salario anual completo (considerando dependientes)
            const salNetoAnual = (emp.salarioBase - tssMensual.afpEmp - tssMensual.sfsEmp) * 12;
            const isrMensual = calcularISR(salNetoAnual, config);
            
            // Ahora dividir TODO por el divisor (quincenal = 2, mensual = 1)
            const salBase = emp.salarioBase / divisor;
            const afpEmp = round2(tssMensual.afpEmp / divisor);
            const sfsEmp = round2(tssMensual.sfsEmp / divisor);
            const isr = round2(isrMensual / divisor);
            const afpPat = round2(tssMensual.afpPat / divisor);
            const sfsPat = round2(tssMensual.sfsPat / divisor);
            const infotep = round2(tssMensual.infotep / divisor);
            const riesgo = round2(tssMensual.riesgo / divisor);
            
            // Otras deducciones fijas también divididas
            // PDSS = Dependientes adicionales SFS × Valor Per Cápita mensual / divisor
            const pdss = round2(((emp.dependientesSFS || 0) * (config.tss.pdssPerCapita || 1100)) / divisor);
            const cooperativa = (emp.cooperativa || 0) / divisor;
            const seguroPrivado = (emp.seguroPrivado || 0) / divisor;
            const embargo = (emp.embargo || 0) / divisor;
            const cuotaPrestamo = getTotalCuotas(emp.id) / divisor;

            // Calcular regalía si es diciembre (solo en 2da quincena o mensual)
            const regalia = esRegalia ? calcularRegalia(emp.salarioBase, 12) : 0;

            edits[emp.id] = { diasAus: 0, fechasAus: [], minTard: 0, horas35: 0, horas100: 0, bonificacion: 0, comisiones: 0, incentivos: 0, viaticos: 0, otrosIng: 0, otrasDed: 0 };

            const totalIng = salBase + regalia;
            const totalDed = afpEmp + sfsEmp + isr + pdss + cuotaPrestamo + cooperativa + seguroPrivado + embargo;

            return {
                empId: emp.id, nombre: emp.nombre, depto: emp.departamento, cargo: emp.cargo,
                salarioBase: salBase, horasExtra: 0, bonificacion: 0, comisiones: 0, incentivos: 0, viaticos: 0, vacaciones: 0, regalia, otrosIng: 0, totalIng,
                diasAus: 0, fechasAus: [], descAusencias: 0, minTard: 0, descTardanzas: 0,
                afpEmp, sfsEmp, isr, pdss, cuotaPrestamo, cooperativa, seguroPrivado, embargo, otrasDed: 0, totalDed,
                neto: round2(totalIng - totalDed),
                afpPat, sfsPat, infotep, riesgo
            };
        });

        setNominaEdits(edits);
        setCurrentNomina({ id: Date.now(), codigo: codigoNuevo, periodo: { ...periodo }, fecha: new Date().toISOString(), detalles, estado: 'borrador' });
        toast(`Nómina ${codigoNuevo} generada - Ajuste valores antes de guardar`, 'success');
        setView('nomina');
    };

    // Recalcular nómina
    const recalcularDetalle = empId => {
        if (!currentNomina || !nominaEdits[empId]) return null;
        const emp = empleados.find(e => e.id === empId);
        const ed = nominaEdits[empId];
        const divisor = currentNomina.periodo.tipo === 'quincenal' ? 2 : 1;
        const esRegalia = currentNomina.periodo.mes === 12 && (currentNomina.periodo.tipo === 'mensual' || currentNomina.periodo.quincena === 2);

        const salBase = emp.salarioBase / divisor;
        const salDiario = calcularSalarioDiario(emp.salarioBase, config);
        const salHora = calcularSalarioHora(emp.salarioBase, config);

        // Descuentos por ausencias y tardanzas (proporcionales al período)
        const descAusencias = round2(salDiario * (ed.diasAus || 0) / divisor);
        const descTardanzas = round2((salHora * (ed.minTard || 0) / 60) / divisor);
        const horasExtra = calcularHorasExtras(emp.salarioBase, ed.horas35 || 0, ed.horas100 || 0, config).total / divisor;
        const bonificacion = parseFloat(ed.bonificacion) || 0;
        const comisiones = parseFloat(ed.comisiones) || 0;
        const incentivos = parseFloat(ed.incentivos) || 0;
        const viaticos = parseFloat(ed.viaticos) || 0;
        const otrosIng = parseFloat(ed.otrosIng) || 0;
        const otrasDed = parseFloat(ed.otrasDed) || 0;
        const regalia = esRegalia ? calcularRegalia(emp.salarioBase, 12) : 0;

        // Deducciones fijas divididas por período
        // PDSS = Dependientes adicionales SFS × Valor Per Cápita mensual / divisor
        const pdss = round2(((emp.dependientesSFS || 0) * (config.tss.pdssPerCapita || 1100)) / divisor);
        const cooperativa = (emp.cooperativa || 0) / divisor;
        const seguroPrivado = (emp.seguroPrivado || 0) / divisor;
        const embargo = (emp.embargo || 0) / divisor;
        const cuotaPrestamo = getTotalCuotas(emp.id) / divisor;

        // IMPORTANTE: Calcular TSS sobre salario MENSUAL equivalente (para aplicar topes correctamente)
        // Reconstruir salario mensual considerando ausencias
        const salMensualParaTSS = Math.max(0, emp.salarioBase - (descAusencias * divisor));
        const tssMensual = calcularTSS(salMensualParaTSS, config);
        
        // Calcular ISR sobre salario anual (considerando dependientes)
        const salNetoAnual = (salMensualParaTSS - tssMensual.afpEmp - tssMensual.sfsEmp) * 12;
        const isrMensual = calcularISR(salNetoAnual, config);
        
        // Dividir TSS e ISR por el divisor
        const afpEmp = round2(tssMensual.afpEmp / divisor);
        const sfsEmp = round2(tssMensual.sfsEmp / divisor);
        const isr = round2(isrMensual / divisor);
        const afpPat = round2(tssMensual.afpPat / divisor);
        const sfsPat = round2(tssMensual.sfsPat / divisor);
        const infotep = round2(tssMensual.infotep / divisor);
        const riesgo = round2(tssMensual.riesgo / divisor);

        const totalIng = salBase + horasExtra + bonificacion + comisiones + incentivos + viaticos + regalia + otrosIng;
        const totalDed = afpEmp + sfsEmp + isr + pdss + descAusencias + descTardanzas + cuotaPrestamo + cooperativa + seguroPrivado + embargo + otrasDed;

        return {
            empId: emp.id, nombre: emp.nombre, depto: emp.departamento, cargo: emp.cargo,
            salarioBase: salBase, horasExtra, bonificacion, comisiones, incentivos, viaticos, vacaciones: 0, regalia, otrosIng, totalIng,
            diasAus: ed.diasAus || 0, fechasAus: ed.fechasAus || [], descAusencias, minTard: ed.minTard || 0, descTardanzas,
            afpEmp, sfsEmp, isr, pdss, cuotaPrestamo, cooperativa, seguroPrivado, embargo, otrasDed, totalDed,
            neto: round2(totalIng - totalDed),
            afpPat, sfsPat, infotep, riesgo
        };
    };

    const getDetallesRecalc = () => currentNomina ? currentNomina.detalles.map(d => recalcularDetalle(d.empId) || d) : [];
    const updateEdit = (empId, field, val) => setNominaEdits(p => ({ ...p, [empId]: { ...p[empId], [field]: val } }));

    // Guardar nómina como borrador (sin procesar)
    const guardarBorrador = () => {
        const detalles = getDetallesRecalc();
        const nominaActualizada = { ...currentNomina, detalles };
        setCurrentNomina(nominaActualizada);
        toast('Cambios guardados en borrador', 'info');
    };

    // Procesar/Cerrar nómina (finalizar)
    const procesarNomina = async () => {
        const esEdicion = currentNomina.editandoExistente;
        const mensajeConfirm = esEdicion 
            ? '¿Está seguro de GUARDAR los cambios?\n\nLos cambios sobrescribirán la nómina anterior.'
            : '¿Está seguro de PROCESAR esta nómina?\n\nUna vez procesada:\n• Se actualizarán los saldos de préstamos\n• Quedará guardada en el historial\n• Podrá editarla posteriormente si necesita corregir algo';
        
        if (!window.confirm(mensajeConfirm)) {
            return;
        }
        
        const detalles = getDetallesRecalc();
        const codigo = currentNomina.codigo || `${currentNomina.periodo.año}${currentNomina.periodo.mes.toString().padStart(2,'0')}${currentNomina.periodo.tipo === 'quincenal' ? currentNomina.periodo.quincena : '0'}`;
        
        // Limpiar flags de edición antes de guardar
        const nominaFinal = { 
            ...currentNomina, 
            codigo, 
            detalles, 
            estado: 'procesada', 
            fechaProceso: new Date().toISOString(),
            editandoExistente: undefined,
            idOriginal: undefined,
            fechaModificacion: esEdicion ? new Date().toISOString() : undefined
        };
        delete nominaFinal.editandoExistente;
        delete nominaFinal.idOriginal;

        // Actualizar préstamos SOLO si es una nómina nueva (no si es edición)
        const prestamosActualizados = [];
        if (!esEdicion) {
            detalles.forEach(d => {
                if (d.cuotaPrestamo > 0) {
                    setPrestamos(p => p.map(pr => {
                        if (pr.empleadoId === d.empId && pr.activo && pr.saldo > 0) {
                            const desc = pr.cuotaMensual / (currentNomina.periodo.tipo === 'quincenal' ? 2 : 1);
                            const nuevoSaldo = Math.max(0, pr.saldo - desc);
                            const actualizado = { ...pr, saldo: nuevoSaldo, cuotasPagadas: pr.cuotasPagadas + (currentNomina.periodo.tipo === 'quincenal' ? 0.5 : 1), activo: nuevoSaldo > 0 };
                            prestamosActualizados.push(actualizado);
                            return actualizado;
                        }
                        return pr;
                    }));
                }
            });
        }

        // Si es edición, sobrescribir; si es nueva, agregar
        if (esEdicion) {
            const idOriginal = currentNomina.idOriginal || currentNomina.id;
            setNominas(p => p.map(n => n.id === idOriginal ? { ...nominaFinal, id: idOriginal } : n));
        } else {
            setNominas(p => [...p, nominaFinal]);
        }
        
        setCurrentNomina(nominaFinal);
        
        // Sincronizar con SharePoint
        if (spConnected) {
            await guardarNominaSP(nominaFinal);
            for (const p of prestamosActualizados) {
                await guardarPrestamoSP(p);
            }
        }
        
        toast(`Nómina ${codigo} ${esEdicion ? 'actualizada' : 'procesada'} correctamente`, 'success');
    };
    
    // Editar nómina existente (cargar como borrador para modificar)
    const editarNomina = (nomina) => {
        // Reconstruir los edits desde los detalles de la nómina
        const edits = {};
        nomina.detalles.forEach(det => {
            edits[det.empId] = {
                diasAus: det.diasAus || 0,
                fechasAus: det.fechasAus || [],
                minTard: det.minTard || 0,
                horas35: 0, // Las horas extras se recalculan
                horas100: 0,
                bonificacion: det.bonificacion || 0,
                comisiones: det.comisiones || 0,
                incentivos: det.incentivos || 0,
                viaticos: det.viaticos || 0,
                otrosIng: det.otrosIng || 0,
                otrasDed: det.otrasDed || 0
            };
        });
        
        // Cargar la nómina como borrador
        const nominaBorrador = {
            ...nomina,
            estado: 'borrador',
            editandoExistente: true, // Flag para saber que estamos editando
            idOriginal: nomina.id // Guardar ID original para sobrescribir
        };
        
        setNominaEdits(edits);
        setPeriodo(nomina.periodo);
        setCurrentNomina(nominaBorrador);
        setActiveTab('nomina');
        
        toast(`Editando nómina ${nomina.codigo} - Haga los cambios y presione "Procesar Nómina" para guardar`, 'info');
    };
    
    // Anular nómina (solo para casos especiales)
    const anularNomina = async (nomina) => {
        const motivo = window.prompt('Ingrese el motivo de anulación:');
        if (!motivo) return;
        
        if (!window.confirm(`¿Está seguro de ANULAR la nómina ${nomina.codigo}?\n\nNOTA: Normalmente es mejor EDITAR la nómina.\nAnular solo si necesita eliminarla completamente del historial.`)) {
            return;
        }
        
        const nominaAnulada = { 
            ...nomina, 
            estado: 'anulada', 
            fechaAnulacion: new Date().toISOString(),
            motivoAnulacion: motivo 
        };
        
        setNominas(p => p.map(n => n.id === nomina.id ? nominaAnulada : n));
        
        // Sincronizar con SharePoint
        if (spConnected) {
            await guardarNominaSP(nominaAnulada);
        }
        
        toast(`Nómina ${nomina.codigo} anulada.`, 'warning');
    };
    
    // Función legacy para compatibilidad
    const guardarNomina = procesarNomina;

    // Liquidación
    const calcularLiquidacionEmp = (emp, motivo = 'despido') => {
        const liq = calcularLiquidacion(emp, config, motivo);
        setLiquidacionData({ emp, motivo, ...liq });
        openModal('liquidacion');
    };

    // Exportar Excel (simulado)
    const exportarExcel = () => {
        toast('Exportando a Excel...', 'info');
        // En producción: usar SheetJS o similar
        setTimeout(() => toast('Archivo generado: nomina_' + new Date().toISOString().slice(0,10) + '.xlsx', 'success'), 1000);
    };

    // Filtros
    const empsFiltrados = useMemo(() => empleados.filter(e => {
        const matchSearch = e.nombre.toLowerCase().includes(searchTerm.toLowerCase()) || e.documento?.includes(searchTerm) || e.nss?.includes(searchTerm);
        const matchDept = filterDept === 'TODOS' || e.departamento === filterDept;
        return matchSearch && matchDept;
    }), [empleados, searchTerm, filterDept]);

    const stats = useMemo(() => {
        const activos = empleados.filter(e => e.activo);
        return {
            totalEmps: activos.length,
            totalNomina: activos.reduce((s, e) => s + e.salarioBase, 0),
            totalPrestamos: prestamos.filter(p => p.activo).reduce((s, p) => s + p.saldo, 0),
            prestamosActivos: prestamos.filter(p => p.activo && p.saldo > 0).length,
            licenciasActivas: licencias.filter(l => new Date(l.fechaFin) >= new Date()).length
        };
    }, [empleados, prestamos, licencias]);

    const nominaPorDepto = useMemo(() => {
        const dets = getDetallesRecalc();
        return dets.reduce((acc, d) => { if (!acc[d.depto]) acc[d.depto] = []; acc[d.depto].push(d); return acc; }, {});
    }, [currentNomina, nominaEdits, config]);

    const totalesNomina = useMemo(() => {
        const dets = getDetallesRecalc();
        if (!dets.length) return null;
        return dets.reduce((a, d) => ({
            totalIng: a.totalIng + d.totalIng, totalDed: a.totalDed + d.totalDed, totalNeto: a.totalNeto + d.neto,
            totalAfpEmp: a.totalAfpEmp + d.afpEmp, totalSfsEmp: a.totalSfsEmp + d.sfsEmp, totalIsr: a.totalIsr + d.isr,
            totalAfpPat: a.totalAfpPat + d.afpPat, totalSfsPat: a.totalSfsPat + d.sfsPat,
            totalInfotep: a.totalInfotep + d.infotep, totalRiesgo: a.totalRiesgo + d.riesgo
        }), { totalIng: 0, totalDed: 0, totalNeto: 0, totalAfpEmp: 0, totalSfsEmp: 0, totalIsr: 0, totalAfpPat: 0, totalSfsPat: 0, totalInfotep: 0, totalRiesgo: 0 });
    }, [currentNomina, nominaEdits, config]);

    const volantesData = useMemo(() => {
        if (!currentNomina) return [];
        const dets = getDetallesRecalc();
        if (selectedVolante) {
            const d = dets.find(x => x.empId === selectedVolante);
            const e = empleados.find(x => x.id === selectedVolante);
            return d && e ? [{ emp: e, det: d }] : [];
        }
        return dets.map(d => ({ emp: empleados.find(e => e.id === d.empId), det: d })).filter(x => x.emp);
    }, [currentNomina, selectedVolante, nominaEdits, empleados]);

    // =========================================
    // RENDER VISTAS
    // =========================================
    const renderDashboard = () => (
        <>
            {/* Panel de conexión SharePoint */}
            {!spConnected && (
                <div className="card" style={{marginBottom:'16px', background:'linear-gradient(135deg, #0078d4 0%, #00bcf2 100%)', color:'white', border:'none'}}>
                    <div className="card-body" style={{display:'flex', alignItems:'center', justifyContent:'space-between', padding:'16px 20px'}}>
                        <div>
                            <h3 style={{fontSize:'14px', fontWeight:'700', marginBottom:'4px', display:'flex', alignItems:'center', gap:'8px'}}>
                                <Icons.Cloud /> Conectar con SharePoint
                            </h3>
                            <p style={{fontSize:'11px', opacity:0.9}}>
                                Sincroniza tus datos con Microsoft 365 para acceso desde cualquier dispositivo y respaldo automático.
                            </p>
                        </div>
                        <button className="btn" style={{background:'white', color:'#0078d4', fontWeight:'700'}} onClick={handleLogin}>
                            <Icons.LogIn /> Conectar ahora
                        </button>
                    </div>
                </div>
            )}
            
            {/* Alert de conexión exitosa */}
            {spConnected && syncStatus.lastSync && (
                <div className="alert alert-success" style={{marginBottom:'16px'}}>
                    <Icons.Cloud />
                    <span>
                        <strong>Conectado a SharePoint</strong> - Los datos se guardarán automáticamente en tu sitio de Microsoft 365.
                        {syncStatus.lastSync && ` Última sincronización: ${syncStatus.lastSync.toLocaleTimeString()}`}
                    </span>
                </div>
            )}
            
            <div className="stats">
                <div className="stat"><div className="stat-header"><span className="stat-label">Empleados</span><div className="stat-icon green"><Icons.Users /></div></div><div className="stat-value">{stats.totalEmps}</div><div className="stat-sub">Activos</div></div>
                <div className="stat"><div className="stat-header"><span className="stat-label">Nómina Mensual</span><div className="stat-icon blue"><Icons.Dollar /></div></div><div className="stat-value" style={{fontSize:'15px'}}>RD$ {formatMoney(stats.totalNomina)}</div><div className="stat-sub">Salarios base</div></div>
                <div className="stat"><div className="stat-header"><span className="stat-label">Préstamos</span><div className="stat-icon purple"><Icons.CreditCard /></div></div><div className="stat-value">{stats.prestamosActivos}</div><div className="stat-sub">RD$ {formatMoney(stats.totalPrestamos)}</div></div>
                <div className="stat"><div className="stat-header"><span className="stat-label">Licencias</span><div className="stat-icon orange"><Icons.Calendar /></div></div><div className="stat-value">{stats.licenciasActivas}</div><div className="stat-sub">Activas</div></div>
                <div className="stat"><div className="stat-header"><span className="stat-label">AFP Emp.</span><div className="stat-icon yellow"><Icons.FileText /></div></div><div className="stat-value">{config.tss.afpEmpleado}%</div><div className="stat-sub">Tasa vigente</div></div>
                <div className="stat"><div className="stat-header"><span className="stat-label">SFS Emp.</span><div className="stat-icon red"><Icons.FileText /></div></div><div className="stat-value">{config.tss.sfsEmpleado}%</div><div className="stat-sub">Tasa vigente</div></div>
            </div>

            <div style={{display:'grid', gridTemplateColumns:'2fr 1fr', gap:'16px'}}>
                <div className="card">
                    <div className="card-header"><span className="card-title"><Icons.Calendar /> Generar Nómina</span></div>
                    <div className="card-body">
                        {!(
                            <div className="alert alert-warning" style={{marginBottom:'12px'}}>
                                <Icons.AlertCircle /><span><strong>Modo Consulta:</strong> Solo puede ver información. Contacte al administrador para generar nóminas.</span>
                            </div>
                        )}
                        <div className="alert alert-info"><Icons.Info /><span>La nómina se genera como borrador. Puede ajustar ausencias, tardanzas, horas extras y otros conceptos antes de guardar.</span></div>
                        <div className="form-row" style={{flexWrap:'wrap', gap:'12px', marginBottom:'12px'}}>
                            <div className="form-group"><label className="form-label">Tipo</label><select className="form-control" style={{width:'110px'}} value={periodo.tipo} onChange={e => setPeriodo(p => ({...p, tipo: e.target.value}))} disabled={!esAdmin}><option value="quincenal">Quincenal</option><option value="mensual">Mensual</option></select></div>
                            <div className="form-group"><label className="form-label">Mes</label><select className="form-control" style={{width:'110px'}} value={periodo.mes} onChange={e => setPeriodo(p => ({...p, mes: +e.target.value}))} disabled={!esAdmin}>{MESES.slice(1).map((m,i) => <option key={i} value={i+1}>{m}</option>)}</select></div>
                            <div className="form-group"><label className="form-label">Año</label><select className="form-control" style={{width:'80px'}} value={periodo.año} onChange={e => setPeriodo(p => ({...p, año: +e.target.value}))} disabled={!esAdmin}><option>2024</option><option>2025</option><option>2026</option></select></div>
                            {periodo.tipo === 'quincenal' && <div className="form-group"><label className="form-label">Quincena</label><select className="form-control" style={{width:'120px'}} value={periodo.quincena} onChange={e => setPeriodo(p => ({...p, quincena: +e.target.value}))} disabled={!esAdmin}><option value="1">1ra (1-15)</option><option value="2">2da (16-31)</option></select></div>}
                        </div>
                        {periodo.mes === 12 && <div className="alert alert-success"><Icons.Gift /><span><strong>Regalía Pascual:</strong> Se incluirá automáticamente en la {periodo.tipo === 'quincenal' ? '2da quincena' : 'nómina'} de diciembre.</span></div>}
                        <button className="btn btn-primary" style={{width:'100%'}} onClick={generarNomina} disabled={!esAdmin}><Icons.FileText /> Generar Nómina</button>
                    </div>
                </div>

                <div className="card">
                    <div className="card-header"><span className="card-title"><Icons.Activity /> Accesos Rápidos</span></div>
                    <div className="card-body" style={{display:'grid', gap:'8px'}}>
                        {esAdmin ? (
                            <>
                                <button className="btn btn-secondary" onClick={() => { setEmpForm(empFormInit); setEditingEmp(null); openModal('empleado'); }}><Icons.Plus /> Nuevo Empleado</button>
                                <button className="btn btn-purple" onClick={() => openModal('prestamo')}><Icons.CreditCard /> Registrar Préstamo</button>
                                <button className="btn btn-info" onClick={() => openModal('licencia')}><Icons.Calendar /> Nueva Licencia</button>
                                <button className="btn btn-orange" onClick={() => setView('config')}><Icons.Settings /> Configuración TSS</button>
                            </>
                        ) : (
                            <>
                                <button className="btn btn-secondary" onClick={() => setView('empleados')}><Icons.Users /> Ver Empleados</button>
                                <button className="btn btn-purple" onClick={() => setView('prestamos')}><Icons.CreditCard /> Ver Préstamos</button>
                                <button className="btn btn-info" onClick={() => setView('historial')}><Icons.FileText /> Ver Historial</button>
                            </>
                        )}
                    </div>
                </div>
            </div>
        </>
    );

    const renderEmpleados = () => (
        <div className="card">
            <div className="card-header"><span className="card-title"><Icons.Users /> Empleados ({empsFiltrados.length})</span>{<button className="btn btn-primary" onClick={() => { setEmpForm(empFormInit); setEditingEmp(null); openModal('empleado'); }}><Icons.Plus /> Nuevo</button>}</div>
            <div className="card-body">
                <div className="search-wrap"><Icons.Search className="search-icon" /><input className="search-input" placeholder="Buscar por nombre o documento..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} /></div>
                <div className="filters"><span className={`filter ${filterDept === 'TODOS' ? 'active' : ''}`} onClick={() => setFilterDept('TODOS')}>Todos</span>{DEPARTAMENTOS.slice(0,7).map(d => <span key={d} className={`filter ${filterDept === d ? 'active' : ''}`} onClick={() => setFilterDept(d)}>{d}</span>)}</div>
                <div className="table-wrap">
                    <table>
                        <thead><tr><th>Empleado</th><th>Documento</th><th>NSS</th><th>Departamento</th><th>Salario</th><th>Tipo Rem.</th><th>Estado</th><th>Acciones</th></tr></thead>
                        <tbody>
                            {empsFiltrados.map(e => {
                                const prest = getPrestamosPend(e.id).reduce((s,p) => s + p.saldo, 0);
                                return (
                                    <tr key={e.id}>
                                        <td><div className="emp-cell"><div className="emp-avatar">{getInitials(e.nombre)}</div><div><div className="emp-name">{e.nombre}</div><div className="emp-sub">{e.cargo || e.departamento}</div></div></div></td>
                                        <td style={{fontFamily:'JetBrains Mono', fontSize:'10px'}}><span className="badge badge-secondary" style={{fontSize:'8px', marginRight:'4px'}}>{e.tipoDocumento === 'pasaporte' ? 'PAS' : 'CED'}</span>{e.documento}</td>
                                        <td style={{fontFamily:'JetBrains Mono', fontSize:'10px'}}>{e.nss || '-'}</td>
                                        <td><span className="badge badge-info">{e.departamento}</span></td>
                                        <td className="money">RD$ {formatMoney(e.salarioBase)}</td>
                                        <td><span className={`badge ${e.tipoRemuneracion === 'Normal' ? 'badge-success' : 'badge-warning'}`} style={{fontSize:'8px'}}>{e.tipoRemuneracion === 'Normal' ? 'Normal' : e.tipoRemuneracion === 'Trabajador ocasional (no fijo)' ? 'Ocasional' : 'Por hora'}</span></td>
                                        <td><span className={`badge ${e.activo ? 'badge-success' : 'badge-danger'}`}>{e.activo ? 'Activo' : 'Inactivo'}</span></td>
                                        <td>
                                            <div className="actions">
                                                {<button className="action-btn" title="Editar" onClick={() => editarEmpleado(e)}><Icons.Edit /></button>}
                                                {<button className="action-btn" title="Liquidar" onClick={() => calcularLiquidacionEmp(e)}><Icons.UserMinus /></button>}
                                                <button className="action-btn" title="Constancia" onClick={() => { setSelectedEmp(e); openModal('constancia'); }}><Icons.FileText /></button>
                                                {<button className="action-btn danger" title="Eliminar" onClick={() => eliminarEmpleado(e.id)}><Icons.Trash /></button>}
                                            </div>
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    );

    const renderNomina = () => {
        if (!currentNomina) return (
            <div className="card"><div className="card-body"><div className="empty"><Icons.FileText /><h3>No hay nómina generada</h3><p>Genere una desde el Dashboard</p><button className="btn btn-primary" style={{marginTop:'12px'}} onClick={() => setView('dashboard')}>Ir al Dashboard</button></div></div></div>
        );

        const periodoTxt = currentNomina.periodo.tipo === 'quincenal' ? `Q${currentNomina.periodo.quincena} ${MESES[currentNomina.periodo.mes]} ${currentNomina.periodo.año}` : `${MESES[currentNomina.periodo.mes]} ${currentNomina.periodo.año}`;
        const esBorrador = currentNomina.estado === 'borrador';
        const esProcesada = currentNomina.estado === 'procesada' || currentNomina.estado === 'guardada';
        const esAnulada = currentNomina.estado === 'anulada';
        const codigo = currentNomina.codigo || 'Sin código';

        return (
            <div className="card">
                <div className="card-header">
                    <span className="card-title">
                        <Icons.FileText /> Nómina: {periodoTxt} 
                        <span className="badge badge-info" style={{marginLeft:'8px', fontFamily:'JetBrains Mono'}}>{codigo}</span>
                        {esBorrador && <span className="badge badge-warning" style={{marginLeft:'6px'}}>Borrador</span>}
                        {esProcesada && <span className="badge badge-success" style={{marginLeft:'6px'}}>Procesada</span>}
                        {esAnulada && <span className="badge badge-danger" style={{marginLeft:'6px'}}>Anulada</span>}
                    </span>
                    <div className="btn-group">
                        {esBorrador && (
                            <>
                                <button className="btn btn-secondary" onClick={guardarBorrador}><Icons.Save /> Guardar Borrador</button>
                                <button className="btn btn-success" onClick={procesarNomina}><Icons.Check /> Procesar Nómina</button>
                            </>
                        )}
                        {esProcesada && (
                            <>
                                {<button className="btn btn-warning" onClick={() => editarNomina(currentNomina)}><Icons.Edit /> Editar</button>}
                                <button className="btn btn-info" onClick={() => window.print()}><Icons.Printer /> Imprimir</button>
                                <button className="btn btn-purple" onClick={() => { setSelectedVolante(null); openModal('volantes'); }}><Icons.Receipt /> Volantes</button>
                                <button className="btn btn-secondary" onClick={exportarExcel}><Icons.Download /> Excel</button>
                                {<button className="btn btn-danger" onClick={() => anularNomina(currentNomina)}><Icons.X /> Anular</button>}
                            </>
                        )}
                        {esAnulada && (
                            <button className="btn btn-primary" onClick={() => setView('dashboard')}><Icons.Plus /> Crear Nueva</button>
                        )}
                    </div>
                </div>
                <div className="card-body">
                    {esBorrador && <div className="alert alert-warning"><Icons.AlertCircle /><span><strong>Nómina en Borrador:</strong> Ajuste ausencias, tardanzas, horas extras y deducciones. Luego presione "Procesar Nómina" para finalizar.</span></div>}
                    {esAnulada && <div className="alert alert-danger"><Icons.AlertCircle /><span><strong>Nómina Anulada:</strong> {currentNomina.motivoAnulacion || 'Sin motivo especificado'}. Puede crear una nueva nómina para este período desde el Dashboard.</span></div>}
                    
                    <div className="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th className="sticky-col">Empleado</th>
                                    <th>Salario</th>
                                    {esBorrador && <><th>Aus.</th><th>Tard.</th><th>H.35%</th><th>H.100%</th><th>Bonif.</th></>}
                                    <th>AFP</th>
                                    <th>SFS</th>
                                    <th>ISR</th>
                                    <th>Préstamo</th>
                                    <th>Otras</th>
                                    <th>Total Ded.</th>
                                    <th>Neto</th>
                                    {esProcesada && <th></th>}
                                </tr>
                            </thead>
                            <tbody>
                                {Object.entries(nominaPorDepto).map(([depto, dets]) => (
                                    <React.Fragment key={depto}>
                                        {dets.map(d => (
                                            <tr key={d.empId}>
                                                <td className="sticky-col"><div className="emp-cell"><div className="emp-avatar" style={{width:24,height:24,fontSize:9}}>{getInitials(d.nombre)}</div><div><div className="emp-name" style={{fontSize:10}}>{d.nombre}</div><span className="badge badge-secondary" style={{fontSize:8}}>{d.depto}</span></div></div></td>
                                                <td className="money">{formatMoney(d.salarioBase)}</td>
                                                {esBorrador && <>
                                                    <td>
                                                        <button 
                                                            className="btn btn-xs" 
                                                            style={{
                                                                minWidth:'45px', 
                                                                padding:'2px 6px',
                                                                background: (nominaEdits[d.empId]?.diasAus || 0) > 0 ? '#dc3545' : '#6c757d',
                                                                color: 'white',
                                                                border: 'none'
                                                            }} 
                                                            onClick={() => abrirModalAusencias(d.empId)}
                                                            title={nominaEdits[d.empId]?.fechasAus?.length > 0 ? nominaEdits[d.empId].fechasAus.map(f => formatFechaCorta(f)).join(', ') : 'Click para registrar ausencias'}
                                                        >
                                                            {nominaEdits[d.empId]?.diasAus || 0}
                                                        </button>
                                                    </td>
                                                    <td><input className="inline-input" type="number" min="0" style={{width:'45px'}} value={nominaEdits[d.empId]?.minTard || ''} onChange={e => updateEdit(d.empId, 'minTard', e.target.value)} placeholder="min" /></td>
                                                    <td><input className="inline-input" type="number" min="0" value={nominaEdits[d.empId]?.horas35 || ''} onChange={e => updateEdit(d.empId, 'horas35', e.target.value)} placeholder="0" /></td>
                                                    <td><input className="inline-input" type="number" min="0" value={nominaEdits[d.empId]?.horas100 || ''} onChange={e => updateEdit(d.empId, 'horas100', e.target.value)} placeholder="0" /></td>
                                                    <td><input className="inline-input" type="number" min="0" value={nominaEdits[d.empId]?.bonificacion || ''} onChange={e => updateEdit(d.empId, 'bonificacion', e.target.value)} placeholder="0" /></td>
                                                </>}
                                                <td className="money">{formatMoney(d.afpEmp)}</td>
                                                <td className="money">{formatMoney(d.sfsEmp)}</td>
                                                <td className="money">{d.isr > 0 ? formatMoney(d.isr) : '-'}</td>
                                                <td className="money">{d.cuotaPrestamo > 0 ? formatMoney(d.cuotaPrestamo) : '-'}</td>
                                                <td className="money">{(d.cooperativa + d.seguroPrivado + d.embargo + d.descAusencias + d.descTardanzas) > 0 ? formatMoney(d.cooperativa + d.seguroPrivado + d.embargo + d.descAusencias + d.descTardanzas) : '-'}</td>
                                                <td className="money neg">{formatMoney(d.totalDed)}</td>
                                                <td className="money pos" style={{fontWeight:700}}>{formatMoney(d.neto)}</td>
                                                {esProcesada && <td><button className="btn btn-xs btn-secondary" onClick={() => { setSelectedVolante(d.empId); openModal('volantes'); }}><Icons.Eye /></button></td>}
                                            </tr>
                                        ))}
                                        <tr className="dept-row">
                                            <td className="sticky-col"><strong>TOTAL {depto}</strong></td>
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.salarioBase,0))}</td>
                                            {esBorrador && <td colSpan="5"></td>}
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.afpEmp,0))}</td>
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.sfsEmp,0))}</td>
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.isr,0))}</td>
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.cuotaPrestamo,0))}</td>
                                            <td></td>
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.totalDed,0))}</td>
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.neto,0))}</td>
                                            {esProcesada && <td></td>}
                                        </tr>
                                    </React.Fragment>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {totalesNomina && (
                        <div className="summary-grid">
                            <div className="summary-box">
                                <div className="summary-title">Resumen Nómina</div>
                                <div className="summary-row"><span>Total Ingresos</span><span>RD$ {formatMoney(totalesNomina.totalIng)}</span></div>
                                <div className="summary-row"><span>TSS Empleado</span><span>RD$ {formatMoney(totalesNomina.totalAfpEmp + totalesNomina.totalSfsEmp)}</span></div>
                                <div className="summary-row"><span>ISR</span><span>RD$ {formatMoney(totalesNomina.totalIsr)}</span></div>
                                <div className="summary-row"><span>Total Deducciones</span><span style={{color:'var(--danger)'}}>RD$ {formatMoney(totalesNomina.totalDed)}</span></div>
                                <div className="summary-row"><span>NETO A PAGAR</span><span style={{color:'var(--success)'}}>RD$ {formatMoney(totalesNomina.totalNeto)}</span></div>
                            </div>
                            <div className="summary-box">
                                <div className="summary-title">Aportes Patronales</div>
                                <div className="summary-row"><span>AFP ({config.tss.afpEmpleador}%)</span><span>RD$ {formatMoney(totalesNomina.totalAfpPat)}</span></div>
                                <div className="summary-row"><span>SFS ({config.tss.sfsEmpleador}%)</span><span>RD$ {formatMoney(totalesNomina.totalSfsPat)}</span></div>
                                <div className="summary-row"><span>INFOTEP ({config.tss.infotep}%)</span><span>RD$ {formatMoney(totalesNomina.totalInfotep)}</span></div>
                                <div className="summary-row"><span>Riesgo Laboral ({config.tss.riesgoLaboral}%)</span><span>RD$ {formatMoney(totalesNomina.totalRiesgo)}</span></div>
                                <div className="summary-row"><span>TOTAL APORTES</span><span style={{color:'var(--primary)'}}>RD$ {formatMoney(totalesNomina.totalAfpPat + totalesNomina.totalSfsPat + totalesNomina.totalInfotep + totalesNomina.totalRiesgo)}</span></div>
                            </div>
                            <div className="summary-box">
                                <div className="summary-title">TSS Consolidado (DGII)</div>
                                <div className="summary-row"><span>AFP Total</span><span>RD$ {formatMoney(totalesNomina.totalAfpEmp + totalesNomina.totalAfpPat)}</span></div>
                                <div className="summary-row"><span>SFS Total</span><span>RD$ {formatMoney(totalesNomina.totalSfsEmp + totalesNomina.totalSfsPat)}</span></div>
                                <div className="summary-row"><span>ISR Retenido (IR-17)</span><span>RD$ {formatMoney(totalesNomina.totalIsr)}</span></div>
                                <div className="summary-row"><span>Empleados</span><span>{getDetallesRecalc().length}</span></div>
                            </div>
                        </div>
                    )}
                </div>
            </div>
        );
    };

    const renderPrestamos = () => (
        <div className="card">
            <div className="card-header"><span className="card-title"><Icons.CreditCard /> Préstamos y Adelantos</span><button className="btn btn-purple" onClick={() => openModal('prestamo')}><Icons.Plus /> Nuevo</button></div>
            <div className="card-body">
                {prestamos.length === 0 ? <div className="empty"><Icons.CreditCard /><h3>Sin préstamos</h3></div> : (
                    <div className="table-wrap">
                        <table>
                            <thead><tr><th>Empleado</th><th>Descripción</th><th>Monto</th><th>Cuota</th><th>Progreso</th><th>Saldo</th><th>Estado</th></tr></thead>
                            <tbody>
                                {prestamos.map(p => {
                                    const emp = empleados.find(e => e.id === p.empleadoId);
                                    return (
                                        <tr key={p.id}>
                                            <td><div className="emp-cell"><div className="emp-avatar" style={{background:'linear-gradient(135deg, var(--purple), #8e44ad)'}}>{emp ? getInitials(emp.nombre) : '?'}</div><div><div className="emp-name">{emp?.nombre || 'N/A'}</div></div></div></td>
                                            <td>{p.desc}</td>
                                            <td className="money">RD$ {formatMoney(p.monto)}</td>
                                            <td className="money">RD$ {formatMoney(p.cuotaMensual)}</td>
                                            <td style={{minWidth:'100px'}}><div style={{display:'flex',alignItems:'center',gap:'6px'}}><div className="progress" style={{flex:1}}><div className="progress-bar" style={{width:`${(p.cuotasPagadas/p.cuotas)*100}%`}}></div></div><span style={{fontSize:'9px'}}>{p.cuotasPagadas}/{p.cuotas}</span></div></td>
                                            <td className="money" style={{fontWeight:700}}>RD$ {formatMoney(p.saldo)}</td>
                                            <td><span className={`badge ${p.activo && p.saldo > 0 ? 'badge-warning' : 'badge-success'}`}>{p.activo && p.saldo > 0 ? 'Activo' : 'Pagado'}</span></td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                )}
            </div>
        </div>
    );

    const renderLicencias = () => (
        <div className="card">
            <div className="card-header"><span className="card-title"><Icons.Calendar /> Licencias y Permisos</span><button className="btn btn-info" onClick={() => openModal('licencia')}><Icons.Plus /> Nueva</button></div>
            <div className="card-body">
                <div className="alert alert-info"><Icons.Info /><span><strong>Licencias RD:</strong> Maternidad (14 semanas), Paternidad (2 días), Vacaciones (14 días mín. después de 1 año), Duelo (3 días), Matrimonio (5 días).</span></div>
                {licencias.length === 0 ? <div className="empty"><Icons.Calendar /><h3>Sin licencias registradas</h3></div> : (
                    <div className="table-wrap">
                        <table>
                            <thead><tr><th>Empleado</th><th>Tipo</th><th>Inicio</th><th>Fin</th><th>Con Pago</th><th>Notas</th><th>Estado</th></tr></thead>
                            <tbody>
                                {licencias.map(l => {
                                    const emp = empleados.find(e => e.id === l.empleadoId);
                                    const activa = new Date(l.fechaFin) >= new Date();
                                    return (
                                        <tr key={l.id}>
                                            <td><div className="emp-cell"><div className="emp-avatar">{emp ? getInitials(emp.nombre) : '?'}</div><div className="emp-name">{emp?.nombre || 'N/A'}</div></div></td>
                                            <td><span className="badge badge-info">{l.tipo}</span></td>
                                            <td>{formatDate(l.fechaInicio)}</td>
                                            <td>{formatDate(l.fechaFin)}</td>
                                            <td>{l.conPago ? <span className="badge badge-success">Sí</span> : <span className="badge badge-danger">No</span>}</td>
                                            <td style={{fontSize:'10px'}}>{l.notas || '-'}</td>
                                            <td><span className={`badge ${activa ? 'badge-warning' : 'badge-secondary'}`}>{activa ? 'Activa' : 'Finalizada'}</span></td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                )}
            </div>
        </div>
    );

    // Estados para filtros del historial
    const [historialFiltro, setHistorialFiltro] = useState({ año: 'TODOS', departamento: 'TODOS' });
    
    // Generar código único de nómina (formato: YYYYMMQQ o YYYYMM)
    const generarCodigoNomina = (periodo) => {
        const año = periodo.año.toString();
        const mes = periodo.mes.toString().padStart(2, '0');
        const quincena = periodo.tipo === 'quincenal' ? periodo.quincena.toString() : '0';
        return `${año}${mes}${quincena}`;
    };
    
    // Calcular fechas del período
    const getFechasPeriodo = (periodo) => {
        const año = periodo.año;
        const mes = periodo.mes;
        const ultimoDia = new Date(año, mes, 0).getDate();
        
        if (periodo.tipo === 'quincenal') {
            if (periodo.quincena === 1) {
                return { inicio: `01/${mes.toString().padStart(2,'0')}/${año}`, fin: `15/${mes.toString().padStart(2,'0')}/${año}` };
            } else {
                return { inicio: `16/${mes.toString().padStart(2,'0')}/${año}`, fin: `${ultimoDia}/${mes.toString().padStart(2,'0')}/${año}` };
            }
        } else {
            return { inicio: `01/${mes.toString().padStart(2,'0')}/${año}`, fin: `${ultimoDia}/${mes.toString().padStart(2,'0')}/${año}` };
        }
    };
    
    // Filtrar nóminas del historial
    const nominasFiltradas = useMemo(() => {
        return nominas.filter(n => {
            const matchAño = historialFiltro.año === 'TODOS' || n.periodo.año.toString() === historialFiltro.año;
            return matchAño;
        }).sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
    }, [nominas, historialFiltro]);
    
    const renderHistorial = () => (
        <div className="card">
            <div className="card-header">
                <span className="card-title"><Icons.Clock /> Historial de Nóminas</span>
                <div style={{display:'flex', gap:'8px', alignItems:'center'}}>
                    <select className="form-control sm" style={{width:'100px'}} value={historialFiltro.año} onChange={e => setHistorialFiltro(f => ({...f, año: e.target.value}))}>
                        <option value="TODOS">Todos</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                    </select>
                    <span style={{fontSize:'10px', color:'var(--text-muted)'}}>{nominasFiltradas.length} nóminas</span>
                </div>
            </div>
            <div className="card-body">
                {nominasFiltradas.length === 0 ? (
                    <div className="empty"><Icons.Clock /><h3>Sin historial</h3><p>Las nóminas guardadas aparecerán aquí</p></div>
                ) : (
                    <div className="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Fecha Inicial</th>
                                    <th>Fecha Final</th>
                                    <th>Tipo</th>
                                    <th>Empleados</th>
                                    <th>Total Bruto</th>
                                    <th>Total Ded.</th>
                                    <th>Total Neto</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {nominasFiltradas.map(n => {
                                    const codigo = n.codigo || generarCodigoNomina(n.periodo);
                                    const fechas = getFechasPeriodo(n.periodo);
                                    const totalBruto = n.detalles.reduce((s,d) => s + d.totalIng, 0);
                                    const totalDed = n.detalles.reduce((s,d) => s + d.totalDed, 0);
                                    const totalNeto = n.detalles.reduce((s,d) => s + d.neto, 0);
                                    const esProcesada = n.estado === 'procesada' || n.estado === 'guardada';
                                    const esAnulada = n.estado === 'anulada';
                                    return (
                                        <tr key={n.id} style={esAnulada ? {opacity: 0.6, textDecoration: 'line-through'} : {}}>
                                            <td><span className="badge badge-info" style={{fontFamily:'JetBrains Mono', fontSize:'10px'}}>{codigo}</span></td>
                                            <td style={{fontFamily:'JetBrains Mono', fontSize:'10px'}}>{fechas.inicio}</td>
                                            <td style={{fontFamily:'JetBrains Mono', fontSize:'10px'}}>{fechas.fin}</td>
                                            <td><span className={`badge ${n.periodo.tipo === 'quincenal' ? 'badge-purple' : 'badge-info'}`} style={{fontSize:'9px'}}>{n.periodo.tipo === 'quincenal' ? `Q${n.periodo.quincena}` : 'Mensual'}</span></td>
                                            <td style={{textAlign:'center'}}>{n.detalles.length}</td>
                                            <td className="money">RD$ {formatMoney(totalBruto)}</td>
                                            <td className="money neg">RD$ {formatMoney(totalDed)}</td>
                                            <td className="money pos" style={{fontWeight:700}}>RD$ {formatMoney(totalNeto)}</td>
                                            <td>
                                                <span className={`badge ${esProcesada ? 'badge-success' : esAnulada ? 'badge-danger' : 'badge-warning'}`}>
                                                    {esProcesada ? 'Procesada' : esAnulada ? 'Anulada' : 'Borrador'}
                                                </span>
                                            </td>
                                            <td>
                                                <div className="btn-group">
                                                    <button className="btn btn-xs btn-secondary" title="Ver detalle" onClick={() => { setCurrentNomina(n); setView('nomina'); }}><Icons.Eye /></button>
                                                    {esProcesada && (
                                                        <>
                                                            <button className="btn btn-xs btn-purple" title="Volantes" onClick={() => { setCurrentNomina(n); setSelectedVolante(null); openModal('volantes'); }}><Icons.Receipt /></button>
                                                            <button className="btn btn-xs btn-info" title="Imprimir" onClick={() => { setCurrentNomina(n); setTimeout(() => window.print(), 100); }}><Icons.Printer /></button>
                                                            <button className="btn btn-xs btn-warning" title="Editar" onClick={() => editarNomina(n)}><Icons.Edit /></button>
                                                            <button className="btn btn-xs btn-danger" title="Anular" onClick={() => anularNomina(n)}><Icons.X /></button>
                                                        </>
                                                    )}
                                                    {esAnulada && (
                                                        <span style={{fontSize:'9px', color:'var(--text-muted)', marginLeft:'4px'}} title={n.motivoAnulacion}>Anulada</span>
                                                    )}
                                                </div>
                                            </td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                        {/* Resumen */}
                        <div style={{marginTop:'16px', padding:'12px', background:'var(--bg-main)', borderRadius:'8px'}}>
                            <div style={{display:'grid', gridTemplateColumns:'repeat(4, 1fr)', gap:'16px', textAlign:'center'}}>
                                <div><div style={{fontSize:'10px', color:'var(--text-secondary)', marginBottom:'4px'}}>NÓMINAS</div><div style={{fontSize:'18px', fontWeight:'700'}}>{nominasFiltradas.length}</div></div>
                                <div><div style={{fontSize:'10px', color:'var(--text-secondary)', marginBottom:'4px'}}>TOTAL BRUTO</div><div style={{fontSize:'14px', fontWeight:'700', fontFamily:'JetBrains Mono'}}>RD$ {formatMoney(nominasFiltradas.reduce((s,n) => s + n.detalles.reduce((ss,d) => ss + d.totalIng, 0), 0))}</div></div>
                                <div><div style={{fontSize:'10px', color:'var(--text-secondary)', marginBottom:'4px'}}>TOTAL DEDUCCIONES</div><div style={{fontSize:'14px', fontWeight:'700', fontFamily:'JetBrains Mono', color:'var(--danger)'}}>RD$ {formatMoney(nominasFiltradas.reduce((s,n) => s + n.detalles.reduce((ss,d) => ss + d.totalDed, 0), 0))}</div></div>
                                <div><div style={{fontSize:'10px', color:'var(--text-secondary)', marginBottom:'4px'}}>TOTAL NETO PAGADO</div><div style={{fontSize:'14px', fontWeight:'700', fontFamily:'JetBrains Mono', color:'var(--success)'}}>RD$ {formatMoney(nominasFiltradas.reduce((s,n) => s + n.detalles.reduce((ss,d) => ss + d.neto, 0), 0))}</div></div>
                            </div>
                        </div>
                    </div>
                )}
            </div>
        </div>
    );

    // Funciones para gestión de catálogos
    const agregarItemCatalogo = () => {
        if (!nuevoItem.trim()) return toast('Ingrese un valor', 'error');
        const lista = catalogos[catalogoActivo];
        if (lista.includes(nuevoItem.trim().toUpperCase()) || lista.includes(nuevoItem.trim())) {
            return toast('Este valor ya existe', 'error');
        }
        setCatalogos(prev => ({
            ...prev,
            [catalogoActivo]: [...prev[catalogoActivo], catalogoActivo === 'departamentos' ? nuevoItem.trim().toUpperCase() : nuevoItem.trim()]
        }));
        setNuevoItem('');
        toast('Agregado correctamente', 'success');
    };
    
    const eliminarItemCatalogo = (item) => {
        if (!window.confirm(`¿Eliminar "${item}"?`)) return;
        setCatalogos(prev => ({
            ...prev,
            [catalogoActivo]: prev[catalogoActivo].filter(i => i !== item)
        }));
        toast('Eliminado correctamente', 'success');
    };
    
    const editarItemCatalogo = (itemOriginal, itemNuevo) => {
        if (!itemNuevo.trim()) return;
        setCatalogos(prev => ({
            ...prev,
            [catalogoActivo]: prev[catalogoActivo].map(i => i === itemOriginal ? (catalogoActivo === 'departamentos' ? itemNuevo.trim().toUpperCase() : itemNuevo.trim()) : i)
        }));
        setEditandoItem(null);
        toast('Actualizado correctamente', 'success');
    };
    
    const catalogoInfo = {
        departamentos: { titulo: 'Departamentos', icono: <Icons.Users />, descripcion: 'Áreas o departamentos de la institución' },
        bancos: { titulo: 'Bancos', icono: <Icons.CreditCard />, descripcion: 'Entidades bancarias para pagos' },
        tiposContrato: { titulo: 'Tipos de Contrato', icono: <Icons.FileText />, descripcion: 'Modalidades de contratación laboral' },
        tiposLicencia: { titulo: 'Tipos de Licencia', icono: <Icons.Calendar />, descripcion: 'Tipos de permisos y licencias' },
        tiposRemuneracion: { titulo: 'Tipos de Remuneración', icono: <Icons.Dollar />, descripcion: 'Formas de pago según TSS' },
        cargos: { titulo: 'Cargos', icono: <Icons.Award />, descripcion: 'Posiciones o cargos laborales' }
    };

    const renderMantenimiento = () => (
        <div style={{display:'grid', gridTemplateColumns:'280px 1fr', gap:'16px'}}>
            {/* Panel lateral de catálogos */}
            <div className="card">
                <div className="card-header"><span className="card-title"><Icons.Database /> Catálogos</span></div>
                <div className="card-body" style={{padding:'8px'}}>
                    {Object.entries(catalogoInfo).map(([key, info]) => (
                        <div 
                            key={key}
                            className={`nav-item ${catalogoActivo === key ? 'active' : ''}`}
                            style={{margin:'2px 0', background: catalogoActivo === key ? 'var(--primary-light)' : 'transparent', color: catalogoActivo === key ? 'white' : 'var(--text-primary)', borderRadius:'6px', cursor:'pointer'}}
                            onClick={() => { setCatalogoActivo(key); setNuevoItem(''); setEditandoItem(null); }}
                        >
                            {info.icono}
                            <div>
                                <div style={{fontWeight:600, fontSize:'11px'}}>{info.titulo}</div>
                                <div style={{fontSize:'9px', opacity:0.7}}>{catalogos[key].length} items</div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
            
            {/* Panel de edición */}
            <div className="card">
                <div className="card-header">
                    <span className="card-title">{catalogoInfo[catalogoActivo].icono} {catalogoInfo[catalogoActivo].titulo}</span>
                    <span style={{fontSize:'10px', color:'var(--text-muted)'}}>{catalogoInfo[catalogoActivo].descripcion}</span>
                </div>
                <div className="card-body">
                    {/* Formulario agregar */}
                    <div style={{display:'flex', gap:'8px', marginBottom:'16px'}}>
                        <input 
                            className="form-control" 
                            placeholder={`Nuevo ${catalogoInfo[catalogoActivo].titulo.slice(0,-1).toLowerCase()}...`}
                            value={nuevoItem}
                            onChange={e => setNuevoItem(e.target.value)}
                            onKeyPress={e => e.key === 'Enter' && agregarItemCatalogo()}
                        />
                        <button className="btn btn-primary" onClick={agregarItemCatalogo}><Icons.Plus /> Agregar</button>
                    </div>
                    
                    {/* Lista de items */}
                    <div className="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th style={{width:'40px'}}>#</th>
                                    <th>Nombre</th>
                                    <th style={{width:'100px'}}>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {catalogos[catalogoActivo].map((item, idx) => (
                                    <tr key={idx}>
                                        <td style={{textAlign:'center', color:'var(--text-muted)'}}>{idx + 1}</td>
                                        <td>
                                            {editandoItem === item ? (
                                                <input 
                                                    className="form-control sm"
                                                    defaultValue={item}
                                                    autoFocus
                                                    onBlur={e => editarItemCatalogo(item, e.target.value)}
                                                    onKeyPress={e => e.key === 'Enter' && editarItemCatalogo(item, e.target.value)}
                                                />
                                            ) : (
                                                <span style={{fontWeight:500}}>{item}</span>
                                            )}
                                        </td>
                                        <td>
                                            <div className="actions">
                                                <button className="action-btn" title="Editar" onClick={() => setEditandoItem(item)}><Icons.Edit /></button>
                                                <button className="action-btn danger" title="Eliminar" onClick={() => eliminarItemCatalogo(item)}><Icons.Trash /></button>
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    
                    {catalogos[catalogoActivo].length === 0 && (
                        <div className="empty">
                            <Icons.AlertCircle />
                            <h3>Sin registros</h3>
                            <p>Agregue nuevos items usando el formulario de arriba</p>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );

    const renderConfig = () => (
        <div style={{display:'grid', gridTemplateColumns:'1fr 1fr', gap:'16px'}}>
            <div className="card">
                <div className="card-header"><span className="card-title"><Icons.Settings /> Tasas TSS</span></div>
                <div className="card-body">
                    <div className="config-section">
                        <div className="config-title">Aportes del Empleado</div>
                        <div className="config-row"><span>AFP</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" step="0.01" value={config.tss.afpEmpleado} onChange={e => setConfig(c => ({...c, tss: {...c.tss, afpEmpleado: +e.target.value}}))} />%</div></div>
                        <div className="config-row"><span>SFS</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" step="0.01" value={config.tss.sfsEmpleado} onChange={e => setConfig(c => ({...c, tss: {...c.tss, sfsEmpleado: +e.target.value}}))} />%</div></div>
                    </div>
                    <div className="config-section">
                        <div className="config-title">Aportes del Empleador</div>
                        <div className="config-row"><span>AFP</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" step="0.01" value={config.tss.afpEmpleador} onChange={e => setConfig(c => ({...c, tss: {...c.tss, afpEmpleador: +e.target.value}}))} />%</div></div>
                        <div className="config-row"><span>SFS</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" step="0.01" value={config.tss.sfsEmpleador} onChange={e => setConfig(c => ({...c, tss: {...c.tss, sfsEmpleador: +e.target.value}}))} />%</div></div>
                        <div className="config-row"><span>INFOTEP</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" step="0.01" value={config.tss.infotep} onChange={e => setConfig(c => ({...c, tss: {...c.tss, infotep: +e.target.value}}))} />%</div></div>
                        <div className="config-row"><span>Riesgo Laboral</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" step="0.01" value={config.tss.riesgoLaboral} onChange={e => setConfig(c => ({...c, tss: {...c.tss, riesgoLaboral: +e.target.value}}))} />%</div></div>
                    </div>
                    <div className="config-section">
                        <div className="config-title">Topes Cotizables</div>
                        <div className="config-row"><span>Tope AFP</span><input className="config-input" style={{width:'100px'}} type="number" value={config.tss.topeAfp} onChange={e => setConfig(c => ({...c, tss: {...c.tss, topeAfp: +e.target.value}}))} /></div>
                        <div className="config-row"><span>Tope SFS</span><input className="config-input" style={{width:'100px'}} type="number" value={config.tss.topeSfs} onChange={e => setConfig(c => ({...c, tss: {...c.tss, topeSfs: +e.target.value}}))} /></div>
                        <div className="config-row"><span>PDSS Per Cápita</span><input className="config-input" style={{width:'80px'}} type="number" value={config.tss.pdssPerCapita} onChange={e => setConfig(c => ({...c, tss: {...c.tss, pdssPerCapita: +e.target.value}}))} /><span style={{fontSize:'9px',marginLeft:'4px',color:'var(--text-muted)'}}>mensual</span></div>
                    </div>
                </div>
            </div>
            <div className="card">
                <div className="card-header"><span className="card-title"><Icons.FileText /> Parámetros Generales</span></div>
                <div className="card-body">
                    <div className="config-section">
                        <div className="config-title">Cálculos</div>
                        <div className="config-row"><span>Días laborables/mes</span><input className="config-input" type="number" step="0.01" value={config.general.diasMes} onChange={e => setConfig(c => ({...c, general: {...c.general, diasMes: +e.target.value}}))} /></div>
                        <div className="config-row"><span>Salario mínimo</span><input className="config-input" style={{width:'90px'}} type="number" value={config.general.salarioMinimo} onChange={e => setConfig(c => ({...c, general: {...c.general, salarioMinimo: +e.target.value}}))} /></div>
                        <div className="config-row"><span>Días vacaciones (mín)</span><input className="config-input" type="number" value={config.general.vacacionesDias} onChange={e => setConfig(c => ({...c, general: {...c.general, vacacionesDias: +e.target.value}}))} /></div>
                    </div>
                    <div className="config-section">
                        <div className="config-title">Horas Extras</div>
                        <div className="config-row"><span>Horas 9-44 semanal</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" value={config.general.horasExtra35} onChange={e => setConfig(c => ({...c, general: {...c.general, horasExtra35: +e.target.value}}))} />%</div></div>
                        <div className="config-row"><span>+44, feriados, domingos</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" value={config.general.horasExtra100} onChange={e => setConfig(c => ({...c, general: {...c.general, horasExtra100: +e.target.value}}))} />%</div></div>
                    </div>
                    <div className="config-section">
                        <div className="config-title">Empresa</div>
                        <div style={{marginBottom:'8px'}}><label className="form-label">Nombre</label><input className="form-control sm" value={config.empresa.nombre} onChange={e => setConfig(c => ({...c, empresa: {...c.empresa, nombre: e.target.value}}))} /></div>
                        <div style={{marginBottom:'8px'}}><label className="form-label">RNC</label><input className="form-control sm" value={config.empresa.rnc} onChange={e => setConfig(c => ({...c, empresa: {...c.empresa, rnc: e.target.value}}))} /></div>
                        <div><label className="form-label">Dirección</label><input className="form-control sm" value={config.empresa.direccion} onChange={e => setConfig(c => ({...c, empresa: {...c.empresa, direccion: e.target.value}}))} /></div>
                    </div>
                    <button className="btn btn-primary" style={{width:'100%',marginTop:'12px'}} onClick={() => toast('Configuración guardada', 'success')}><Icons.Save /> Guardar Configuración</button>
                    <button className="btn btn-danger" style={{width:'100%',marginTop:'8px'}} onClick={restaurarDatosPorDefecto}><Icons.Trash /> Restaurar Datos por Defecto</button>
                </div>
            </div>
        </div>
    );

    const renderContent = () => {
        switch(view) {
            case 'dashboard': return renderDashboard();
            case 'empleados': return renderEmpleados();
            case 'nomina': return renderNomina();
            case 'prestamos': return renderPrestamos();
            case 'licencias': return renderLicencias();
            case 'historial': return renderHistorial();
            case 'mantenimiento': return renderMantenimiento();
            case 'config': return renderConfig();
            default: return renderDashboard();
        }
    };

    return (
        <div className="app">
            {/* Pantalla de Login */}
            {!usuarioActual ? (
                <div style={{
                    minHeight: '100vh',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)',
                    padding: '20px'
                }}>
                    <div style={{
                        background: 'var(--bg-card)',
                        borderRadius: '16px',
                        padding: '40px',
                        width: '100%',
                        maxWidth: '400px',
                        boxShadow: '0 25px 50px -12px rgba(0,0,0,0.5)',
                        border: '1px solid var(--border-color)'
                    }}>
                        {/* Logo */}
                        <div style={{ textAlign: 'center', marginBottom: '32px' }}>
                            <div style={{
                                width: '100px',
                                height: '100px',
                                margin: '0 auto 16px',
                                borderRadius: '20px',
                                overflow: 'hidden',
                                boxShadow: '0 8px 20px rgba(0,0,0,0.3)'
                            }}>
                                <img 
                                    src="data:image/png;base64,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"
                                    alt="Centro Educativo Tehui"
                                    style={{ width: '100%', height: '100%', objectFit: 'contain' }}
                                />
                            </div>
                            <h1 style={{ 
                                fontSize: '24px', 
                                fontWeight: '700', 
                                marginBottom: '4px',
                                background: 'linear-gradient(135deg, var(--primary) 0%, var(--purple) 100%)',
                                WebkitBackgroundClip: 'text',
                                WebkitTextFillColor: 'transparent'
                            }}>
                                Sistema de Nómina
                            </h1>
                            <p style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>
                                Centro Educativo de Formación Integral Tehui
                            </p>
                            <p style={{ fontSize: '10px', color: 'var(--text-muted)', marginTop: '4px', fontStyle: 'italic' }}>
                                "Educando en valores con calidad"
                            </p>
                        </div>
                        
                        {/* Formulario */}
                        <form onSubmit={handleUserLogin}>
                            <div style={{ marginBottom: '16px' }}>
                                <label style={{ display: 'block', fontSize: '11px', fontWeight: '600', marginBottom: '6px', color: 'var(--text-secondary)' }}>
                                    <Icons.User style={{ width: '12px', height: '12px', marginRight: '4px', verticalAlign: 'middle' }} />
                                    Usuario
                                </label>
                                <input 
                                    type="text"
                                    className="form-control"
                                    value={loginForm.usuario}
                                    onChange={e => setLoginForm(f => ({ ...f, usuario: e.target.value, error: '' }))}
                                    placeholder="Ingrese su usuario"
                                    style={{ width: '100%' }}
                                    autoFocus
                                />
                            </div>
                            <div style={{ marginBottom: '20px' }}>
                                <label style={{ display: 'block', fontSize: '11px', fontWeight: '600', marginBottom: '6px', color: 'var(--text-secondary)' }}>
                                    <Icons.Lock style={{ width: '12px', height: '12px', marginRight: '4px', verticalAlign: 'middle' }} />
                                    Contraseña
                                </label>
                                <input 
                                    type="password"
                                    className="form-control"
                                    value={loginForm.password}
                                    onChange={e => setLoginForm(f => ({ ...f, password: e.target.value, error: '' }))}
                                    placeholder="Ingrese su contraseña"
                                    style={{ width: '100%' }}
                                />
                            </div>
                            
                            {loginForm.error && (
                                <div style={{ 
                                    padding: '10px 12px', 
                                    background: 'rgba(239,68,68,0.1)', 
                                    border: '1px solid rgba(239,68,68,0.3)',
                                    borderRadius: '8px', 
                                    color: 'var(--danger)',
                                    fontSize: '12px',
                                    marginBottom: '16px',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '8px'
                                }}>
                                    <Icons.AlertCircle style={{ width: '14px', height: '14px' }} />
                                    {loginForm.error}
                                </div>
                            )}
                            
                            <button 
                                type="submit" 
                                className="btn btn-primary"
                                style={{ 
                                    width: '100%', 
                                    padding: '12px',
                                    fontSize: '14px',
                                    fontWeight: '600'
                                }}
                            >
                                <Icons.LogIn style={{ marginRight: '8px' }} />
                                Iniciar Sesión
                            </button>
                        </form>
                        
                        <div style={{ 
                            marginTop: '24px', 
                            paddingTop: '20px', 
                            borderTop: '1px solid var(--border-color)',
                            textAlign: 'center'
                        }}>
                            <p style={{ fontSize: '10px', color: 'var(--text-muted)' }}>
                                Sistema Nómina Tehui v3.9 © 2026
                            </p>
                        </div>
                    </div>
                </div>
            ) : (
            <>
            {/* Sidebar */}
            <aside className="sidebar no-print">
                <div className="sidebar-header"><div className="logo"><div className="logo-icon"><img src="data:image/png;base64,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" alt="Tehui" /></div><div><h1>Nómina Tehui</h1><span>Sistema v3.9</span></div></div></div>
                <nav className="nav">
                    <div className="nav-group"><div className="nav-label">Principal</div>
                        <div className={`nav-item ${view === 'dashboard' ? 'active' : ''}`} onClick={() => setView('dashboard')}><Icons.Dashboard /><span>Dashboard</span></div>
                        <div className={`nav-item ${view === 'empleados' ? 'active' : ''}`} onClick={() => setView('empleados')}><Icons.Users /><span>Empleados</span></div>
                        <div className={`nav-item ${view === 'nomina' ? 'active' : ''}`} onClick={() => setView('nomina')}><Icons.Dollar /><span>Nómina</span></div>
                    </div>
                    <div className="nav-group"><div className="nav-label">Gestión</div>
                        <div className={`nav-item ${view === 'prestamos' ? 'active' : ''}`} onClick={() => setView('prestamos')}><Icons.CreditCard /><span>Préstamos</span>{stats.prestamosActivos > 0 && <span className="nav-badge">{stats.prestamosActivos}</span>}</div>
                        <div className={`nav-item ${view === 'licencias' ? 'active' : ''}`} onClick={() => setView('licencias')}><Icons.Calendar /><span>Licencias</span>{stats.licenciasActivas > 0 && <span className="nav-badge">{stats.licenciasActivas}</span>}</div>
                    </div>
                    <div className="nav-group"><div className="nav-label">Reportes</div>
                        <div className={`nav-item ${view === 'historial' ? 'active' : ''}`} onClick={() => setView('historial')}><Icons.Clock /><span>Historial</span></div>
                    </div>
                    <div className="nav-group"><div className="nav-label">Sistema</div>
                        <div className={`nav-item ${view === 'mantenimiento' ? 'active' : ''}`} onClick={() => setView('mantenimiento')}><Icons.Database /><span>Mantenimiento</span></div>
                        <div className={`nav-item ${view === 'config' ? 'active' : ''}`} onClick={() => setView('config')}><Icons.Settings /><span>Configuración</span></div>
                    </div>
                    
                    {/* Sección SharePoint */}
                    <div className="nav-group" style={{marginTop:'auto', borderTop:'1px solid rgba(255,255,255,0.1)', paddingTop:'12px'}}>
                        <div className="nav-label">SharePoint</div>
                        {!spConnected ? (
                            <div className="nav-item" onClick={handleLogin} style={{background:'rgba(0,120,212,0.2)', color:'#4fc3f7'}}>
                                <Icons.LogIn /><span>Conectar Microsoft</span>
                            </div>
                        ) : (
                            <>
                                <div style={{padding:'6px 10px', fontSize:'10px', color:'rgba(255,255,255,0.7)'}}>
                                    <div style={{display:'flex', alignItems:'center', gap:'6px', marginBottom:'4px'}}>
                                        <span style={{width:'8px', height:'8px', borderRadius:'50%', background:'#4caf50'}}></span>
                                        <span>Conectado</span>
                                    </div>
                                    <div style={{fontSize:'9px', color:'rgba(255,255,255,0.5)', marginLeft:'14px'}}>
                                        {msUser?.username || msUser?.name || 'Usuario'}
                                    </div>
                                    {syncStatus.lastSync && (
                                        <div style={{fontSize:'9px', color:'rgba(255,255,255,0.4)', marginLeft:'14px', marginTop:'2px'}}>
                                            Último sync: {syncStatus.lastSync.toLocaleTimeString()}
                                        </div>
                                    )}
                                </div>
                                <div className="nav-item" onClick={sincronizarConSharePoint} style={{color: syncStatus.syncing ? '#ffc107' : 'rgba(255,255,255,0.6)'}}>
                                    <Icons.Refresh style={syncStatus.syncing ? {animation:'spin 1s linear infinite'} : {}} /><span>{syncStatus.syncing ? 'Sincronizando...' : 'Sincronizar'}</span>
                                </div>
                                <div className="nav-item" onClick={handleLogout} style={{color:'rgba(255,255,255,0.5)'}}>
                                    <Icons.LogOut /><span>Desconectar</span>
                                </div>
                            </>
                        )}
                    </div>
                </nav>
            </aside>

            {/* Main */}
            <main className="main">
                <header className="topbar no-print">
                    <div className="topbar-left">
                        <h2>{view === 'dashboard' ? 'Dashboard' : view === 'empleados' ? 'Empleados' : view === 'nomina' ? 'Nómina' : view === 'prestamos' ? 'Préstamos' : view === 'licencias' ? 'Licencias' : view === 'historial' ? 'Historial' : view === 'mantenimiento' ? 'Mantenimiento' : 'Configuración'}</h2>
                        <p style={{display:'flex', alignItems:'center', gap:'8px'}}>
                            {config.empresa.nombre}
                            {spConnected ? (
                                <span style={{display:'inline-flex', alignItems:'center', gap:'4px', background:'rgba(76,175,80,0.1)', color:'#4caf50', padding:'2px 8px', borderRadius:'10px', fontSize:'9px', fontWeight:'600'}}>
                                    <Icons.Cloud style={{width:'10px', height:'10px'}} /> SharePoint
                                </span>
                            ) : (
                                <span style={{display:'inline-flex', alignItems:'center', gap:'4px', background:'rgba(255,152,0,0.1)', color:'#ff9800', padding:'2px 8px', borderRadius:'10px', fontSize:'9px', fontWeight:'600'}}>
                                    <Icons.CloudOff style={{width:'10px', height:'10px'}} /> Local
                                </span>
                            )}
                        </p>
                    </div>
                    <div className="topbar-right" style={{display:'flex', alignItems:'center', gap:'12px'}}>
                        {spConnected && (
                            <button className="btn btn-secondary btn-sm" onClick={sincronizarConSharePoint} disabled={syncStatus.syncing}>
                                <Icons.Refresh style={syncStatus.syncing ? {animation:'spin 1s linear infinite'} : {}} /> {syncStatus.syncing ? 'Sincronizando...' : 'Sincronizar'}
                            </button>
                        )}
                        {view === 'empleados' && <button className="btn btn-primary" onClick={() => { setEmpForm(empFormInit); setEditingEmp(null); openModal('empleado'); }}><Icons.Plus /> Empleado</button>}
                        {view === 'prestamos' && <button className="btn btn-purple" onClick={() => openModal('prestamo')}><Icons.Plus /> Préstamo</button>}
                        {view === 'licencias' && <button className="btn btn-info" onClick={() => openModal('licencia')}><Icons.Plus /> Licencia</button>}
                        
                        {/* Menú de Usuario */}
                        <div style={{display:'flex', alignItems:'center', gap:'8px', paddingLeft:'12px', borderLeft:'1px solid var(--border-color)'}}>
                            <div style={{
                                display:'flex', 
                                alignItems:'center', 
                                gap:'8px',
                                background:'var(--bg-main)',
                                padding:'6px 12px',
                                borderRadius:'20px'
                            }}>
                                <div style={{
                                    width:'28px', 
                                    height:'28px', 
                                    borderRadius:'50%', 
                                    background: usuarioActual?.rol === 'admin' ? 'linear-gradient(135deg, var(--primary), var(--purple))' : 'linear-gradient(135deg, var(--info), var(--success))',
                                    display:'flex',
                                    alignItems:'center',
                                    justifyContent:'center',
                                    color:'white',
                                    fontSize:'11px',
                                    fontWeight:'700'
                                }}>
                                    {usuarioActual?.usuario?.substring(0,2).toUpperCase()}
                                </div>
                                <div>
                                    <div style={{fontSize:'11px', fontWeight:'600'}}>{usuarioActual?.nombre}</div>
                                    <div style={{fontSize:'9px', color:'var(--text-muted)'}}>
                                        {usuarioActual?.rol === 'admin' ? 
                                            <span style={{color:'var(--primary)'}}>Administrador</span> : 
                                            <span style={{color:'var(--info)'}}>Solo Consulta</span>
                                        }
                                    </div>
                                </div>
                            </div>
                            <button 
                                className="btn btn-secondary btn-sm" 
                                onClick={() => setMostrarCambioPassword(true)}
                                title="Cambiar contraseña"
                                style={{padding:'6px'}}
                            >
                                <Icons.Lock style={{width:'14px', height:'14px'}} />
                            </button>
                            <button 
                                className="btn btn-danger btn-sm" 
                                onClick={handleUserLogout}
                                title="Cerrar sesión"
                                style={{padding:'6px'}}
                            >
                                <Icons.LogOut style={{width:'14px', height:'14px'}} />
                            </button>
                        </div>
                    </div>
                </header>
                <div className="page">{renderContent()}</div>
            </main>

            {/* Modal Empleado */}
            <Modal open={modals.empleado} onClose={() => { closeModal('empleado'); setEditingEmp(null); setEmpForm(empFormInit); }} title={editingEmp ? 'Editar Empleado' : 'Nuevo Empleado'} size="lg" footer={<><button className="btn btn-secondary" onClick={() => closeModal('empleado')}>Cancelar</button><button className="btn btn-primary" onClick={guardarEmpleado}><Icons.Check /> {editingEmp ? 'Actualizar' : 'Guardar'}</button></>}>
                <div className="form-grid">
                    <div className="form-group span-2"><label className="form-label">Nombre Completo *</label><input className="form-control" value={empForm.nombre} onChange={e => setEmpForm(f => ({...f, nombre: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Tipo Documento</label><select className="form-control" value={empForm.tipoDocumento} onChange={e => setEmpForm(f => ({...f, tipoDocumento: e.target.value}))}><option value="cedula">Cédula</option><option value="pasaporte">Pasaporte</option></select></div>
                    <div className="form-group"><label className="form-label">{empForm.tipoDocumento === 'cedula' ? 'Cédula' : 'Pasaporte'} *</label><input className="form-control" value={empForm.documento} onChange={e => setEmpForm(f => ({...f, documento: e.target.value}))} placeholder={empForm.tipoDocumento === 'cedula' ? '000-0000000-0' : 'Número de pasaporte'} /></div>
                    <div className="form-group"><label className="form-label">NSS (Seg. Social)</label><input className="form-control" value={empForm.nss} onChange={e => setEmpForm(f => ({...f, nss: e.target.value}))} placeholder="00000000-0" /><div className="form-help">Número asignado por TSS</div></div>
                    <div className="form-group"><label className="form-label">Departamento *</label><select className="form-control" value={empForm.departamento} onChange={e => setEmpForm(f => ({...f, departamento: e.target.value}))}>{DEPARTAMENTOS.map(d => <option key={d} value={d}>{d}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">Cargo</label><input className="form-control" value={empForm.cargo} onChange={e => setEmpForm(f => ({...f, cargo: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Salario Mensual *</label><input className="form-control" type="number" value={empForm.salarioBase} onChange={e => setEmpForm(f => ({...f, salarioBase: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Tipo Remuneración</label><select className="form-control" value={empForm.tipoRemuneracion} onChange={e => setEmpForm(f => ({...f, tipoRemuneracion: e.target.value}))}>{TIPOS_REMUNERACION.map(t => <option key={t} value={t}>{t}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">Fecha Ingreso</label><input className="form-control" type="date" value={empForm.fechaIngreso} onChange={e => setEmpForm(f => ({...f, fechaIngreso: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Tipo Contrato</label><select className="form-control" value={empForm.tipoContrato} onChange={e => setEmpForm(f => ({...f, tipoContrato: e.target.value}))}>{TIPOS_CONTRATO.map(t => <option key={t} value={t}>{t}</option>)}</select></div>
                </div>
                <h4 style={{margin:'16px 0 12px', fontSize:'12px', color:'var(--text-secondary)'}}>Deducciones Fijas Mensuales</h4>
                <div className="form-grid">
                    <div className="form-group"><label className="form-label">Depend. Adic. SFS</label><input className="form-control" type="number" min="0" max="10" value={empForm.dependientesSFS || 0} onChange={e => setEmpForm(f => ({...f, dependientesSFS: parseInt(e.target.value) || 0}))} placeholder="0" /><div className="form-help">Dependientes adicionales en seguro salud</div></div>
                    <div className="form-group"><label className="form-label">Cooperativa</label><input className="form-control" type="number" value={empForm.cooperativa} onChange={e => setEmpForm(f => ({...f, cooperativa: e.target.value}))} placeholder="0" /></div>
                    <div className="form-group"><label className="form-label">Seguro Médico</label><input className="form-control" type="number" value={empForm.seguroPrivado} onChange={e => setEmpForm(f => ({...f, seguroPrivado: e.target.value}))} placeholder="0" /><div className="form-help">Seguro privado adicional</div></div>
                    <div className="form-group"><label className="form-label">Embargo/Pensión</label><input className="form-control" type="number" value={empForm.embargo} onChange={e => setEmpForm(f => ({...f, embargo: e.target.value}))} placeholder="0" /><div className="form-help">Deducciones judiciales</div></div>
                </div>
                <h4 style={{margin:'16px 0 12px', fontSize:'12px', color:'var(--text-secondary)'}}>Datos Bancarios</h4>
                <div className="form-grid form-grid-3">
                    <div className="form-group"><label className="form-label">Banco</label><select className="form-control" value={empForm.banco} onChange={e => setEmpForm(f => ({...f, banco: e.target.value}))}><option value="">Seleccionar...</option>{BANCOS.map(b => <option key={b} value={b}>{b}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">No. Cuenta</label><input className="form-control" value={empForm.cuenta} onChange={e => setEmpForm(f => ({...f, cuenta: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Estado</label><select className="form-control" value={empForm.activo} onChange={e => setEmpForm(f => ({...f, activo: e.target.value === 'true'}))}><option value="true">Activo</option><option value="false">Inactivo</option></select></div>
                </div>
            </Modal>

            {/* Modal Préstamo */}
            <Modal open={modals.prestamo} onClose={() => { closeModal('prestamo'); setPrestamoForm({empleadoId:'',monto:'',cuotas:'',desc:'',fecha:''}); }} title="Nuevo Préstamo" footer={<><button className="btn btn-secondary" onClick={() => closeModal('prestamo')}>Cancelar</button><button className="btn btn-purple" onClick={guardarPrestamo}><Icons.Check /> Registrar</button></>}>
                <div className="form-grid form-grid-2">
                    <div className="form-group full"><label className="form-label">Empleado *</label><select className="form-control" value={prestamoForm.empleadoId} onChange={e => setPrestamoForm(f => ({...f, empleadoId: e.target.value}))}><option value="">Seleccionar...</option>{empleados.filter(e => e.activo).map(e => <option key={e.id} value={e.id}>{e.nombre}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">Monto Total *</label><input className="form-control" type="number" value={prestamoForm.monto} onChange={e => setPrestamoForm(f => ({...f, monto: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Cuotas *</label><input className="form-control" type="number" min="1" value={prestamoForm.cuotas} onChange={e => setPrestamoForm(f => ({...f, cuotas: e.target.value}))} /></div>
                    {prestamoForm.monto && prestamoForm.cuotas && <div className="form-group full"><div className="alert alert-success"><Icons.Info /><span>Cuota mensual: <strong>RD$ {formatMoney(+prestamoForm.monto / +prestamoForm.cuotas)}</strong></span></div></div>}
                    <div className="form-group"><label className="form-label">Fecha Inicio</label><input className="form-control" type="date" value={prestamoForm.fecha} onChange={e => setPrestamoForm(f => ({...f, fecha: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Descripción</label><input className="form-control" value={prestamoForm.desc} onChange={e => setPrestamoForm(f => ({...f, desc: e.target.value}))} placeholder="Préstamo personal..." /></div>
                </div>
            </Modal>

            {/* Modal Licencia */}
            <Modal open={modals.licencia} onClose={() => closeModal('licencia')} title="Nueva Licencia" footer={<><button className="btn btn-secondary" onClick={() => closeModal('licencia')}>Cancelar</button><button className="btn btn-info" onClick={guardarLicencia}><Icons.Check /> Registrar</button></>}>
                <div className="form-grid form-grid-2">
                    <div className="form-group full"><label className="form-label">Empleado *</label><select className="form-control" value={licenciaForm.empleadoId} onChange={e => setLicenciaForm(f => ({...f, empleadoId: e.target.value}))}><option value="">Seleccionar...</option>{empleados.filter(e => e.activo).map(e => <option key={e.id} value={e.id}>{e.nombre}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">Tipo</label><select className="form-control" value={licenciaForm.tipo} onChange={e => setLicenciaForm(f => ({...f, tipo: e.target.value}))}>{TIPOS_LICENCIA.map(t => <option key={t} value={t}>{t}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">Con Pago</label><select className="form-control" value={licenciaForm.conPago} onChange={e => setLicenciaForm(f => ({...f, conPago: e.target.value === 'true'}))}><option value="true">Sí</option><option value="false">No</option></select></div>
                    <div className="form-group"><label className="form-label">Fecha Inicio *</label><input className="form-control" type="date" value={licenciaForm.fechaInicio} onChange={e => setLicenciaForm(f => ({...f, fechaInicio: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Fecha Fin</label><input className="form-control" type="date" value={licenciaForm.fechaFin} onChange={e => setLicenciaForm(f => ({...f, fechaFin: e.target.value}))} /></div>
                    <div className="form-group full"><label className="form-label">Notas</label><input className="form-control" value={licenciaForm.notas} onChange={e => setLicenciaForm(f => ({...f, notas: e.target.value}))} /></div>
                </div>
            </Modal>

            {/* Modal Liquidación */}
            <Modal open={modals.liquidacion} onClose={() => closeModal('liquidacion')} title="Cálculo de Liquidación" size="md">
                {liquidacionData && (
                    <div>
                        <div className="alert alert-info"><Icons.UserMinus /><span><strong>{liquidacionData.emp.nombre}</strong> - Antigüedad: {calcularAntiguedad(liquidacionData.emp.fechaIngreso).años} años, {calcularAntiguedad(liquidacionData.emp.fechaIngreso).meses % 12} meses</span></div>
                        <div className="config-section">
                            <div className="config-title">Desglose de Liquidación (Despido)</div>
                            <div className="config-row"><span>Preaviso ({liquidacionData.preaviso.dias} días)</span><span className="money">RD$ {formatMoney(liquidacionData.preaviso.monto)}</span></div>
                            <div className="config-row"><span>Cesantía ({round2(liquidacionData.cesantia.dias)} días)</span><span className="money">RD$ {formatMoney(liquidacionData.cesantia.monto)}</span></div>
                            <div className="config-row"><span>Vacaciones no disfrutadas</span><span className="money">RD$ {formatMoney(liquidacionData.vacaciones)}</span></div>
                            <div className="config-row"><span>Salario pendiente</span><span className="money">RD$ {formatMoney(liquidacionData.salarioPendiente)}</span></div>
                            <div className="config-row"><span>Regalía proporcional</span><span className="money">RD$ {formatMoney(liquidacionData.regalia)}</span></div>
                            <div className="config-row" style={{fontWeight:700, borderTop:'2px solid var(--border)', paddingTop:'8px', marginTop:'8px'}}><span>TOTAL LIQUIDACIÓN</span><span className="money pos" style={{fontSize:'14px'}}>RD$ {formatMoney(liquidacionData.total)}</span></div>
                        </div>
                        <button className="btn btn-primary" style={{width:'100%', marginTop:'12px'}} onClick={() => { toast('Liquidación exportada', 'success'); closeModal('liquidacion'); }}><Icons.Download /> Exportar Liquidación</button>
                    </div>
                )}
            </Modal>

            {/* Modal Volantes */}
            <Modal open={modals.volantes} onClose={() => { closeModal('volantes'); setSelectedVolante(null); }} title="Volantes de Pago" size="xl" footer={<><button className="btn btn-secondary" onClick={() => closeModal('volantes')}>Cerrar</button><button className="btn btn-primary" onClick={() => window.print()}><Icons.Printer /> Imprimir</button></>}>
                <div className="print-area">
                    {volantesData.map((v, i) => <Volante key={i} emp={v.emp} det={v.det} periodo={currentNomina?.periodo} config={config} />)}
                </div>
            </Modal>

            {/* Modal Constancia */}
            <Modal open={modals.constancia} onClose={() => closeModal('constancia')} title="Constancia de Trabajo" size="md">
                {selectedEmp && (
                    <div style={{fontFamily:'serif', lineHeight:1.8}}>
                        <div style={{textAlign:'center', marginBottom:'20px'}}>
                            <h2 style={{fontSize:'16px'}}>{config.empresa.nombre}</h2>
                            <p style={{fontSize:'11px', color:'var(--text-secondary)'}}>{config.empresa.direccion}<br/>RNC: {config.empresa.rnc}</p>
                        </div>
                        <h3 style={{textAlign:'center', margin:'20px 0', textDecoration:'underline'}}>CONSTANCIA DE TRABAJO</h3>
                        <p style={{textAlign:'justify', fontSize:'12px'}}>
                            Por medio de la presente hacemos constar que el/la Sr(a). <strong>{selectedEmp.nombre}</strong>, 
                            portador(a) de la cédula de identidad No. <strong>{selectedEmp.cedula}</strong>, 
                            labora en nuestra institución desde el <strong>{formatDate(selectedEmp.fechaIngreso)}</strong>, 
                            desempeñando el cargo de <strong>{selectedEmp.cargo || selectedEmp.departamento}</strong>, 
                            devengando un salario mensual de <strong>RD$ {formatMoney(selectedEmp.salarioBase)}</strong>.
                        </p>
                        <p style={{fontSize:'12px', marginTop:'16px'}}>
                            Se expide la presente constancia a solicitud de la parte interesada, para los fines que considere pertinentes.
                        </p>
                        <p style={{fontSize:'12px', marginTop:'20px'}}>
                            Dado en Santiago de los Caballeros, República Dominicana, a los {new Date().getDate()} días del mes de {MESES[new Date().getMonth() + 1]} del {new Date().getFullYear()}.
                        </p>
                        <div style={{marginTop:'50px', textAlign:'center'}}>
                            <div style={{borderTop:'1px solid #333', width:'200px', margin:'0 auto', paddingTop:'8px', fontSize:'11px'}}>Firma y Sello</div>
                        </div>
                        <button className="btn btn-primary no-print" style={{width:'100%', marginTop:'20px'}} onClick={() => window.print()}><Icons.Printer /> Imprimir</button>
                    </div>
                )}
            </Modal>

            {/* Modal de Ausencias */}
            <Modal 
                open={modals.ausencias} 
                onClose={() => { closeModal('ausencias'); setAusenciasEmpId(null); }} 
                title="Registrar Días No Laborados" 
                size="md"
                footer={
                    <>
                        <button className="btn btn-secondary" onClick={() => { closeModal('ausencias'); setAusenciasEmpId(null); }}>Cerrar</button>
                    </>
                }
            >
                {ausenciasEmpId && (
                    <div>
                        <div className="alert alert-info" style={{marginBottom:'16px'}}>
                            <Icons.Info />
                            <span>
                                <strong>{empleados.find(e => e.id === ausenciasEmpId)?.nombre}</strong><br/>
                                Seleccione los días que NO laboró en este período. El descuento se calculará automáticamente.
                            </span>
                        </div>
                        
                        <div style={{marginBottom:'16px', padding:'12px', background:'var(--bg-secondary)', borderRadius:'8px'}}>
                            <strong>Período:</strong> {MESES[periodo.mes]} {periodo.año} 
                            {periodo.tipo === 'quincenal' && ` - ${periodo.quincena === 1 ? '1ra' : '2da'} Quincena`}
                        </div>

                        <div style={{display:'grid', gridTemplateColumns:'repeat(auto-fill, minmax(100px, 1fr))', gap:'8px'}}>
                            {getFechasDelPeriodo().map(fecha => {
                                const seleccionada = (nominaEdits[ausenciasEmpId]?.fechasAus || []).includes(fecha);
                                return (
                                    <button
                                        key={fecha}
                                        className="btn btn-sm"
                                        style={{
                                            background: seleccionada ? '#dc3545' : 'var(--bg-tertiary)',
                                            color: seleccionada ? 'white' : 'var(--text-primary)',
                                            border: seleccionada ? '2px solid #dc3545' : '1px solid var(--border-color)',
                                            padding: '8px 4px',
                                            display: 'flex',
                                            flexDirection: 'column',
                                            alignItems: 'center',
                                            fontSize: '11px'
                                        }}
                                        onClick={() => toggleFechaAusencia(fecha)}
                                    >
                                        <span style={{fontWeight:'bold'}}>{getDiaSemana(fecha)}</span>
                                        <span>{formatFechaCorta(fecha)}</span>
                                    </button>
                                );
                            })}
                        </div>

                        {(nominaEdits[ausenciasEmpId]?.fechasAus?.length || 0) > 0 && (
                            <div style={{marginTop:'16px', padding:'12px', background:'#dc354520', borderRadius:'8px', border:'1px solid #dc3545'}}>
                                <strong style={{color:'#dc3545'}}>Días seleccionados ({nominaEdits[ausenciasEmpId]?.fechasAus?.length || 0}):</strong>
                                <div style={{marginTop:'8px', display:'flex', flexWrap:'wrap', gap:'4px'}}>
                                    {nominaEdits[ausenciasEmpId]?.fechasAus?.map(f => (
                                        <span key={f} className="badge" style={{background:'#dc3545', color:'white', padding:'4px 8px'}}>
                                            {getDiaSemana(f)} {formatFechaCorta(f)}
                                        </span>
                                    ))}
                                </div>
                                <div style={{marginTop:'8px', fontSize:'12px', color:'var(--text-secondary)'}}>
                                    Descuento estimado: <strong style={{color:'#dc3545'}}>RD$ {formatMoney(
                                        calcularSalarioDiario(empleados.find(e => e.id === ausenciasEmpId)?.salarioBase || 0, config) * 
                                        (nominaEdits[ausenciasEmpId]?.fechasAus?.length || 0)
                                    )}</strong>
                                </div>
                            </div>
                        )}
                    </div>
                )}
            </Modal>

            {/* Modal Cambio de Contraseña */}
            <Modal 
                open={mostrarCambioPassword} 
                onClose={() => { setMostrarCambioPassword(false); setCambioPasswordForm({ actual: '', nueva: '', confirmar: '', error: '' }); }} 
                title="Cambiar Contraseña" 
                size="sm"
                footer={
                    <>
                        <button className="btn btn-secondary" onClick={() => setMostrarCambioPassword(false)}>Cancelar</button>
                        <button className="btn btn-primary" onClick={handleCambioPassword}><Icons.Check /> Cambiar</button>
                    </>
                }
            >
                <form onSubmit={handleCambioPassword}>
                    <div className="form-group">
                        <label className="form-label">Contraseña Actual</label>
                        <input 
                            type="password" 
                            className="form-control" 
                            value={cambioPasswordForm.actual}
                            onChange={e => setCambioPasswordForm(f => ({ ...f, actual: e.target.value, error: '' }))}
                        />
                    </div>
                    <div className="form-group">
                        <label className="form-label">Nueva Contraseña</label>
                        <input 
                            type="password" 
                            className="form-control" 
                            value={cambioPasswordForm.nueva}
                            onChange={e => setCambioPasswordForm(f => ({ ...f, nueva: e.target.value, error: '' }))}
                        />
                        <div className="form-help">Mínimo 6 caracteres</div>
                    </div>
                    <div className="form-group">
                        <label className="form-label">Confirmar Nueva Contraseña</label>
                        <input 
                            type="password" 
                            className="form-control" 
                            value={cambioPasswordForm.confirmar}
                            onChange={e => setCambioPasswordForm(f => ({ ...f, confirmar: e.target.value, error: '' }))}
                        />
                    </div>
                    {cambioPasswordForm.error && (
                        <div className="alert alert-danger" style={{marginTop:'12px'}}>
                            <Icons.AlertCircle /><span>{cambioPasswordForm.error}</span>
                        </div>
                    )}
                </form>
            </Modal>

            {/* Toasts */}
            <div className="toasts">{toasts.map(t => <Toast key={t.id} msg={t.msg} type={t.type} onClose={() => removeToast(t.id)} />)}</div>
            
            {/* Loading */}
            {loading && <div className="loading"><div className="spinner"></div></div>}
            </>
            )}
        </div>
    );
};

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
