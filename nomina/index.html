<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Nómina Tehui v3.95 - Protección de Datos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <!-- Bibliotecas para 2FA -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- EmailJS para envío de códigos por correo -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Colores institucionales Centro Educativo Tehui */
            --primary: #1565C0; --primary-light: #1E88E5; --primary-dark: #0D47A1;
            --secondary: #FF9800; --accent: #4CAF50;
            --tehui-red: #E53935; --tehui-yellow: #FDD835; --tehui-green: #43A047; --tehui-blue: #42A5F5; --tehui-orange: #FB8C00;
            --bg-main: #f5f7fa; --bg-card: #ffffff; --bg-sidebar: linear-gradient(180deg, #1565C0 0%, #0D47A1 100%);
            --text-primary: #1a1f24; --text-secondary: #5c6975; --text-muted: #8b95a1;
            --border: #e0e4e8; --border-light: #f0f2f5;
            --success: #43A047; --warning: #FDD835; --danger: #E53935; --info: #42A5F5; --purple: #7E57C2;
            --shadow: 0 2px 8px rgba(21, 101, 192, 0.08); --shadow-md: 0 4px 16px rgba(21, 101, 192, 0.12);
            --radius: 8px; --radius-lg: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg-main); color: var(--text-primary); font-size: 13px; line-height: 1.5; }
        
        /* Layout */
        .app { display: flex; min-height: 100vh; }
        .sidebar { width: 240px; background: var(--bg-sidebar); position: fixed; height: 100vh; overflow-y: auto; z-index: 100; }
        .sidebar::-webkit-scrollbar { width: 4px; }
        .sidebar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 2px; }
        .sidebar-header { padding: 16px; border-bottom: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.05); }
        .logo { display: flex; align-items: center; gap: 12px; color: white; }
        .logo-icon { width: 50px; height: 50px; border-radius: 10px; display: flex; align-items: center; justify-content: center; background: white; padding: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .logo-icon img { width: 100%; height: 100%; object-fit: contain; }
        .logo h1 { font-size: 13px; font-weight: 700; line-height: 1.3; }
        .logo span { font-size: 10px; color: rgba(255,255,255,0.7); display: block; margin-top: 2px; }
        
        .nav { padding: 12px 8px; }
        .nav-group { margin-bottom: 16px; }
        .nav-label { font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: rgba(255,255,255,0.5); padding: 0 10px; margin-bottom: 6px; }
        .nav-item { display: flex; align-items: center; gap: 8px; padding: 9px 12px; border-radius: 8px; color: rgba(255,255,255,0.75); font-size: 12px; font-weight: 500; cursor: pointer; transition: all 0.2s; margin-bottom: 2px; }
        .nav-item:hover { background: rgba(255,255,255,0.12); color: white; }
        .nav-item.active { background: rgba(255,255,255,0.2); color: white; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.1); }
        .nav-item svg { width: 16px; height: 16px; flex-shrink: 0; }
        .nav-badge { background: var(--tehui-red); color: white; font-size: 9px; padding: 2px 6px; border-radius: 10px; margin-left: auto; font-weight: 600; }
        
        .main { flex: 1; margin-left: 240px; overflow-x: hidden; }
        .topbar { background: var(--bg-card); padding: 12px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; }
        .topbar-left h2 { font-size: 16px; font-weight: 700; }
        .topbar-left p { font-size: 11px; color: var(--text-secondary); }
        .topbar-right { display: flex; gap: 8px; }
        .page { padding: 16px 20px 60px 20px; overflow-x: auto; } /* padding-bottom extra para la barra de protección */
        
        /* Buttons - Colores Tehui */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 5px; padding: 8px 14px; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; border: none; font-family: inherit; transition: all 0.2s; white-space: nowrap; }
        .btn-primary { background: linear-gradient(135deg, var(--primary-light), var(--primary)); color: white; box-shadow: 0 2px 8px rgba(30, 136, 229, 0.3); }
        .btn-primary:hover { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(30, 136, 229, 0.4); }
        .btn-secondary { background: white; color: var(--text-primary); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--bg-main); border-color: var(--primary-light); }
        .btn-success { background: linear-gradient(135deg, var(--tehui-green), #388E3C); color: white; box-shadow: 0 2px 8px rgba(67, 160, 71, 0.3); }
        .btn-success:hover { transform: translateY(-1px); }
        .btn-danger { background: linear-gradient(135deg, var(--tehui-red), #C62828); color: white; }
        .btn-warning { background: linear-gradient(135deg, var(--tehui-yellow), #F9A825); color: #333; }
        .btn-info { background: linear-gradient(135deg, var(--tehui-blue), #1E88E5); color: white; }
        .btn-purple { background: linear-gradient(135deg, var(--purple), #5E35B1); color: white; }
        .btn-orange { background: linear-gradient(135deg, var(--tehui-orange), #EF6C00); color: white; box-shadow: 0 2px 8px rgba(251, 140, 0, 0.3); }
        .btn-sm { padding: 6px 10px; font-size: 11px; }
        .btn-xs { padding: 4px 8px; font-size: 10px; }
        .btn-icon { padding: 6px; width: 30px; height: 30px; }
        .btn-group { display: flex; gap: 4px; }
        
        /* Cards */
        .card { background: var(--bg-card); border-radius: var(--radius-lg); box-shadow: var(--shadow); border: 1px solid var(--border-light); margin-bottom: 16px; overflow: hidden; }
        .card-header { padding: 12px 16px; border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-size: 13px; font-weight: 700; display: flex; align-items: center; gap: 6px; }
        .card-body { padding: 16px; overflow: auto; }
        .card-footer { padding: 12px 16px; border-top: 1px solid var(--border-light); background: var(--bg-main); }
        
        /* Stats - Colores Tehui */
        .stats { display: grid; grid-template-columns: repeat(6, 1fr); gap: 14px; margin-bottom: 16px; }
        .stat { background: var(--bg-card); border-radius: var(--radius-lg); padding: 16px; box-shadow: var(--shadow); border: 1px solid var(--border-light); transition: all 0.2s; }
        .stat:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .stat-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .stat-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .stat-icon.green { background: linear-gradient(135deg, rgba(67,160,71,0.15), rgba(67,160,71,0.05)); color: var(--tehui-green); }
        .stat-icon.blue { background: linear-gradient(135deg, rgba(66,165,245,0.15), rgba(66,165,245,0.05)); color: var(--tehui-blue); }
        .stat-icon.orange { background: linear-gradient(135deg, rgba(251,140,0,0.15), rgba(251,140,0,0.05)); color: var(--tehui-orange); }
        .stat-icon.red { background: linear-gradient(135deg, rgba(229,57,53,0.15), rgba(229,57,53,0.05)); color: var(--tehui-red); }
        .stat-icon.purple { background: linear-gradient(135deg, rgba(126,87,194,0.15), rgba(126,87,194,0.05)); color: var(--purple); }
        .stat-icon.yellow { background: linear-gradient(135deg, rgba(253,216,53,0.2), rgba(253,216,53,0.05)); color: #F9A825; }
        .stat-label { font-size: 10px; color: var(--text-secondary); font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; }
        .stat-value { font-size: 20px; font-weight: 800; color: var(--text-primary); }
        .stat-sub { font-size: 10px; color: var(--text-muted); margin-top: 3px; }
        
        /* Tables */
        .table-wrap { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        th { text-align: left; padding: 8px 10px; font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.3px; color: var(--text-secondary); background: var(--bg-main); border-bottom: 2px solid var(--border); white-space: nowrap; }
        td { padding: 8px 10px; border-bottom: 1px solid var(--border-light); vertical-align: middle; }
        tr:hover td { background: rgba(0,0,0,0.01); }
        .sticky-col { position: sticky; left: 0; background: var(--bg-card); z-index: 1; }
        
        .emp-cell { display: flex; align-items: center; gap: 8px; min-width: 180px; }
        .emp-avatar { width: 28px; height: 28px; border-radius: 6px; background: linear-gradient(135deg, var(--primary-light), var(--primary)); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 10px; flex-shrink: 0; }
        .emp-name { font-weight: 600; font-size: 11px; white-space: nowrap; }
        .emp-sub { font-size: 9px; color: var(--text-muted); }
        
        .badge { display: inline-flex; padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: 600; }
        .badge-success { background: rgba(25,135,84,0.1); color: var(--success); }
        .badge-warning { background: rgba(255,193,7,0.15); color: #997404; }
        .badge-danger { background: rgba(220,53,69,0.1); color: var(--danger); }
        .badge-info { background: rgba(13,202,240,0.1); color: #055160; }
        .badge-purple { background: rgba(111,66,193,0.1); color: var(--purple); }
        .badge-secondary { background: var(--bg-main); color: var(--text-secondary); }
        
        .money { font-family: 'JetBrains Mono', monospace; font-size: 11px; }
        .money.pos { color: var(--success); }
        .money.neg { color: var(--danger); }
        
        .actions { display: flex; gap: 3px; }
        .action-btn { width: 24px; height: 24px; border-radius: 4px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; background: var(--bg-main); color: var(--text-secondary); transition: all 0.15s; }
        .action-btn:hover { background: var(--primary-light); color: white; }
        .action-btn.danger:hover { background: var(--danger); }
        .action-btn svg { width: 12px; height: 12px; }
        
        /* Forms */
        .form-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .form-grid-3 { grid-template-columns: repeat(3, 1fr); }
        .form-grid-2 { grid-template-columns: repeat(2, 1fr); }
        .form-group { }
        .form-group.full { grid-column: 1 / -1; }
        .form-group.span-2 { grid-column: span 2; }
        .form-group.span-3 { grid-column: span 3; }
        .form-label { display: block; font-size: 10px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; text-transform: uppercase; }
        .form-control { width: 100%; padding: 7px 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 12px; font-family: inherit; transition: border-color 0.15s; }
        .form-control:focus { outline: none; border-color: var(--primary-light); box-shadow: 0 0 0 2px rgba(25,135,84,0.1); }
        .form-control.sm { padding: 5px 8px; font-size: 11px; }
        .form-help { font-size: 9px; color: var(--text-muted); margin-top: 2px; }
        .form-row { display: flex; gap: 8px; align-items: flex-end; }
        
        /* Modal */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal { background: var(--bg-card); border-radius: var(--radius-lg); width: 100%; max-width: 500px; max-height: 90vh; display: flex; flex-direction: column; }
        .modal.md { max-width: 650px; }
        .modal.lg { max-width: 850px; }
        .modal.xl { max-width: 1100px; }
        .modal-header { padding: 12px 16px; border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .modal-title { font-size: 14px; font-weight: 700; }
        .modal-close { width: 28px; height: 28px; border-radius: 6px; border: none; background: var(--bg-main); cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .modal-close:hover { background: var(--danger); color: white; }
        .modal-body { padding: 16px; overflow-y: auto; flex: 1; }
        .modal-footer { padding: 12px 16px; border-top: 1px solid var(--border-light); display: flex; justify-content: flex-end; gap: 8px; background: var(--bg-main); flex-shrink: 0; }
        
        /* Tabs */
        .tabs { display: flex; gap: 2px; background: var(--bg-main); padding: 3px; border-radius: 6px; margin-bottom: 16px; flex-wrap: wrap; }
        .tab { padding: 6px 12px; font-size: 11px; font-weight: 600; cursor: pointer; border: none; background: transparent; color: var(--text-secondary); border-radius: 4px; transition: all 0.15s; white-space: nowrap; }
        .tab:hover { color: var(--primary); }
        .tab.active { background: var(--bg-card); color: var(--primary); box-shadow: var(--shadow); }
        
        /* Config */
        .config-section { border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-bottom: 12px; }
        .config-title { font-size: 11px; font-weight: 700; color: var(--primary); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
        .config-row { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px solid var(--border-light); font-size: 11px; }
        .config-row:last-child { border-bottom: none; }
        .config-input { width: 80px; padding: 4px 8px; border: 1px solid var(--border); border-radius: 4px; font-size: 11px; text-align: right; font-family: 'JetBrains Mono', monospace; }
        
        /* Alert */
        .alert { padding: 10px 12px; border-radius: 6px; margin-bottom: 12px; display: flex; align-items: flex-start; gap: 8px; font-size: 11px; }
        .alert svg { flex-shrink: 0; width: 14px; height: 14px; margin-top: 1px; }
        .alert-info { background: rgba(13,202,240,0.1); border: 1px solid rgba(13,202,240,0.2); color: #055160; }
        .alert-warning { background: rgba(255,193,7,0.1); border: 1px solid rgba(255,193,7,0.2); color: #664d03; }
        .alert-success { background: rgba(25,135,84,0.1); border: 1px solid rgba(25,135,84,0.2); color: var(--success); }
        .alert-danger { background: rgba(220,53,69,0.1); border: 1px solid rgba(220,53,69,0.2); color: var(--danger); }
        
        /* Inline input */
        .inline-input { padding: 3px 5px; border: 1px solid var(--border); border-radius: 3px; font-size: 10px; width: 55px; text-align: right; font-family: 'JetBrains Mono', monospace; }
        .inline-input:focus { outline: none; border-color: var(--primary-light); }
        
        /* Summary */
        .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 16px; }
        .summary-box { background: var(--bg-main); border-radius: 8px; padding: 12px; }
        .summary-title { font-size: 10px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 8px; }
        .summary-row { display: flex; justify-content: space-between; padding: 4px 0; font-size: 10px; border-bottom: 1px dashed var(--border); }
        .summary-row:last-child { border-bottom: none; font-weight: 700; padding-top: 6px; margin-top: 4px; border-top: 2px solid var(--border); font-size: 11px; }
        
        .dept-row { background: linear-gradient(90deg, rgba(15,81,50,0.05), transparent); }
        .dept-row td { font-weight: 700; color: var(--primary); border-bottom: 2px solid var(--primary-light); }
        
        /* Progress */
        .progress { height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--primary-light); border-radius: 2px; }
        
        /* Empty */
        .empty { text-align: center; padding: 40px 20px; color: var(--text-secondary); }
        .empty svg { width: 48px; height: 48px; margin-bottom: 12px; opacity: 0.3; }
        .empty h3 { font-size: 14px; margin-bottom: 4px; color: var(--text-primary); }
        .empty p { font-size: 12px; }
        
        /* SVG size control */
        svg { max-width: 100%; height: auto; }
        .card-body svg:not(.stat-icon svg):not(.action-btn svg) { width: 16px; height: 16px; }
        .card-header svg { width: 16px; height: 16px; }
        .stat-icon svg { width: 18px; height: 18px; }
        
        /* Toast */
        .toasts { position: fixed; bottom: 16px; right: 16px; z-index: 2000; }
        .toast { padding: 10px 14px; border-radius: 8px; background: var(--bg-card); box-shadow: var(--shadow-md); display: flex; align-items: center; gap: 8px; margin-top: 8px; min-width: 220px; font-size: 12px; animation: slideIn 0.2s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(40px); } }
        .toast.success { border-left: 3px solid var(--success); }
        .toast.error { border-left: 3px solid var(--danger); }
        .toast.warning { border-left: 3px solid var(--warning); }
        
        /* Loading */
        .loading { position: fixed; inset: 0; background: rgba(255,255,255,0.9); display: flex; align-items: center; justify-content: center; z-index: 3000; }
        .spinner { width: 32px; height: 32px; border: 3px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.6s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* SharePoint connection styles */
        .sp-connected { background: rgba(76, 175, 80, 0.1); color: #4caf50; }
        .sp-disconnected { background: rgba(255, 152, 0, 0.1); color: #ff9800; }
        .sync-spin { animation: spin 1s linear infinite; }
        
        /* === SISTEMA DE PROTECCIÓN DE DATOS === */
        .data-protection-bar {
            position: fixed;
            bottom: 0;
            left: 240px;
            right: 0;
            background: linear-gradient(135deg, #1565C0, #0D47A1);
            color: white;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
            font-size: 11px;
        }
        .data-protection-bar.warning {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }
        .data-protection-bar.danger {
            background: linear-gradient(135deg, #e53935, #c62828);
            animation: pulse-danger 1.5s infinite;
        }
        .data-protection-bar.success {
            background: linear-gradient(135deg, #43a047, #2e7d32);
        }
        @keyframes pulse-danger {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .protection-status {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .protection-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: rgba(255,255,255,0.15);
            border-radius: 12px;
            font-size: 10px;
        }
        .protection-indicator.active {
            background: rgba(255,255,255,0.25);
        }
        .protection-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4caf50;
        }
        .protection-dot.warning { background: #ffc107; }
        .protection-dot.danger { background: #ff5252; animation: blink 1s infinite; }
        .protection-dot.syncing { background: #2196f3; animation: pulse 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.3); } }
        .protection-actions {
            display: flex;
            gap: 8px;
        }
        .protection-btn {
            padding: 5px 12px;
            border-radius: 6px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .protection-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.5);
        }
        .protection-btn.primary {
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.5);
        }
        
        /* Modal de Recuperación de Datos */
        .recovery-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .recovery-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .recovery-header {
            background: linear-gradient(135deg, #1565C0, #0D47A1);
            color: white;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .recovery-header h3 {
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .recovery-body {
            padding: 20px;
            max-height: 50vh;
            overflow-y: auto;
        }
        .backup-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.2s;
        }
        .backup-item:hover {
            border-color: var(--primary);
            background: rgba(21, 101, 192, 0.05);
        }
        .backup-info h4 {
            font-size: 12px;
            margin-bottom: 2px;
        }
        .backup-info p {
            font-size: 10px;
            color: var(--text-muted);
        }
        .backup-actions {
            display: flex;
            gap: 6px;
        }
        .integrity-check {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
        }
        .integrity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid var(--border-light);
        }
        .integrity-item:last-child { border-bottom: none; }
        .integrity-status {
            font-size: 11px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
        }
        .integrity-status.ok { background: rgba(76, 175, 80, 0.15); color: #43a047; }
        .integrity-status.warning { background: rgba(255, 193, 7, 0.15); color: #f9a825; }
        .integrity-status.error { background: rgba(244, 67, 54, 0.15); color: #e53935; }
        
        /* Search */
        .search-wrap { position: relative; margin-bottom: 12px; }
        .search-input { width: 100%; padding: 8px 12px 8px 32px; border: 1px solid var(--border); border-radius: 6px; font-size: 12px; }
        .search-icon { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-muted); width: 14px; height: 14px; }
        
        .filters { display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 12px; }
        .filter { padding: 4px 10px; border-radius: 12px; font-size: 10px; font-weight: 600; cursor: pointer; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-secondary); transition: all 0.15s; }
        .filter:hover { border-color: var(--primary-light); color: var(--primary); }
        .filter.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        /* Print */
        .print-only { display: none; }
        
        /* ========== VOLANTE - DISEÑO COMPACTO 3 POR PÁGINA ========== */
        .volante {
            border: 1px solid #000;
            padding: 8px 10px;
            margin-bottom: 8px;
            page-break-inside: avoid;
            font-family: Arial, sans-serif;
            font-size: 11px;
            background: #fff;
        }
        
        /* Header: Empresa centrada */
        .volante-header {
            text-align: center;
            border-bottom: 1px solid #000;
            padding-bottom: 4px;
            margin-bottom: 6px;
        }
        .volante-header h2 {
            font-size: 13px;
            font-weight: bold;
            margin: 0;
            font-style: italic;
        }
        .volante-header p {
            font-size: 9px;
            margin: 1px 0;
            font-style: italic;
        }
        
        /* Info row: ID, Período, Nómina# */
        .volante-info-row {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            margin-bottom: 4px;
            padding: 2px 0;
        }
        .volante-info-row span { font-weight: normal; }
        
        /* Datos empleado */
        .volante-empleado {
            margin-bottom: 6px;
        }
        .volante-empleado-nombre {
            font-size: 13px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 2px;
        }
        .volante-empleado-datos {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            padding: 3px 0;
            border-top: 1px solid #ccc;
            border-bottom: 1px solid #ccc;
        }
        .volante-empleado-datos span { display: flex; gap: 4px; }
        .volante-empleado-datos label { font-weight: normal; color: #555; font-size: 9px; }
        
        /* Grid de Ingresos y Deducciones */
        .volante-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 6px;
        }
        .volante-col h4 {
            font-size: 10px;
            font-weight: bold;
            text-align: center;
            background: #e8e8e8;
            border: 1px solid #999;
            padding: 2px 4px;
            margin: 0 0 3px 0;
        }
        .volante-row {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            padding: 1px 3px;
            border-bottom: 1px dotted #ccc;
        }
        .volante-row:last-child { border-bottom: none; }
        .volante-row.total-row {
            border-top: 1px solid #000;
            border-bottom: none;
            font-weight: bold;
            padding-top: 3px;
            margin-top: 3px;
        }
        .volante-row .monto { 
            font-family: 'Consolas', 'Courier New', monospace;
            text-align: right;
        }
        
        /* Pie: Totales y Firma */
        .volante-footer {
            display: flex;
            align-items: stretch;
            gap: 10px;
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px solid #000;
        }
        .volante-firma {
            flex: 1;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }
        .volante-firma-line {
            border-bottom: 1px solid #000;
            height: 18px;
            margin-bottom: 2px;
        }
        .volante-firma span {
            font-size: 8px;
            color: #555;
        }
        .volante-neto {
            flex: 1.2;
            background: #000;
            color: #fff;
            text-align: center;
            padding: 6px 8px;
            border: 2px solid #000;
        }
        .volante-neto label {
            font-size: 9px;
            display: block;
            margin-bottom: 2px;
        }
        .volante-neto .monto {
            font-size: 16px;
            font-weight: bold;
            font-family: 'Consolas', 'Courier New', monospace;
        }
        .volante-totales-ded {
            flex: 0.8;
            text-align: right;
            font-size: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .volante-totales-ded div {
            display: flex;
            justify-content: space-between;
            padding: 1px 0;
        }
        .volante-totales-ded .monto {
            font-family: 'Consolas', 'Courier New', monospace;
            margin-left: 8px;
        }
        
        /* Responsive */
        @media (max-width: 1400px) { .stats { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 1000px) { .stats { grid-template-columns: repeat(2, 1fr); } .form-grid { grid-template-columns: repeat(2, 1fr); } .summary-grid { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { .sidebar { display: none; } .main { margin-left: 0; } .stats { grid-template-columns: 1fr; } .form-grid { grid-template-columns: 1fr; } }
        
        @media print {
            /* Ocultar todo excepto área de impresión */
            body * { visibility: hidden; }
            
            /* Hacer visible el área de impresión y todos sus ancestros */
            .print-area, .print-area * { 
                visibility: visible !important; 
            }
            
            /* Hacer visible el modal si contiene print-area */
            .modal-backdrop:has(.print-area),
            .modal-backdrop:has(.print-area) * {
                visibility: visible !important;
            }
            
            .print-area { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                margin: 0;
                padding: 10px;
            }
            
            /* Excepción: cuando se imprimen volantes, el print-area NO debe ser absolute */
            body.printing-volantes .print-area {
                position: relative !important;
                top: auto !important;
                left: auto !important;
            }
            
            .no-print { display: none !important; }
            
            /* Evitar páginas en blanco */
            html, body {
                height: auto !important;
                overflow: visible !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* Evitar páginas en blanco al final del documento */
            html::after, body::after {
                content: none !important;
                display: none !important;
            }
            
            /* Eliminar cualquier espacio extra al final */
            .print-area:last-child {
                margin-bottom: 0 !important;
                padding-bottom: 0 !important;
            }
            
            /* Nómina: evitar saltos de página innecesarios */
            .print-area table {
                page-break-inside: auto !important;
            }
            .print-area tr {
                page-break-inside: avoid !important;
                page-break-after: auto !important;
            }
            .print-area thead {
                display: table-header-group !important;
            }
            .print-area tfoot {
                display: table-footer-group !important;
            }
            
            /* Ocultar elementos de la interfaz */
            .sidebar, .toasts, .loading, header, nav, footer {
                display: none !important;
                height: 0 !important;
                overflow: hidden !important;
            }
            
            /* Modal: ocultar decoración pero mostrar contenido */
            .modal-backdrop {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: auto !important;
                background: transparent !important;
                padding: 0 !important;
                margin: 0 !important;
                overflow: visible !important;
            }
            
            .modal {
                position: relative !important;
                width: 100% !important;
                max-width: 100% !important;
                height: auto !important;
                max-height: none !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                border: none !important;
                background: white !important;
                transform: none !important;
            }
            
            .modal-header, .modal-footer {
                display: none !important;
            }
            
            .modal-body {
                padding: 0 !important;
                max-height: none !important;
                overflow: visible !important;
            }
            
            .app, .main {
                display: block !important;
                min-height: auto !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* Por defecto: landscape para tablas de nómina */
            @page { 
                margin: 5mm; 
                size: letter landscape;
            }
            
            /* Forzar impresión en blanco y negro */
            .print-area, .print-area * { 
                color: #000 !important; 
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* Contenedor de volantes sin espacio extra */
            .volantes-container,
            .print-area {
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* Fondos claros para impresión */
            .print-area table { background: #fff !important; }
            .print-area th { background: #e0e0e0 !important; color: #000 !important; border: 1px solid #000 !important; }
            .print-area td { border: 1px solid #999 !important; background: #fff !important; }
            .print-area tr:nth-child(even) td { background: #f5f5f5 !important; }
            
            /* Cuando hay volantes, cambiar a portrait */
            .print-area:has(.volante) {
                break-before: auto;
            }
            
            /* ========== VOLANTES - FORZAR 3 POR PÁGINA ========== */
            @page volantes {
                margin: 4mm 6mm;
                size: letter portrait;
            }
            .volante { page: volantes; }
            
            /* Carta portrait: 279mm alto - 8mm márgenes = 271mm. 3 volantes × 88mm + 2 × 2mm = 268mm ✓ */
            .volante { 
                border: 1px solid #000 !important; 
                background: #fff !important; 
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                margin: 0 !important;
                margin-bottom: 2mm !important;
                padding: 2mm 3mm !important;
                width: 100% !important;
                box-sizing: border-box !important;
                height: 88mm !important;
                min-height: 88mm !important;
                max-height: 88mm !important;
                overflow: hidden !important;
            }
            
            /* Primer volante sin margen superior */
            .volante:first-child { margin-top: 0 !important; }
            
            /* Cada 3er volante fuerza salto de página después */
            .volante:nth-child(3n) { 
                page-break-after: always !important;
                margin-bottom: 0 !important;
            }
            
            /* Header */
            .volante-header { 
                text-align: center !important;
                border-bottom: 1px solid #000 !important;
                padding-bottom: 1.5mm !important;
                margin-bottom: 1.5mm !important;
            }
            .volante-header h2 { font-size: 11pt !important; margin: 0 !important; }
            .volante-header p { font-size: 8pt !important; margin: 0.5mm 0 !important; }
            
            /* Info row */
            .volante-info-row {
                display: flex !important;
                justify-content: space-between !important;
                font-size: 9pt !important;
                margin-bottom: 1mm !important;
            }
            
            /* Empleado */
            .volante-empleado { margin-bottom: 1.5mm !important; }
            .volante-empleado-nombre { font-size: 11pt !important; font-weight: bold !important; }
            .volante-empleado-datos { 
                display: flex !important;
                justify-content: space-between !important;
                font-size: 9pt !important;
                padding: 1mm 0 !important;
                border-top: 1px solid #999 !important;
                border-bottom: 1px solid #999 !important;
            }
            .volante-empleado-datos label { font-size: 8pt !important; color: #333 !important; }
            
            /* Grid */
            .volante-grid {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 3mm !important;
                margin-bottom: 1.5mm !important;
            }
            .volante-col h4 { 
                font-size: 9pt !important; 
                background: #e0e0e0 !important;
                border: 1px solid #999 !important;
                padding: 1mm !important;
                margin: 0 0 1mm 0 !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .volante-row { font-size: 9pt !important; padding: 0.5mm 1mm !important; }
            .volante-row.total-row { 
                border-top: 1px solid #000 !important;
                font-weight: bold !important;
                padding-top: 1mm !important;
                margin-top: 1mm !important;
            }
            
            /* Footer */
            .volante-footer {
                display: flex !important;
                gap: 3mm !important;
                padding-top: 1.5mm !important;
                border-top: 1px solid #000 !important;
                margin-top: auto !important;
            }
            .volante-firma { flex: 1 !important; text-align: center !important; }
            .volante-firma-line { border-bottom: 1px solid #000 !important; height: 12mm !important; }
            .volante-firma span { font-size: 7pt !important; }
            .volante-neto {
                flex: 1 !important;
                background: #000 !important;
                color: #fff !important;
                padding: 2mm !important;
                text-align: center !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .volante-neto label { font-size: 8pt !important; color: #fff !important; }
            .volante-neto .monto { font-size: 13pt !important; color: #fff !important; font-weight: bold !important; }
            .volante-totales-ded { flex: 0.8 !important; font-size: 8pt !important; }
            }
            
            /* Datos en línea horizontal */
            .volante-datos-linea { 
                display: flex !important;
                gap: 2mm !important;
                background: #f0f0f0 !important;
                padding: 0.8mm 1.5mm !important;
                margin-bottom: 1mm !important;
                flex-shrink: 0 !important;
            }
            .volante-datos-linea div { flex: 1 !important; }
            .volante-datos-linea label { font-size: 5px !important; color: #555 !important; text-transform: uppercase !important; }
            .volante-datos-linea span { font-size: 8px !important; font-weight: 600 !important; }
            
            /* Detalle de ingresos y deducciones */
            .volante-detalle { 
                gap: 2mm !important; 
                margin-bottom: 0.5mm !important;
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                flex: 1 !important;
                min-height: 0 !important;
                overflow: hidden !important;
            }
            .volante-seccion { 
                display: flex !important;
                flex-direction: column !important;
                overflow: hidden !important;
            }
            .volante-seccion h4 { 
                font-size: 7px !important; 
                padding: 0.4mm 1mm !important; 
                margin-bottom: 0.4mm !important;
                background: #e0e0e0 !important;
                border: 1px solid #999 !important;
                font-weight: bold !important;
                flex-shrink: 0 !important;
            }
            .volante-linea { 
                font-size: 8px !important; 
                padding: 0.3mm 0.8mm !important;
                display: flex !important;
                justify-content: space-between !important;
            }
            .volante-linea.total { 
                margin-top: auto !important; 
                padding: 0.6mm 0.8mm !important;
                font-weight: bold !important;
                border-top: 1px solid #333 !important;
                font-size: 8px !important;
                background: #e8e8e8 !important;
            }
            
            /* Ausencias más visibles */
            .volante-ausencias {
                background: #f5f5f5 !important;
                font-weight: 600 !important;
            }
            
            /* Pie: Firmas + NETO en una fila */
            .volante-pie {
                display: flex !important;
                align-items: flex-end !important;
                gap: 1.5mm !important;
                margin-top: auto !important;
                padding-top: 0.5mm !important;
                flex-shrink: 0 !important;
            }
            .volante-firma-box {
                flex: 1 !important;
                text-align: center !important;
            }
            .volante-firma-box .volante-firma-linea {
                border-top: 1px solid #333 !important;
                height: 4mm !important;
                margin-bottom: 0.3mm !important;
            }
            .volante-firma-box span {
                font-size: 5px !important;
                color: #333 !important;
            }
            .volante-neto-box {
                flex: 1.2 !important;
                background: #d0d0d0 !important;
                border: 1px solid #000 !important;
                padding: 0.8mm !important;
                text-align: center !important;
            }
            .volante-neto-box label {
                font-size: 5px !important;
                font-weight: bold !important;
                display: block !important;
            }
            .volante-neto-box span {
                font-size: 10px !important;
                font-weight: bold !important;
            }
            
            /* Salto de página después de cada 3 volantes */
            .volante:nth-child(3n) {
                page-break-after: always !important;
                break-after: page !important;
                margin-bottom: 0 !important;
            }
            /* No salto después del último */
            .volante:last-child {
                page-break-after: auto !important;
                break-after: auto !important;
                margin-bottom: 0 !important;
            }
            
            /* Neto destacado sin color */
            .neto-print { background: #d0d0d0 !important; font-weight: bold !important; border: 2px solid #000 !important; }
            
            /* Cuando se imprimen volantes desde el modal */
            body.printing-volantes * {
                visibility: hidden;
            }
            
            body.printing-volantes .modal-backdrop {
                visibility: visible !important;
                display: block !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                width: 100% !important;
                height: auto !important;
                background: white !important;
                padding: 0 !important;
                margin: 0 !important;
                overflow: visible !important;
            }
            
            body.printing-volantes .modal {
                visibility: visible !important;
                position: relative !important;
                box-shadow: none !important;
                max-width: 100% !important;
                width: 100% !important;
                height: auto !important;
                max-height: none !important;
                margin: 0 !important;
                padding: 0 !important;
                transform: none !important;
                border: none !important;
                border-radius: 0 !important;
            }
            
            body.printing-volantes .modal-header,
            body.printing-volantes .modal-footer {
                display: none !important;
                visibility: hidden !important;
            }
            
            body.printing-volantes .modal-body {
                visibility: visible !important;
                max-height: none !important;
                overflow: visible !important;
                padding: 10px !important;
                height: auto !important;
            }
            
            body.printing-volantes .modal-body .print-area {
                visibility: visible !important;
                position: relative !important;
                top: auto !important;
                left: auto !important;
                width: 100% !important;
            }
            
            body.printing-volantes .modal-body .print-area *,
            body.printing-volantes .volante,
            body.printing-volantes .volante *,
            body.printing-volantes .volante-header,
            body.printing-volantes .volante-header *,
            body.printing-volantes .volante-empleado,
            body.printing-volantes .volante-empleado *,
            body.printing-volantes .volante-detalle,
            body.printing-volantes .volante-detalle *,
            body.printing-volantes .volante-seccion,
            body.printing-volantes .volante-seccion *,
            body.printing-volantes .volante-neto,
            body.printing-volantes .volante-neto *,
            body.printing-volantes .volante-firmas,
            body.printing-volantes .volante-firmas * {
                visibility: visible !important;
            }
            
            body.printing-volantes .volante {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                margin-bottom: 2mm !important;
                height: 88mm !important;
                min-height: 88mm !important;
                max-height: 88mm !important;
            }
            
            body.printing-volantes .volante:nth-child(3n) {
                page-break-after: always !important;
                margin-bottom: 0 !important;
            }
            
            /* ========== ESTILOS IMPRESIÓN CHECKLIST PAGOS POR BANCO ========== */
            
            /* Ocultar todo con visibility */
            body.printing-checklist * {
                visibility: hidden !important;
            }
            
            /* Mostrar el contenido del checklist */
            body.printing-checklist .modal-backdrop,
            body.printing-checklist .modal,
            body.printing-checklist .modal-body,
            body.printing-checklist .print-pagos-banco,
            body.printing-checklist .print-pagos-banco * {
                visibility: visible !important;
            }
            
            body.printing-checklist .modal-backdrop {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                background: white !important;
                padding: 0 !important;
                height: auto !important;
                overflow: visible !important;
            }
            
            body.printing-checklist .modal {
                position: relative !important;
                max-width: 100% !important;
                width: 100% !important;
                max-height: none !important;
                height: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                border: none !important;
                transform: none !important;
            }
            
            body.printing-checklist .modal-header,
            body.printing-checklist .modal-footer {
                display: none !important;
            }
            
            body.printing-checklist .modal-body {
                padding: 5mm !important;
                max-height: none !important;
                overflow: visible !important;
                height: auto !important;
            }
            
            body.printing-checklist .print-pagos-banco {
                font-size: 11px !important;
                width: 100% !important;
            }
            
            body.printing-checklist .print-pagos-banco table {
                width: 100% !important;
                border-collapse: collapse !important;
            }
            
            body.printing-checklist .print-pagos-banco th,
            body.printing-checklist .print-pagos-banco td {
                border: 1px solid #333 !important;
                padding: 5px 8px !important;
                font-size: 10px !important;
                background: white !important;
            }
            
            body.printing-checklist .print-pagos-banco th {
                font-weight: bold !important;
                font-size: 9px !important;
            }
            
            /* Quitar todos los colores de fondo */
            body.printing-checklist .print-pagos-banco div[style*="background"] {
                background: white !important;
                color: #000 !important;
                border: 1px solid #333 !important;
            }
            
            body.printing-checklist .print-pagos-banco span[style*="color"] {
                color: #000 !important;
            }
            
            /* Checkbox */
            body.printing-checklist .print-pagos-banco div[style*="border: 2px solid"] {
                border: 2px solid #000 !important;
                background: white !important;
            }
            
            /* Ocultar nota de EPSON en impresión */
            body.printing-checklist .no-print {
                display: none !important;
                visibility: hidden !important;
            }
            
            @page {
                margin: 5mm !important;
                size: letter landscape !important;
            }
        }
        
        /* ========== ESTILOS IMPRESIÓN CENTRO DE REPORTES ========== */
        @media print {
            body.printing-reportes * {
                visibility: hidden !important;
            }
            
            body.printing-reportes .modal-backdrop,
            body.printing-reportes .modal,
            body.printing-reportes .modal-body,
            body.printing-reportes .reporte-print-area,
            body.printing-reportes .reporte-print-area * {
                visibility: visible !important;
            }
            
            body.printing-reportes .modal-backdrop {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                background: white !important;
                padding: 0 !important;
                height: auto !important;
                overflow: visible !important;
            }
            
            body.printing-reportes .modal {
                position: relative !important;
                max-width: 100% !important;
                width: 100% !important;
                max-height: none !important;
                height: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                border: none !important;
                transform: none !important;
            }
            
            body.printing-reportes .modal-header,
            body.printing-reportes .modal-footer,
            body.printing-reportes .reporte-selector,
            body.printing-reportes .no-print {
                display: none !important;
            }
            
            body.printing-reportes .modal-body {
                padding: 5mm !important;
                max-height: none !important;
                overflow: visible !important;
                height: auto !important;
            }
            
            body.printing-reportes .reporte-print-area {
                font-size: 9px !important;
                width: 100% !important;
            }
            
            body.printing-reportes .reporte-print-area table {
                width: 100% !important;
                border-collapse: collapse !important;
                page-break-inside: auto !important;
            }
            
            body.printing-reportes .reporte-print-area tr {
                page-break-inside: avoid !important;
                page-break-after: auto !important;
            }
            
            body.printing-reportes .reporte-print-area th,
            body.printing-reportes .reporte-print-area td {
                border: 1px solid #333 !important;
                padding: 3px 5px !important;
                font-size: 8px !important;
            }
            
            body.printing-reportes .reporte-print-area th {
                background: #e0e0e0 !important;
                font-weight: bold !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            body.printing-reportes .reporte-seccion {
                page-break-inside: avoid !important;
                margin-bottom: 10px !important;
            }
            
            body.printing-reportes .reporte-firmas {
                page-break-inside: avoid !important;
                margin-top: 20px !important;
            }
        }
        
        /* ========================================== */
        /* ESTILOS LOGIN EDUCATIVO TEHUI */
        /* ========================================== */
        .login-container-edu {
            display: flex;
            width: 100%;
            min-height: 100vh;
        }

        .login-panel-edu {
            width: 320px;
            min-width: 320px;
            background: linear-gradient(180deg, #1e3a5f 0%, #0d47a1 100%);
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .logo-container-edu {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo-container-edu img {
            width: 160px;
            height: auto;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }

        .logo-subtitle-edu {
            color: #90caf9;
            font-size: 11px;
            margin-top: 8px;
            font-style: italic;
        }

        .system-title-edu {
            color: white;
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 30px;
            text-align: center;
        }

        .form-group-edu {
            width: 100%;
            margin-bottom: 20px;
        }

        .form-group-edu label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .form-group-edu input {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: box-shadow 0.3s;
        }

        .form-group-edu input:focus {
            box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.4);
        }

        .form-group-edu input::placeholder {
            color: #999;
        }

        .btn-login-edu {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        .btn-login-edu:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(30, 136, 229, 0.4);
        }

        .footer-text-edu {
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            margin-top: 30px;
            text-align: center;
        }

        .illustration-panel-edu {
            flex: 1;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 50%, #90caf9 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            position: relative;
            overflow: hidden;
        }

        .welcome-message-edu {
            text-align: center;
            z-index: 10;
            margin-bottom: 20px;
        }

        .welcome-title-edu {
            font-size: 36px;
            color: #1565c0;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .welcome-subtitle-edu {
            font-size: 18px;
            color: #1976d2;
            font-weight: 400;
        }

        .illustration-container-edu {
            position: relative;
            width: 100%;
            max-width: 650px;
            height: 380px;
        }

        .floating-element-edu {
            position: absolute;
            animation: floatEdu 3s ease-in-out infinite;
        }

        @keyframes floatEdu {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }

        .cloud-edu {
            fill: white;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.1));
        }

        .star-edu {
            fill: #ffd54f;
            animation: twinkleEdu 2s ease-in-out infinite;
        }

        @keyframes twinkleEdu {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.9); }
        }

        .values-container-edu {
            display: flex;
            gap: 30px;
            margin-top: 20px;
            z-index: 10;
        }

        .value-item-edu {
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .value-item-edu:hover {
            transform: translateY(-5px);
        }

        .value-icon-edu {
            font-size: 30px;
            margin-bottom: 8px;
        }

        .value-text-edu {
            color: #1565c0;
            font-weight: 600;
            font-size: 14px;
        }

        .error-message-edu {
            background: rgba(229, 57, 53, 0.15);
            border: 1px solid rgba(229, 57, 53, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            color: #ffcdd2;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (max-width: 900px) {
            .login-container-edu {
                flex-direction: column;
            }
            .login-panel-edu {
                width: 100%;
                min-height: 100vh;
            }
            .illustration-panel-edu {
                display: none;
            }
        }
    </style>
</head>
<body>
<div id="root"></div>

<!-- ============================================================================
     MÓDULO DE ENCRIPTACIÓN AES-256 - SISTEMA DE NÓMINA TEHUI v1.0
     PROTECCIÓN DE DATOS SENSIBLES
     ============================================================================ -->
<script>
(function() {
    'use strict';
    
    // Clave de encriptación derivada del sistema (en producción usar clave segura)
    const CLAVE_MAESTRA = 'T3hu1-N0m1n4-S3gur4-2025-C3ntr0-3duc4t1v0';
    
    // ========================================
    // SISTEMA DE ENCRIPTACIÓN AES-256
    // ========================================
    const CryptoTehui = {
        // Generar clave desde texto
        async generarClave(texto) {
            const encoder = new TextEncoder();
            const data = encoder.encode(texto);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return await crypto.subtle.importKey(
                'raw', hash, { name: 'AES-GCM' }, false, ['encrypt', 'decrypt']
            );
        },
        
        // Encriptar datos
        async encriptar(datos) {
            try {
                const clave = await this.generarClave(CLAVE_MAESTRA);
                const encoder = new TextEncoder();
                const iv = crypto.getRandomValues(new Uint8Array(12));
                const datosStr = typeof datos === 'string' ? datos : JSON.stringify(datos);
                
                const encrypted = await crypto.subtle.encrypt(
                    { name: 'AES-GCM', iv: iv },
                    clave,
                    encoder.encode(datosStr)
                );
                
                // Combinar IV + datos encriptados
                const combined = new Uint8Array(iv.length + encrypted.byteLength);
                combined.set(iv);
                combined.set(new Uint8Array(encrypted), iv.length);
                
                // Convertir a base64
                return btoa(String.fromCharCode(...combined));
            } catch (e) {
                console.error('Error encriptando:', e);
                return null;
            }
        },
        
        // Desencriptar datos
        async desencriptar(datosEncriptados) {
            try {
                const clave = await this.generarClave(CLAVE_MAESTRA);
                
                // Decodificar base64
                const combined = new Uint8Array(
                    atob(datosEncriptados).split('').map(c => c.charCodeAt(0))
                );
                
                // Extraer IV y datos
                const iv = combined.slice(0, 12);
                const encrypted = combined.slice(12);
                
                const decrypted = await crypto.subtle.decrypt(
                    { name: 'AES-GCM', iv: iv },
                    clave,
                    encrypted
                );
                
                const decoder = new TextDecoder();
                const texto = decoder.decode(decrypted);
                
                // Intentar parsear como JSON
                try {
                    return JSON.parse(texto);
                } catch {
                    return texto;
                }
            } catch (e) {
                console.error('Error desencriptando:', e);
                return null;
            }
        },
        
        // Hash SHA-256 para contraseñas
        async hashPassword(password, salt = 'ThuiSalt2025') {
            const encoder = new TextEncoder();
            const data = encoder.encode(password + salt);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        },
        
        // Verificar contraseña contra hash
        async verificarPassword(password, hashGuardado, salt = 'ThuiSalt2025') {
            const hashCalculado = await this.hashPassword(password, salt);
            return hashCalculado === hashGuardado;
        },
        
        // Encriptar campo específico (para datos sensibles)
        async encriptarCampo(valor) {
            if (!valor || valor === '') return valor;
            return await this.encriptar(valor);
        },
        
        // Desencriptar campo específico
        async desencriptarCampo(valorEncriptado) {
            if (!valorEncriptado || valorEncriptado === '') return valorEncriptado;
            // Verificar si parece estar encriptado (base64 largo)
            if (valorEncriptado.length < 30 || !valorEncriptado.match(/^[A-Za-z0-9+/=]+$/)) {
                return valorEncriptado; // No está encriptado
            }
            return await this.desencriptar(valorEncriptado);
        },
        
        // Enmascarar datos para visualización
        enmascarar(valor, tipo = 'cuenta') {
            if (!valor) return '';
            const str = String(valor);
            if (tipo === 'cuenta') {
                // Mostrar solo últimos 4 dígitos: ****1234
                return '****' + str.slice(-4);
            } else if (tipo === 'cedula') {
                // Mostrar solo últimos 4 dígitos: ***-*****-1234
                return '***-*****-' + str.slice(-4);
            } else if (tipo === 'salario') {
                // No mostrar monto exacto
                return 'RD$ ***,***';
            }
            return '****';
        }
    };
    
    // Exportar globalmente
    window.CryptoTehui = CryptoTehui;
    console.log('🔐 Módulo de Encriptación AES-256 cargado');
})();
</script>

<!-- ============================================================================
     MÓDULO DE DISPONIBILIDAD Y RESILIENCIA - SISTEMA DE NÓMINA TEHUI v1.0
     GARANTIZAR ACCESO CONTINUO A LOS DATOS
     ============================================================================ -->
<script>
(function() {
    'use strict';
    
    const DisponibilidadTehui = {
        // Estado de conexión
        estado: {
            online: navigator.onLine,
            sharePointConectado: false,
            ultimaSync: null,
            intentosReconexion: 0,
            maxIntentos: 5
        },
        
        // Iniciar monitoreo de conexión
        iniciarMonitoreo() {
            // Detectar cambios de conexión
            window.addEventListener('online', () => {
                this.estado.online = true;
                this.notificar('🌐 Conexión restaurada', 'success');
                this.intentarReconexion();
            });
            
            window.addEventListener('offline', () => {
                this.estado.online = false;
                this.notificar('⚠️ Sin conexión a internet - Modo offline activado', 'warning');
            });
            
            // Verificar conexión periódicamente
            setInterval(() => this.verificarConexion(), 30000);
            
            console.log('📡 Monitoreo de disponibilidad iniciado');
        },
        
        // Verificar estado de conexión
        async verificarConexion() {
            try {
                const response = await fetch('https://www.google.com/favicon.ico', {
                    mode: 'no-cors',
                    cache: 'no-store'
                });
                this.estado.online = true;
                return true;
            } catch {
                this.estado.online = false;
                return false;
            }
        },
        
        // Intentar reconexión a SharePoint
        async intentarReconexion() {
            if (this.estado.intentosReconexion >= this.maxIntentos) {
                this.notificar('❌ Máximo de intentos de reconexión alcanzado', 'error');
                return false;
            }
            
            this.estado.intentosReconexion++;
            // La reconexión real se maneja en el componente React
            return true;
        },
        
        // Sistema de caché local robusto
        cache: {
            guardar(clave, datos) {
                try {
                    const item = {
                        datos: datos,
                        timestamp: Date.now(),
                        version: '3.88'
                    };
                    localStorage.setItem('cache_' + clave, JSON.stringify(item));
                    return true;
                } catch (e) {
                    console.error('Error guardando en caché:', e);
                    return false;
                }
            },
            
            obtener(clave, maxEdadMs = 3600000) { // 1 hora por defecto
                try {
                    const item = JSON.parse(localStorage.getItem('cache_' + clave));
                    if (!item) return null;
                    
                    // Verificar si el caché expiró
                    if (Date.now() - item.timestamp > maxEdadMs) {
                        localStorage.removeItem('cache_' + clave);
                        return null;
                    }
                    
                    return item.datos;
                } catch {
                    return null;
                }
            },
            
            limpiar() {
                const claves = Object.keys(localStorage).filter(k => k.startsWith('cache_'));
                claves.forEach(k => localStorage.removeItem(k));
            }
        },
        
        // Cola de operaciones pendientes (para modo offline)
        colaPendiente: {
            agregar(operacion) {
                const cola = JSON.parse(localStorage.getItem('cola_pendiente') || '[]');
                cola.push({
                    ...operacion,
                    timestamp: Date.now(),
                    id: Date.now() + '_' + Math.random().toString(36).substr(2, 9)
                });
                localStorage.setItem('cola_pendiente', JSON.stringify(cola));
            },
            
            obtener() {
                return JSON.parse(localStorage.getItem('cola_pendiente') || '[]');
            },
            
            limpiar() {
                localStorage.removeItem('cola_pendiente');
            },
            
            remover(id) {
                const cola = this.obtener().filter(op => op.id !== id);
                localStorage.setItem('cola_pendiente', JSON.stringify(cola));
            }
        },
        
        // Notificaciones (se conecta con el sistema de toasts)
        notificar(mensaje, tipo) {
            console.log(`[${tipo.toUpperCase()}] ${mensaje}`);
            // El componente React escuchará estos eventos
            window.dispatchEvent(new CustomEvent('disponibilidad-notificacion', {
                detail: { mensaje, tipo }
            }));
        },
        
        // Exportación automática de seguridad
        async exportarBackupAutomatico() {
            try {
                const datos = {};
                ['empleados', 'prestamos', 'licencias', 'nominas', 'config', 'catalogos'].forEach(clave => {
                    const valor = localStorage.getItem('nominaTehui_' + clave);
                    if (valor) datos[clave] = JSON.parse(valor);
                });
                
                const backup = {
                    tipo: 'backup_automatico',
                    fecha: new Date().toISOString(),
                    version: '3.88',
                    datos: datos
                };
                
                // Guardar en IndexedDB como respaldo adicional
                if (window.indexedDB) {
                    const request = indexedDB.open('ThuiBackups', 1);
                    request.onupgradeneeded = (e) => {
                        const db = e.target.result;
                        if (!db.objectStoreNames.contains('backups')) {
                            db.createObjectStore('backups', { keyPath: 'fecha' });
                        }
                    };
                    request.onsuccess = (e) => {
                        const db = e.target.result;
                        const tx = db.transaction('backups', 'readwrite');
                        const store = tx.objectStore('backups');
                        store.put(backup);
                    };
                }
                
                return backup;
            } catch (e) {
                console.error('Error en backup automático:', e);
                return null;
            }
        },
        
        // Recuperar de IndexedDB
        async recuperarDeIndexedDB() {
            return new Promise((resolve, reject) => {
                if (!window.indexedDB) {
                    resolve(null);
                    return;
                }
                
                const request = indexedDB.open('ThuiBackups', 1);
                request.onerror = () => resolve(null);
                request.onsuccess = (e) => {
                    try {
                        const db = e.target.result;
                        const tx = db.transaction('backups', 'readonly');
                        const store = tx.objectStore('backups');
                        const getAll = store.getAll();
                        
                        getAll.onsuccess = () => {
                            const backups = getAll.result;
                            if (backups.length > 0) {
                                // Retornar el más reciente
                                backups.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
                                resolve(backups[0]);
                            } else {
                                resolve(null);
                            }
                        };
                        getAll.onerror = () => resolve(null);
                    } catch {
                        resolve(null);
                    }
                };
            });
        }
    };
    
    // Iniciar monitoreo
    DisponibilidadTehui.iniciarMonitoreo();
    
    // Backup automático cada 15 minutos
    setInterval(() => {
        DisponibilidadTehui.exportarBackupAutomatico();
    }, 900000); // 15 minutos
    
    // Exportar globalmente
    window.DisponibilidadTehui = DisponibilidadTehui;
    console.log('📡 Módulo de Disponibilidad y Resiliencia cargado');
})();
</script>

<!-- ============================================================================
     MÓDULO DE PROTECCIÓN DE DATOS - SISTEMA DE NÓMINA TEHUI v3.0
     PRIORIDAD: PROTEGER LA INFORMACIÓN A TODA COSTA
     ============================================================================ -->
<script>
(function() {
    'use strict';
    
    const CONFIG_PROTECCION = {
        VERSION_MODULO: '3.0.0',
        PREFIX_STORAGE: 'nominaTehui_',
        MAX_BACKUPS: 15,
        INTERVALO_BACKUP: 300000, // 5 minutos
        INTERVALO_VERIFICACION: 60000, // Verificar integridad cada 1 minuto
        CLAVES_DATOS: ['empleados', 'prestamos', 'licencias', 'nominas', 'config', 'catalogos'],
        CLAVES_CRITICAS: ['empleados', 'nominas', 'prestamos'],
        CHECKSUM_KEY: 'nominaTehui_checksums',
        ULTIMO_GUARDADO_KEY: 'nominaTehui_ultimoGuardado',
        ESTADO_SYNC_KEY: 'nominaTehui_estadoSync',
        DATOS_ENCRIPTADOS: true, // Nueva bandera para encriptación
    };

    // ========================================
    // SISTEMA DE CHECKSUMS PARA INTEGRIDAD
    // ========================================
    const SistemaChecksum = {
        // Generar checksum simple pero efectivo
        generarChecksum: function(datos) {
            const str = JSON.stringify(datos);
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convertir a 32bit integer
            }
            return hash.toString(16);
        },
        
        // Guardar checksums de todos los datos
        guardarChecksums: function() {
            const checksums = {};
            CONFIG_PROTECCION.CLAVES_DATOS.forEach(function(clave) {
                const key = CONFIG_PROTECCION.PREFIX_STORAGE + clave;
                const valor = localStorage.getItem(key);
                if (valor) {
                    checksums[clave] = SistemaChecksum.generarChecksum(valor);
                }
            });
            checksums.timestamp = Date.now();
            localStorage.setItem(CONFIG_PROTECCION.CHECKSUM_KEY, JSON.stringify(checksums));
            return checksums;
        },
        
        // Verificar integridad de los datos
        verificarIntegridad: function() {
            const resultado = {
                valido: true,
                errores: [],
                advertencias: [],
                detalles: {}
            };
            
            try {
                const checksumsGuardados = JSON.parse(localStorage.getItem(CONFIG_PROTECCION.CHECKSUM_KEY) || '{}');
                
                CONFIG_PROTECCION.CLAVES_DATOS.forEach(function(clave) {
                    const key = CONFIG_PROTECCION.PREFIX_STORAGE + clave;
                    const valor = localStorage.getItem(key);
                    
                    if (!valor) {
                        resultado.detalles[clave] = { status: 'vacio', mensaje: 'Sin datos' };
                        return;
                    }
                    
                    // Verificar que sea JSON válido
                    try {
                        JSON.parse(valor);
                    } catch (e) {
                        resultado.valido = false;
                        resultado.errores.push('Datos corruptos en: ' + clave);
                        resultado.detalles[clave] = { status: 'corrupto', mensaje: 'JSON inválido' };
                        return;
                    }
                    
                    // Verificar checksum si existe
                    const checksumActual = SistemaChecksum.generarChecksum(valor);
                    if (checksumsGuardados[clave] && checksumsGuardados[clave] !== checksumActual) {
                        resultado.advertencias.push('Datos modificados externamente: ' + clave);
                        resultado.detalles[clave] = { status: 'modificado', mensaje: 'Checksum diferente' };
                    } else {
                        resultado.detalles[clave] = { status: 'ok', mensaje: 'Integridad verificada' };
                    }
                });
                
            } catch (e) {
                resultado.valido = false;
                resultado.errores.push('Error al verificar integridad: ' + e.message);
            }
            
            return resultado;
        },
        
        // Recuperar datos corruptos desde backup
        recuperarDesdeBackup: function(clave) {
            const backups = SistemaBackup.listarBackups();
            for (let i = 0; i < backups.length; i++) {
                try {
                    const backup = JSON.parse(localStorage.getItem(backups[i].key));
                    if (backup.datos && backup.datos[clave]) {
                        const key = CONFIG_PROTECCION.PREFIX_STORAGE + clave;
                        localStorage.setItem(key, JSON.stringify(backup.datos[clave]));
                        LogActividad.registrar('DATOS_RECUPERADOS', { clave: clave, backup: backups[i].key });
                        return { exito: true, backup: backups[i].key };
                    }
                } catch (e) { continue; }
            }
            return { exito: false, error: 'No se encontró backup válido' };
        }
    };

    // ========================================
    // SISTEMA DE BACKUP MEJORADO
    // ========================================
    const SistemaBackup = {
        crearBackupCompleto: function() {
            const timestamp = new Date().toISOString();
            const backup = {
                version: CONFIG_PROTECCION.VERSION_MODULO,
                fechaCreacion: timestamp,
                navegador: navigator.userAgent,
                checksums: {},
                datos: {}
            };
            
            CONFIG_PROTECCION.CLAVES_DATOS.forEach(function(clave) {
                const key = CONFIG_PROTECCION.PREFIX_STORAGE + clave;
                const valor = localStorage.getItem(key);
                if (valor) {
                    try { 
                        backup.datos[clave] = JSON.parse(valor);
                        backup.checksums[clave] = SistemaChecksum.generarChecksum(valor);
                    }
                    catch(e) { backup.datos[clave] = valor; }
                }
            });
            
            const backupKey = CONFIG_PROTECCION.PREFIX_STORAGE + 'backup_' + timestamp.replace(/[:.]/g, '-');
            localStorage.setItem(backupKey, JSON.stringify(backup));
            this.limpiarBackupsAntiguos();
            LogActividad.registrar('BACKUP_CREADO', { key: backupKey });
            
            // Actualizar checksums
            SistemaChecksum.guardarChecksums();
            
            return { key: backupKey, timestamp: timestamp, exito: true };
        },
        
        backupAntesCambio: function(razon) {
            const timestamp = Date.now();
            const backupKey = CONFIG_PROTECCION.PREFIX_STORAGE + 'pre_cambio_' + timestamp;
            const backup = { razon: razon, timestamp: timestamp, datos: {} };
            
            CONFIG_PROTECCION.CLAVES_CRITICAS.forEach(function(clave) {
                const key = CONFIG_PROTECCION.PREFIX_STORAGE + clave;
                const valor = localStorage.getItem(key);
                if (valor) {
                    try { backup.datos[clave] = JSON.parse(valor); }
                    catch(e) {}
                }
            });
            
            localStorage.setItem(backupKey, JSON.stringify(backup));
            return backupKey;
        },
        
        listarBackups: function() {
            var backups = [];
            for (var i = 0; i < localStorage.length; i++) {
                var key = localStorage.key(i);
                if (key && (key.indexOf('backup_') > -1 || key.indexOf('pre_cambio_') > -1)) {
                    try {
                        var backup = JSON.parse(localStorage.getItem(key));
                        backups.push({
                            key: key,
                            fecha: backup.fechaCreacion || new Date(backup.timestamp).toISOString(),
                            tipo: key.indexOf('pre_cambio') > -1 ? 'Pre-cambio' : 'Completo',
                            razon: backup.razon || 'Backup programado',
                            tamaño: Math.round(JSON.stringify(backup).length / 1024) + ' KB'
                        });
                    } catch(e) {}
                }
            }
            return backups.sort(function(a, b) { return new Date(b.fecha) - new Date(a.fecha); });
        },
        
        restaurarBackup: function(backupKey) {
            try {
                var backupStr = localStorage.getItem(backupKey);
                if (!backupStr) return { exito: false, error: 'Backup no encontrado' };
                
                var backup = JSON.parse(backupStr);
                this.backupAntesCambio('Pre-restauración de ' + backupKey);
                
                Object.keys(backup.datos).forEach(function(clave) {
                    var key = CONFIG_PROTECCION.PREFIX_STORAGE + clave;
                    localStorage.setItem(key, JSON.stringify(backup.datos[clave]));
                });
                
                LogActividad.registrar('BACKUP_RESTAURADO', { key: backupKey });
                return { exito: true, datosRestaurados: Object.keys(backup.datos) };
            } catch(e) {
                return { exito: false, error: e.message };
            }
        },
        
        limpiarBackupsAntiguos: function() {
            var backups = this.listarBackups();
            var completos = backups.filter(function(b) { return b.tipo === 'Completo'; });
            
            if (completos.length > CONFIG_PROTECCION.MAX_BACKUPS) {
                completos.slice(CONFIG_PROTECCION.MAX_BACKUPS).forEach(function(b) {
                    localStorage.removeItem(b.key);
                });
            }
            
            var hace24h = Date.now() - (24 * 60 * 60 * 1000);
            backups.filter(function(b) { return b.tipo === 'Pre-cambio'; }).forEach(function(b) {
                var parts = b.key.split('pre_cambio_');
                var timestamp = parseInt(parts[1]) || 0;
                if (timestamp < hace24h) localStorage.removeItem(b.key);
            });
        },
        
        iniciarBackupAutomatico: function() {
            var self = this;
            setInterval(function() {
                self.crearBackupCompleto();
                console.log('✅ Backup automático creado - ' + new Date().toLocaleTimeString());
            }, CONFIG_PROTECCION.INTERVALO_BACKUP);
        }
    };

    // Log de Actividad
    var LogActividad = {
        MAX_REGISTROS: 500,
        
        registrar: function(tipo, detalles) {
            var key = CONFIG_PROTECCION.PREFIX_STORAGE + 'log_actividad';
            var log = [];
            
            try { log = JSON.parse(localStorage.getItem(key)) || []; }
            catch(e) {}
            
            log.unshift({
                timestamp: new Date().toISOString(),
                tipo: tipo,
                detalles: detalles || {},
                navegador: navigator.userAgent.substring(0, 50)
            });
            
            if (log.length > this.MAX_REGISTROS) {
                log = log.slice(0, this.MAX_REGISTROS);
            }
            
            localStorage.setItem(key, JSON.stringify(log));
        },
        
        obtener: function(limite) {
            var key = CONFIG_PROTECCION.PREFIX_STORAGE + 'log_actividad';
            try {
                return (JSON.parse(localStorage.getItem(key)) || []).slice(0, limite || 50);
            } catch(e) {
                return [];
            }
        }
    };

    // Validación de Integridad
    var ValidacionIntegridad = {
        verificarIntegridad: function() {
            var resultados = { estado: 'OK', problemas: [], estadisticas: {} };
            
            CONFIG_PROTECCION.CLAVES_DATOS.forEach(function(clave) {
                var key = CONFIG_PROTECCION.PREFIX_STORAGE + clave;
                var valor = localStorage.getItem(key);
                
                if (!valor) {
                    resultados.estadisticas[clave] = { existe: false, registros: 0 };
                    return;
                }
                
                try {
                    var datos = JSON.parse(valor);
                    resultados.estadisticas[clave] = { 
                        existe: true, 
                        registros: Array.isArray(datos) ? datos.length : 1 
                    };
                } catch(e) {
                    resultados.problemas.push({ clave: clave, tipo: 'CORRUPCION', mensaje: 'Datos corruptos' });
                    resultados.estado = 'ERROR';
                }
            });
            
            if (resultados.problemas.length > 0 && resultados.estado === 'OK') {
                resultados.estado = 'ADVERTENCIA';
            }
            
            return resultados;
        },
        
        repararProblemas: function() {
            var reparaciones = [];
            
            // Eliminar nóminas duplicadas
            var keyNominas = CONFIG_PROTECCION.PREFIX_STORAGE + 'nominas';
            var nominasStr = localStorage.getItem(keyNominas);
            if (nominasStr) {
                try {
                    var nominas = JSON.parse(nominasStr);
                    var idsVistos = {};
                    var sinDup = nominas.filter(function(n) {
                        if (n.id && idsVistos[n.id]) return false;
                        if (n.id) idsVistos[n.id] = true;
                        return true;
                    });
                    
                    if (sinDup.length < nominas.length) {
                        localStorage.setItem(keyNominas, JSON.stringify(sinDup));
                        reparaciones.push('Eliminadas ' + (nominas.length - sinDup.length) + ' nóminas duplicadas');
                    }
                } catch(e) {}
            }
            
            LogActividad.registrar('REPARACION_AUTOMATICA', { reparaciones: reparaciones });
            return reparaciones;
        }
    };

    // Exportación/Importación
    var ExportImport = {
        exportarTodo: function() {
            var exportacion = {
                sistema: 'Sistema de Nómina Tehui',
                version: CONFIG_PROTECCION.VERSION_MODULO,
                fechaExportacion: new Date().toISOString(),
                datos: {}
            };
            
            CONFIG_PROTECCION.CLAVES_DATOS.forEach(function(clave) {
                var key = CONFIG_PROTECCION.PREFIX_STORAGE + clave;
                var valor = localStorage.getItem(key);
                if (valor) {
                    try { exportacion.datos[clave] = JSON.parse(valor); }
                    catch(e) {}
                }
            });
            
            var blob = new Blob([JSON.stringify(exportacion, null, 2)], { type: 'application/json' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'backup_nomina_tehui_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            LogActividad.registrar('EXPORTACION_COMPLETA');
            return true;
        },
        
        importarDesdeArchivo: function(archivo) {
            return new Promise(function(resolve, reject) {
                var reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        var importacion = JSON.parse(e.target.result);
                        if (!importacion.datos) throw new Error('Archivo inválido');
                        
                        SistemaBackup.backupAntesCambio('Pre-importación');
                        
                        var importados = [];
                        Object.keys(importacion.datos).forEach(function(clave) {
                            if (CONFIG_PROTECCION.CLAVES_DATOS.indexOf(clave) > -1) {
                                var key = CONFIG_PROTECCION.PREFIX_STORAGE + clave;
                                localStorage.setItem(key, JSON.stringify(importacion.datos[clave]));
                                importados.push(clave);
                            }
                        });
                        
                        LogActividad.registrar('IMPORTACION_COMPLETA', { datosImportados: importados });
                        resolve({ exito: true, datosImportados: importados });
                    } catch(err) {
                        reject({ exito: false, error: err.message });
                    }
                };
                
                reader.onerror = function() { reject({ exito: false, error: 'Error leyendo archivo' }); };
                reader.readAsText(archivo);
            });
        }
    };

    // ========================================
    // PROTECCIÓN CONTRA CIERRE ACCIDENTAL
    // ========================================
    const ProteccionCierre = {
        habilitada: true,
        cambiosSinSincronizar: false,
        ultimaSync: null,
        
        marcarCambiosPendientes: function() {
            this.cambiosSinSincronizar = true;
            localStorage.setItem(CONFIG_PROTECCION.ESTADO_SYNC_KEY, JSON.stringify({
                pendiente: true,
                timestamp: Date.now()
            }));
        },
        
        marcarSincronizado: function() {
            this.cambiosSinSincronizar = false;
            this.ultimaSync = new Date();
            localStorage.setItem(CONFIG_PROTECCION.ESTADO_SYNC_KEY, JSON.stringify({
                pendiente: false,
                timestamp: Date.now(),
                ultimaSync: this.ultimaSync.toISOString()
            }));
        },
        
        obtenerEstado: function() {
            try {
                return JSON.parse(localStorage.getItem(CONFIG_PROTECCION.ESTADO_SYNC_KEY) || '{}');
            } catch(e) {
                return {};
            }
        }
    };

    // Exportar globalmente
    window.ProteccionNomina = {
        CONFIG: CONFIG_PROTECCION,
        Backup: SistemaBackup,
        Log: LogActividad,
        Validacion: ValidacionIntegridad,
        ExportImport: ExportImport,
        Checksum: SistemaChecksum,
        Cierre: ProteccionCierre,
        
        // Verificación completa de integridad
        verificarTodo: function() {
            const checksum = SistemaChecksum.verificarIntegridad();
            const validacion = ValidacionIntegridad.verificarIntegridad();
            return {
                checksum: checksum,
                validacion: validacion,
                timestamp: new Date().toISOString(),
                saludable: checksum.valido && validacion.estado === 'OK'
            };
        },
        
        // Recuperación automática
        recuperarAutomatico: function() {
            const verificacion = this.verificarTodo();
            const recuperados = [];
            
            if (!verificacion.saludable) {
                CONFIG_PROTECCION.CLAVES_CRITICAS.forEach(function(clave) {
                    if (verificacion.checksum.detalles[clave] && 
                        verificacion.checksum.detalles[clave].status === 'corrupto') {
                        const resultado = SistemaChecksum.recuperarDesdeBackup(clave);
                        if (resultado.exito) {
                            recuperados.push(clave);
                        }
                    }
                });
            }
            
            return {
                verificacion: verificacion,
                recuperados: recuperados,
                exito: recuperados.length > 0 || verificacion.saludable
            };
        },
        
        iniciar: function() {
            console.log('🛡️ Iniciando Sistema de Protección de Datos v' + CONFIG_PROTECCION.VERSION_MODULO);
            
            // Verificar integridad al iniciar
            const verificacion = this.verificarTodo();
            if (!verificacion.saludable) {
                console.warn('⚠️ Se detectaron problemas de integridad, intentando recuperar...');
                const recuperacion = this.recuperarAutomatico();
                if (recuperacion.recuperados.length > 0) {
                    console.log('✅ Datos recuperados:', recuperacion.recuperados.join(', '));
                }
            }
            
            // Crear backup inicial solo si hay datos
            var hayDatos = CONFIG_PROTECCION.CLAVES_DATOS.some(function(clave) {
                return localStorage.getItem(CONFIG_PROTECCION.PREFIX_STORAGE + clave) !== null;
            });
            
            if (hayDatos) {
                SistemaBackup.crearBackupCompleto();
                SistemaChecksum.guardarChecksums();
                console.log('✅ Backup inicial y checksums creados');
            }
            
            // Iniciar backup automático
            SistemaBackup.iniciarBackupAutomatico();
            console.log('⏰ Backup automático configurado cada 5 minutos');
            
            // Verificación periódica de integridad
            setInterval(function() {
                const ver = SistemaChecksum.verificarIntegridad();
                if (!ver.valido) {
                    console.warn('⚠️ Verificación periódica detectó problemas');
                }
            }, CONFIG_PROTECCION.INTERVALO_VERIFICACION);
            
            LogActividad.registrar('SISTEMA_INICIADO', { version: CONFIG_PROTECCION.VERSION_MODULO });
            return verificacion;
        }
    };
    
    console.log('🛡️ Módulo de Protección de Datos v2.0 cargado. Use window.ProteccionNomina para acceder.');
})();
</script>

<script type="text/babel">
const { useState, useEffect, useMemo, useCallback } = React;

// =====================================================
// CONFIGURACIÓN DE SHAREPOINT
// =====================================================
const SHAREPOINT_CONFIG = {
    clientId: '2133c50e-ffb4-4793-af2b-385d451b997b', // Client ID de Azure de Tehui
    authority: 'https://login.microsoftonline.com/tehui.onmicrosoft.com', // Tenant de Tehui
    redirectUri: 'https://centrotehui.github.io/boletin/nomina/index.html', // URI fijo registrado en Azure
    scopes: ['User.Read', 'Sites.ReadWrite.All', 'Files.ReadWrite.All', 'Mail.Send'],
    siteName: 'SistemaBoletinTehui',
    siteUrl: 'tehui.sharepoint.com:/sites/SistemaNomina',
    listas: {
        empleados: 'NominaEmpleados',
        prestamos: 'NominaPrestamos',
        licencias: 'NominaLicencias',
        nominas: 'NominaNominas',
        config: 'NominaConfig'
    },
    enabled: true
};

// Cargar MSAL dinámicamente
const loadMSAL = () => {
    return new Promise((resolve, reject) => {
        if (window.msal) { resolve(window.msal); return; }
        const script = document.createElement('script');
        script.src = 'https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js';
        script.onload = () => resolve(window.msal);
        script.onerror = reject;
        document.head.appendChild(script);
    });
};

let msalInstance = null;
let currentAccount = null;

const initMSAL = async () => {
    if (msalInstance) return msalInstance;
    try {
        const msal = await loadMSAL();
        msalInstance = new msal.PublicClientApplication({
            auth: {
                clientId: SHAREPOINT_CONFIG.clientId,
                authority: SHAREPOINT_CONFIG.authority,
                redirectUri: SHAREPOINT_CONFIG.redirectUri
            },
            cache: { cacheLocation: 'localStorage', storeAuthStateInCookie: true }
        });
        await msalInstance.initialize();
        
        // Manejar respuesta de redirección
        try {
            const response = await msalInstance.handleRedirectPromise();
            if (response) {
                currentAccount = response.account;
            }
        } catch (e) {
            console.log('No redirect response');
        }
        
        const accounts = msalInstance.getAllAccounts();
        if (accounts.length > 0) currentAccount = accounts[0];
        return msalInstance;
    } catch (e) {
        console.error('Error inicializando MSAL:', e);
        return null;
    }
};

const loginMicrosoft = async () => {
    try {
        const instance = await initMSAL();
        if (!instance) return null;
        
        // Si ya hay una cuenta activa, retornarla sin abrir popup
        if (currentAccount) {
            console.log('Ya hay cuenta activa:', currentAccount.username);
            return currentAccount;
        }
        
        // Verificar si ya hay cuentas en cache
        const accounts = instance.getAllAccounts();
        if (accounts.length > 0) {
            currentAccount = accounts[0];
            console.log('Cuenta encontrada en cache:', currentAccount.username);
            return currentAccount;
        }
        
        // Solo abrir popup si no hay cuenta
        const response = await instance.loginPopup({ scopes: SHAREPOINT_CONFIG.scopes });
        currentAccount = response.account;
        return response.account;
    } catch (e) {
        // Manejar error de interacción en progreso
        if (e.errorCode === 'interaction_in_progress') {
            console.log('Interacción en progreso, esperando...');
            // Esperar un momento y verificar si hay cuenta
            await new Promise(resolve => setTimeout(resolve, 1000));
            const instance = await initMSAL();
            if (instance) {
                const accounts = instance.getAllAccounts();
                if (accounts.length > 0) {
                    currentAccount = accounts[0];
                    return currentAccount;
                }
            }
            return null;
        }
        console.error('Error en login:', e);
        return null;
    }
};

const logoutMicrosoft = async () => {
    try {
        const instance = await initMSAL();
        if (instance && currentAccount) {
            await instance.logoutPopup({ account: currentAccount });
            currentAccount = null;
        }
    } catch (e) {
        console.error('Error en logout:', e);
    }
};

const getAccessToken = async () => {
    try {
        const instance = await initMSAL();
        if (!instance || !currentAccount) return null;
        const response = await instance.acquireTokenSilent({
            scopes: SHAREPOINT_CONFIG.scopes,
            account: currentAccount
        });
        return response.accessToken;
    } catch (e) {
        try {
            const instance = await initMSAL();
            const response = await instance.acquireTokenPopup({ scopes: SHAREPOINT_CONFIG.scopes });
            return response.accessToken;
        } catch (e2) {
            console.error('Error obteniendo token:', e2);
            return null;
        }
    }
};

const getSharePointSiteId = async (token) => {
    try {
        const response = await fetch(
            `https://graph.microsoft.com/v1.0/sites/${SHAREPOINT_CONFIG.siteUrl}`,
            { headers: { 'Authorization': `Bearer ${token}` } }
        );
        if (!response.ok) return null;
        const data = await response.json();
        return data.id;
    } catch (e) {
        console.error('Error obteniendo siteId:', e);
        return null;
    }
};

const getOrCreateList = async (token, siteId, listName, columns) => {
    try {
        // Buscar lista existente - cargar todas y buscar en JavaScript
        const searchResponse = await fetch(
            `https://graph.microsoft.com/v1.0/sites/${siteId}/lists?$top=100`,
            { headers: { 'Authorization': `Bearer ${token}` } }
        );
        if (searchResponse.ok) {
            const data = await searchResponse.json();
            const existingList = data.value?.find(list => list.displayName === listName);
            if (existingList) return existingList.id;
        }
        
        // Crear lista si no existe
        const createResponse = await fetch(
            `https://graph.microsoft.com/v1.0/sites/${siteId}/lists`,
            {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    displayName: listName,
                    columns: columns,
                    list: { template: 'genericList' }
                })
            }
        );
        if (createResponse.ok) {
            const newList = await createResponse.json();
            return newList.id;
        }
        return null;
    } catch (e) {
        console.error('Error con lista:', e);
        return null;
    }
};

// Columnas para cada lista
const COLUMNAS_EMPLEADOS = [
    { name: 'Cedula', text: {} },
    { name: 'Departamento', text: {} },
    { name: 'Cargo', text: {} },
    { name: 'SalarioBase', number: {} },
    { name: 'FechaIngreso', dateTime: {} },
    { name: 'Activo', boolean: {} },
    { name: 'DatosJSON', text: { allowMultipleLines: true } }
];

const COLUMNAS_PRESTAMOS = [
    { name: 'EmpleadoId', number: {} },
    { name: 'Monto', number: {} },
    { name: 'Cuotas', number: {} },
    { name: 'Saldo', number: {} },
    { name: 'Activo', boolean: {} },
    { name: 'DatosJSON', text: { allowMultipleLines: true } }
];

const COLUMNAS_LICENCIAS = [
    { name: 'EmpleadoId', number: {} },
    { name: 'Tipo', text: {} },
    { name: 'FechaInicio', dateTime: {} },
    { name: 'FechaFin', dateTime: {} },
    { name: 'DatosJSON', text: { allowMultipleLines: true } }
];

const COLUMNAS_NOMINAS = [
    { name: 'Periodo', text: {} },
    { name: 'FechaGeneracion', dateTime: {} },
    { name: 'TotalNeto', number: {} },
    { name: 'Estado', text: {} },
    { name: 'DatosJSON', text: { allowMultipleLines: true } }
];

const COLUMNAS_CONFIG = [
    { name: 'TipoConfig', text: {} },
    { name: 'DatosJSON', text: { allowMultipleLines: true } }
];

// Cache para evitar múltiples llamadas
let _spCache = { siteId: null, lists: {}, lastToken: null };

// Sincronización MASIVA - guarda todo en un solo registro
const sincronizarTodoSP = async (empleados, prestamos, licencias, nominas, config, catalogos) => {
    if (!SHAREPOINT_CONFIG.enabled) return { success: false, error: 'SharePoint no habilitado' };
    const token = await getAccessToken();
    if (!token) return { success: false, error: 'No hay token de acceso' };
    
    try {
        console.log('🚀 Iniciando sincronización masiva...');
        
        // Obtener siteId (con caché)
        if (!_spCache.siteId || _spCache.lastToken !== token) {
            console.log('🔍 Obteniendo siteId...');
            _spCache.siteId = await getSharePointSiteId(token);
            _spCache.lastToken = token;
        }
        const siteId = _spCache.siteId;
        if (!siteId) return { success: false, error: 'No se pudo obtener siteId' };
        console.log('✅ SiteId:', siteId);
        
        // Obtener listId de Config (usaremos esta lista para el backup completo)
        if (!_spCache.lists.config) {
            console.log('🔍 Obteniendo lista de configuración...');
            _spCache.lists.config = await getOrCreateList(token, siteId, SHAREPOINT_CONFIG.listas.config, COLUMNAS_CONFIG);
        }
        const listId = _spCache.lists.config;
        if (!listId) return { success: false, error: 'No se pudo obtener listId' };
        console.log('✅ ListId:', listId);
        
        // Preparar todos los datos en un solo objeto
        const backupCompleto = {
            version: '3.47',
            fecha: new Date().toISOString(),
            datos: {
                empleados: empleados || [],
                prestamos: prestamos || [],
                licencias: licencias || [],
                nominas: nominas || [],
                config: config || {},
                catalogos: catalogos || {}
            },
            stats: {
                empleados: empleados?.length || 0,
                prestamos: prestamos?.length || 0,
                licencias: licencias?.length || 0,
                nominas: nominas?.length || 0
            }
        };
        
        console.log('📦 Datos preparados:', backupCompleto.stats);
        
        const campos = {
            fields: {
                Title: 'BackupCompleto',
                DatosJSON: JSON.stringify(backupCompleto)
            }
        };
        
        // Buscar si ya existe el backup
        console.log('🔍 Buscando backup existente...');
        const allItemsUrl = `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items?$expand=fields&$top=100`;
        const allResp = await fetch(allItemsUrl, { headers: { 'Authorization': `Bearer ${token}` } });
        const allData = await allResp.json();
        
        const existingBackup = allData.value?.find(item => item.fields?.Title === 'BackupCompleto');
        
        if (existingBackup) {
            // Actualizar
            console.log('📝 Actualizando backup existente...');
            const updateResp = await fetch(
                `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items/${existingBackup.id}`,
                { method: 'PATCH', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(campos) }
            );
            if (!updateResp.ok) {
                const errorText = await updateResp.text();
                console.error('❌ Error actualizando:', errorText);
                return { success: false, error: `Error ${updateResp.status}: ${errorText}` };
            }
            console.log('✅ Backup actualizado correctamente');
        } else {
            // Crear nuevo
            console.log('📝 Creando nuevo backup...');
            const createResp = await fetch(
                `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items`,
                { method: 'POST', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(campos) }
            );
            if (!createResp.ok) {
                const errorText = await createResp.text();
                console.error('❌ Error creando:', errorText);
                return { success: false, error: `Error ${createResp.status}: ${errorText}` };
            }
            console.log('✅ Backup creado correctamente');
        }
        
        return { success: true, stats: backupCompleto.stats };
    } catch (e) {
        console.error('❌ Error en sincronización:', e);
        return { success: false, error: e.message };
    }
};

// Cargar TODO desde SharePoint
const cargarTodoSP = async () => {
    if (!SHAREPOINT_CONFIG.enabled) return null;
    const token = await getAccessToken();
    if (!token) return null;
    
    try {
        console.log('📥 Cargando datos desde SharePoint...');
        
        if (!_spCache.siteId || _spCache.lastToken !== token) {
            _spCache.siteId = await getSharePointSiteId(token);
            _spCache.lastToken = token;
        }
        const siteId = _spCache.siteId;
        if (!siteId) return null;
        
        if (!_spCache.lists.config) {
            _spCache.lists.config = await getOrCreateList(token, siteId, SHAREPOINT_CONFIG.listas.config, COLUMNAS_CONFIG);
        }
        const listId = _spCache.lists.config;
        if (!listId) return null;
        
        const allItemsUrl = `https://graph.microsoft.com/v1.0/sites/${siteId}/lists/${listId}/items?$expand=fields&$top=100`;
        const resp = await fetch(allItemsUrl, { headers: { 'Authorization': `Bearer ${token}` } });
        if (!resp.ok) return null;
        
        const data = await resp.json();
        const backupItem = data.value?.find(item => item.fields?.Title === 'BackupCompleto');
        
        if (backupItem && backupItem.fields?.DatosJSON) {
            const backup = JSON.parse(backupItem.fields.DatosJSON);
            console.log('✅ Datos cargados:', backup.stats);
            return backup.datos;
        }
        
        return null;
    } catch (e) {
        console.error('❌ Error cargando datos:', e);
        return null;
    }
};

// Funciones CRUD SharePoint (mantenidas por compatibilidad pero no usadas)
const guardarEmpleadoSP = async (empleado) => { return true; };
const guardarPrestamoSP = async (prestamo) => { return true; };
const guardarNominaSP = async (nomina) => { return true; };
const guardarConfigSP = async (tipo, datos) => { return true; };
const cargarEmpleadosSP = async () => { return []; };
const cargarPrestamosSP = async () => { return []; };
const cargarNominasSP = async () => { return []; };
const cargarConfigSP = async (tipo) => { return null; };

// =====================================================
// CONFIGURACIÓN INICIAL - LEYES LABORALES RD 2025
// =====================================================
const CONFIG_DEFAULT = {
    tss: {
        afpEmpleado: 2.87, sfsEmpleado: 3.04,
        afpEmpleador: 7.10, sfsEmpleador: 7.09,
        infotep: 1.00, riesgoLaboral: 1.15,
        topeAfp: 485070, topeSfs: 485070,
        pdssPerCapita: 1715.46  // RD$ 1,715.46 mensual por dependiente adicional en SFS
    },
    isr: [
        { min: 0, max: 416220, tasa: 0, fijo: 0 },
        { min: 416220.01, max: 624329, tasa: 15, fijo: 0 },
        { min: 624329.01, max: 867123, tasa: 20, fijo: 31216.35 },
        { min: 867123.01, max: Infinity, tasa: 25, fijo: 79775.15 }
    ],
    general: {
        diasMes: 23.83,
        salarioMinimo: 21000,
        horasExtra35: 35,  // Horas 9-44 semanal
        horasExtra100: 100, // Más de 44, feriados, domingos
        vacacionesDias: 14,
        regaliaMes: 12
    },
    empresa: {
        nombre: 'Centro Educativo de Formación Integral Tehui',
        rnc: '133-03246-5',
        direccion: 'Carretera Don Pedro No. 140, Esq. Las Orquideas',
        telefono: '809-000-0000',
        representante: 'GRUPO PAIDOS, SRL'
    },
    liquidacion: {
        preavisoMeses: { 3: 7, 6: 14, 12: 28 }, // días según antigüedad en meses
        cesantiaDias: { 3: 6, 6: 13, 12: 21, 60: 23 } // días por año según antigüedad
    }
};

// Valores predeterminados para configuración (se pueden modificar en Mantenimiento)
const DEPARTAMENTOS_DEFAULT = ['ADMINISTRACION', 'ASISTENTE', 'DOCENTE', 'MAESTRA INTEGRADORA', 'PROFESOR', 'PSICOLOGIA', 'MANTENIMIENTO', 'COCINA', 'TRANSPORTE', 'SEGURIDAD'];
const BANCOS_DEFAULT = ['Banco Popular Dominicano', 'BHD León', 'Banreservas', 'Scotiabank', 'Banco Santa Cruz', 'Banco Promerica', 'Asociación Popular', 'Banco BDI', 'Banco Caribe', 'Banco Vimenca'];
const TIPOS_CONTRATO_DEFAULT = ['Indefinido', 'Temporal', 'Por Obra', 'Pasantía', 'Prueba'];
const TIPOS_LICENCIA_DEFAULT = ['Maternidad', 'Paternidad', 'Médica', 'Sin Sueldo', 'Duelo', 'Matrimonio', 'Vacaciones'];
const TIPOS_REMUNERACION_DEFAULT = ['Normal', 'Trabajador ocasional (no fijo)', 'Asalariado por hora/día/semana'];
const CARGOS_DEFAULT = ['Docente', 'Asistente', 'Administrativa', 'Psicóloga', 'Mantenimiento', 'Representante', 'Coordinador', 'Director', 'Secretaria', 'Conserje'];
const MESES = ['', 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

// =====================================================
// FUNCIONES DE CÁLCULO
// =====================================================
const round2 = n => Math.round(n * 100) / 100;
const formatMoney = n => new Intl.NumberFormat('es-DO', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n || 0);
const formatDate = d => d ? new Date(d).toLocaleDateString('es-DO') : '-';
const getInitials = name => name?.split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase() || '??';
const calcularEdad = (fechaNacimiento) => {
    if (!fechaNacimiento) return null;
    const hoy = new Date();
    const nacimiento = new Date(fechaNacimiento);
    let edad = hoy.getFullYear() - nacimiento.getFullYear();
    const mes = hoy.getMonth() - nacimiento.getMonth();
    if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) {
        edad--;
    }
    return edad;
};

// Función para eliminar duplicados de nóminas (mantiene la más reciente por código)
const eliminarDuplicadosNominas = (nominas) => {
    if (!nominas || !Array.isArray(nominas)) return [];
    const mapa = new Map();
    // Ordenar por fecha de proceso (más reciente primero) para mantener la última versión
    const ordenadas = [...nominas].sort((a, b) => {
        const fechaA = new Date(a.fechaProceso || a.fechaModificacion || 0);
        const fechaB = new Date(b.fechaProceso || b.fechaModificacion || 0);
        return fechaB - fechaA;
    });
    // Mantener solo la primera ocurrencia (la más reciente)
    ordenadas.forEach(n => {
        if (n.codigo && !mapa.has(n.codigo)) {
            mapa.set(n.codigo, n);
        } else if (!n.codigo) {
            // Para borradores sin código, usar el id
            mapa.set(n.id, n);
        }
    });
    return Array.from(mapa.values());
};

const calcularAntiguedad = (fechaIngreso) => {
    if (!fechaIngreso) return { años: 0, meses: 0, dias: 0 };
    const inicio = new Date(fechaIngreso);
    const hoy = new Date();
    let años = hoy.getFullYear() - inicio.getFullYear();
    let meses = hoy.getMonth() - inicio.getMonth();
    let dias = hoy.getDate() - inicio.getDate();
    if (dias < 0) { meses--; dias += 30; }
    if (meses < 0) { años--; meses += 12; }
    return { años, meses: años * 12 + meses, dias };
};

const calcularTSS = (salario, config) => {
    const topeAfp = Math.min(salario, config.tss.topeAfp);
    const topeSfs = Math.min(salario, config.tss.topeSfs);
    return {
        afpEmp: round2(topeAfp * config.tss.afpEmpleado / 100),
        sfsEmp: round2(topeSfs * config.tss.sfsEmpleado / 100),
        afpPat: round2(topeAfp * config.tss.afpEmpleador / 100),
        sfsPat: round2(topeSfs * config.tss.sfsEmpleador / 100),
        infotep: round2(salario * config.tss.infotep / 100),
        riesgo: round2(salario * config.tss.riesgoLaboral / 100)
    };
};

const calcularISR = (salarioAnualNeto, config) => {
    // En RD los dependientes NO afectan el ISR
    for (const t of config.isr) {
        if (salarioAnualNeto >= t.min && salarioAnualNeto <= t.max) {
            if (t.tasa === 0) return 0;
            return round2((((salarioAnualNeto - t.min) * t.tasa / 100) + t.fijo) / 12);
        }
    }
    return 0;
};

const calcularSalarioDiario = (salarioMensual, config) => round2(salarioMensual / config.general.diasMes);
const calcularSalarioHora = (salarioMensual, config) => round2(calcularSalarioDiario(salarioMensual, config) / 8);

const calcularHorasExtras = (salarioMensual, horas35, horas100, config) => {
    const salarioHora = calcularSalarioHora(salarioMensual, config);
    const extra35 = round2(horas35 * salarioHora * (1 + config.general.horasExtra35 / 100));
    const extra100 = round2(horas100 * salarioHora * (1 + config.general.horasExtra100 / 100));
    return { extra35, extra100, total: round2(extra35 + extra100) };
};

const calcularVacaciones = (salarioMensual, diasVacaciones, config) => {
    const salarioDiario = calcularSalarioDiario(salarioMensual, config);
    return round2(salarioDiario * diasVacaciones);
};

const calcularRegalia = (salarioPromedio, mesesTrabajados) => {
    // Regalía = (Salario promedio / 12) * meses trabajados en el año
    return round2((salarioPromedio / 12) * Math.min(mesesTrabajados, 12));
};

const calcularPreaviso = (salarioMensual, mesesAntiguedad, config) => {
    const salarioDiario = calcularSalarioDiario(salarioMensual, config);
    let dias = 0;
    if (mesesAntiguedad >= 12) dias = 28;
    else if (mesesAntiguedad >= 6) dias = 14;
    else if (mesesAntiguedad >= 3) dias = 7;
    return { dias, monto: round2(salarioDiario * dias) };
};

const calcularCesantia = (salarioMensual, mesesAntiguedad, config) => {
    const salarioDiario = calcularSalarioDiario(salarioMensual, config);
    let diasPorAño = 0;
    if (mesesAntiguedad >= 60) diasPorAño = 23;
    else if (mesesAntiguedad >= 12) diasPorAño = 21;
    else if (mesesAntiguedad >= 6) diasPorAño = 13;
    else if (mesesAntiguedad >= 3) diasPorAño = 6;
    const años = mesesAntiguedad / 12;
    const dias = round2(diasPorAño * años);
    return { diasPorAño, dias, monto: round2(salarioDiario * dias) };
};

const calcularLiquidacion = (empleado, config, motivoSalida = 'despido') => {
    const { meses } = calcularAntiguedad(empleado.fechaIngreso);
    const salario = empleado.salarioBase;
    const salarioDiario = calcularSalarioDiario(salario, config);
    
    // Preaviso (solo si aplica según motivo)
    const preaviso = motivoSalida === 'despido' ? calcularPreaviso(salario, meses, config) : { dias: 0, monto: 0 };
    
    // Cesantía (solo despido injustificado)
    const cesantia = motivoSalida === 'despido' ? calcularCesantia(salario, meses, config) : { dias: 0, monto: 0 };
    
    // Vacaciones no disfrutadas
    const diasVacacionesAcum = Math.floor((meses / 12) * config.general.vacacionesDias);
    const diasVacacionesPend = diasVacacionesAcum - (empleado.vacacionesDisfrutadas || 0);
    const vacaciones = round2(salarioDiario * Math.max(0, diasVacacionesPend));
    
    // Salario pendiente (proporcional del mes)
    const diasPendientes = new Date().getDate();
    const salarioPendiente = round2(salarioDiario * diasPendientes);
    
    // Regalía proporcional
    const mesActual = new Date().getMonth() + 1;
    const regalia = calcularRegalia(salario, mesActual);
    
    return {
        preaviso, cesantia, vacaciones, salarioPendiente, regalia,
        total: round2(preaviso.monto + cesantia.monto + vacaciones + salarioPendiente + regalia)
    };
};

// =====================================================
// ICONOS SVG
// =====================================================
const Icons = {
    Dashboard: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="7" height="9" rx="1"/><rect x="14" y="3" width="7" height="5" rx="1"/><rect x="14" y="12" width="7" height="9" rx="1"/><rect x="3" y="16" width="7" height="5" rx="1"/></svg>,
    Users: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
    Dollar: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
    FileText: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
    Settings: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
    Plus: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
    Edit: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
    Trash: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3,6 5,6 21,6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
    X: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
    Search: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
    Download: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
    Printer: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6,9 6,2 18,2 18,9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>,
    Calendar: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
    Check: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20,6 9,17 4,12"/></svg>,
    Clock: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>,
    CreditCard: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>,
    AlertCircle: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
    Info: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>,
    Gift: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20,12 20,22 4,22 4,12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>,
    Umbrella: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M23 12a11.05 11.05 0 0 0-22 0zm-5 7a3 3 0 0 1-6 0v-7"/></svg>,
    UserMinus: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="23" y1="11" x2="17" y2="11"/></svg>,
    UserCheck: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><polyline points="17,11 19,13 23,9"/></svg>,
    FileSpreadsheet: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="8" y1="13" x2="16" y2="13"/><line x1="8" y1="17" x2="16" y2="17"/><line x1="10" y1="9" x2="10" y2="21"/></svg>,
    Receipt: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1z"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="8" y1="10" x2="16" y2="10"/><line x1="8" y1="14" x2="12" y2="14"/></svg>,
    Save: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17,21 17,13 7,13 7,21"/><polyline points="7,3 7,8 15,8"/></svg>,
    Eye: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
    Award: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21,13.89 7,23 12,20 17,23 15.79,13.88"/></svg>,
    Briefcase: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>,
    Home: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>,
    Activity: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/></svg>,
    Cloud: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg>,
    CloudOff: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="1" y1="1" x2="23" y2="23"/><path d="M7 17H4a4 4 0 0 1 0-8c.5 0 .97.09 1.41.26M16 17h2a5 5 0 0 0 .95-9.9"/><path d="M8.3 8.3A5.98 5.98 0 0 1 16 6c.5 0 .97.06 1.43.17"/></svg>,
    Refresh: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23,4 23,10 17,10"/><polyline points="1,20 1,14 7,14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>,
    LogIn: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10,17 15,12 10,7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>,
    LogOut: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>,
    Lock: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
    User: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
    Database: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
    Shield: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
    Tool: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>,
    Mail: () => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>,
};

// =====================================================
// COMPONENTES UI
// =====================================================
const Toast = ({ msg, type, onClose }) => {
    useEffect(() => { const t = setTimeout(onClose, 3000); return () => clearTimeout(t); }, []);
    return <div className={`toast ${type}`}><span>{msg}</span></div>;
};

const Modal = ({ open, onClose, title, children, footer, size }) => {
    if (!open) return null;
    return (
        <div className="modal-backdrop" onClick={onClose}>
            <div className={`modal ${size || ''}`} onClick={e => e.stopPropagation()}>
                <div className="modal-header">
                    <span className="modal-title">{title}</span>
                    <button className="modal-close" onClick={onClose}><Icons.X /></button>
                </div>
                <div className="modal-body">{children}</div>
                {footer && <div className="modal-footer">{footer}</div>}
            </div>
        </div>
    );
};

// =====================================================
// COMPONENTE PANEL DE PROTECCIÓN DE DATOS
// =====================================================
const ProteccionDatosPanel = ({ toast, onClose }) => {
    const [tab, setTab] = useState('estado');
    const [backups, setBackups] = useState([]);
    const [integridad, setIntegridad] = useState(null);
    const [log, setLog] = useState([]);
    const [cargando, setCargando] = useState(false);
    
    useEffect(() => {
        cargarDatos();
    }, []);
    
    const cargarDatos = () => {
        if (window.ProteccionNomina) {
            setBackups(window.ProteccionNomina.Backup.listarBackups());
            setIntegridad(window.ProteccionNomina.Validacion.verificarIntegridad());
            setLog(window.ProteccionNomina.Log.obtener(50));
        }
    };
    
    const crearBackup = () => {
        setCargando(true);
        setTimeout(() => {
            window.ProteccionNomina.Backup.crearBackupCompleto();
            toast('✅ Backup creado correctamente', 'success');
            cargarDatos();
            setCargando(false);
        }, 500);
    };
    
    const restaurarBackup = (key) => {
        if (!confirm('¿Restaurar este backup? Se creará backup de seguridad antes de restaurar.')) return;
        setCargando(true);
        setTimeout(() => {
            const resultado = window.ProteccionNomina.Backup.restaurarBackup(key);
            if (resultado.exito) {
                toast('✅ Backup restaurado. Recargando página...', 'success');
                setTimeout(() => window.location.reload(), 1500);
            } else {
                toast('❌ Error: ' + resultado.error, 'error');
            }
            setCargando(false);
        }, 500);
    };
    
    const exportarDatos = () => {
        window.ProteccionNomina.ExportImport.exportarTodo();
        toast('✅ Archivo de backup descargado', 'success');
    };
    
    const importarDatos = (e) => {
        const archivo = e.target.files[0];
        if (!archivo) return;
        if (!confirm('¿Importar estos datos? Se reemplazarán los datos actuales (se creará backup de seguridad).')) return;
        
        setCargando(true);
        window.ProteccionNomina.ExportImport.importarDesdeArchivo(archivo)
            .then(resultado => {
                toast(`✅ Datos importados: ${resultado.datosImportados.join(', ')}`, 'success');
                setTimeout(() => window.location.reload(), 1500);
            })
            .catch(error => toast('❌ ' + error.error, 'error'))
            .finally(() => setCargando(false));
    };
    
    const verificarIntegridad = () => {
        setCargando(true);
        setTimeout(() => {
            const resultado = window.ProteccionNomina.Validacion.verificarIntegridad();
            setIntegridad(resultado);
            toast(resultado.estado === 'OK' ? '✅ Datos íntegros' : '⚠️ Se encontraron problemas', resultado.estado === 'OK' ? 'success' : 'warning');
            setCargando(false);
        }, 500);
    };
    
    const repararProblemas = () => {
        if (!confirm('¿Ejecutar reparación automática de problemas?')) return;
        setCargando(true);
        setTimeout(() => {
            const reparaciones = window.ProteccionNomina.Validacion.repararProblemas();
            toast(reparaciones.length > 0 ? `✅ ${reparaciones.join(', ')}` : 'ℹ️ Sin problemas que reparar', 'info');
            cargarDatos();
            setCargando(false);
        }, 500);
    };
    
    const colorEstado = integridad?.estado === 'OK' ? '#10b981' : integridad?.estado === 'ADVERTENCIA' ? '#f59e0b' : '#ef4444';
    
    const tabs = [
        { id: 'estado', label: '📊 Estado' },
        { id: 'backups', label: '💾 Backups' },
        { id: 'exportar', label: '📤 Exportar' },
        { id: 'log', label: '📋 Actividad' },
    ];
    
    return (
        <div>
            {/* Tabs */}
            <div style={{display:'flex', borderBottom:'1px solid var(--border)', marginBottom:'16px'}}>
                {tabs.map(t => (
                    <button 
                        key={t.id} 
                        onClick={() => setTab(t.id)} 
                        style={{
                            flex:1, padding:'10px', border:'none', 
                            background: tab === t.id ? 'var(--primary)' : 'transparent',
                            color: tab === t.id ? 'white' : 'var(--text-primary)',
                            cursor:'pointer', fontWeight: tab === t.id ? '600' : '400',
                            borderRadius: tab === t.id ? '6px 6px 0 0' : '0'
                        }}
                    >
                        {t.label}
                    </button>
                ))}
            </div>
            
            {cargando && (
                <div style={{textAlign:'center', padding:'40px'}}>
                    <div className="spinner"></div>
                    <p style={{marginTop:'12px'}}>Procesando...</p>
                </div>
            )}
            
            {/* Tab Estado */}
            {!cargando && tab === 'estado' && integridad && (
                <div>
                    <div style={{
                        background:`${colorEstado}15`, border:`1px solid ${colorEstado}40`,
                        borderRadius:'10px', padding:'16px', marginBottom:'16px',
                        display:'flex', alignItems:'center', gap:'16px'
                    }}>
                        <div style={{
                            width:'50px', height:'50px', borderRadius:'50%', background:colorEstado,
                            display:'flex', alignItems:'center', justifyContent:'center',
                            fontSize:'1.5rem', color:'white'
                        }}>
                            {integridad.estado === 'OK' ? '✓' : '!'}
                        </div>
                        <div>
                            <h3 style={{margin:0, color:colorEstado}}>
                                {integridad.estado === 'OK' ? 'Datos Íntegros' : 'Problemas Detectados'}
                            </h3>
                            <p style={{margin:'4px 0 0', color:'var(--text-secondary)', fontSize:'12px'}}>
                                {integridad.problemas.length === 0 ? 'Todos los datos están protegidos y respaldados' : `${integridad.problemas.length} problema(s) encontrado(s)`}
                            </p>
                        </div>
                    </div>
                    
                    <h4 style={{marginBottom:'12px', fontSize:'13px'}}>📈 Estadísticas de Datos</h4>
                    <div style={{display:'grid', gridTemplateColumns:'repeat(auto-fill, minmax(100px, 1fr))', gap:'10px', marginBottom:'16px'}}>
                        {Object.entries(integridad.estadisticas).map(([clave, stats]) => (
                            <div key={clave} style={{
                                background: stats.existe ? '#f0fdf4' : '#fef2f2',
                                border:`1px solid ${stats.existe ? '#86efac' : '#fecaca'}`,
                                borderRadius:'8px', padding:'10px', textAlign:'center'
                            }}>
                                <div style={{fontSize:'1.3rem', fontWeight:'bold', color: stats.existe ? '#166534' : '#991b1b'}}>
                                    {stats.registros}
                                </div>
                                <div style={{fontSize:'10px', color:'var(--text-muted)', textTransform:'capitalize'}}>{clave}</div>
                            </div>
                        ))}
                    </div>
                    
                    <div style={{display:'flex', gap:'10px'}}>
                        <button className="btn btn-primary" onClick={verificarIntegridad}>🔍 Verificar</button>
                        {integridad.problemas.length > 0 && (
                            <button className="btn btn-warning" onClick={repararProblemas}>🔧 Reparar</button>
                        )}
                    </div>
                </div>
            )}
            
            {/* Tab Backups */}
            {!cargando && tab === 'backups' && (
                <div>
                    <button className="btn btn-success" onClick={crearBackup} style={{marginBottom:'16px'}}>➕ Crear Backup Ahora</button>
                    
                    <div className="alert alert-info" style={{marginBottom:'16px'}}>
                        💡 Los backups se crean automáticamente cada 5 minutos. Se mantienen los últimos 10 backups.
                    </div>
                    
                    <h4 style={{marginBottom:'12px', fontSize:'13px'}}>📂 Backups Disponibles ({backups.length})</h4>
                    <div style={{maxHeight:'250px', overflowY:'auto'}}>
                        {backups.length === 0 ? (
                            <p style={{color:'var(--text-muted)', textAlign:'center', padding:'20px'}}>No hay backups disponibles</p>
                        ) : backups.map((b, i) => (
                            <div key={b.key} style={{
                                display:'flex', justifyContent:'space-between', alignItems:'center',
                                padding:'10px', background: i % 2 === 0 ? 'var(--bg-main)' : 'white',
                                borderRadius:'6px', marginBottom:'4px'
                            }}>
                                <div>
                                    <div style={{fontWeight:'500', fontSize:'12px'}}>{new Date(b.fecha).toLocaleString('es-DO')}</div>
                                    <div style={{fontSize:'10px', color:'var(--text-muted)'}}>{b.tipo} • {b.tamaño}</div>
                                </div>
                                <button className="btn btn-xs btn-success" onClick={() => restaurarBackup(b.key)}>Restaurar</button>
                            </div>
                        ))}
                    </div>
                </div>
            )}
            
            {/* Tab Exportar */}
            {!cargando && tab === 'exportar' && (
                <div>
                    <div style={{background:'#f0fdf4', border:'1px solid #86efac', borderRadius:'10px', padding:'20px', marginBottom:'16px', textAlign:'center'}}>
                        <div style={{fontSize:'2.5rem', marginBottom:'10px'}}>📤</div>
                        <h3 style={{margin:'0 0 8px', color:'#166534', fontSize:'14px'}}>Exportar Datos</h3>
                        <p style={{color:'var(--text-secondary)', marginBottom:'12px', fontSize:'12px'}}>Descarga un archivo JSON con todos los datos del sistema.</p>
                        <button className="btn btn-success" onClick={exportarDatos}>📥 Descargar Backup Completo</button>
                    </div>
                    
                    <div style={{background:'#fef3c7', border:'1px solid #fcd34d', borderRadius:'10px', padding:'20px', textAlign:'center'}}>
                        <div style={{fontSize:'2.5rem', marginBottom:'10px'}}>📥</div>
                        <h3 style={{margin:'0 0 8px', color:'#92400e', fontSize:'14px'}}>Importar Datos</h3>
                        <p style={{color:'var(--text-secondary)', marginBottom:'12px', fontSize:'12px'}}>⚠️ Esto reemplazará los datos actuales. Se creará backup de seguridad.</p>
                        <label className="btn btn-warning" style={{cursor:'pointer'}}>
                            📂 Seleccionar Archivo
                            <input type="file" accept=".json" onChange={importarDatos} style={{display:'none'}} />
                        </label>
                    </div>
                </div>
            )}
            
            {/* Tab Log */}
            {!cargando && tab === 'log' && (
                <div>
                    <h4 style={{marginBottom:'12px', fontSize:'13px'}}>📋 Registro de Actividad</h4>
                    <div style={{maxHeight:'300px', overflowY:'auto'}}>
                        {log.length === 0 ? (
                            <p style={{color:'var(--text-muted)', textAlign:'center', padding:'20px'}}>No hay actividad registrada</p>
                        ) : log.map((entrada, i) => (
                            <div key={i} style={{
                                display:'flex', gap:'10px', padding:'8px',
                                background: i % 2 === 0 ? 'var(--bg-main)' : 'white',
                                borderRadius:'6px', marginBottom:'2px', fontSize:'11px'
                            }}>
                                <div style={{flex:1}}>
                                    <div style={{fontWeight:'500', color:'var(--text-primary)'}}>{entrada.tipo.replace(/_/g, ' ')}</div>
                                    <div style={{fontSize:'10px', color:'var(--text-muted)'}}>{new Date(entrada.timestamp).toLocaleString('es-DO')}</div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            )}
        </div>
    );
};

// =====================================================
// COMPONENTE GESTIÓN DE USUARIOS
// Panel completo para administrar usuarios del sistema
// =====================================================
const GestionUsuariosPanel = ({ toast, onClose, usuarioActual }) => {
    const [usuarios, setUsuarios] = useState({});
    const [editando, setEditando] = useState(null);
    const [nuevoUsuario, setNuevoUsuario] = useState({ 
        id: '', nombre: '', email: '', rol: 'consulta', password: '', requires2FA: true 
    });
    const [mostrarFormulario, setMostrarFormulario] = useState(false);
    const [cargando, setCargando] = useState(false);
    
    useEffect(() => {
        cargarUsuarios();
    }, []);
    
    const cargarUsuarios = () => {
        const users = cargarUsuariosSistema();
        setUsuarios(users);
    };
    
    const handleCrearUsuario = async () => {
        if (!nuevoUsuario.id || !nuevoUsuario.nombre || !nuevoUsuario.password) {
            toast('⚠️ Complete todos los campos obligatorios', 'warning');
            return;
        }
        
        if (usuarios[nuevoUsuario.id.toLowerCase()]) {
            toast('❌ Ya existe un usuario con ese ID', 'error');
            return;
        }
        
        if (nuevoUsuario.password.length < 8) {
            toast('⚠️ La contraseña debe tener al menos 8 caracteres', 'warning');
            return;
        }
        
        setCargando(true);
        
        const hash = await generarPasswordHash(nuevoUsuario.password);
        
        const nuevo = {
            passwordHash: hash,
            nombre: nuevoUsuario.nombre,
            email: nuevoUsuario.email,
            rol: nuevoUsuario.rol,
            requires2FA: nuevoUsuario.requires2FA,
            activo: true,
            fechaCreacion: new Date().toISOString().split('T')[0],
            ultimoAcceso: null
        };
        
        const actualizados = { ...usuarios, [nuevoUsuario.id.toLowerCase()]: nuevo };
        guardarUsuariosSistema(actualizados);
        USUARIOS_SISTEMA = actualizados;
        
        // Registrar en historial
        if (window.HistorialCambios) {
            window.HistorialCambios.registrar('USUARIO_CREADO', {
                usuarioId: nuevoUsuario.id.toLowerCase(),
                nombre: nuevoUsuario.nombre,
                rol: nuevoUsuario.rol
            }, usuarioActual?.usuario);
        }
        
        toast('✅ Usuario creado correctamente', 'success');
        setNuevoUsuario({ id: '', nombre: '', email: '', rol: 'consulta', password: '', requires2FA: true });
        setMostrarFormulario(false);
        cargarUsuarios();
        setCargando(false);
    };
    
    const handleToggleActivo = (userId) => {
        if (userId === 'admin') {
            toast('⚠️ No se puede desactivar el usuario admin', 'warning');
            return;
        }
        
        const actualizados = { ...usuarios };
        actualizados[userId].activo = !actualizados[userId].activo;
        guardarUsuariosSistema(actualizados);
        USUARIOS_SISTEMA = actualizados;
        
        if (window.HistorialCambios) {
            window.HistorialCambios.registrar(
                actualizados[userId].activo ? 'USUARIO_ACTIVADO' : 'USUARIO_DESACTIVADO',
                { usuarioId: userId },
                usuarioActual?.usuario
            );
        }
        
        toast(`✅ Usuario ${actualizados[userId].activo ? 'activado' : 'desactivado'}`, 'success');
        cargarUsuarios();
    };
    
    const handleResetPassword = async (userId) => {
        const nuevaPassword = prompt('Ingrese la nueva contraseña (mínimo 8 caracteres):');
        if (!nuevaPassword || nuevaPassword.length < 8) {
            toast('⚠️ Contraseña inválida', 'warning');
            return;
        }
        
        setCargando(true);
        const hash = await generarPasswordHash(nuevaPassword);
        
        const actualizados = { ...usuarios };
        actualizados[userId].passwordHash = hash;
        guardarUsuariosSistema(actualizados);
        USUARIOS_SISTEMA = actualizados;
        
        if (window.HistorialCambios) {
            window.HistorialCambios.registrar('USUARIO_PASSWORD_RESET', { usuarioId: userId }, usuarioActual?.usuario);
        }
        
        toast('✅ Contraseña actualizada', 'success');
        setCargando(false);
    };
    
    const handleReset2FA = (userId) => {
        if (!confirm('¿Resetear 2FA de este usuario? Deberá configurarlo nuevamente.')) return;
        
        // Eliminar secreto 2FA del localStorage
        localStorage.removeItem(`tehui_2fa_${userId}`);
        
        if (window.HistorialCambios) {
            window.HistorialCambios.registrar('USUARIO_2FA_RESET', { usuarioId: userId }, usuarioActual?.usuario);
        }
        
        toast('✅ 2FA reseteado. El usuario deberá configurarlo nuevamente', 'success');
    };
    
    return (
        <div style={{padding: '10px 0'}}>
            {/* Header con botón crear */}
            <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:'20px'}}>
                <div>
                    <h4 style={{margin:0}}>👥 Usuarios del Sistema</h4>
                    <small style={{color:'var(--text-muted)'}}>{Object.keys(usuarios).length} usuarios registrados</small>
                </div>
                <button 
                    className="btn btn-success"
                    onClick={() => setMostrarFormulario(!mostrarFormulario)}
                >
                    {mostrarFormulario ? '✕ Cancelar' : '+ Nuevo Usuario'}
                </button>
            </div>
            
            {/* Formulario nuevo usuario */}
            {mostrarFormulario && (
                <div style={{background:'var(--bg-main)', padding:'15px', borderRadius:'8px', marginBottom:'20px'}}>
                    <h5 style={{marginTop:0}}>Crear Nuevo Usuario</h5>
                    <div style={{display:'grid', gridTemplateColumns:'1fr 1fr', gap:'10px'}}>
                        <div>
                            <label style={{fontSize:'11px', fontWeight:'600'}}>ID Usuario *</label>
                            <input 
                                type="text" 
                                className="form-control form-control-sm"
                                placeholder="ej: maria.perez"
                                value={nuevoUsuario.id}
                                onChange={e => setNuevoUsuario({...nuevoUsuario, id: e.target.value})}
                            />
                        </div>
                        <div>
                            <label style={{fontSize:'11px', fontWeight:'600'}}>Nombre Completo *</label>
                            <input 
                                type="text" 
                                className="form-control form-control-sm"
                                placeholder="ej: María Pérez"
                                value={nuevoUsuario.nombre}
                                onChange={e => setNuevoUsuario({...nuevoUsuario, nombre: e.target.value})}
                            />
                        </div>
                        <div>
                            <label style={{fontSize:'11px', fontWeight:'600'}}>Email</label>
                            <input 
                                type="email" 
                                className="form-control form-control-sm"
                                placeholder="ej: maria@tehui.edu.do"
                                value={nuevoUsuario.email}
                                onChange={e => setNuevoUsuario({...nuevoUsuario, email: e.target.value})}
                            />
                        </div>
                        <div>
                            <label style={{fontSize:'11px', fontWeight:'600'}}>Rol</label>
                            <select 
                                className="form-control form-control-sm"
                                value={nuevoUsuario.rol}
                                onChange={e => setNuevoUsuario({...nuevoUsuario, rol: e.target.value})}
                            >
                                <option value="admin">Administrador (acceso total)</option>
                                <option value="rrhh">RRHH (gestión empleados)</option>
                                <option value="consulta">Consulta (solo lectura)</option>
                            </select>
                        </div>
                        <div>
                            <label style={{fontSize:'11px', fontWeight:'600'}}>Contraseña *</label>
                            <input 
                                type="password" 
                                className="form-control form-control-sm"
                                placeholder="Mínimo 8 caracteres"
                                value={nuevoUsuario.password}
                                onChange={e => setNuevoUsuario({...nuevoUsuario, password: e.target.value})}
                            />
                        </div>
                        <div style={{display:'flex', alignItems:'center', gap:'8px', paddingTop:'20px'}}>
                            <input 
                                type="checkbox" 
                                id="req2fa"
                                checked={nuevoUsuario.requires2FA}
                                onChange={e => setNuevoUsuario({...nuevoUsuario, requires2FA: e.target.checked})}
                            />
                            <label htmlFor="req2fa" style={{fontSize:'11px'}}>Requiere 2FA</label>
                        </div>
                    </div>
                    <div style={{marginTop:'15px', display:'flex', gap:'10px'}}>
                        <button className="btn btn-primary" onClick={handleCrearUsuario} disabled={cargando}>
                            {cargando ? '⏳ Creando...' : '✓ Crear Usuario'}
                        </button>
                    </div>
                </div>
            )}
            
            {/* Lista de usuarios */}
            <div style={{border:'1px solid var(--border)', borderRadius:'8px', overflow:'hidden'}}>
                <table style={{width:'100%', fontSize:'12px', borderCollapse:'collapse'}}>
                    <thead>
                        <tr style={{background:'var(--bg-main)'}}>
                            <th style={{padding:'10px', textAlign:'left'}}>Usuario</th>
                            <th style={{padding:'10px', textAlign:'left'}}>Nombre</th>
                            <th style={{padding:'10px', textAlign:'center'}}>Rol</th>
                            <th style={{padding:'10px', textAlign:'center'}}>Estado</th>
                            <th style={{padding:'10px', textAlign:'center'}}>2FA</th>
                            <th style={{padding:'10px', textAlign:'center'}}>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {Object.entries(usuarios).map(([userId, user]) => (
                            <tr key={userId} style={{borderTop:'1px solid var(--border)', opacity: user.activo ? 1 : 0.5}}>
                                <td style={{padding:'10px'}}>
                                    <strong>{userId}</strong>
                                    <br/><small style={{color:'var(--text-muted)'}}>{user.email}</small>
                                </td>
                                <td style={{padding:'10px'}}>{user.nombre}</td>
                                <td style={{padding:'10px', textAlign:'center'}}>
                                    <span className={`badge badge-${user.rol === 'admin' ? 'danger' : user.rol === 'rrhh' ? 'warning' : 'info'}`}>
                                        {user.rol}
                                    </span>
                                </td>
                                <td style={{padding:'10px', textAlign:'center'}}>
                                    <span className={`badge badge-${user.activo ? 'success' : 'secondary'}`}>
                                        {user.activo ? '✓ Activo' : '✕ Inactivo'}
                                    </span>
                                </td>
                                <td style={{padding:'10px', textAlign:'center'}}>
                                    {user.requires2FA ? '🔐' : '🔓'}
                                </td>
                                <td style={{padding:'10px', textAlign:'center'}}>
                                    <div style={{display:'flex', gap:'4px', justifyContent:'center', flexWrap:'wrap'}}>
                                        <button 
                                            className="btn btn-xs btn-warning"
                                            onClick={() => handleResetPassword(userId)}
                                            title="Cambiar contraseña"
                                        >
                                            🔑
                                        </button>
                                        <button 
                                            className="btn btn-xs btn-info"
                                            onClick={() => handleReset2FA(userId)}
                                            title="Resetear 2FA"
                                        >
                                            📱
                                        </button>
                                        <button 
                                            className={`btn btn-xs btn-${user.activo ? 'secondary' : 'success'}`}
                                            onClick={() => handleToggleActivo(userId)}
                                            title={user.activo ? 'Desactivar' : 'Activar'}
                                            disabled={userId === 'admin'}
                                        >
                                            {user.activo ? '🚫' : '✓'}
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            </div>
            
            <div style={{marginTop:'15px', padding:'12px', background:'rgba(255,193,7,0.1)', borderRadius:'8px', fontSize:'11px'}}>
                <strong>💡 Roles:</strong><br/>
                • <strong>Admin:</strong> Acceso total al sistema<br/>
                • <strong>RRHH:</strong> Gestionar empleados, nóminas, préstamos<br/>
                • <strong>Consulta:</strong> Solo ver información, no puede modificar
            </div>
        </div>
    );
};

// =====================================================
// COMPONENTE HISTORIAL Y AUDITORÍA
// Panel para ver todas las acciones del sistema
// =====================================================
const HistorialAuditoriaPanel = ({ toast, onClose }) => {
    const [historial, setHistorial] = useState([]);
    const [filtros, setFiltros] = useState({ tipo: '', usuario: '', busqueda: '', limite: 100 });
    const [stats, setStats] = useState(null);
    const [cargando, setCargando] = useState(false);
    
    useEffect(() => {
        cargarHistorial();
    }, [filtros]);
    
    const cargarHistorial = () => {
        if (window.HistorialCambios) {
            setHistorial(window.HistorialCambios.obtener(filtros));
            setStats(window.HistorialCambios.estadisticas());
        }
    };
    
    const exportarHistorial = (formato) => {
        if (window.HistorialCambios) {
            window.HistorialCambios.exportar(formato);
            toast(`✅ Historial exportado en formato ${formato.toUpperCase()}`, 'success');
        }
    };
    
    const limpiarHistorial = () => {
        const dias = prompt('¿Eliminar registros con más de cuántos días de antigüedad?', '90');
        if (!dias) return;
        
        const eliminados = window.HistorialCambios.limpiar(parseInt(dias));
        toast(`✅ Se eliminaron ${eliminados} registros antiguos`, 'success');
        cargarHistorial();
    };
    
    const getTipoColor = (tipo) => {
        if (tipo.includes('CREADO') || tipo.includes('EXITOSO')) return 'success';
        if (tipo.includes('ELIMINADO') || tipo.includes('FALLIDO')) return 'danger';
        if (tipo.includes('EDITADO') || tipo.includes('RESET')) return 'warning';
        return 'info';
    };
    
    const getTipoIcon = (tipo) => {
        if (tipo.includes('USUARIO')) return '👤';
        if (tipo.includes('EMPLEADO')) return '👥';
        if (tipo.includes('NOMINA')) return '💰';
        if (tipo.includes('PRESTAMO')) return '💳';
        if (tipo.includes('LICENCIA')) return '🏖️';
        if (tipo.includes('BACKUP')) return '💾';
        if (tipo.includes('LOGIN') || tipo.includes('LOGOUT')) return '🔐';
        if (tipo.includes('SYNC')) return '☁️';
        return '📋';
    };
    
    return (
        <div style={{padding: '10px 0'}}>
            {/* Estadísticas */}
            {stats && (
                <div style={{display:'grid', gridTemplateColumns:'repeat(4, 1fr)', gap:'10px', marginBottom:'20px'}}>
                    <div style={{background:'var(--bg-main)', padding:'12px', borderRadius:'8px', textAlign:'center'}}>
                        <div style={{fontSize:'24px', fontWeight:'bold', color:'var(--primary)'}}>{stats.total}</div>
                        <div style={{fontSize:'10px', color:'var(--text-muted)'}}>Total Registros</div>
                    </div>
                    <div style={{background:'var(--bg-main)', padding:'12px', borderRadius:'8px', textAlign:'center'}}>
                        <div style={{fontSize:'24px', fontWeight:'bold', color:'var(--success)'}}>{stats.ultimaSemana}</div>
                        <div style={{fontSize:'10px', color:'var(--text-muted)'}}>Última Semana</div>
                    </div>
                    <div style={{background:'var(--bg-main)', padding:'12px', borderRadius:'8px', textAlign:'center'}}>
                        <div style={{fontSize:'24px', fontWeight:'bold', color:'var(--warning)'}}>{Object.keys(stats.porUsuario).length}</div>
                        <div style={{fontSize:'10px', color:'var(--text-muted)'}}>Usuarios Activos</div>
                    </div>
                    <div style={{background:'var(--bg-main)', padding:'12px', borderRadius:'8px', textAlign:'center'}}>
                        <div style={{fontSize:'24px', fontWeight:'bold', color:'var(--info)'}}>{Object.keys(stats.porTipo).length}</div>
                        <div style={{fontSize:'10px', color:'var(--text-muted)'}}>Tipos de Evento</div>
                    </div>
                </div>
            )}
            
            {/* Filtros */}
            <div style={{display:'flex', gap:'10px', marginBottom:'15px', flexWrap:'wrap', alignItems:'center'}}>
                <input 
                    type="text"
                    className="form-control form-control-sm"
                    style={{width:'200px'}}
                    placeholder="🔍 Buscar..."
                    value={filtros.busqueda}
                    onChange={e => setFiltros({...filtros, busqueda: e.target.value})}
                />
                <select 
                    className="form-control form-control-sm"
                    style={{width:'150px'}}
                    value={filtros.tipo}
                    onChange={e => setFiltros({...filtros, tipo: e.target.value})}
                >
                    <option value="">Todos los tipos</option>
                    <option value="LOGIN_EXITOSO">Logins</option>
                    <option value="EMPLEADO_">Empleados</option>
                    <option value="NOMINA_">Nóminas</option>
                    <option value="USUARIO_">Usuarios</option>
                    <option value="BACKUP_">Backups</option>
                </select>
                <select 
                    className="form-control form-control-sm"
                    style={{width:'100px'}}
                    value={filtros.limite}
                    onChange={e => setFiltros({...filtros, limite: parseInt(e.target.value)})}
                >
                    <option value={50}>50</option>
                    <option value={100}>100</option>
                    <option value={500}>500</option>
                    <option value={1000}>1000</option>
                </select>
                <div style={{marginLeft:'auto', display:'flex', gap:'5px'}}>
                    <button className="btn btn-sm btn-info" onClick={() => exportarHistorial('csv')}>📥 CSV</button>
                    <button className="btn btn-sm btn-info" onClick={() => exportarHistorial('json')}>📥 JSON</button>
                    <button className="btn btn-sm btn-warning" onClick={limpiarHistorial}>🗑️ Limpiar</button>
                </div>
            </div>
            
            {/* Lista de eventos */}
            <div style={{maxHeight:'400px', overflowY:'auto', border:'1px solid var(--border)', borderRadius:'8px'}}>
                {historial.length === 0 ? (
                    <div style={{padding:'40px', textAlign:'center', color:'var(--text-muted)'}}>
                        No hay registros de actividad
                    </div>
                ) : (
                    historial.map((item, i) => (
                        <div key={item.id} style={{
                            display:'flex', gap:'12px', padding:'10px 12px',
                            borderBottom: i < historial.length - 1 ? '1px solid var(--border-light)' : 'none',
                            alignItems:'flex-start'
                        }}>
                            <div style={{fontSize:'20px'}}>{getTipoIcon(item.tipo)}</div>
                            <div style={{flex:1}}>
                                <div style={{display:'flex', alignItems:'center', gap:'8px'}}>
                                    <span className={`badge badge-${getTipoColor(item.tipo)}`} style={{fontSize:'9px'}}>
                                        {item.tipo.replace(/_/g, ' ')}
                                    </span>
                                    <span style={{fontSize:'10px', color:'var(--text-muted)'}}>por {item.usuario}</span>
                                </div>
                                <div style={{fontSize:'11px', marginTop:'4px'}}>
                                    {item.datos && Object.keys(item.datos).length > 0 && (
                                        <span style={{color:'var(--text-secondary)'}}>
                                            {Object.entries(item.datos).map(([k,v]) => `${k}: ${v}`).join(' • ')}
                                        </span>
                                    )}
                                </div>
                            </div>
                            <div style={{fontSize:'10px', color:'var(--text-muted)', whiteSpace:'nowrap'}}>
                                {new Date(item.timestamp).toLocaleString('es-DO', {
                                    day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit'
                                })}
                            </div>
                        </div>
                    ))
                )}
            </div>
        </div>
    );
};

// =====================================================
// COMPONENTE EXPORTACIÓN TSS/DGII
// Generar archivos para reportes gubernamentales
// =====================================================
const ExportacionTSSPanel = ({ empleados, nominas, config, toast }) => {
    const [periodoExport, setPeriodoExport] = useState({
        mes: new Date().getMonth(),
        año: new Date().getFullYear()
    });
    const [tipoExport, setTipoExport] = useState('tss');
    const [cargando, setCargando] = useState(false);
    
    const MESES_NOMBRES = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
    
    // Generar archivo TSS (Tesorería de la Seguridad Social)
    const generarArchivoTSS = () => {
        const nominaMes = nominas.find(n => 
            n.periodo.mes === periodoExport.mes && 
            n.periodo.año === periodoExport.año
        );
        
        if (!nominaMes) {
            toast('⚠️ No hay nómina para el período seleccionado', 'warning');
            return null;
        }
        
        // Formato TSS: RNC|TipoDoc|NumDoc|Nombre|SFS|AFP|Riesgos|Infotep
        let contenido = '';
        const rnc = config.empresa.rnc.replace(/-/g, '');
        
        empleados.filter(e => e.activo).forEach(emp => {
            const docNum = emp.documento.replace(/-/g, '');
            const nombre = emp.nombre.toUpperCase().substring(0, 50);
            const salario = emp.salarioBase || 0;
            
            // Cálculos TSS
            const sfs = Math.round(salario * 0.0709 * 100) / 100; // SFS 7.09%
            const afp = Math.round(salario * 0.0287 * 100) / 100; // AFP 2.87%
            const srl = Math.round(salario * 0.0110 * 100) / 100; // Riesgos Lab 1.10%
            const infotep = Math.round(salario * 0.01 * 100) / 100; // INFOTEP 1%
            
            contenido += `${rnc}|C|${docNum}|${nombre}|${sfs.toFixed(2)}|${afp.toFixed(2)}|${srl.toFixed(2)}|${infotep.toFixed(2)}\n`;
        });
        
        return {
            nombre: `TSS_${rnc}_${periodoExport.año}${String(periodoExport.mes + 1).padStart(2, '0')}.txt`,
            contenido: contenido,
            tipo: 'text/plain'
        };
    };
    
    // Generar archivo IR-17 (DGII)
    const generarArchivoIR17 = () => {
        const nominaMes = nominas.find(n => 
            n.periodo.mes === periodoExport.mes && 
            n.periodo.año === periodoExport.año
        );
        
        if (!nominaMes) {
            toast('⚠️ No hay nómina para el período seleccionado', 'warning');
            return null;
        }
        
        // Formato IR-17: Detalle de retenciones
        let contenido = 'RNC/Cedula|Nombre|Salario Bruto|ISR Retenido|Otros Ingresos|Total\n';
        
        empleados.filter(e => e.activo).forEach(emp => {
            const doc = emp.documento.replace(/-/g, '');
            const nombre = emp.nombre.toUpperCase();
            const salario = emp.salarioBase || 0;
            const isr = emp.isrMensual || 0;
            
            contenido += `${doc}|${nombre}|${salario.toFixed(2)}|${isr.toFixed(2)}|0.00|${salario.toFixed(2)}\n`;
        });
        
        return {
            nombre: `IR17_${config.empresa.rnc.replace(/-/g, '')}_${periodoExport.año}${String(periodoExport.mes + 1).padStart(2, '0')}.csv`,
            contenido: contenido,
            tipo: 'text/csv'
        };
    };
    
    // Generar Formato 606 (Compras)
    const generarFormato606 = () => {
        // Este es simplificado - normalmente requiere datos de proveedores
        let contenido = 'RNC/Cedula Proveedor|Tipo Bienes/Servicios|NCF|Fecha Comprobante|Monto\n';
        contenido += '// Agregar datos de proveedores de nómina aquí\n';
        
        return {
            nombre: `606_${config.empresa.rnc.replace(/-/g, '')}_${periodoExport.año}${String(periodoExport.mes + 1).padStart(2, '0')}.csv`,
            contenido: contenido,
            tipo: 'text/csv'
        };
    };
    
    // Generar Reporte de Empleados para DGII
    const generarReporteEmpleados = () => {
        let contenido = 'No.|Cedula|Nombre|Departamento|Cargo|Fecha Ingreso|Salario|Estado\n';
        
        empleados.forEach((emp, i) => {
            contenido += `${i+1}|${emp.documento}|${emp.nombre}|${emp.departamento}|${emp.cargo}|${emp.fechaIngreso}|${(emp.salarioBase || 0).toFixed(2)}|${emp.activo ? 'Activo' : 'Inactivo'}\n`;
        });
        
        return {
            nombre: `Empleados_${config.empresa.rnc.replace(/-/g, '')}_${new Date().toISOString().split('T')[0]}.csv`,
            contenido: contenido,
            tipo: 'text/csv'
        };
    };
    
    const handleExportar = () => {
        setCargando(true);
        
        let archivo = null;
        switch(tipoExport) {
            case 'tss': archivo = generarArchivoTSS(); break;
            case 'ir17': archivo = generarArchivoIR17(); break;
            case '606': archivo = generarFormato606(); break;
            case 'empleados': archivo = generarReporteEmpleados(); break;
        }
        
        if (archivo) {
            const blob = new Blob([archivo.contenido], { type: archivo.tipo });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = archivo.nombre;
            a.click();
            URL.revokeObjectURL(url);
            
            if (window.HistorialCambios) {
                window.HistorialCambios.registrar('DATOS_EXPORTADOS', {
                    tipo: tipoExport,
                    archivo: archivo.nombre
                });
            }
            
            toast(`✅ Archivo ${archivo.nombre} generado`, 'success');
        }
        
        setCargando(false);
    };
    
    return (
        <div style={{padding: '10px 0'}}>
            <div style={{display:'grid', gridTemplateColumns:'repeat(2, 1fr)', gap:'20px'}}>
                {/* Selección de período */}
                <div style={{background:'var(--bg-main)', padding:'15px', borderRadius:'8px'}}>
                    <h5 style={{marginTop:0}}>📅 Período a Exportar</h5>
                    <div style={{display:'flex', gap:'10px'}}>
                        <select 
                            className="form-control form-control-sm"
                            value={periodoExport.mes}
                            onChange={e => setPeriodoExport({...periodoExport, mes: parseInt(e.target.value)})}
                        >
                            {MESES_NOMBRES.map((m, i) => (
                                <option key={i} value={i}>{m}</option>
                            ))}
                        </select>
                        <select 
                            className="form-control form-control-sm"
                            value={periodoExport.año}
                            onChange={e => setPeriodoExport({...periodoExport, año: parseInt(e.target.value)})}
                        >
                            {[2024, 2025, 2026, 2027].map(a => (
                                <option key={a} value={a}>{a}</option>
                            ))}
                        </select>
                    </div>
                </div>
                
                {/* Selección de tipo */}
                <div style={{background:'var(--bg-main)', padding:'15px', borderRadius:'8px'}}>
                    <h5 style={{marginTop:0}}>📄 Tipo de Reporte</h5>
                    <select 
                        className="form-control"
                        value={tipoExport}
                        onChange={e => setTipoExport(e.target.value)}
                    >
                        <option value="tss">📊 TSS - Tesorería Seguridad Social</option>
                        <option value="ir17">🏛️ IR-17 - Retenciones ISR (DGII)</option>
                        <option value="606">📋 Formato 606 - Compras (DGII)</option>
                        <option value="empleados">👥 Lista de Empleados</option>
                    </select>
                </div>
            </div>
            
            {/* Descripción del reporte */}
            <div style={{marginTop:'20px', padding:'15px', border:'1px solid var(--border)', borderRadius:'8px'}}>
                {tipoExport === 'tss' && (
                    <div>
                        <h5 style={{marginTop:0}}>📊 Archivo TSS</h5>
                        <p style={{fontSize:'12px', color:'var(--text-secondary)'}}>
                            Genera el archivo para la Tesorería de la Seguridad Social con el detalle de cotizaciones:
                        </p>
                        <ul style={{fontSize:'11px', color:'var(--text-muted)'}}>
                            <li>SFS (Seguro Familiar de Salud) - 7.09% empleador</li>
                            <li>AFP (Fondo de Pensiones) - 2.87% empleado</li>
                            <li>SRL (Seguro Riesgos Laborales) - 1.10% empleador</li>
                            <li>INFOTEP - 1.00% empleador</li>
                        </ul>
                    </div>
                )}
                {tipoExport === 'ir17' && (
                    <div>
                        <h5 style={{marginTop:0}}>🏛️ Formulario IR-17</h5>
                        <p style={{fontSize:'12px', color:'var(--text-secondary)'}}>
                            Declaración jurada mensual de retenciones del ISR (Impuesto Sobre la Renta) a empleados.
                            Debe presentarse antes del día 10 del mes siguiente.
                        </p>
                    </div>
                )}
                {tipoExport === '606' && (
                    <div>
                        <h5 style={{marginTop:0}}>📋 Formato 606</h5>
                        <p style={{fontSize:'12px', color:'var(--text-secondary)'}}>
                            Formato de envío de compras de bienes y servicios para la DGII.
                            Este reporte requiere información adicional de proveedores.
                        </p>
                    </div>
                )}
                {tipoExport === 'empleados' && (
                    <div>
                        <h5 style={{marginTop:0}}>👥 Lista de Empleados</h5>
                        <p style={{fontSize:'12px', color:'var(--text-secondary)'}}>
                            Listado completo de empleados con datos básicos: documento, nombre, departamento, cargo, fecha de ingreso, salario y estado.
                        </p>
                    </div>
                )}
            </div>
            
            {/* Botón exportar */}
            <div style={{marginTop:'20px', textAlign:'center'}}>
                <button 
                    className="btn btn-lg btn-primary"
                    onClick={handleExportar}
                    disabled={cargando}
                >
                    {cargando ? '⏳ Generando...' : '📥 Generar y Descargar Archivo'}
                </button>
            </div>
            
            {/* Información adicional */}
            <div style={{marginTop:'20px', padding:'12px', background:'rgba(33, 150, 243, 0.1)', borderRadius:'8px', fontSize:'11px'}}>
                <strong>ℹ️ Información:</strong><br/>
                • Los archivos se generan según los formatos oficiales de RD<br/>
                • Verifique los datos antes de enviar a las instituciones<br/>
                • La empresa configurada es: <strong>{config.empresa.nombre}</strong> (RNC: {config.empresa.rnc})
            </div>
        </div>
    );
};

// =====================================================
// COMPONENTE VOLANTE DE PAGO - DISEÑO COMPACTO (3 POR PÁGINA)
// =====================================================
const Volante = ({ emp, det, periodo, config, nominaCodigo }) => {
    const periodoDesde = periodo.tipo === 'quincenal' 
        ? `${periodo.quincena === 1 ? '01' : '16'}/${String(periodo.mes).padStart(2,'0')}/${periodo.año}`
        : `01/${String(periodo.mes).padStart(2,'0')}/${periodo.año}`;
    const periodoHasta = periodo.tipo === 'quincenal'
        ? `${periodo.quincena === 1 ? '15' : new Date(periodo.año, periodo.mes, 0).getDate()}/${String(periodo.mes).padStart(2,'0')}/${periodo.año}`
        : `${new Date(periodo.año, periodo.mes, 0).getDate()}/${String(periodo.mes).padStart(2,'0')}/${periodo.año}`;
    
    return (
        <div className="volante">
            {/* Header: Empresa centrada */}
            <div className="volante-header">
                <h2>{config.empresa.nombre}</h2>
                <p>{config.empresa.direccion}</p>
                <p>{config.empresa.razonSocial || 'GRUPO PAIDOS, SRL'}</p>
            </div>
            
            {/* Info: ID, Período, Nómina */}
            <div className="volante-info-row">
                <span><label>No.</label> {emp.id}</span>
                <span><strong>NÓMINA DESDE {periodoDesde} HASTA {periodoHasta}</strong></span>
                <span><em>Nómina #: {nominaCodigo || 'N/A'}</em></span>
            </div>
            
            {/* Datos del empleado */}
            <div className="volante-empleado">
                <div className="volante-empleado-nombre">{emp.nombre}</div>
                <div className="volante-empleado-datos">
                    <span><label>{emp.tipoDocumento === 'pasaporte' ? 'PASAPORTE' : 'CÉDULA'}:</label> {emp.documento}</span>
                    <span><label>NSS:</label> {emp.nss || 'N/A'}</span>
                    <span><label>DEPARTAMENTO:</label> {emp.departamento}</span>
                </div>
            </div>
            
            {/* Grid: Ingresos | Deducciones */}
            <div className="volante-grid">
                {/* Columna Ingresos */}
                <div className="volante-col">
                    <h4>&lt;&gt; Ingresos &lt;&gt;</h4>
                    <div className="volante-row">
                        <span>Normal</span>
                        <span className="monto">{formatMoney(det.salarioBase)}</span>
                    </div>
                    {det.vacaciones > 0 && (
                        <div className="volante-row">
                            <span>Vacaciones</span>
                            <span className="monto">{formatMoney(det.vacaciones)}</span>
                        </div>
                    )}
                    {det.horasExtra > 0 && (
                        <div className="volante-row">
                            <span>Extra</span>
                            <span className="monto">{formatMoney(det.horasExtra)}</span>
                        </div>
                    )}
                    {(det.bonificacion > 0 || det.comisiones > 0 || det.incentivos > 0 || det.viaticos > 0 || det.otrosIng > 0) && (
                        <div className="volante-row">
                            <span>Otros</span>
                            <span className="monto">{formatMoney((det.bonificacion || 0) + (det.comisiones || 0) + (det.incentivos || 0) + (det.viaticos || 0) + (det.otrosIng || 0))}</span>
                        </div>
                    )}
                    {det.regalia > 0 && (
                        <div className="volante-row">
                            <span>Regalía</span>
                            <span className="monto">{formatMoney(det.regalia)}</span>
                        </div>
                    )}
                    <div className="volante-row total-row">
                        <span></span>
                        <span className="monto">{formatMoney(det.totalIng)}</span>
                    </div>
                </div>
                
                {/* Columna Deducciones */}
                <div className="volante-col">
                    <h4>&lt;&gt; Deducciones &lt;&gt;</h4>
                    <div className="volante-row">
                        <span>AFP</span>
                        <span className="monto">{formatMoney(det.afpEmp)}</span>
                    </div>
                    {det.isr > 0 && (
                        <div className="volante-row">
                            <span>Imp./Renta</span>
                            <span className="monto">{formatMoney(det.isr)}</span>
                        </div>
                    )}
                    <div className="volante-row">
                        <span>Seg. F. Salud</span>
                        <span className="monto">{formatMoney(det.sfsEmp)}</span>
                    </div>
                    {det.seguroPrivado > 0 && (
                        <div className="volante-row">
                            <span>Seg. Medico</span>
                            <span className="monto">{formatMoney(det.seguroPrivado)}</span>
                        </div>
                    )}
                    {det.pdss > 0 && (
                        <div className="volante-row">
                            <span>PDSS-PER CAPITA</span>
                            <span className="monto">{formatMoney(det.pdss)}</span>
                        </div>
                    )}
                    {det.cuotaPrestamo > 0 && (
                        <div className="volante-row">
                            <span>Préstamo</span>
                            <span className="monto">{formatMoney(det.cuotaPrestamo)}</span>
                        </div>
                    )}
                    {det.cooperativa > 0 && (
                        <div className="volante-row">
                            <span>Cooperativa</span>
                            <span className="monto">{formatMoney(det.cooperativa)}</span>
                        </div>
                    )}
                    {det.descAusencias > 0 && (
                        <div className="volante-row">
                            <span>Ausencias</span>
                            <span className="monto">{formatMoney(det.descAusencias)}</span>
                        </div>
                    )}
                    {det.embargo > 0 && (
                        <div className="volante-row">
                            <span>Embargo</span>
                            <span className="monto">{formatMoney(det.embargo)}</span>
                        </div>
                    )}
                    <div className="volante-row total-row">
                        <span></span>
                        <span className="monto">{formatMoney(det.totalDed)}</span>
                    </div>
                </div>
            </div>
            
            {/* Pie: Firma + Neto */}
            <div className="volante-footer">
                <div className="volante-firma">
                    <div className="volante-firma-line"></div>
                    <span>FIRMA / CÉDULA</span>
                </div>
                <div className="volante-neto">
                    <label>Total Neto</label>
                    <div className="monto">{formatMoney(det.neto)}</div>
                </div>
                <div className="volante-totales-ded">
                    <div><span>TOTAL ING:</span><span className="monto">{formatMoney(det.totalIng)}</span></div>
                    <div><span>TOTAL DED:</span><span className="monto">{formatMoney(det.totalDed)}</span></div>
                </div>
            </div>
        </div>
    );
};

// =====================================================
// CONFIGURACIÓN DE USUARIOS CON 2FA
// =====================================================
// =====================================================
// SISTEMA DE GESTIÓN DE USUARIOS DINÁMICO
// Los usuarios se guardan en localStorage para poder administrarlos
// =====================================================

// Usuarios por defecto del sistema
const USUARIOS_DEFAULT = {
    admin: { 
        passwordHash: '2451a82e26d0c426f1d7fe4f28674ec387b708a7b9aecc23c75134b04bc795f7', 
        rol: 'admin', 
        nombre: 'Administrador',
        email: 'admin@tehui.edu.do',
        requires2FA: true,
        activo: true,
        fechaCreacion: '2025-01-01',
        ultimoAcceso: null
    },
    consulta: { 
        passwordHash: '6f13a9443c7e9344fd8a0e29a2e5d0ab0eb2ebd4791d4f9e8f9c909069dc0e27', 
        rol: 'consulta', 
        nombre: 'Usuario Consulta',
        email: 'consulta@tehui.edu.do',
        requires2FA: true,
        activo: true,
        fechaCreacion: '2025-01-01',
        ultimoAcceso: null
    }
};

// Cargar usuarios desde localStorage o usar los por defecto
const cargarUsuariosSistema = () => {
    try {
        const guardados = localStorage.getItem('nominaTehui_usuarios');
        if (guardados) {
            return JSON.parse(guardados);
        }
    } catch (e) {
        console.error('Error cargando usuarios:', e);
    }
    // Primera vez: guardar usuarios por defecto
    localStorage.setItem('nominaTehui_usuarios', JSON.stringify(USUARIOS_DEFAULT));
    return { ...USUARIOS_DEFAULT };
};

// Guardar usuarios en localStorage
const guardarUsuariosSistema = (usuarios) => {
    try {
        localStorage.setItem('nominaTehui_usuarios', JSON.stringify(usuarios));
        return true;
    } catch (e) {
        console.error('Error guardando usuarios:', e);
        return false;
    }
};

// Variable global de usuarios (se carga dinámicamente)
let USUARIOS_SISTEMA = cargarUsuariosSistema();

// Función para verificar contraseña contra hash
const verificarPasswordHash = async (password, hashGuardado) => {
    if (window.CryptoTehui) {
        const hashCalculado = await window.CryptoTehui.hashPassword(password);
        return hashCalculado === hashGuardado;
    }
    return false;
};

// Generar hash de contraseña
const generarPasswordHash = async (password) => {
    if (window.CryptoTehui) {
        return await window.CryptoTehui.hashPassword(password);
    }
    return null;
};

// =====================================================
// SISTEMA DE AUDITORÍA Y HISTORIAL DE CAMBIOS
// Registra todas las acciones importantes del sistema
// =====================================================

const HISTORIAL_KEY = 'nominaTehui_historial';
const MAX_HISTORIAL = 1000;

const HistorialCambios = {
    // Registrar un cambio
    registrar: function(tipo, datos, usuario) {
        try {
            let historial = JSON.parse(localStorage.getItem(HISTORIAL_KEY) || '[]');
            
            const registro = {
                id: Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                timestamp: new Date().toISOString(),
                tipo: tipo, // 'EMPLEADO_CREADO', 'EMPLEADO_EDITADO', 'NOMINA_GENERADA', etc.
                usuario: usuario || 'sistema',
                datos: datos,
                ip: 'local',
                navegador: navigator.userAgent.substring(0, 50)
            };
            
            historial.unshift(registro);
            
            // Limitar tamaño
            if (historial.length > MAX_HISTORIAL) {
                historial = historial.slice(0, MAX_HISTORIAL);
            }
            
            localStorage.setItem(HISTORIAL_KEY, JSON.stringify(historial));
            return registro.id;
        } catch (e) {
            console.error('Error registrando historial:', e);
            return null;
        }
    },
    
    // Obtener historial completo o filtrado
    obtener: function(filtros = {}) {
        try {
            let historial = JSON.parse(localStorage.getItem(HISTORIAL_KEY) || '[]');
            
            // Aplicar filtros
            if (filtros.tipo) {
                historial = historial.filter(h => h.tipo === filtros.tipo);
            }
            if (filtros.usuario) {
                historial = historial.filter(h => h.usuario === filtros.usuario);
            }
            if (filtros.desde) {
                const desde = new Date(filtros.desde);
                historial = historial.filter(h => new Date(h.timestamp) >= desde);
            }
            if (filtros.hasta) {
                const hasta = new Date(filtros.hasta);
                historial = historial.filter(h => new Date(h.timestamp) <= hasta);
            }
            if (filtros.busqueda) {
                const busq = filtros.busqueda.toLowerCase();
                historial = historial.filter(h => 
                    JSON.stringify(h.datos).toLowerCase().includes(busq) ||
                    h.tipo.toLowerCase().includes(busq)
                );
            }
            
            return filtros.limite ? historial.slice(0, filtros.limite) : historial;
        } catch (e) {
            console.error('Error obteniendo historial:', e);
            return [];
        }
    },
    
    // Obtener estadísticas
    estadisticas: function() {
        const historial = this.obtener({});
        const stats = {
            total: historial.length,
            porTipo: {},
            porUsuario: {},
            ultimaSemana: 0
        };
        
        const haceSemana = new Date();
        haceSemana.setDate(haceSemana.getDate() - 7);
        
        historial.forEach(h => {
            // Por tipo
            stats.porTipo[h.tipo] = (stats.porTipo[h.tipo] || 0) + 1;
            // Por usuario
            stats.porUsuario[h.usuario] = (stats.porUsuario[h.usuario] || 0) + 1;
            // Última semana
            if (new Date(h.timestamp) >= haceSemana) {
                stats.ultimaSemana++;
            }
        });
        
        return stats;
    },
    
    // Exportar historial
    exportar: function(formato = 'json') {
        const historial = this.obtener({});
        
        if (formato === 'json') {
            const blob = new Blob([JSON.stringify(historial, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `historial_nomina_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        } else if (formato === 'csv') {
            let csv = 'Fecha,Tipo,Usuario,Detalles\n';
            historial.forEach(h => {
                csv += `"${h.timestamp}","${h.tipo}","${h.usuario}","${JSON.stringify(h.datos).replace(/"/g, '""')}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `historial_nomina_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }
    },
    
    // Limpiar historial antiguo
    limpiar: function(diasAntiguedad = 90) {
        try {
            let historial = JSON.parse(localStorage.getItem(HISTORIAL_KEY) || '[]');
            const limite = new Date();
            limite.setDate(limite.getDate() - diasAntiguedad);
            
            const antes = historial.length;
            historial = historial.filter(h => new Date(h.timestamp) >= limite);
            
            localStorage.setItem(HISTORIAL_KEY, JSON.stringify(historial));
            return antes - historial.length;
        } catch (e) {
            return 0;
        }
    }
};

// Tipos de eventos para el historial
const TIPOS_HISTORIAL = {
    // Usuarios
    USUARIO_CREADO: 'USUARIO_CREADO',
    USUARIO_EDITADO: 'USUARIO_EDITADO',
    USUARIO_DESACTIVADO: 'USUARIO_DESACTIVADO',
    USUARIO_PASSWORD_RESET: 'USUARIO_PASSWORD_RESET',
    USUARIO_2FA_RESET: 'USUARIO_2FA_RESET',
    LOGIN_EXITOSO: 'LOGIN_EXITOSO',
    LOGIN_FALLIDO: 'LOGIN_FALLIDO',
    LOGOUT: 'LOGOUT',
    
    // Empleados
    EMPLEADO_CREADO: 'EMPLEADO_CREADO',
    EMPLEADO_EDITADO: 'EMPLEADO_EDITADO',
    EMPLEADO_ELIMINADO: 'EMPLEADO_ELIMINADO',
    
    // Nóminas
    NOMINA_CREADA: 'NOMINA_CREADA',
    NOMINA_EDITADA: 'NOMINA_EDITADA',
    NOMINA_ELIMINADA: 'NOMINA_ELIMINADA',
    NOMINA_CERRADA: 'NOMINA_CERRADA',
    
    // Préstamos
    PRESTAMO_CREADO: 'PRESTAMO_CREADO',
    PRESTAMO_EDITADO: 'PRESTAMO_EDITADO',
    PRESTAMO_PAGADO: 'PRESTAMO_PAGADO',
    
    // Licencias
    LICENCIA_CREADA: 'LICENCIA_CREADA',
    LICENCIA_EDITADA: 'LICENCIA_EDITADA',
    
    // Sistema
    BACKUP_CREADO: 'BACKUP_CREADO',
    BACKUP_RESTAURADO: 'BACKUP_RESTAURADO',
    DATOS_EXPORTADOS: 'DATOS_EXPORTADOS',
    DATOS_IMPORTADOS: 'DATOS_IMPORTADOS',
    SYNC_SHAREPOINT: 'SYNC_SHAREPOINT',
    CONFIG_MODIFICADA: 'CONFIG_MODIFICADA'
};

// Exportar globalmente
window.HistorialCambios = HistorialCambios;
window.TIPOS_HISTORIAL = TIPOS_HISTORIAL;

// =====================================================
// FUNCIONES DE AUTENTICACIÓN DE DOS FACTORES (2FA/TOTP)
// =====================================================

// Generar secreto aleatorio para TOTP (Base32)
const generarSecreto2FA = () => {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
    let secreto = '';
    for (let i = 0; i < 32; i++) {
        secreto += chars[Math.floor(Math.random() * chars.length)];
    }
    return secreto;
};

// Decodificar Base32 a bytes
const base32ToBytes = (base32) => {
    const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
    let bits = '';
    for (let char of base32.toUpperCase().replace(/=+$/, '')) {
        const val = alphabet.indexOf(char);
        if (val === -1) continue;
        bits += val.toString(2).padStart(5, '0');
    }
    const bytes = [];
    for (let i = 0; i + 8 <= bits.length; i += 8) {
        bytes.push(parseInt(bits.substr(i, 8), 2));
    }
    return new Uint8Array(bytes);
};

// HMAC-SHA1 simplificado para TOTP
const hmacSha1 = async (key, message) => {
    const cryptoKey = await crypto.subtle.importKey(
        'raw', key, { name: 'HMAC', hash: 'SHA-1' }, false, ['sign']
    );
    const signature = await crypto.subtle.sign('HMAC', cryptoKey, message);
    return new Uint8Array(signature);
};

// Generar código TOTP
const generarTOTP = async (secreto, tiempo = null) => {
    try {
        const key = base32ToBytes(secreto);
        const epoch = tiempo || Math.floor(Date.now() / 1000);
        const counter = Math.floor(epoch / 30);
        
        const counterBytes = new Uint8Array(8);
        let temp = counter;
        for (let i = 7; i >= 0; i--) {
            counterBytes[i] = temp & 0xff;
            temp = Math.floor(temp / 256);
        }
        
        const hmac = await hmacSha1(key, counterBytes);
        const offset = hmac[hmac.length - 1] & 0x0f;
        const code = ((hmac[offset] & 0x7f) << 24 | 
                      (hmac[offset + 1] & 0xff) << 16 | 
                      (hmac[offset + 2] & 0xff) << 8 | 
                      (hmac[offset + 3] & 0xff)) % 1000000;
        
        return code.toString().padStart(6, '0');
    } catch (e) {
        console.error('Error generando TOTP:', e);
        return null;
    }
};

// Validar código TOTP (permite ±1 intervalo por desfase de tiempo)
const validarTOTP = async (secreto, codigo) => {
    const ahora = Math.floor(Date.now() / 1000);
    
    // Verificar código actual y ±1 intervalo (30 segundos)
    for (let offset of [0, -30, 30]) {
        const esperado = await generarTOTP(secreto, ahora + offset);
        if (esperado === codigo) return true;
    }
    return false;
};

// Generar URI para QR de Authenticator
const generarURIAuthenticator = (usuario, secreto, emisor = 'Sistema Nomina Tehui') => {
    const cuenta = encodeURIComponent(`${emisor}:${usuario}`);
    const params = new URLSearchParams({
        secret: secreto,
        issuer: emisor,
        algorithm: 'SHA1',
        digits: '6',
        period: '30'
    });
    return `otpauth://totp/${cuenta}?${params.toString()}`;
};

// =====================================================
// SISTEMA 2FA MEJORADO CON SINCRONIZACIÓN
// Los secretos se guardan en localStorage Y en usuarios
// para poder recuperarlos desde SharePoint
// =====================================================

// Clave para almacenar secretos 2FA
const SECRETOS_2FA_KEY = 'tehui_2fa_secrets';
const SECRETOS_2FA_BACKUP_KEY = 'nominaTehui_2fa_backup';

// Guardar secreto 2FA (localStorage + usuarios + backup + SharePoint)
const guardarSecreto2FA = (usuario, secreto) => {
    // 1. Guardar en localStorage (acceso rápido)
    const secretos = JSON.parse(localStorage.getItem(SECRETOS_2FA_KEY) || '{}');
    secretos[usuario] = secreto;
    localStorage.setItem(SECRETOS_2FA_KEY, JSON.stringify(secretos));
    
    // 2. Guardar en la estructura de usuarios (para sincronizar)
    const usuarios = cargarUsuariosSistema();
    if (usuarios[usuario]) {
        usuarios[usuario].secreto2FA = secreto;
        usuarios[usuario].fecha2FA = new Date().toISOString();
        guardarUsuariosSistema(usuarios);
        USUARIOS_SISTEMA = usuarios;
    }
    
    // 3. Guardar backup encriptado
    const backup2FA = JSON.parse(localStorage.getItem(SECRETOS_2FA_BACKUP_KEY) || '{}');
    backup2FA[usuario] = {
        secreto: secreto,
        fecha: new Date().toISOString(),
        dispositivo: navigator.userAgent.substring(0, 50)
    };
    localStorage.setItem(SECRETOS_2FA_BACKUP_KEY, JSON.stringify(backup2FA));
    
    // 4. Marcar que necesita sincronizar con SharePoint
    localStorage.setItem('nominaTehui_2fa_pendiente_sync', 'true');
    
    console.log('✅ Secreto 2FA guardado para:', usuario);
    console.log('⚠️ Recuerde sincronizar con SharePoint para respaldar el 2FA');
};

// Verificar si hay 2FA pendiente de sincronizar
const hay2FAPendienteSync = () => {
    return localStorage.getItem('nominaTehui_2fa_pendiente_sync') === 'true';
};

// Marcar 2FA como sincronizado
const marcar2FASincronizado = () => {
    localStorage.removeItem('nominaTehui_2fa_pendiente_sync');
};

// Obtener secreto 2FA (intenta múltiples fuentes)
const obtenerSecreto2FA = (usuario) => {
    // 1. Primero intenta localStorage (más rápido)
    const secretos = JSON.parse(localStorage.getItem(SECRETOS_2FA_KEY) || '{}');
    if (secretos[usuario]) {
        return secretos[usuario];
    }
    
    // 2. Si no está, buscar en usuarios (podría venir de SharePoint)
    const usuarios = cargarUsuariosSistema();
    if (usuarios[usuario] && usuarios[usuario].secreto2FA) {
        // Restaurar a localStorage para próximos accesos
        secretos[usuario] = usuarios[usuario].secreto2FA;
        localStorage.setItem(SECRETOS_2FA_KEY, JSON.stringify(secretos));
        console.log('✅ Secreto 2FA restaurado desde usuarios para:', usuario);
        return usuarios[usuario].secreto2FA;
    }
    
    // 3. Buscar en backup
    const backup = JSON.parse(localStorage.getItem(SECRETOS_2FA_BACKUP_KEY) || '{}');
    if (backup[usuario] && backup[usuario].secreto) {
        // Restaurar
        secretos[usuario] = backup[usuario].secreto;
        localStorage.setItem(SECRETOS_2FA_KEY, JSON.stringify(secretos));
        console.log('✅ Secreto 2FA restaurado desde backup para:', usuario);
        return backup[usuario].secreto;
    }
    
    return null;
};

// Verificar si tiene 2FA configurado
const tiene2FAConfigurado = (usuario) => {
    return obtenerSecreto2FA(usuario) !== null;
};

// Recuperar secreto 2FA desde SharePoint (cuando se conecta)
const recuperarSecretos2FADesdeSharePoint = (usuariosSharePoint) => {
    if (!usuariosSharePoint) return;
    
    const secretosLocales = JSON.parse(localStorage.getItem(SECRETOS_2FA_KEY) || '{}');
    let recuperados = 0;
    
    Object.entries(usuariosSharePoint).forEach(([userId, userData]) => {
        if (userData.secreto2FA && !secretosLocales[userId]) {
            secretosLocales[userId] = userData.secreto2FA;
            recuperados++;
        }
    });
    
    if (recuperados > 0) {
        localStorage.setItem(SECRETOS_2FA_KEY, JSON.stringify(secretosLocales));
        console.log(`✅ ${recuperados} secretos 2FA recuperados desde SharePoint`);
    }
};

// Exportar secreto 2FA para backup manual
const exportarSecreto2FAManual = (usuario) => {
    const secreto = obtenerSecreto2FA(usuario);
    if (!secreto) return null;
    
    return {
        usuario: usuario,
        secreto: secreto,
        issuer: 'Sistema+Nomina+Tehui',
        uri: `otpauth://totp/Sistema%20Nomina%20Tehui%3A${usuario}?secret=${secreto}&issuer=Sistema+Nomina+Tehui&algorithm=SHA1&digits=6&period=30`
    };
};

// Importar/restaurar secreto 2FA manualmente
const importarSecreto2FAManual = (usuario, secreto) => {
    if (!secreto || secreto.length < 16) {
        return { exito: false, error: 'Secreto inválido' };
    }
    
    guardarSecreto2FA(usuario, secreto.toUpperCase().replace(/\s/g, ''));
    return { exito: true };
};

// =====================================================
// FUNCIONES DE CÓDIGO POR EMAIL (EmailJS)
// =====================================================
const EMAILJS_CONFIG = {
    serviceId: 'service_1944u1j',
    templateId: 'template_sn7v16n',
    publicKey: 't9mcT2kCIkd4kamkr'
};

// Inicializar EmailJS
try {
    emailjs.init(EMAILJS_CONFIG.publicKey);
    console.log('✅ EmailJS inicializado');
} catch (e) {
    console.log('⚠️ EmailJS no disponible:', e);
}

// Almacenamiento temporal de códigos por email (en memoria)
const codigosEmailTemp = {};

// Generar código aleatorio de 6 dígitos
const generarCodigoEmail = () => {
    return Math.floor(100000 + Math.random() * 900000).toString();
};

// Enviar código por email
const enviarCodigoEmail = async (usuario, email) => {
    const codigo = generarCodigoEmail();
    const expiracion = Date.now() + (5 * 60 * 1000); // 5 minutos
    
    // Guardar código temporalmente
    codigosEmailTemp[usuario] = { codigo, expiracion };
    
    try {
        const response = await emailjs.send(
            EMAILJS_CONFIG.serviceId,
            EMAILJS_CONFIG.templateId,
            {
                to_name: USUARIOS_SISTEMA[usuario]?.nombre || usuario,
                to_email: email,
                codigo: codigo
            }
        );
        console.log('✅ Código enviado por email:', response.status);
        return { success: true, message: 'Código enviado a ' + email };
    } catch (error) {
        console.error('❌ Error enviando email:', error);
        return { success: false, message: 'Error al enviar el código: ' + error.text };
    }
};

// Validar código por email
const validarCodigoEmail = (usuario, codigo) => {
    const datos = codigosEmailTemp[usuario];
    if (!datos) return false;
    
    // Verificar expiración
    if (Date.now() > datos.expiracion) {
        delete codigosEmailTemp[usuario];
        return false;
    }
    
    // Verificar código
    if (datos.codigo === codigo) {
        delete codigosEmailTemp[usuario]; // Usar solo una vez
        return true;
    }
    
    return false;
};

// =====================================================
// APLICACIÓN PRINCIPAL
// =====================================================

const App = () => {
    // =====================================================
    // AUTENTICACIÓN DE USUARIO CON 2FA
    // =====================================================
    const [usuarioActual, setUsuarioActual] = useState(() => {
        try {
            const saved = sessionStorage.getItem('tehui_nomina_session');
            return saved ? JSON.parse(saved) : null;
        } catch { return null; }
    });
    const [loginForm, setLoginForm] = useState({ usuario: '', password: '', error: '' });
    const [mostrarCambioPassword, setMostrarCambioPassword] = useState(false);
    const [cambioPasswordForm, setCambioPasswordForm] = useState({ actual: '', nueva: '', confirmar: '', error: '' });
    
    // Estados para 2FA
    const [paso2FA, setPaso2FA] = useState(null); // null, 'verificar', 'configurar', 'email'
    const [codigo2FA, setCodigo2FA] = useState('');
    const [error2FA, setError2FA] = useState('');
    const [secretoTemp, setSecretoTemp] = useState(null);
    const [usuarioTemp, setUsuarioTemp] = useState(null);
    const [qrGenerado, setQrGenerado] = useState(false);
    
    // Estados para código por email
    const [enviandoEmail, setEnviandoEmail] = useState(false);
    const [mensajeEmail, setMensajeEmail] = useState('');

    // Generar QR cuando se configura 2FA
    useEffect(() => {
        if (paso2FA === 'configurar' && secretoTemp && !qrGenerado) {
            setTimeout(() => {
                const qrContainer = document.getElementById('qr-2fa-container');
                if (qrContainer) {
                    qrContainer.innerHTML = '';
                    const uri = generarURIAuthenticator(usuarioTemp, secretoTemp);
                    new QRCode(qrContainer, {
                        text: uri,
                        width: 200,
                        height: 200,
                        colorDark: '#1565C0',
                        colorLight: '#ffffff',
                        correctLevel: QRCode.CorrectLevel.H
                    });
                    setQrGenerado(true);
                }
            }, 100);
        }
    }, [paso2FA, secretoTemp, qrGenerado, usuarioTemp]);

    // Función para cambiar contraseña (solo muestra mensaje informativo)
    const handleCambioPassword = (e) => {
        e.preventDefault();
        const { actual, nueva, confirmar } = cambioPasswordForm;
        
        if (!actual || !nueva || !confirmar) {
            setCambioPasswordForm(prev => ({ ...prev, error: 'Todos los campos son requeridos' }));
            return;
        }
        if (nueva !== confirmar) {
            setCambioPasswordForm(prev => ({ ...prev, error: 'Las contraseñas no coinciden' }));
            return;
        }
        if (nueva.length < 6) {
            setCambioPasswordForm(prev => ({ ...prev, error: 'La contraseña debe tener al menos 6 caracteres' }));
            return;
        }
        
        // Simular cambio exitoso (en producción se conectaría a un backend)
        alert('Funcionalidad de cambio de contraseña: En un entorno de producción, esto actualizaría la contraseña en el servidor.');
        setMostrarCambioPassword(false);
        setCambioPasswordForm({ actual: '', nueva: '', confirmar: '', error: '' });
    };

    // Login de usuario del sistema CON 2FA
    const handleUserLogin = async (e) => {
        e.preventDefault();
        const { usuario, password } = loginForm;
        const userKey = usuario.toLowerCase().trim();
        const user = USUARIOS_SISTEMA[userKey];
        
        if (!user) {
            setLoginForm(prev => ({ ...prev, error: 'Usuario o contraseña incorrectos' }));
            return;
        }
        
        // Verificar contraseña con hash (SEGURO)
        let passwordValida = false;
        
        if (user.passwordHash) {
            // Nuevo sistema con hash
            passwordValida = await verificarPasswordHash(password, user.passwordHash);
        } else if (user.password) {
            // Compatibilidad con sistema antiguo (temporal)
            passwordValida = (user.password === password);
        }
        
        if (passwordValida) {
            // Credenciales correctas, verificar si necesita 2FA
            if (user.requires2FA) {
                setUsuarioTemp(userKey);
                
                if (tiene2FAConfigurado(userKey)) {
                    // Ya tiene 2FA configurado, pedir código
                    setPaso2FA('verificar');
                    setCodigo2FA('');
                    setError2FA('');
                } else {
                    // Primera vez, configurar 2FA
                    const nuevoSecreto = generarSecreto2FA();
                    setSecretoTemp(nuevoSecreto);
                    setPaso2FA('configurar');
                    setQrGenerado(false);
                    setCodigo2FA('');
                    setError2FA('');
                }
            } else {
                // No requiere 2FA, login directo
                completarLogin(userKey, user);
            }
        } else {
            setLoginForm(prev => ({ ...prev, error: 'Usuario o contraseña incorrectos' }));
        }
    };
    
    // Verificar código 2FA
    const handleVerificar2FA = async (e) => {
        e.preventDefault();
        setError2FA('');
        
        const secreto = paso2FA === 'configurar' ? secretoTemp : obtenerSecreto2FA(usuarioTemp);
        
        if (!secreto) {
            setError2FA('Error de configuración. Intente nuevamente.');
            return;
        }
        
        const esValido = await validarTOTP(secreto, codigo2FA);
        
        if (esValido) {
            // Si estaba configurando, guardar el secreto
            if (paso2FA === 'configurar') {
                guardarSecreto2FA(usuarioTemp, secretoTemp);
                
                // Mostrar aviso importante sobre sincronización
                setTimeout(() => {
                    alert('✅ ¡2FA configurado correctamente!\n\n⚠️ IMPORTANTE: Para no perder esta configuración cuando cambie de navegador, conecte y sincronice con SharePoint.\n\n💡 Vaya a: SharePoint → Sincronizar');
                }, 500);
            }
            
            // Completar login
            const user = USUARIOS_SISTEMA[usuarioTemp];
            completarLogin(usuarioTemp, user);
            
            // Limpiar estados 2FA
            setPaso2FA(null);
            setCodigo2FA('');
            setSecretoTemp(null);
            setUsuarioTemp(null);
            setQrGenerado(false);
        } else {
            setError2FA('Código incorrecto. Verifique e intente nuevamente.');
            setCodigo2FA('');
        }
    };
    
    // Cancelar proceso 2FA
    const cancelar2FA = () => {
        setPaso2FA(null);
        setCodigo2FA('');
        setError2FA('');
        setSecretoTemp(null);
        setUsuarioTemp(null);
        setQrGenerado(false);
        setMensajeEmail('');
        setLoginForm({ usuario: '', password: '', error: '' });
    };
    
    // Enviar código por email como alternativa a Authenticator
    const handleEnviarCodigoEmail = async () => {
        const userKey = usuarioTemp || loginForm.usuario.toLowerCase().trim();
        const user = USUARIOS_SISTEMA[userKey];
        
        if (!user || !user.email) {
            setError2FA('No hay email configurado para este usuario');
            return;
        }
        
        setEnviandoEmail(true);
        setError2FA('');
        setMensajeEmail('');
        
        const resultado = await enviarCodigoEmail(userKey, user.email);
        
        setEnviandoEmail(false);
        
        if (resultado.success) {
            setUsuarioTemp(userKey);
            setPaso2FA('email');
            setMensajeEmail(resultado.message);
            setCodigo2FA('');
        } else {
            setError2FA(resultado.message);
        }
    };
    
    // Verificar código enviado por email
    const handleVerificarCodigoEmail = async (e) => {
        e.preventDefault();
        setError2FA('');
        
        const esValido = validarCodigoEmail(usuarioTemp, codigo2FA);
        
        if (esValido) {
            // Completar login
            const user = USUARIOS_SISTEMA[usuarioTemp];
            completarLogin(usuarioTemp, user);
            
            // Limpiar estados
            setPaso2FA(null);
            setCodigo2FA('');
            setUsuarioTemp(null);
            setMensajeEmail('');
        } else {
            setError2FA('Código incorrecto o expirado. El código expira en 5 minutos.');
            setCodigo2FA('');
        }
    };
    
    // Completar login exitoso
    const completarLogin = (userKey, user) => {
        const session = { usuario: userKey, rol: user.rol, nombre: user.nombre };
        setUsuarioActual(session);
        sessionStorage.setItem('tehui_nomina_session', JSON.stringify(session));
        setLoginForm({ usuario: '', password: '', error: '' });
        
        // Registrar acceso
        registrarAcceso(userKey, 'login');
        
        // ⭐ CONEXIÓN AUTOMÁTICA A SHAREPOINT (con delay mayor para evitar conflictos)
        setTimeout(async () => {
            try {
                console.log('Intentando conexión automática a SharePoint...');
                const account = await loginMicrosoft();
                if (account) {
                    setMsUser(account);
                    setSpConnected(true);
                    toast('✅ Conectado a SharePoint automáticamente', 'success');
                    cargarDatosSharePoint();
                } else {
                    console.log('No se pudo conectar automáticamente, cargando datos locales');
                    cargarDatosLocales();
                }
            } catch (e) {
                console.log('Auto-conexión SharePoint:', e.message);
                cargarDatosLocales();
            }
        }, 1500); // Aumentado a 1.5 segundos para dar tiempo a que se complete cualquier interacción
    };
    
    // Registro de accesos (auditoría)
    const registrarAcceso = (usuario, tipo) => {
        const registros = JSON.parse(localStorage.getItem('tehui_audit_log') || '[]');
        registros.push({
            usuario,
            tipo,
            fecha: new Date().toISOString(),
            ip: 'local',
            userAgent: navigator.userAgent.substring(0, 100)
        });
        // Mantener solo los últimos 100 registros
        if (registros.length > 100) registros.shift();
        localStorage.setItem('tehui_audit_log', JSON.stringify(registros));
    };

    // Logout de usuario del sistema (MEJORADO - con protección de datos)
    const handleUserLogout = async () => {
        // Verificar si hay cambios pendientes y no está sincronizado
        const mensajeBase = '¿Está seguro que desea cerrar sesión?';
        let mensajeAdvertencia = mensajeBase;
        
        if (!spConnected) {
            mensajeAdvertencia = '⚠️ ADVERTENCIA: No está conectado a SharePoint.\n\nLos datos solo están guardados en este navegador.\nSi cambia de navegador o dispositivo, perderá acceso a los datos.\n\n' + mensajeBase + '\n\n¿Desea crear un backup antes de salir?';
        } else if (pendingChanges || (syncStatus.lastSync && (Date.now() - new Date(syncStatus.lastSync).getTime() > 60000))) {
            mensajeAdvertencia = '⏳ Puede haber cambios sin sincronizar.\n\n' + mensajeBase;
        }
        
        if (window.confirm(mensajeAdvertencia)) {
            // Crear backup de seguridad antes de cerrar
            if (window.ProteccionNomina && window.ProteccionNomina.Backup) {
                window.ProteccionNomina.Backup.crearBackupCompleto();
                console.log('✅ Backup de seguridad creado antes de cerrar sesión');
            }
            
            // Intentar sincronizar si está conectado
            if (spConnected && empleados.length > 0) {
                try {
                    toast('🔄 Sincronizando antes de cerrar...', 'info');
                    await sincronizarTodoSP(empleados, prestamos, licencias, nominas, config, catalogos);
                    console.log('✅ Datos sincronizados antes de cerrar');
                } catch (e) {
                    console.warn('⚠️ No se pudo sincronizar antes de cerrar:', e.message);
                }
            }
            
            // Registrar cierre
            registrarAcceso(usuarioActual?.usuario || 'desconocido', 'logout');
            
            setUsuarioActual(null);
            sessionStorage.removeItem('tehui_nomina_session');
        }
    };

    // Estados de UI
    const [toasts, setToasts] = useState([]);
    const [loading, setLoading] = useState(false);
    const [modoImpresionNomina, setModoImpresionNomina] = useState(false);
    const [tipoReporteActivo, setTipoReporteActivo] = useState(null); // Para el sistema de reportes
    
    // ========================================
    // SISTEMA DE PROTECCIÓN DE DATOS
    // ========================================
    const [showRecoveryModal, setShowRecoveryModal] = useState(false);
    const [backupsList, setBackupsList] = useState([]);
    const [dataIntegrity, setDataIntegrity] = useState({ checked: false, results: {} });
    const [pendingChanges, setPendingChanges] = useState(false);
    const [lastLocalSave, setLastLocalSave] = useState(null);
    const [autoBackupEnabled, setAutoBackupEnabled] = useState(true);
    
    // Verificar integridad de datos
    const verificarIntegridadDatos = () => {
        const results = {
            empleados: { status: 'ok', count: 0, message: '' },
            nominas: { status: 'ok', count: 0, message: '' },
            prestamos: { status: 'ok', count: 0, message: '' },
            licencias: { status: 'ok', count: 0, message: '' },
            config: { status: 'ok', message: '' },
            localStorage: { status: 'ok', message: '' },
            sharePoint: { status: spConnected ? 'ok' : 'warning', message: spConnected ? 'Conectado' : 'Sin conexión' }
        };
        
        // Verificar empleados
        try {
            const empsLocal = JSON.parse(localStorage.getItem('nominaTehui_empleados') || '[]');
            results.empleados.count = empsLocal.length;
            if (empsLocal.length === 0) {
                results.empleados.status = 'warning';
                results.empleados.message = 'Sin empleados';
            } else if (empsLocal.some(e => !e.nombre || !e.documento)) {
                results.empleados.status = 'warning';
                results.empleados.message = 'Datos incompletos';
            } else {
                results.empleados.message = `${empsLocal.length} registros válidos`;
            }
        } catch (e) {
            results.empleados.status = 'error';
            results.empleados.message = 'Datos corruptos';
        }
        
        // Verificar nóminas
        try {
            const nomsLocal = JSON.parse(localStorage.getItem('nominaTehui_nominas') || '[]');
            results.nominas.count = nomsLocal.length;
            results.nominas.message = `${nomsLocal.length} nóminas guardadas`;
        } catch (e) {
            results.nominas.status = 'error';
            results.nominas.message = 'Datos corruptos';
        }
        
        // Verificar préstamos
        try {
            const prestsLocal = JSON.parse(localStorage.getItem('nominaTehui_prestamos') || '[]');
            results.prestamos.count = prestsLocal.length;
            results.prestamos.message = `${prestsLocal.length} préstamos`;
        } catch (e) {
            results.prestamos.status = 'error';
            results.prestamos.message = 'Datos corruptos';
        }
        
        // Verificar licencias
        try {
            const licsLocal = JSON.parse(localStorage.getItem('nominaTehui_licencias') || '[]');
            results.licencias.count = licsLocal.length;
            results.licencias.message = `${licsLocal.length} licencias`;
        } catch (e) {
            results.licencias.status = 'error';
            results.licencias.message = 'Datos corruptos';
        }
        
        // Verificar configuración
        try {
            const configLocal = JSON.parse(localStorage.getItem('nominaTehui_config') || '{}');
            if (configLocal.empresa) {
                results.config.message = 'Configuración válida';
            } else {
                results.config.status = 'warning';
                results.config.message = 'Config por defecto';
            }
        } catch (e) {
            results.config.status = 'error';
            results.config.message = 'Configuración corrupta';
        }
        
        // Verificar espacio localStorage
        try {
            let totalSize = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    totalSize += localStorage.getItem(key).length * 2; // UTF-16
                }
            }
            const usedMB = (totalSize / 1024 / 1024).toFixed(2);
            results.localStorage.message = `${usedMB} MB usado`;
            if (totalSize > 4 * 1024 * 1024) { // > 4MB
                results.localStorage.status = 'warning';
                results.localStorage.message += ' (cerca del límite)';
            }
        } catch (e) {
            results.localStorage.status = 'error';
            results.localStorage.message = 'Error de almacenamiento';
        }
        
        setDataIntegrity({ checked: true, results, lastCheck: new Date() });
        return results;
    };
    
    // Crear backup manual
    const crearBackupManual = () => {
        if (window.ProteccionNomina && window.ProteccionNomina.Backup) {
            const result = window.ProteccionNomina.Backup.crearBackupCompleto();
            if (result.exito) {
                toast('✅ Backup creado exitosamente', 'success');
                cargarListaBackups();
            } else {
                toast('❌ Error al crear backup', 'error');
            }
        }
    };
    
    // Cargar lista de backups
    const cargarListaBackups = () => {
        if (window.ProteccionNomina && window.ProteccionNomina.Backup) {
            const backups = window.ProteccionNomina.Backup.listarBackups();
            setBackupsList(backups);
        }
    };
    
    // Restaurar backup
    const restaurarBackup = (backupKey) => {
        if (window.confirm('⚠️ ¿Está seguro de restaurar este backup?\n\nEsto reemplazará TODOS los datos actuales con los del backup seleccionado.\n\nSe creará un backup de seguridad antes de restaurar.')) {
            if (window.ProteccionNomina && window.ProteccionNomina.Backup) {
                const result = window.ProteccionNomina.Backup.restaurarBackup(backupKey);
                if (result.exito) {
                    toast('✅ Backup restaurado. Recargando...', 'success');
                    setTimeout(() => window.location.reload(), 1500);
                } else {
                    toast('❌ Error: ' + result.error, 'error');
                }
            }
        }
    };
    
    // Exportar backup como archivo
    const exportarBackupArchivo = () => {
        if (window.ProteccionNomina && window.ProteccionNomina.ExportImport) {
            window.ProteccionNomina.ExportImport.exportarTodo();
            toast('📥 Descargando backup...', 'success');
        }
    };
    
    // Conectar a Microsoft/SharePoint
    const conectarMicrosoft = async () => {
        setLoading(true);
        try {
            const account = await loginMicrosoft();
            if (account) {
                setMsUser(account);
                setSpConnected(true);
                toast('✅ Conectado a SharePoint', 'success');
                // Sincronizar datos
                cargarDatosSharePoint();
            } else {
                toast('⚠️ No se pudo conectar', 'warning');
            }
        } catch (e) {
            toast('❌ Error: ' + e.message, 'error');
        }
        setLoading(false);
    };
    
    // Advertencia al cerrar navegador
    React.useEffect(() => {
        const handleBeforeUnload = (e) => {
            // Crear backup automático antes de cerrar
            if (window.ProteccionNomina && window.ProteccionNomina.Backup && datosInicializados) {
                window.ProteccionNomina.Backup.crearBackupCompleto();
            }
            
            // Si no está conectado a SharePoint, advertir
            if (!spConnected && datosInicializados && empleados.length > 0) {
                const mensaje = '⚠️ No está conectado a SharePoint. Los cambios solo están guardados localmente.';
                e.preventDefault();
                e.returnValue = mensaje;
                return mensaje;
            }
        };
        
        window.addEventListener('beforeunload', handleBeforeUnload);
        return () => window.removeEventListener('beforeunload', handleBeforeUnload);
    }, [spConnected, datosInicializados, empleados]);
    
    // Auto-backup cada 10 minutos
    React.useEffect(() => {
        if (!autoBackupEnabled || !datosInicializados) return;
        
        const interval = setInterval(() => {
            if (window.ProteccionNomina && window.ProteccionNomina.Backup) {
                window.ProteccionNomina.Backup.crearBackupCompleto();
                console.log('🔄 Auto-backup creado:', new Date().toLocaleTimeString());
            }
        }, 10 * 60 * 1000); // 10 minutos
        
        return () => clearInterval(interval);
    }, [autoBackupEnabled, datosInicializados]);
    
    // Verificar integridad al iniciar
    React.useEffect(() => {
        if (datosInicializados) {
            verificarIntegridadDatos();
            cargarListaBackups();
        }
    }, [datosInicializados]);
    
    // Marcar cambios pendientes
    React.useEffect(() => {
        if (datosInicializados) {
            setPendingChanges(true);
            setLastLocalSave(new Date());
            
            // Auto-limpiar flag después de sync exitoso
            const timeout = setTimeout(() => {
                if (spConnected && !syncStatus.syncing && syncStatus.lastSync) {
                    setPendingChanges(false);
                }
            }, 6000);
            
            return () => clearTimeout(timeout);
        }
    }, [empleados, nominas, prestamos, licencias]);
    
    // ========================================
    // FIN SISTEMA DE PROTECCIÓN DE DATOS
    // ========================================
    
    // Funciones de Toast
    const toast = (msg, type = 'info') => setToasts(p => [...p, { id: Date.now(), msg, type }]);
    const removeToast = id => setToasts(p => p.filter(t => t.id !== id));
    
    // Estados
    const [view, setView] = useState('dashboard');
    const [config, setConfig] = useState(CONFIG_DEFAULT);
    const [empleados, setEmpleados] = useState([]);
    const [prestamos, setPrestamos] = useState([]);
    const [licencias, setLicencias] = useState([]);
    const [nominas, setNominas] = useState([]);
    const [datosInicializados, setDatosInicializados] = useState(false); // Flag para evitar sobrescribir localStorage al inicio
    const [currentNomina, setCurrentNomina] = useState(null);
    const [nominaEdits, setNominaEdits] = useState({});
    const [searchTerm, setSearchTerm] = useState('');
    const [filterDept, setFilterDept] = useState('TODOS');
    const [filterEstado, setFilterEstado] = useState('ACTIVOS');
    
    // Estados de Configuración del Sistema (Mantenimiento)
    const [catalogos, setCatalogos] = useState({
        departamentos: DEPARTAMENTOS_DEFAULT,
        bancos: BANCOS_DEFAULT,
        tiposContrato: TIPOS_CONTRATO_DEFAULT,
        tiposLicencia: TIPOS_LICENCIA_DEFAULT,
        tiposRemuneracion: TIPOS_REMUNERACION_DEFAULT,
        cargos: CARGOS_DEFAULT
    });
    const [catalogoActivo, setCatalogoActivo] = useState('departamentos');
    const [nuevoItem, setNuevoItem] = useState('');
    const [editandoItem, setEditandoItem] = useState(null);
    
    // Accesos rápidos a catálogos
    const DEPARTAMENTOS = catalogos.departamentos;
    const BANCOS = catalogos.bancos;
    const TIPOS_CONTRATO = catalogos.tiposContrato;
    const TIPOS_LICENCIA = catalogos.tiposLicencia;
    const TIPOS_REMUNERACION = catalogos.tiposRemuneracion;
    const CARGOS = catalogos.cargos;
    
    // Estados SharePoint
    const [msUser, setMsUser] = useState(null);
    const [syncStatus, setSyncStatus] = useState({ syncing: false, lastSync: null, error: null });
    const [spConnected, setSpConnected] = useState(false);
    
    // Modales
    const [modals, setModals] = useState({
        empleado: false, prestamo: false, licencia: false, liquidacion: false,
        volantes: false, constancia: false, config: false, ausencias: false, pagosBanco: false,
        reportes: false, // Modal de Centro de Reportes
        proteccionDatos: false // Modal de Protección de Datos
    });
    const [editingEmp, setEditingEmp] = useState(null);
    const [selectedEmp, setSelectedEmp] = useState(null);
    const [selectedVolante, setSelectedVolante] = useState(null);
    const [ausenciasEmpId, setAusenciasEmpId] = useState(null); // Empleado seleccionado para registrar ausencias
    
    // Estados para envío de volantes por email
    const [empleadosPagados, setEmpleadosPagados] = useState({}); // {nominaCodigo: {empId: {enviado: bool, fecha: ISO}}}
    const [enviandoVolante, setEnviandoVolante] = useState(null); // empId del volante que se está enviando
    
    // Forms
    const empFormInit = { nombre: '', tipoDocumento: 'cedula', documento: '', nss: '', departamento: 'DOCENTE', cargo: '', salarioBase: '', tipoRemuneracion: 'Normal', fechaIngreso: '', fechaSalida: '', motivoSalida: '', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '', telefono: '', email: '', direccion: '', fechaNacimiento: '', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana' };
    const [empForm, setEmpForm] = useState(empFormInit);
    const [prestamoForm, setPrestamoForm] = useState({ empleadoId: '', monto: '', cuotas: '', desc: '', fecha: '' });
    const [editingPrestamo, setEditingPrestamo] = useState(null);
    const [licenciaForm, setLicenciaForm] = useState({ empleadoId: '', tipo: 'Vacaciones', fechaInicio: '', fechaFin: '', conPago: true, notas: '' });
    const [periodo, setPeriodo] = useState({ tipo: 'quincenal', mes: new Date().getMonth() + 1, año: new Date().getFullYear(), quincena: new Date().getDate() <= 15 ? 1 : 2 });
    const [liquidacionData, setLiquidacionData] = useState(null);

    // Init - solo cargar datos locales, SharePoint será manual
    useEffect(() => { 
        // Iniciar sistema de protección de datos
        if (window.ProteccionNomina) {
            const estadoProteccion = window.ProteccionNomina.iniciar();
            console.log('🛡️ Estado de protección:', estadoProteccion.estado);
        }
        
        initMSAL().then(() => {
            if (currentAccount) {
                setMsUser(currentAccount);
                setSpConnected(true);
            }
            // Siempre cargar datos locales primero (es instantáneo)
            cargarDatosLocales();
        });
    }, []);

    // Login Microsoft - solo autenticar, no cargar datos
    const handleLogin = async () => {
        setLoading(true);
        try {
            const account = await loginMicrosoft();
            if (account) {
                setMsUser(account);
                setSpConnected(true);
                toast('✅ Conectado a Microsoft 365. Los datos se sincronizarán automáticamente.', 'success');
            } else {
                toast('No se pudo conectar', 'error');
            }
        } catch (e) {
            toast('Error al conectar: ' + e.message, 'error');
        }
        setLoading(false);
    };

    // Logout Microsoft
    const handleLogout = async () => {
        await logoutMicrosoft();
        setMsUser(null);
        setSpConnected(false);
        toast('Sesión cerrada', 'warning');
    };

    // Cargar datos desde SharePoint
    const cargarDatosSharePoint = async () => {
        setLoading(true);
        setSyncStatus(s => ({ ...s, syncing: true, error: null }));
        try {
            // Cargar TODO en una sola llamada
            const datos = await cargarTodoSP();
            
            if (datos) {
                if (datos.empleados?.length > 0) setEmpleados(datos.empleados);
                if (datos.prestamos?.length > 0) setPrestamos(datos.prestamos);
                if (datos.licencias?.length > 0) setLicencias(datos.licencias);
                if (datos.nominas?.length > 0) setNominas(eliminarDuplicadosNominas(datos.nominas));
                if (datos.config) setConfig(prev => ({ ...prev, ...datos.config }));
                if (datos.catalogos) setCatalogos(prev => ({ ...prev, ...datos.catalogos }));
                
                // 🔐 RECUPERAR SECRETOS 2FA DESDE SHAREPOINT
                if (datos.config && datos.config.secretos2FA) {
                    const secretosLocales = JSON.parse(localStorage.getItem('tehui_2fa_secrets') || '{}');
                    let recuperados = 0;
                    
                    Object.entries(datos.config.secretos2FA).forEach(([userId, secreto]) => {
                        if (secreto && !secretosLocales[userId]) {
                            secretosLocales[userId] = secreto;
                            recuperados++;
                        }
                    });
                    
                    if (recuperados > 0) {
                        localStorage.setItem('tehui_2fa_secrets', JSON.stringify(secretosLocales));
                        console.log(`🔐 ${recuperados} secretos 2FA recuperados desde SharePoint`);
                        toast(`🔐 Configuración 2FA restaurada (${recuperados} usuarios)`, 'success');
                    }
                }
                
                // También recuperar usuarios con sus secretos 2FA
                if (datos.config && datos.config.usuarios) {
                    const usuariosRecuperados = datos.config.usuarios;
                    const secretosLocales = JSON.parse(localStorage.getItem('tehui_2fa_secrets') || '{}');
                    
                    Object.entries(usuariosRecuperados).forEach(([userId, userData]) => {
                        if (userData.secreto2FA && !secretosLocales[userId]) {
                            secretosLocales[userId] = userData.secreto2FA;
                        }
                    });
                    
                    localStorage.setItem('tehui_2fa_secrets', JSON.stringify(secretosLocales));
                    
                    // Actualizar usuarios del sistema
                    guardarUsuariosSistema(usuariosRecuperados);
                    USUARIOS_SISTEMA = usuariosRecuperados;
                }
                
                setSyncStatus({ syncing: false, lastSync: new Date(), error: null });
                setDatosInicializados(true);
                toast('✅ Datos cargados desde SharePoint', 'success');
            } else {
                // Si no hay datos en SP, cargar locales
                cargarDatosLocales();
                toast('📁 Sin datos en SharePoint, usando datos locales', 'info');
            }
        } catch (e) {
            setSyncStatus(s => ({ ...s, syncing: false, error: e.message }));
            toast('Error al cargar datos: ' + e.message, 'error');
            cargarDatosLocales();
        }
        setLoading(false);
    };

    // Sincronizar todo con SharePoint
    const sincronizarConSharePoint = async () => {
        if (!spConnected) {
            toast('Conecte con Microsoft primero', 'warning');
            return;
        }
        
        setLoading(true);
        setSyncStatus(s => ({ ...s, syncing: true }));
        
        try {
            // 🔐 Incluir secretos 2FA y usuarios en la configuración
            const secretos2FA = JSON.parse(localStorage.getItem('tehui_2fa_secrets') || '{}');
            const usuariosSistema = cargarUsuariosSistema();
            
            const configConSecretos = {
                ...config,
                secretos2FA: secretos2FA,
                usuarios: usuariosSistema,
                ultimaSync: new Date().toISOString()
            };
            
            // Usar sincronización masiva - UN SOLO registro con todo
            const resultado = await sincronizarTodoSP(empleados, prestamos, licencias, nominas, configConSecretos, catalogos);
            
            if (resultado.success) {
                setSyncStatus({ syncing: false, lastSync: new Date(), error: null });
                toast(`✅ Sincronización completa: ${resultado.stats.empleados} empleados, ${resultado.stats.prestamos} préstamos`, 'success');
                console.log('🔐 Secretos 2FA sincronizados con SharePoint');
            } else {
                setSyncStatus({ syncing: false, lastSync: null, error: resultado.error });
                toast(`❌ Error: ${resultado.error}`, 'error');
            }
        } catch (e) {
            setSyncStatus(s => ({ ...s, syncing: false, error: e.message }));
            toast('Error en sincronización: ' + e.message, 'error');
        }
        setLoading(false);
    };

    // === PERSISTENCIA LOCAL (localStorage) ===
    const STORAGE_KEYS = {
        empleados: 'nominaTehui_empleados',
        prestamos: 'nominaTehui_prestamos',
        licencias: 'nominaTehui_licencias',
        nominas: 'nominaTehui_nominas',
        config: 'nominaTehui_config',
        catalogos: 'nominaTehui_catalogos'
    };

    const guardarEnLocal = (key, data) => {
        try {
            // Crear backup antes de guardar datos críticos
            const clavesCriticas = ['nominaTehui_empleados', 'nominaTehui_nominas', 'nominaTehui_prestamos'];
            if (clavesCriticas.includes(key) && window.ProteccionNomina) {
                // Solo crear backup si hay datos existentes y son diferentes
                const datosExistentes = localStorage.getItem(key);
                if (datosExistentes && datosExistentes !== JSON.stringify(data)) {
                    window.ProteccionNomina.Backup.backupAntesCambio('Guardando ' + key.replace('nominaTehui_', ''));
                }
            }
            localStorage.setItem(key, JSON.stringify(data));
            return true;
        } catch (e) {
            console.error('Error guardando en localStorage:', e);
            return false;
        }
    };

    const cargarDeLocal = (key) => {
        try {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        } catch (e) {
            console.error('Error cargando de localStorage:', e);
            return null;
        }
    };

    // Mapa MAESTRO completo de empleados (para migración de TODOS los campos)
    const DATOS_MAESTROS_EMPLEADOS = {
        '175008483': { banco: 'BHD León', cuenta: '30646860016', celular: '(829)-943-5474' },
        '031-0175106-7': { banco: 'ACAP', cuenta: '100020364950', celular: '(829)-458-1808' },
        '504587447': { banco: 'ACAP', cuenta: '100070133430', celular: '(829)-487-8039' },
        '104587395': { banco: 'Banreservas', cuenta: '9603026315', celular: '(809)-458-5099' },
        '094-0020547-3': { banco: 'Banreservas', cuenta: '9605795967', celular: '(829)-573-0980' },
        '402-3169217-5': { banco: 'Banco Popular', cuenta: '839042439', celular: '(809)-873-8758' },
        '224-0007033-4': { banco: 'BHD León', cuenta: '10254060011', celular: '(829)-728-4267' },
        '031-0243772-4': { banco: 'Banreservas', cuenta: '0301699601', celular: '(849)-330-9533' },
        '094375613': { banco: 'ACAP', cuenta: '100070137044', celular: '(809)-905-8926' },
        '402-2237446-0': { banco: 'BHD León', cuenta: '21187240014', celular: '(809)-669-8573' },
        '039-0024840-6': { banco: 'Banreservas', cuenta: '9603679466', celular: '(829)-961-1568' },
        '054868674': { banco: 'ACAP', cuenta: '100160157346', celular: '(829)-704-1687' },
        '402-1000810-4': { banco: 'BHD León', cuenta: '34257050021', celular: '(849)-851-1404' },
        '402-0961340-1': { banco: 'ACAP', cuenta: '100250066064', celular: '(809)-441-1708' },
        '402-1922127-8': { banco: 'ACAP', cuenta: '100020384390', celular: '(809)-457-3893' },
        '402-2631749-9': { banco: 'ACAP', cuenta: '100160144856', celular: '(829)-928-5968' },
        '031-0343936-4': { banco: 'ACAP', cuenta: '100070141726', celular: '(809)-204-3613' },
        '402-1546613-3': { banco: 'Banreservas', cuenta: '9608741088', celular: '(809)-276-7456' },
        '032-0031709-1': { banco: 'Banreservas', cuenta: '9608740924', celular: '(809)-216-5228' },
        '402-1106253-0': { banco: 'Banreservas', cuenta: '1202330765', celular: '(849)-394-4074' },
        '031-0073915-4': { banco: '', cuenta: '', celular: '' },
        '402-2280604-0': { banco: 'Banco Popular', cuenta: '826465213', celular: '(809)-798-7037' },
        '174630184': { banco: 'Banreservas', cuenta: '9600189996', celular: '(809)-340-7473' },
        '031-0410964-4': { banco: 'BHD León', cuenta: '34530350016', celular: '(809)-665-3875' },
        '176883175': { banco: 'Banreservas', cuenta: '2450373494', celular: '(829)-835-0189' },
        '031-0408757-6': { banco: 'Banreservas', cuenta: '9607586638', celular: '(829)-891-2449' },
        '031-0306511-0': { banco: 'ACAP', cuenta: '100070092512', celular: '(809)-277-4604' },
        '031-0278033-9': { banco: 'Banco Popular', cuenta: '852048115', celular: '(809)-910-4181' },
    };

    // Cargar datos locales (empleados reales del Centro Tehui - SUIR TSS)
    const cargarDatosLocales = () => {
        setLoading(true);
        setTimeout(() => {
            // Intentar cargar de localStorage primero
            const empsLocal = cargarDeLocal(STORAGE_KEYS.empleados);
            const prestsLocal = cargarDeLocal(STORAGE_KEYS.prestamos);
            const licsLocal = cargarDeLocal(STORAGE_KEYS.licencias);
            const nominasLocal = cargarDeLocal(STORAGE_KEYS.nominas);
            const configLocal = cargarDeLocal(STORAGE_KEYS.config);
            const catalogosLocal = cargarDeLocal(STORAGE_KEYS.catalogos);

            // Función para normalizar empleados (agregar campos faltantes y FORZAR migrar datos)
            const normalizarEmpleado = (emp) => {
                // SIEMPRE buscar datos en el mapa maestro por documento
                const datosMaestros = DATOS_MAESTROS_EMPLEADOS[emp.documento] || null;
                
                // Si encontramos datos en el mapa maestro, usarlos (tienen prioridad)
                const bancoFinal = datosMaestros ? datosMaestros.banco : (emp.banco || '');
                const cuentaFinal = datosMaestros ? datosMaestros.cuenta : (emp.cuenta || '');
                const celularFinal = datosMaestros && datosMaestros.celular ? datosMaestros.celular : (emp.celular || '');
                
                return {
                    celular: '', telefono: '', direccion: '', fechaNacimiento: '', 
                    estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', 
                    fechaSalida: '', motivoSalida: '',
                    dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0,
                    ...emp,  // Los datos existentes sobrescriben los valores por defecto
                    // Forzar datos desde mapa maestro si existen
                    banco: bancoFinal,
                    cuenta: cuentaFinal,
                    celular: celularFinal,
                };
            };
            
            // Si hay datos en localStorage, usarlos
            if (empsLocal && empsLocal.length > 0) {
                console.log('Cargando datos de localStorage...');
                const empsNormalizados = empsLocal.map(normalizarEmpleado);
                // Verificar si se actualizaron datos
                const datosActualizados = empsNormalizados.filter((e, i) => {
                    const empOriginal = empsLocal[i];
                    return e.banco !== empOriginal.banco || 
                           e.cuenta !== empOriginal.cuenta ||
                           e.celular !== empOriginal.celular;
                }).length;
                setEmpleados(empsNormalizados);
                setPrestamos(prestsLocal || []);
                setLicencias(licsLocal || []);
                setNominas(eliminarDuplicadosNominas(nominasLocal || []));
                if (configLocal) setConfig(configLocal);
                if (catalogosLocal) setCatalogos(catalogosLocal);
                setLoading(false);
                console.log('Habilitando persistencia automática...');
                setDatosInicializados(true); // Habilitar guardado automático
                if (datosActualizados > 0) {
                    toast(`Datos cargados. ${datosActualizados} empleados actualizados (bancos, celulares).`, 'success');
                    console.log(`Empleados actualizados: ${datosActualizados}`);
                } else {
                    toast('Datos cargados de almacenamiento local', 'success');
                }
                return;
            }

            // Si no hay datos en localStorage, usar los datos por defecto
            const emps = [
                { id: 1, nombre: 'Carreño Leon, Maria De Jesús', tipoDocumento: 'cedula', documento: '175008483', nss: '19021577-1', departamento: 'PROFESOR', cargo: 'MAESTRA DE ARTE', salarioBase: 18000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-05-06', tipoContrato: 'Indefinido', banco: 'BHD León', cuenta: '30646860016', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(829)-943-5474', telefono: '', direccion: '', fechaNacimiento: '2003-03-20', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 2, nombre: 'Castillo Matta, Zeneida', tipoDocumento: 'cedula', documento: '031-0175106-7', nss: '03715559-5', departamento: 'ADMINISTRACION', cargo: 'LIMPIEZA', salarioBase: 6500, tipoRemuneracion: 'Trabajador ocasional (no fijo)', fechaIngreso: '2006-07-15', tipoContrato: 'Temporal', banco: 'ACAP', cuenta: '100020364950', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(829)-458-1808', telefono: '', direccion: '', fechaNacimiento: '1974-06-12', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Empleado' },
                { id: 3, nombre: 'Fuentes De Garcia, Cary Roxana', tipoDocumento: 'cedula', documento: '504587447', nss: '18396764-2', departamento: 'PROFESOR', cargo: 'MAESTRA CUARTO PRIMARIA', salarioBase: 20000, tipoRemuneracion: 'Normal', fechaIngreso: '2022-08-01', tipoContrato: 'Indefinido', banco: 'ACAP', cuenta: '100070133430', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(829)-487-8039', telefono: '', direccion: '', fechaNacimiento: '1977-06-25', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 4, nombre: 'Garcia Fuentes, Roxana Josefina', tipoDocumento: 'pasaporte', documento: '104587395', nss: '', departamento: 'PROFESOR', cargo: 'MAESTRA PRIMARIA', salarioBase: 25000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-08-05', tipoContrato: 'Indefinido', banco: 'Banreservas', cuenta: '9603026315', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-458-5099', telefono: '', direccion: '', fechaNacimiento: '1999-06-19', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 5, nombre: 'Hernandez Cabrera, Ramona Altagracia', tipoDocumento: 'cedula', documento: '094-0020547-3', nss: '05699203-1', departamento: 'PROFESOR', cargo: 'PSICOLOGA', salarioBase: 20000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-05-01', tipoContrato: 'Indefinido', banco: 'Banreservas', cuenta: '9605795967', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(829)-573-0980', telefono: '', direccion: '', fechaNacimiento: '1983-12-10', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 6, nombre: 'Jimaquen Garcia, Lucelis Beatriz', tipoDocumento: 'cedula', documento: '402-3169217-5', nss: '18621595-0', departamento: 'PROFESOR', cargo: 'PROFESORA DE INGLES', salarioBase: 19000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-08-05', tipoContrato: 'Indefinido', banco: 'Banco Popular', cuenta: '839042439', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-873-8758', telefono: '', direccion: '', fechaNacimiento: '2005-12-10', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 7, nombre: 'Jimenez Cuevas, Ingrid Ivelisse', tipoDocumento: 'cedula', documento: '224-0007033-4', nss: '05571827-1', departamento: 'ASISTENTE', cargo: 'ASISTENTE MAESTRA TERCERO', salarioBase: 15000, tipoRemuneracion: 'Asalariado por hora/día/semana', fechaIngreso: '2025-10-20', tipoContrato: 'Por obra', banco: 'BHD León', cuenta: '10254060011', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(829)-728-4267', telefono: '', direccion: '', fechaNacimiento: '1985-12-02', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 8, nombre: 'Jimenez Tavarez, Javier Arturo', tipoDocumento: 'cedula', documento: '031-0243772-4', nss: '03503956-2', departamento: 'PROFESOR', cargo: 'PROFESOR EDUCACION FISICA', salarioBase: 10000, tipoRemuneracion: 'Trabajador ocasional (no fijo)', fechaIngreso: '2021-10-15', tipoContrato: 'Temporal', banco: 'Banreservas', cuenta: '0301699601', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(849)-330-9533', telefono: '', direccion: '', fechaNacimiento: '1965-06-16', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 9, nombre: 'Lucena Villalobos, Yusmary Chiquinquira', tipoDocumento: 'cedula', documento: '094375613', nss: '18217801-7', departamento: 'PROFESOR', cargo: 'MAESTRA 1ER GRADO PRIMARIA', salarioBase: 19000, tipoRemuneracion: 'Normal', fechaIngreso: '2022-11-15', tipoContrato: 'Indefinido', banco: 'ACAP', cuenta: '100070137044', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-905-8926', telefono: '', direccion: '', fechaNacimiento: '1977-12-29', estadoCivil: 'Soltero/a', nacionalidad: 'Venezolana', tipoEmpleado: 'Profesor' },
                { id: 10, nombre: 'Medina, Melisa', tipoDocumento: 'cedula', documento: '039-0024840-6', nss: '07527950-2', departamento: 'PROFESOR', cargo: 'MAESTRA PRIMARIA', salarioBase: 18000, tipoRemuneracion: 'Normal', fechaIngreso: '2024-11-11', tipoContrato: 'Indefinido', banco: 'Banreservas', cuenta: '9603679466', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-815-0735', telefono: '', direccion: '', fechaNacimiento: '1992-06-15', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 11, nombre: 'Mencia Mencia, Alba Iris', tipoDocumento: 'cedula', documento: '402-2237446-0', nss: '07683312-7', departamento: 'PROFESOR', cargo: 'MAESTRA TITULAR PRE-KINDER', salarioBase: 25000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-09-22', tipoContrato: 'Indefinido', banco: 'BHD León', cuenta: '21187240014', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(829)-312-7558', telefono: '', direccion: '', fechaNacimiento: '1992-08-12', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 12, nombre: 'Millan, Diorelys Del Valle', tipoDocumento: 'pasaporte', documento: '054868674', nss: '', departamento: 'ASISTENTE', cargo: 'ASISTENTE NIVEL INICIAL', salarioBase: 18000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-05-06', tipoContrato: 'Indefinido', banco: 'ACAP', cuenta: '100160157346', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(829)-704-1687', telefono: '', direccion: '', fechaNacimiento: '1979-09-08', estadoCivil: 'Soltero/a', nacionalidad: 'Venezolana', tipoEmpleado: 'Empleado' },
                { id: 13, nombre: 'Nuñez Sosa, Denzel Gabriel', tipoDocumento: 'cedula', documento: '402-1000810-4', nss: '07395851-2', departamento: 'PROFESOR', cargo: 'PROFESOR DE MUSICA', salarioBase: 11426.47, tipoRemuneracion: 'Asalariado por hora/día/semana', fechaIngreso: '2025-09-02', tipoContrato: 'Por obra', banco: 'BHD León', cuenta: '34257050021', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(849)-851-1404', telefono: '', direccion: '', fechaNacimiento: '2004-09-14', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 14, nombre: 'Paulino Paulino, Gabriela', tipoDocumento: 'cedula', documento: '402-0961340-1', nss: '17867486-3', departamento: 'MAESTRA INTEGRADORA', cargo: 'MAESTRA INTEGRADORA INICIAL', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2024-03-01', tipoContrato: 'Indefinido', banco: 'ACAP', cuenta: '100250066064', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-441-1708', telefono: '', direccion: '', fechaNacimiento: '2005-06-07', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 15, nombre: 'Peralta Mendoza, Daniela', tipoDocumento: 'cedula', documento: '402-1922127-8', nss: '09098043-1', departamento: 'PSICOLOGIA', cargo: 'MAESTRA INTEGRADORA', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2024-03-01', tipoContrato: 'Indefinido', banco: 'ACAP', cuenta: '100020384390', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-457-3893', telefono: '', direccion: '', fechaNacimiento: '2000-11-03', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 16, nombre: 'Perez Ramos, Valerin Mariel', tipoDocumento: 'cedula', documento: '402-2631749-9', nss: '16110843-2', departamento: 'PROFESOR', cargo: 'MAESTRA PRIMARIA SOCIALES', salarioBase: 18000, tipoRemuneracion: 'Normal', fechaIngreso: '2023-07-17', tipoContrato: 'Indefinido', banco: 'ACAP', cuenta: '100160144856', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(829)-928-5968', telefono: '', direccion: '', fechaNacimiento: '1996-06-07', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Empleado' },
                { id: 17, nombre: 'Pichardo Quezada, Ana Rosa', tipoDocumento: 'cedula', documento: '031-0343936-4', nss: '03632048-7', departamento: 'ASISTENTE', cargo: 'CONSERJE', salarioBase: 10000, tipoRemuneracion: 'Trabajador ocasional (no fijo)', fechaIngreso: '2024-08-14', tipoContrato: 'Temporal', banco: 'ACAP', cuenta: '100070141726', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-204-3613', telefono: '', direccion: '', fechaNacimiento: '1974-07-10', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Empleado' },
                { id: 18, nombre: 'Ramos Santana, Emely Altagracia', tipoDocumento: 'cedula', documento: '402-1546613-3', nss: '17399380-7', departamento: 'PROFESOR', cargo: 'ASISTENTE PARVULO', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2022-08-01', tipoContrato: 'Indefinido', banco: 'Banreservas', cuenta: '9608741088', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-276-7456', telefono: '', direccion: '', fechaNacimiento: '2002-11-22', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 19, nombre: 'Ramos Santana, Yudelca Altagracia', tipoDocumento: 'cedula', documento: '032-0031709-1', nss: '03713540-7', departamento: 'PROFESOR', cargo: 'MAESTRA TITULAR PRE-PRIMARIO', salarioBase: 25000, tipoRemuneracion: 'Normal', fechaIngreso: '2012-07-23', tipoContrato: 'Indefinido', banco: 'Banreservas', cuenta: '9608740924', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-216-5228', telefono: '', direccion: '', fechaNacimiento: '1985-03-14', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 20, nombre: 'Rodriguez Reyes, Daniela Isabel', tipoDocumento: 'cedula', documento: '402-1106253-0', nss: '06687131-1', departamento: 'PROFESOR', cargo: 'PROFESORA DE INGLES NIVEL INICIAL', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2025-10-09', tipoContrato: 'Indefinido', banco: 'Banreservas', cuenta: '1202330765', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(849)-394-4074', telefono: '', direccion: '', fechaNacimiento: '2006-11-07', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 21, nombre: 'Rodriguez Rodriguez, Gabriel De Jesus', tipoDocumento: 'cedula', documento: '031-0073915-4', nss: '03657548-3', departamento: 'ADMINISTRACION', cargo: 'Representante', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2024-07-17', tipoContrato: 'Indefinido', banco: '', cuenta: '', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '', telefono: '', direccion: '', fechaNacimiento: '', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Empleado' },
                { id: 22, nombre: 'Rosario Vasquez, Luisa Estebania', tipoDocumento: 'cedula', documento: '402-2280604-0', nss: '13781314-0', departamento: 'PSICOLOGIA', cargo: 'PSICOLOGA', salarioBase: 25000, tipoRemuneracion: 'Normal', fechaIngreso: '2024-09-02', tipoContrato: 'Indefinido', banco: 'Banco Popular', cuenta: '826465213', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-798-7037', telefono: '', direccion: '', fechaNacimiento: '1994-12-02', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 23, nombre: 'Sanchez De Colmenares, Flor Maria', tipoDocumento: 'cedula', documento: '174630184', nss: '18543727-7', departamento: 'PROFESOR', cargo: 'MAESTRA PRIMARIA', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2023-09-11', tipoContrato: 'Indefinido', banco: 'Banreservas', cuenta: '9600189996', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-340-7473', telefono: '', direccion: '', fechaNacimiento: '1966-05-21', estadoCivil: 'Soltero/a', nacionalidad: 'Venezolana', tipoEmpleado: 'Profesor' },
                { id: 24, nombre: 'Tavarez Felipe, Yubelkys Altagracia', tipoDocumento: 'cedula', documento: '031-0410964-4', nss: '03679280-1', departamento: 'PROFESOR', cargo: 'TITULAR PARVULO', salarioBase: 25000, tipoRemuneracion: 'Normal', fechaIngreso: '2024-09-23', tipoContrato: 'Indefinido', banco: 'BHD León', cuenta: '34530350016', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-665-3875', telefono: '', direccion: '', fechaNacimiento: '1983-02-04', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 25, nombre: 'Vivas Cuencas, Lisbia Coromoto', tipoDocumento: 'cedula', documento: '176883175', nss: '18270308-0', departamento: 'PROFESOR', cargo: 'MAESTRA MATEMATICAS', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2024-10-08', tipoContrato: 'Indefinido', banco: 'Banreservas', cuenta: '2450373494', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(829)-835-0189', telefono: '', direccion: '', fechaNacimiento: '1963-11-24', estadoCivil: 'Soltero/a', nacionalidad: 'Venezolana', tipoEmpleado: 'Profesor' },
                { id: 26, nombre: 'Jimaquen Cabrera, Mayorka Delfina', tipoDocumento: 'cedula', documento: '031-0408757-6', nss: '03361275-0', departamento: 'ASISTENTE', cargo: 'ASISTENTE KINDER', salarioBase: 17193.12, tipoRemuneracion: 'Normal', fechaIngreso: '2021-09-20', tipoContrato: 'Indefinido', banco: 'Banreservas', cuenta: '9607586638', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(829)-891-2449', telefono: '', direccion: '', fechaNacimiento: '1982-05-25', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Profesor' },
                { id: 27, nombre: 'Olivares Contreras De Rodriguez, Erika Cristina', tipoDocumento: 'cedula', documento: '031-0306511-0', nss: '03296898-1', departamento: 'ADMINISTRACION', cargo: 'DIRECTORA', salarioBase: 20000, tipoRemuneracion: 'Normal', fechaIngreso: '2004-07-25', tipoContrato: 'Indefinido', banco: 'ACAP', cuenta: '100070092512', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-277-4604', telefono: '', direccion: '', fechaNacimiento: '1969-02-06', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Empleado' },
                { id: 28, nombre: 'Inoa Espaillat, Fanny Josefina', tipoDocumento: 'cedula', documento: '031-0278033-9', nss: '', departamento: 'ADMINISTRACION', cargo: 'ASISTENTE ADMINISTRATIVO', salarioBase: 20000, tipoRemuneracion: 'Normal', fechaIngreso: '2025-01-07', tipoContrato: 'Indefinido', banco: 'Banco Popular', cuenta: '852048115', activo: true, dependientesSFS: 0, cooperativa: 0, seguroPrivado: 0, embargo: 0, vacacionesDisfrutadas: 0, celular: '(809)-910-4181', telefono: '', direccion: '', fechaNacimiento: '1971-01-28', estadoCivil: 'Soltero/a', nacionalidad: 'Dominicana', tipoEmpleado: 'Empleado' },
            ];
            const prests = [];
            const lics = [];
            setEmpleados(emps.map(normalizarEmpleado));
            setPrestamos(prests);
            setLicencias(lics);
            setLoading(false);
            setDatosInicializados(true); // Habilitar guardado automático
            toast('Sistema cargado correctamente', 'success');
        }, 500);
    };

    // Helpers
    const openModal = name => setModals(m => ({ ...m, [name]: true }));
    const closeModal = name => setModals(m => ({ ...m, [name]: false }));
    const getPrestamosPend = empId => prestamos.filter(p => p.empleadoId === empId && p.activo && p.saldo > 0);

    // Funciones para manejar ausencias
    const abrirModalAusencias = (empId) => {
        setAusenciasEmpId(empId);
        openModal('ausencias');
    };

    const toggleFechaAusencia = (fecha) => {
        if (!ausenciasEmpId) return;
        setNominaEdits(prev => {
            const current = prev[ausenciasEmpId] || {};
            const fechasAus = current.fechasAus || [];
            const existe = fechasAus.includes(fecha);
            const nuevasFechas = existe 
                ? fechasAus.filter(f => f !== fecha) 
                : [...fechasAus, fecha].sort();
            return {
                ...prev,
                [ausenciasEmpId]: {
                    ...current,
                    fechasAus: nuevasFechas,
                    diasAus: nuevasFechas.length
                }
            };
        });
    };

    const getFechasDelPeriodo = () => {
        const { mes, año, tipo, quincena } = periodo;
        const fechas = [];
        const diasEnMes = new Date(año, mes, 0).getDate();
        
        let inicio, fin;
        if (tipo === 'quincenal') {
            inicio = quincena === 1 ? 1 : 16;
            fin = quincena === 1 ? 15 : diasEnMes;
        } else {
            inicio = 1;
            fin = diasEnMes;
        }
        
        for (let d = inicio; d <= fin; d++) {
            const fecha = new Date(año, mes - 1, d);
            const diaSemana = fecha.getDay();
            // Solo días laborables (lunes a viernes)
            if (diaSemana !== 0 && diaSemana !== 6) {
                fechas.push(`${año}-${String(mes).padStart(2,'0')}-${String(d).padStart(2,'0')}`);
            }
        }
        return fechas;
    };

    const formatFechaCorta = (fecha) => {
        const [año, mes, dia] = fecha.split('-');
        const meses = ['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
        return `${parseInt(dia)} ${meses[parseInt(mes)-1]}`;
    };

    const getDiaSemana = (fecha) => {
        const dias = ['Dom','Lun','Mar','Mié','Jue','Vie','Sáb'];
        const [año, mes, dia] = fecha.split('-').map(Number);
        return dias[new Date(año, mes - 1, dia).getDay()];
    };

    // Guardar automáticamente cuando cambien los datos (solo después de inicialización)
    React.useEffect(() => {
        if (datosInicializados && empleados.length > 0) {
            console.log('Guardando empleados en localStorage:', empleados.length);
            guardarEnLocal(STORAGE_KEYS.empleados, empleados);
        }
    }, [empleados, datosInicializados]);

    React.useEffect(() => {
        if (datosInicializados) {
            console.log('Guardando préstamos en localStorage:', prestamos.length);
            guardarEnLocal(STORAGE_KEYS.prestamos, prestamos);
        }
    }, [prestamos, datosInicializados]);

    React.useEffect(() => {
        if (datosInicializados) {
            console.log('Guardando licencias en localStorage:', licencias.length);
            guardarEnLocal(STORAGE_KEYS.licencias, licencias);
        }
    }, [licencias, datosInicializados]);

    React.useEffect(() => {
        if (datosInicializados) {
            console.log('Guardando nóminas en localStorage:', nominas.length);
            guardarEnLocal(STORAGE_KEYS.nominas, nominas);
        }
    }, [nominas, datosInicializados]);

    React.useEffect(() => {
        if (datosInicializados) {
            console.log('Guardando config en localStorage');
            guardarEnLocal(STORAGE_KEYS.config, config);
        }
    }, [config, datosInicializados]);

    React.useEffect(() => {
        if (datosInicializados) {
            console.log('Guardando catálogos en localStorage');
            guardarEnLocal(STORAGE_KEYS.catalogos, catalogos);
        }
    }, [catalogos, datosInicializados]);

    // ⭐ SINCRONIZACIÓN AUTOMÁTICA CON SHAREPOINT (con debounce de 5 segundos)
    const syncTimeoutRef = React.useRef(null);
    React.useEffect(() => {
        // Solo sincronizar si está conectado a SharePoint y hay datos inicializados
        if (!datosInicializados || !spConnected || syncStatus.syncing) return;
        
        // Cancelar sincronización pendiente
        if (syncTimeoutRef.current) {
            clearTimeout(syncTimeoutRef.current);
        }
        
        // Programar nueva sincronización en 5 segundos
        syncTimeoutRef.current = setTimeout(async () => {
            console.log('🔄 Auto-sincronizando con SharePoint...');
            setSyncStatus(s => ({ ...s, syncing: true }));
            
            try {
                const resultado = await sincronizarTodoSP(empleados, prestamos, licencias, nominas, config, catalogos);
                if (resultado.success) {
                    setSyncStatus({ syncing: false, lastSync: new Date(), error: null });
                    console.log('✅ Auto-sincronización completada');
                } else {
                    setSyncStatus({ syncing: false, lastSync: syncStatus.lastSync, error: resultado.error });
                    console.error('❌ Error en auto-sincronización:', resultado.error);
                }
            } catch (e) {
                setSyncStatus(s => ({ ...s, syncing: false, error: e.message }));
                console.error('❌ Error en auto-sincronización:', e);
            }
        }, 5000); // 5 segundos de delay
        
        // Cleanup
        return () => {
            if (syncTimeoutRef.current) {
                clearTimeout(syncTimeoutRef.current);
            }
        };
    }, [empleados, prestamos, licencias, nominas, config, catalogos, datosInicializados, spConnected]);

    // Función para restaurar datos por defecto (limpia localStorage)
    const restaurarDatosPorDefecto = () => {
        if (confirm('¿Está seguro de restaurar los datos por defecto? Se perderán todos los cambios guardados localmente.')) {
            Object.values(STORAGE_KEYS).forEach(key => localStorage.removeItem(key));
            window.location.reload();
        }
    };

    // Función para actualizar empleados desde plantilla sin borrar nóminas/préstamos
    const forzarActualizacionEmpleados = () => {
        if (confirm('¿Actualizar datos de empleados desde la plantilla maestra? Esto sobrescribirá: bancos, cuentas y celulares. Las nóminas y préstamos NO se borrarán.')) {
            // Borrar SOLO los empleados del localStorage
            localStorage.removeItem(STORAGE_KEYS.empleados);
            toast('Datos de empleados actualizados. Recargando...', 'success');
            setTimeout(() => window.location.reload(), 1000);
        }
    };

    const getTotalCuotas = empId => getPrestamosPend(empId).reduce((s, p) => s + p.cuotaMensual, 0);

    // CRUD Empleados
    const guardarEmpleado = async () => {
        if (!empForm.nombre || !empForm.salarioBase) { toast('Complete los campos requeridos', 'error'); return; }
        
        // Construir objeto con todos los campos, parseando números correctamente
        const data = { 
            ...empForm,
            // Campos numéricos - asegurar que se parseen correctamente
            salarioBase: parseFloat(empForm.salarioBase) || 0,
            dependientesSFS: parseInt(empForm.dependientesSFS) || 0,
            cooperativa: parseFloat(empForm.cooperativa) || 0,
            seguroPrivado: parseFloat(empForm.seguroPrivado) || 0,
            embargo: parseFloat(empForm.embargo) || 0,
            vacacionesDisfrutadas: parseFloat(empForm.vacacionesDisfrutadas) || 0,
            // Campos de texto - asegurar valores por defecto
            celular: empForm.celular || '',
            telefono: empForm.telefono || '',
            email: empForm.email || '',
            direccion: empForm.direccion || '',
            fechaNacimiento: empForm.fechaNacimiento || '',
            estadoCivil: empForm.estadoCivil || 'Soltero/a',
            nacionalidad: empForm.nacionalidad || 'Dominicana',
            fechaSalida: empForm.fechaSalida || '',
            motivoSalida: empForm.motivoSalida || '',
            // Booleano
            activo: empForm.activo === true || empForm.activo === 'true'
        };
        
        if (editingEmp) {
            // Al editar, preservar campos del empleado original que no están en el formulario
            const updated = { 
                ...editingEmp,  // Primero los datos originales
                ...data,       // Luego sobrescribir con los nuevos
                id: editingEmp.id, 
                _spId: editingEmp._spId 
            };
            setEmpleados(p => p.map(e => e.id === editingEmp.id ? updated : e));
            if (spConnected) await guardarEmpleadoSP(updated);
            toast('Empleado actualizado', 'success');
        } else {
            const newEmp = { ...data, id: Math.max(...empleados.map(e => e.id), 0) + 1 };
            setEmpleados(p => [...p, newEmp]);
            if (spConnected) await guardarEmpleadoSP(newEmp);
            toast('Empleado agregado', 'success');
        }
        closeModal('empleado');
        setEditingEmp(null);
        setEmpForm(empFormInit);
    };

    const editarEmpleado = emp => { 
        setEditingEmp(emp); 
        // Combinar con empFormInit para asegurar que todos los campos existan
        setEmpForm({ 
            ...empFormInit,  // Primero valores por defecto
            ...emp,          // Luego datos del empleado
            // Asegurar que campos booleanos se manejen correctamente
            activo: emp.activo === true || emp.activo === 'true'
        }); 
        openModal('empleado'); 
    };
    const eliminarEmpleado = id => { if (confirm('¿Eliminar empleado?')) { setEmpleados(p => p.filter(e => e.id !== id)); toast('Empleado eliminado', 'warning'); } };

    // CRUD Préstamos
    const guardarPrestamo = async () => {
        if (!prestamoForm.empleadoId || !prestamoForm.monto || !prestamoForm.cuotas) { toast('Complete los campos', 'error'); return; }
        const monto = parseFloat(prestamoForm.monto);
        const cuotas = parseInt(prestamoForm.cuotas);
        
        if (editingPrestamo) {
            // Actualizar préstamo existente
            const cuotasPagadas = editingPrestamo.cuotasPagadas || 0;
            const cuotaMensual = round2(monto / cuotas);
            const saldoPagado = cuotasPagadas * (editingPrestamo.cuotaMensual || 0);
            const nuevoSaldo = Math.max(0, monto - saldoPagado);
            
            const updated = {
                ...editingPrestamo,
                empleadoId: parseInt(prestamoForm.empleadoId),
                monto,
                cuotas,
                cuotaMensual,
                saldo: nuevoSaldo,
                desc: prestamoForm.desc || 'Préstamo',
                fecha: prestamoForm.fecha || editingPrestamo.fecha,
                activo: nuevoSaldo > 0
            };
            setPrestamos(p => p.map(pr => pr.id === editingPrestamo.id ? updated : pr));
            toast('Préstamo actualizado', 'success');
        } else {
            // Crear nuevo préstamo
            const nuevoPrestamo = {
                id: Date.now(), empleadoId: parseInt(prestamoForm.empleadoId), monto, cuotas, cuotasPagadas: 0,
                cuotaMensual: round2(monto / cuotas), saldo: monto, desc: prestamoForm.desc || 'Préstamo',
                fecha: prestamoForm.fecha || new Date().toISOString().split('T')[0], activo: true
            };
            setPrestamos(p => [...p, nuevoPrestamo]);
            if (spConnected) await guardarPrestamoSP(nuevoPrestamo);
            toast('Préstamo registrado', 'success');
        }
        closeModal('prestamo');
        setEditingPrestamo(null);
        setPrestamoForm({ empleadoId: '', monto: '', cuotas: '', desc: '', fecha: '' });
    };
    
    const editarPrestamo = (prestamo) => {
        setEditingPrestamo(prestamo);
        setPrestamoForm({
            empleadoId: prestamo.empleadoId.toString(),
            monto: prestamo.monto.toString(),
            cuotas: prestamo.cuotas.toString(),
            desc: prestamo.desc || '',
            fecha: prestamo.fecha || ''
        });
        openModal('prestamo');
    };
    
    const eliminarPrestamo = (prestamo) => {
        const emp = empleados.find(e => e.id === prestamo.empleadoId);
        if (window.confirm(`¿Eliminar el préstamo de ${emp?.nombre || 'este empleado'}?\n\nMonto: RD$ ${formatMoney(prestamo.monto)}\nSaldo pendiente: RD$ ${formatMoney(prestamo.saldo)}`)) {
            setPrestamos(p => p.filter(pr => pr.id !== prestamo.id));
            toast('Préstamo eliminado', 'success');
        }
    };

    // CRUD Licencias
    const guardarLicencia = () => {
        if (!licenciaForm.empleadoId || !licenciaForm.fechaInicio) { toast('Complete los campos', 'error'); return; }
        setLicencias(p => [...p, { ...licenciaForm, id: Date.now(), empleadoId: parseInt(licenciaForm.empleadoId) }]);
        toast('Licencia registrada', 'success');
        closeModal('licencia');
        setLicenciaForm({ empleadoId: '', tipo: 'Vacaciones', fechaInicio: '', fechaFin: '', conPago: true, notas: '' });
    };

    // Generar Nómina
    const generarNomina = () => {
        // Verificar si existe una nómina para el mismo período
        const codigoNuevo = `${periodo.año}${periodo.mes.toString().padStart(2,'0')}${periodo.tipo === 'quincenal' ? periodo.quincena : '0'}`;
        const existente = nominas.find(n => {
            const codigoExistente = `${n.periodo.año}${n.periodo.mes.toString().padStart(2,'0')}${n.periodo.tipo === 'quincenal' ? n.periodo.quincena : '0'}`;
            return codigoExistente === codigoNuevo && (n.estado === 'guardada' || n.estado === 'procesada');
        });
        
        // Verificar si hay un borrador existente para este período
        const borradorExistente = nominas.find(n => {
            const codigoExistente = `${n.periodo.año}${n.periodo.mes.toString().padStart(2,'0')}${n.periodo.tipo === 'quincenal' ? n.periodo.quincena : '0'}`;
            return codigoExistente === codigoNuevo && n.estado === 'borrador';
        });
        
        if (borradorExistente) {
            // Preguntar si quiere continuar con el borrador
            if (window.confirm(`Existe un BORRADOR guardado para este período (Código: ${codigoNuevo}).\n\n¿Desea CONTINUAR editando el borrador?\n\n• Sí = Cargar el borrador guardado\n• No = Crear una nómina nueva (el borrador se perderá)`)) {
                cargarBorrador(borradorExistente);
                return;
            } else {
                // Eliminar borrador anterior si decide crear uno nuevo
                setNominas(p => p.filter(n => n.id !== borradorExistente.id));
            }
        }
        
        if (existente) {
            // Preguntar si quiere editar la existente
            if (window.confirm(`Ya existe una nómina procesada para este período (Código: ${codigoNuevo}).\n\n¿Desea EDITARLA para hacer correcciones?\n\nLos cambios sobrescribirán la nómina anterior.`)) {
                editarNomina(existente);
                return;
            }
            return;
        }
        
        // Filtrar empleados elegibles: activos Y (sin fecha salida O fecha salida posterior al inicio del período)
        const inicioMes = new Date(periodo.año, periodo.mes - 1, 1);
        const activos = empleados.filter(e => {
            if (!e.activo) return false;
            if (!e.fechaSalida) return true;
            // Si tiene fecha de salida, incluir solo si salió después del inicio del período
            const fechaSal = new Date(e.fechaSalida);
            return fechaSal >= inicioMes;
        });
        
        if (activos.length === 0) {
            toast('No hay empleados activos para generar la nómina', 'error');
            return;
        }
        
        const divisor = periodo.tipo === 'quincenal' ? 2 : 1;
        const esRegalia = periodo.mes === 12 && (periodo.tipo === 'mensual' || periodo.quincena === 2);
        const edits = {};

        const detalles = activos.map(emp => {
            // IMPORTANTE: Calcular TSS sobre salario MENSUAL completo (para aplicar topes correctamente)
            const tssMensual = calcularTSS(emp.salarioBase, config);
            
            // Calcular ISR sobre salario anual completo (considerando dependientes)
            const salNetoAnual = (emp.salarioBase - tssMensual.afpEmp - tssMensual.sfsEmp) * 12;
            const isrMensual = calcularISR(salNetoAnual, config);
            
            // Ahora dividir TODO por el divisor (quincenal = 2, mensual = 1)
            const salBase = emp.salarioBase / divisor;
            const afpEmp = round2(tssMensual.afpEmp / divisor);
            const sfsEmp = round2(tssMensual.sfsEmp / divisor);
            const isr = round2(isrMensual / divisor);
            const afpPat = round2(tssMensual.afpPat / divisor);
            const sfsPat = round2(tssMensual.sfsPat / divisor);
            const infotep = round2(tssMensual.infotep / divisor);
            const riesgo = round2(tssMensual.riesgo / divisor);
            
            // Otras deducciones fijas también divididas
            // PDSS = Dependientes adicionales SFS × Valor Per Cápita mensual / divisor
            const pdss = round2(((emp.dependientesSFS || 0) * (config.tss.pdssPerCapita || 1715.46)) / divisor);
            const cooperativa = (emp.cooperativa || 0) / divisor;
            const seguroPrivado = (emp.seguroPrivado || 0) / divisor;
            const embargo = (emp.embargo || 0) / divisor;
            const cuotaPrestamo = getTotalCuotas(emp.id) / divisor;

            // Calcular regalía si es diciembre (solo en 2da quincena o mensual)
            const regalia = esRegalia ? calcularRegalia(emp.salarioBase, 12) : 0;

            edits[emp.id] = { diasAus: 0, fechasAus: [], minTard: 0, horas35: 0, horas100: 0, bonificacion: 0, comisiones: 0, incentivos: 0, viaticos: 0, vacaciones: 0, otrosIng: 0, otrasDed: 0 };

            const totalIng = salBase + regalia;
            const totalDed = afpEmp + sfsEmp + isr + pdss + cuotaPrestamo + cooperativa + seguroPrivado + embargo;

            return {
                empId: emp.id, nombre: emp.nombre, depto: emp.departamento, cargo: emp.cargo,
                salarioBase: salBase, horasExtra: 0, bonificacion: 0, comisiones: 0, incentivos: 0, viaticos: 0, vacaciones: 0, regalia, otrosIng: 0, totalIng,
                diasAus: 0, fechasAus: [], descAusencias: 0, minTard: 0, descTardanzas: 0,
                afpEmp, sfsEmp, isr, pdss, cuotaPrestamo, cooperativa, seguroPrivado, embargo, otrasDed: 0, totalDed,
                neto: round2(totalIng - totalDed),
                afpPat, sfsPat, infotep, riesgo
            };
        });

        setNominaEdits(edits);
        setCurrentNomina({ id: Date.now(), codigo: codigoNuevo, periodo: { ...periodo }, fecha: new Date().toISOString(), detalles, estado: 'borrador' });
        toast(`Nómina ${codigoNuevo} generada - Use "Guardar Borrador" para guardar cambios`, 'warning');
        setView('nomina');
    };

    // Recalcular nómina
    const recalcularDetalle = empId => {
        if (!currentNomina || !nominaEdits[empId]) return null;
        const emp = empleados.find(e => e.id === empId);
        const ed = nominaEdits[empId];
        const divisor = currentNomina.periodo.tipo === 'quincenal' ? 2 : 1;
        const esRegalia = currentNomina.periodo.mes === 12 && (currentNomina.periodo.tipo === 'mensual' || currentNomina.periodo.quincena === 2);

        const salBase = emp.salarioBase / divisor;
        const salDiario = calcularSalarioDiario(emp.salarioBase, config);
        const salHora = calcularSalarioHora(emp.salarioBase, config);

        // Descuentos por ausencias y tardanzas (proporcionales al período)
        const descAusencias = round2(salDiario * (ed.diasAus || 0) / divisor);
        const descTardanzas = round2((salHora * (ed.minTard || 0) / 60) / divisor);
        const horasExtra = calcularHorasExtras(emp.salarioBase, ed.horas35 || 0, ed.horas100 || 0, config).total / divisor;
        const bonificacion = parseFloat(ed.bonificacion) || 0;
        const comisiones = parseFloat(ed.comisiones) || 0;
        const incentivos = parseFloat(ed.incentivos) || 0;
        const viaticos = parseFloat(ed.viaticos) || 0;
        const otrosIng = parseFloat(ed.otrosIng) || 0;
        const otrasDed = parseFloat(ed.otrasDed) || 0;
        const regalia = esRegalia ? calcularRegalia(emp.salarioBase, 12) : 0;

        // Deducciones fijas divididas por período
        // PDSS = Dependientes adicionales SFS × Valor Per Cápita mensual / divisor
        const pdss = round2(((emp.dependientesSFS || 0) * (config.tss.pdssPerCapita || 1715.46)) / divisor);
        const cooperativa = (emp.cooperativa || 0) / divisor;
        const seguroPrivado = (emp.seguroPrivado || 0) / divisor;
        const embargo = (emp.embargo || 0) / divisor;
        const cuotaPrestamo = getTotalCuotas(emp.id) / divisor;

        // IMPORTANTE: Calcular TSS sobre salario MENSUAL equivalente (para aplicar topes correctamente)
        // Reconstruir salario mensual considerando ausencias
        const salMensualParaTSS = Math.max(0, emp.salarioBase - (descAusencias * divisor));
        const tssMensual = calcularTSS(salMensualParaTSS, config);
        
        // Calcular ISR sobre salario anual (considerando dependientes)
        const salNetoAnual = (salMensualParaTSS - tssMensual.afpEmp - tssMensual.sfsEmp) * 12;
        const isrMensual = calcularISR(salNetoAnual, config);
        
        // Dividir TSS e ISR por el divisor
        const afpEmp = round2(tssMensual.afpEmp / divisor);
        const sfsEmp = round2(tssMensual.sfsEmp / divisor);
        const isr = round2(isrMensual / divisor);
        const afpPat = round2(tssMensual.afpPat / divisor);
        const sfsPat = round2(tssMensual.sfsPat / divisor);
        const infotep = round2(tssMensual.infotep / divisor);
        const riesgo = round2(tssMensual.riesgo / divisor);

        const totalIng = salBase + horasExtra + bonificacion + comisiones + incentivos + viaticos + (ed.vacaciones || 0) + regalia + otrosIng;
        const totalDed = afpEmp + sfsEmp + isr + pdss + descAusencias + descTardanzas + cuotaPrestamo + cooperativa + seguroPrivado + embargo + otrasDed;

        return {
            empId: emp.id, nombre: emp.nombre, depto: emp.departamento, cargo: emp.cargo,
            salarioBase: salBase, horasExtra, horas35: ed.horas35 || 0, horas100: ed.horas100 || 0, bonificacion, comisiones, incentivos, viaticos, vacaciones: ed.vacaciones || 0, regalia, otrosIng, totalIng,
            diasAus: ed.diasAus || 0, fechasAus: ed.fechasAus || [], descAusencias, minTard: ed.minTard || 0, descTardanzas,
            afpEmp, sfsEmp, isr, pdss, cuotaPrestamo, cooperativa, seguroPrivado, embargo, otrasDed, totalDed,
            neto: round2(totalIng - totalDed),
            afpPat, sfsPat, infotep, riesgo
        };
    };

    const getDetallesRecalc = () => currentNomina ? currentNomina.detalles.map(d => recalcularDetalle(d.empId) || d) : [];
    const updateEdit = (empId, field, val) => setNominaEdits(p => ({ ...p, [empId]: { ...p[empId], [field]: val } }));

    // Guardar nómina como borrador (persiste en localStorage)
    const guardarBorrador = () => {
        if (!currentNomina) {
            toast('No hay nómina para guardar', 'error');
            return;
        }
        
        const detalles = getDetallesRecalc();
        const nominaActualizada = { 
            ...currentNomina, 
            detalles,
            estado: 'borrador',
            fechaModificacion: new Date().toISOString()
        };
        
        // Actualizar estado de nómina actual
        setCurrentNomina(nominaActualizada);
        
        // Actualizar lista de nóminas
        setNominas(prev => {
            const existe = prev.find(n => n.id === nominaActualizada.id);
            let nuevasNominas;
            if (existe) {
                nuevasNominas = prev.map(n => n.id === nominaActualizada.id ? nominaActualizada : n);
            } else {
                nuevasNominas = [...prev, nominaActualizada];
            }
            
            // Guardar directamente en localStorage para asegurar persistencia
            try {
                localStorage.setItem(STORAGE_KEYS.nominas, JSON.stringify(nuevasNominas));
                console.log('Borrador guardado en localStorage:', nominaActualizada.codigo);
            } catch (e) {
                console.error('Error guardando borrador:', e);
            }
            
            return nuevasNominas;
        });
        
        toast('Borrador guardado correctamente', 'success');
    };
    
    // Cargar borrador existente
    const cargarBorrador = (borrador) => {
        // Reconstruir los edits desde los detalles del borrador
        const edits = {};
        borrador.detalles.forEach(d => {
            edits[d.empId] = {
                diasAus: d.diasAus || 0,
                fechasAus: d.fechasAus || [],
                minTard: d.minTard || 0,
                horas35: d.horas35 || 0,
                horas100: d.horas100 || 0,
                bonificacion: d.bonificacion || 0,
                comisiones: d.comisiones || 0,
                incentivos: d.incentivos || 0,
                viaticos: d.viaticos || 0,
                otrosIng: d.otrosIng || 0,
                otrasDed: d.otrasDed || 0
            };
        });
        
        setNominaEdits(edits);
        setCurrentNomina(borrador);
        toast(`Borrador ${borrador.codigo} cargado - Continúe editando`, 'info');
        setView('nomina');
    };

    // Procesar/Cerrar nómina (finalizar)
    const procesarNomina = async () => {
        const esEdicion = currentNomina.editandoExistente;
        const mensajeConfirm = esEdicion 
            ? '¿Está seguro de GUARDAR los cambios?\n\nLos cambios sobrescribirán la nómina anterior.'
            : '¿Está seguro de PROCESAR esta nómina?\n\nUna vez procesada:\n• Se actualizarán los saldos de préstamos\n• Quedará guardada en el historial\n• Podrá editarla posteriormente si necesita corregir algo';
        
        if (!window.confirm(mensajeConfirm)) {
            return;
        }
        
        const detalles = getDetallesRecalc();
        const codigo = currentNomina.codigo || `${currentNomina.periodo.año}${currentNomina.periodo.mes.toString().padStart(2,'0')}${currentNomina.periodo.tipo === 'quincenal' ? currentNomina.periodo.quincena : '0'}`;
        
        // Limpiar flags de edición antes de guardar
        const nominaFinal = { 
            ...currentNomina, 
            codigo, 
            detalles, 
            estado: 'procesada', 
            fechaProceso: new Date().toISOString(),
            editandoExistente: undefined,
            idOriginal: undefined,
            fechaModificacion: esEdicion ? new Date().toISOString() : undefined
        };
        delete nominaFinal.editandoExistente;
        delete nominaFinal.idOriginal;

        // Actualizar préstamos SOLO si es una nómina nueva (no si es edición)
        const prestamosActualizados = [];
        if (!esEdicion) {
            detalles.forEach(d => {
                if (d.cuotaPrestamo > 0) {
                    setPrestamos(p => p.map(pr => {
                        if (pr.empleadoId === d.empId && pr.activo && pr.saldo > 0) {
                            const desc = pr.cuotaMensual / (currentNomina.periodo.tipo === 'quincenal' ? 2 : 1);
                            const nuevoSaldo = Math.max(0, pr.saldo - desc);
                            const actualizado = { ...pr, saldo: nuevoSaldo, cuotasPagadas: pr.cuotasPagadas + (currentNomina.periodo.tipo === 'quincenal' ? 0.5 : 1), activo: nuevoSaldo > 0 };
                            prestamosActualizados.push(actualizado);
                            return actualizado;
                        }
                        return pr;
                    }));
                }
            });
        }

        // Si es edición, sobrescribir; si es nueva, agregar (pero verificar duplicados)
        if (esEdicion) {
            const idOriginal = currentNomina.idOriginal || currentNomina.id;
            setNominas(p => p.map(n => n.id === idOriginal ? { ...nominaFinal, id: idOriginal } : n));
        } else {
            // Verificar si ya existe una nómina con el mismo código
            setNominas(p => {
                const existente = p.find(n => n.codigo === codigo && n.estado !== 'anulada');
                if (existente) {
                    // Si existe, actualizar en lugar de agregar
                    console.log(`Actualizando nómina existente con código ${codigo}`);
                    return p.map(n => n.id === existente.id ? { ...nominaFinal, id: existente.id } : n);
                } else {
                    // Si no existe, agregar nueva
                    return [...p, nominaFinal];
                }
            });
        }
        
        setCurrentNomina(nominaFinal);
        
        // Sincronizar con SharePoint
        if (spConnected) {
            await guardarNominaSP(nominaFinal);
            for (const p of prestamosActualizados) {
                await guardarPrestamoSP(p);
            }
        }
        
        toast(`Nómina ${codigo} ${esEdicion ? 'actualizada' : 'procesada'} correctamente`, 'success');
    };
    
    // Editar nómina existente (cargar como borrador para modificar)
    const editarNomina = (nomina) => {
        // Reconstruir los edits desde los detalles de la nómina
        const edits = {};
        nomina.detalles.forEach(det => {
            edits[det.empId] = {
                diasAus: det.diasAus || 0,
                fechasAus: det.fechasAus || [],
                minTard: det.minTard || 0,
                horas35: 0, // Las horas extras se recalculan
                horas100: 0,
                bonificacion: det.bonificacion || 0,
                comisiones: det.comisiones || 0,
                incentivos: det.incentivos || 0,
                viaticos: det.viaticos || 0,
                otrosIng: det.otrosIng || 0,
                otrasDed: det.otrasDed || 0
            };
        });
        
        // Cargar la nómina como borrador
        const nominaBorrador = {
            ...nomina,
            estado: 'borrador',
            editandoExistente: true, // Flag para saber que estamos editando
            idOriginal: nomina.id // Guardar ID original para sobrescribir
        };
        
        setNominaEdits(edits);
        setPeriodo(nomina.periodo);
        setCurrentNomina(nominaBorrador);
        setView('nomina');
        
        toast(`Editando nómina ${nomina.codigo} - Haga los cambios y presione "Procesar Nómina" para guardar`, 'info');
    };
    
    // Anular nómina (solo para casos especiales)
    const anularNomina = async (nomina) => {
        const motivo = window.prompt('Ingrese el motivo de anulación:');
        if (!motivo) return;
        
        if (!window.confirm(`¿Está seguro de ANULAR la nómina ${nomina.codigo}?\n\nNOTA: Normalmente es mejor EDITAR la nómina.\nAnular solo si necesita eliminarla completamente del historial.`)) {
            return;
        }
        
        const nominaAnulada = { 
            ...nomina, 
            estado: 'anulada', 
            fechaAnulacion: new Date().toISOString(),
            motivoAnulacion: motivo 
        };
        
        setNominas(p => p.map(n => n.id === nomina.id ? nominaAnulada : n));
        
        // Sincronizar con SharePoint
        if (spConnected) {
            await guardarNominaSP(nominaAnulada);
        }
        
        toast(`Nómina ${nomina.codigo} anulada.`, 'warning');
    };
    
    // Función legacy para compatibilidad
    const guardarNomina = procesarNomina;

    // Liquidación
    const calcularLiquidacionEmp = (emp, motivo = 'despido') => {
        const liq = calcularLiquidacion(emp, config, motivo);
        setLiquidacionData({ emp, motivo, ...liq });
        openModal('liquidacion');
    };

    // Exportar Excel (simulado)
    const exportarExcel = () => {
        if (!currentNomina) return;
        toast('Generando archivo Excel...', 'info');
        
        const dets = getDetallesRecalc();
        const periodo = currentNomina.periodo;
        const periodoStr = `${periodo.tipo === 'quincenal' ? 'Q' + periodo.quincena + '_' : ''}${periodo.mes}_${periodo.año}`;
        
        // Crear contenido HTML para Excel
        let html = `
            <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel">
            <head><meta charset="UTF-8">
            <style>
                table { border-collapse: collapse; }
                th, td { border: 1px solid #000; padding: 5px; }
                th { background: #1565C0; color: white; font-weight: bold; }
                .money { text-align: right; }
                .header { background: #f0f0f0; font-weight: bold; }
                .total { background: #e0e0e0; font-weight: bold; }
            </style>
            </head><body>
            <h2>NÓMINA - Centro Educativo Tehui</h2>
            <p><strong>Período:</strong> ${['','Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'][periodo.mes]} ${periodo.año} ${periodo.tipo === 'quincenal' ? '- Quincena ' + periodo.quincena : ''}</p>
            <p><strong>Fecha:</strong> ${new Date().toLocaleDateString('es-DO')}</p>
            <table>
                <tr>
                    <th>Empleado</th>
                    <th>Departamento</th>
                    <th>Cargo</th>
                    <th>Salario Base</th>
                    <th>Horas Extra</th>
                    <th>Bonificación</th>
                    <th>Comisiones</th>
                    <th>Incentivos</th>
                    <th>Viáticos</th>
                    <th>Vacaciones</th>
                    <th>Otros Ing.</th>
                    <th>Total Ingresos</th>
                    <th>AFP (2.87%)</th>
                    <th>SFS (3.04%)</th>
                    <th>ISR</th>
                    <th>Préstamos</th>
                    <th>Ausencias</th>
                    <th>Otras Ded.</th>
                    <th>Total Deducciones</th>
                    <th>NETO A PAGAR</th>
                </tr>`;
        
        dets.forEach(d => {
            html += `
                <tr>
                    <td>${d.nombre}</td>
                    <td>${d.depto}</td>
                    <td>${d.cargo || '-'}</td>
                    <td class="money">${d.salarioBase.toFixed(2)}</td>
                    <td class="money">${d.horasExtra.toFixed(2)}</td>
                    <td class="money">${d.bonificacion.toFixed(2)}</td>
                    <td class="money">${(d.comisiones || 0).toFixed(2)}</td>
                    <td class="money">${(d.incentivos || 0).toFixed(2)}</td>
                    <td class="money">${(d.viaticos || 0).toFixed(2)}</td>
                    <td class="money">${(d.vacaciones || 0).toFixed(2)}</td>
                    <td class="money">${d.otrosIng.toFixed(2)}</td>
                    <td class="money">${d.totalIng.toFixed(2)}</td>
                    <td class="money">${d.afpEmp.toFixed(2)}</td>
                    <td class="money">${d.sfsEmp.toFixed(2)}</td>
                    <td class="money">${d.isr.toFixed(2)}</td>
                    <td class="money">${d.cuotaPrestamo.toFixed(2)}</td>
                    <td class="money">${(d.descAusencias || 0).toFixed(2)}</td>
                    <td class="money">${d.otrasDed.toFixed(2)}</td>
                    <td class="money">${d.totalDed.toFixed(2)}</td>
                    <td class="money" style="background:#c8e6c9;font-weight:bold;">${d.neto.toFixed(2)}</td>
                </tr>`;
        });
        
        // Totales
        const totales = dets.reduce((a, d) => ({
            salarioBase: a.salarioBase + d.salarioBase,
            horasExtra: a.horasExtra + d.horasExtra,
            bonificacion: a.bonificacion + d.bonificacion,
            comisiones: a.comisiones + (d.comisiones || 0),
            incentivos: a.incentivos + (d.incentivos || 0),
            viaticos: a.viaticos + (d.viaticos || 0),
            otrosIng: a.otrosIng + d.otrosIng,
            totalIng: a.totalIng + d.totalIng,
            afpEmp: a.afpEmp + d.afpEmp,
            sfsEmp: a.sfsEmp + d.sfsEmp,
            isr: a.isr + d.isr,
            cuotaPrestamo: a.cuotaPrestamo + d.cuotaPrestamo,
            descAusencias: a.descAusencias + (d.descAusencias || 0),
            otrasDed: a.otrasDed + d.otrasDed,
            totalDed: a.totalDed + d.totalDed,
            neto: a.neto + d.neto
        }), { salarioBase: 0, horasExtra: 0, bonificacion: 0, comisiones: 0, incentivos: 0, viaticos: 0, otrosIng: 0, totalIng: 0, afpEmp: 0, sfsEmp: 0, isr: 0, cuotaPrestamo: 0, descAusencias: 0, otrasDed: 0, totalDed: 0, neto: 0 });
        
        html += `
            <tr class="total">
                <td colspan="3"><strong>TOTALES</strong></td>
                <td class="money">${totales.salarioBase.toFixed(2)}</td>
                <td class="money">${totales.horasExtra.toFixed(2)}</td>
                <td class="money">${totales.bonificacion.toFixed(2)}</td>
                <td class="money">${totales.comisiones.toFixed(2)}</td>
                <td class="money">${totales.incentivos.toFixed(2)}</td>
                <td class="money">${totales.viaticos.toFixed(2)}</td>
                <td class="money">${totales.otrosIng.toFixed(2)}</td>
                <td class="money">${totales.totalIng.toFixed(2)}</td>
                <td class="money">${totales.afpEmp.toFixed(2)}</td>
                <td class="money">${totales.sfsEmp.toFixed(2)}</td>
                <td class="money">${totales.isr.toFixed(2)}</td>
                <td class="money">${totales.cuotaPrestamo.toFixed(2)}</td>
                <td class="money">${totales.descAusencias.toFixed(2)}</td>
                <td class="money">${totales.otrasDed.toFixed(2)}</td>
                <td class="money">${totales.totalDed.toFixed(2)}</td>
                <td class="money" style="background:#a5d6a7;font-weight:bold;">${totales.neto.toFixed(2)}</td>
            </tr>
            </table>
            <br/><br/>
            <h3>Aportes Patronales</h3>
            <table>
                <tr><th>Concepto</th><th>Monto</th></tr>
                <tr><td>AFP Patronal (7.10%)</td><td class="money">${dets.reduce((s,d) => s + d.afpPat, 0).toFixed(2)}</td></tr>
                <tr><td>SFS Patronal (7.09%)</td><td class="money">${dets.reduce((s,d) => s + d.sfsPat, 0).toFixed(2)}</td></tr>
                <tr><td>INFOTEP (1%)</td><td class="money">${dets.reduce((s,d) => s + d.infotep, 0).toFixed(2)}</td></tr>
                <tr><td>Riesgo Laboral (${config.tss.riesgoLaboral}%)</td><td class="money">${dets.reduce((s,d) => s + d.riesgo, 0).toFixed(2)}</td></tr>
            </table>
            </body></html>`;
        
        // Crear y descargar archivo
        const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Nomina_Tehui_${periodoStr}.xls`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        toast('Archivo Excel generado correctamente', 'success');
    };

    // Función para imprimir nómina
    const imprimirNomina = () => {
        setModoImpresionNomina(true);
        setTimeout(() => {
            window.print();
            setTimeout(() => setModoImpresionNomina(false), 500);
        }, 100);
    };
    
    const imprimirVolantes = () => {
        document.body.classList.add('printing-volantes');
        setTimeout(() => {
            window.print();
            setTimeout(() => document.body.classList.remove('printing-volantes'), 500);
        }, 100);
    };
    
    // Funciones para envío de volantes por email (Microsoft Graph)
    const enviarCorreoGraph = async (destinatario, asunto, htmlBody) => {
        try {
            const token = await getAccessToken();
            if (!token) {
                throw new Error('No se pudo obtener token de acceso. Inicie sesión con Microsoft.');
            }
            
            const mensaje = {
                message: {
                    subject: asunto,
                    body: {
                        contentType: 'HTML',
                        content: htmlBody
                    },
                    toRecipients: [
                        { emailAddress: { address: destinatario } }
                    ]
                },
                saveToSentItems: true
            };
            
            const response = await fetch('https://graph.microsoft.com/v1.0/me/sendMail', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(mensaje)
            });
            
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.error?.message || `Error ${response.status}`);
            }
            
            return true;
        } catch (error) {
            console.error('Error enviando correo:', error);
            throw error;
        }
    };
    
    const generarHTMLVolante = (emp, det, periodoTexto) => {
        return `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #1565C0, #0D47A1); color: white; padding: 25px; text-align: center; }
        .header h1 { margin: 0; font-size: 22px; }
        .header p { margin: 8px 0 0; opacity: 0.9; font-size: 14px; }
        .periodo-badge { display: inline-block; background: rgba(255,255,255,0.2); padding: 8px 20px; border-radius: 20px; margin-top: 15px; font-weight: 600; }
        .content { padding: 25px; }
        .empleado-info { background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #1565C0; }
        .empleado-nombre { font-size: 18px; font-weight: 700; color: #1a1f24; margin-bottom: 5px; }
        .empleado-datos { font-size: 13px; color: #5c6975; }
        .tabla-detalle { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .tabla-detalle th { background: #e3f2fd; color: #1565C0; padding: 12px; text-align: left; font-size: 12px; text-transform: uppercase; }
        .tabla-detalle td { padding: 10px 12px; border-bottom: 1px solid #e0e4e8; font-size: 14px; }
        .tabla-detalle tr:last-child td { border-bottom: none; }
        .monto { text-align: right; font-family: 'Consolas', monospace; }
        .seccion-titulo { font-weight: 700; color: #43A047; }
        .seccion-titulo.deducciones { color: #E53935; }
        .neto-row { background: linear-gradient(135deg, #43A047, #388E3C); color: white; }
        .neto-row td { padding: 15px 12px; font-size: 16px; font-weight: 700; }
        .banco-info { background: #fff3e0; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #FF9800; }
        .banco-info h4 { margin: 0 0 10px; color: #e65100; font-size: 14px; }
        .banco-dato { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 13px; }
        .footer { background: #f5f5f5; padding: 20px; text-align: center; font-size: 11px; color: #888; }
        .footer img { max-height: 40px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📋 VOLANTE DE PAGO</h1>
            <p>Centro Educativo Tehui</p>
            <div class="periodo-badge">${periodoTexto}</div>
        </div>
        
        <div class="content">
            <div class="empleado-info">
                <div class="empleado-nombre">${emp.nombre}</div>
                <div class="empleado-datos">
                    <span>📄 ${emp.documento || 'N/A'}</span> &nbsp;|&nbsp;
                    <span>🏢 ${emp.departamento || 'N/A'}</span> &nbsp;|&nbsp;
                    <span>💼 ${emp.cargo || 'N/A'}</span>
                </div>
            </div>
            
            <table class="tabla-detalle">
                <thead>
                    <tr>
                        <th colspan="2">Detalle de Pagos</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="seccion-titulo">💰 INGRESOS</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>Salario Base</td>
                        <td class="monto">RD$ ${formatMoney(det.salarioBase || 0)}</td>
                    </tr>
                    ${det.horasExtras > 0 ? `<tr><td>Horas Extras</td><td class="monto">RD$ ${formatMoney(det.horasExtras)}</td></tr>` : ''}
                    ${det.bonificaciones > 0 ? `<tr><td>Bonificaciones</td><td class="monto">RD$ ${formatMoney(det.bonificaciones)}</td></tr>` : ''}
                    ${det.incentivo > 0 ? `<tr><td>Incentivos</td><td class="monto">RD$ ${formatMoney(det.incentivo)}</td></tr>` : ''}
                    <tr>
                        <td><strong>Total Ingresos</strong></td>
                        <td class="monto"><strong>RD$ ${formatMoney(det.totalIng || 0)}</strong></td>
                    </tr>
                    
                    <tr>
                        <td class="seccion-titulo deducciones">📉 DEDUCCIONES</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>AFP (2.87%)</td>
                        <td class="monto">RD$ ${formatMoney(det.afp || 0)}</td>
                    </tr>
                    <tr>
                        <td>SFS (3.04%)</td>
                        <td class="monto">RD$ ${formatMoney(det.sfs || 0)}</td>
                    </tr>
                    ${det.isr > 0 ? `<tr><td>ISR</td><td class="monto">RD$ ${formatMoney(det.isr)}</td></tr>` : ''}
                    ${det.cooperativa > 0 ? `<tr><td>Cooperativa</td><td class="monto">RD$ ${formatMoney(det.cooperativa)}</td></tr>` : ''}
                    ${det.prestamos > 0 ? `<tr><td>Préstamos</td><td class="monto">RD$ ${formatMoney(det.prestamos)}</td></tr>` : ''}
                    ${det.otrasDeducc > 0 ? `<tr><td>Otras Deducciones</td><td class="monto">RD$ ${formatMoney(det.otrasDeducc)}</td></tr>` : ''}
                    <tr>
                        <td><strong>Total Deducciones</strong></td>
                        <td class="monto"><strong>RD$ ${formatMoney(det.totalDed || 0)}</strong></td>
                    </tr>
                    
                    <tr class="neto-row">
                        <td>✅ NETO A RECIBIR</td>
                        <td class="monto">RD$ ${formatMoney(det.neto || 0)}</td>
                    </tr>
                </tbody>
            </table>
            
            ${emp.banco ? `
            <div class="banco-info">
                <h4>🏦 Información de Depósito</h4>
                <div class="banco-dato"><span>Banco:</span><strong>${emp.banco}</strong></div>
                <div class="banco-dato"><span>No. Cuenta:</span><strong>${emp.cuenta || 'N/A'}</strong></div>
            </div>
            ` : ''}
        </div>
        
        <div class="footer">
            <p><strong>Centro Educativo Tehui</strong></p>
            <p>Educando en valores con calidad</p>
            <p style="margin-top: 10px; font-size: 10px;">Este es un documento informativo generado automáticamente.<br>Fecha de emisión: ${new Date().toLocaleDateString('es-DO', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
        </div>
    </div>
</body>
</html>`;
    };
    
    const enviarVolanteEmail = async (emp, det) => {
        if (!emp.email) {
            toast(`${emp.nombre} no tiene email registrado`, 'error');
            return false;
        }
        
        // Verificar que esté conectado a Microsoft
        if (!msUser) {
            toast('Debe iniciar sesión con Microsoft para enviar correos', 'warning');
            return false;
        }
        
        setEnviandoVolante(emp.id);
        
        try {
            const periodoTexto = currentNomina ? 
                `${MESES[currentNomina.periodo.mes]} ${currentNomina.periodo.año}${currentNomina.periodo.tipo === 'quincenal' ? ` - ${currentNomina.periodo.quincena === 1 ? '1ra' : '2da'} Quincena` : ''}` : '';
            
            const asunto = `📋 Volante de Pago - ${periodoTexto} | Centro Educativo Tehui`;
            const htmlBody = generarHTMLVolante(emp, det, periodoTexto);
            
            await enviarCorreoGraph(emp.email, asunto, htmlBody);
            
            // Marcar como enviado
            const nominaCodigo = currentNomina?.codigo;
            if (nominaCodigo) {
                setEmpleadosPagados(prev => ({
                    ...prev,
                    [nominaCodigo]: {
                        ...(prev[nominaCodigo] || {}),
                        [emp.id]: { enviado: true, fecha: new Date().toISOString() }
                    }
                }));
            }
            
            toast(`✉️ Volante enviado a ${emp.email}`, 'success');
            setEnviandoVolante(null);
            return true;
        } catch (error) {
            console.error('Error enviando volante:', error);
            toast(`Error: ${error.message || 'No se pudo enviar el correo'}`, 'error');
            setEnviandoVolante(null);
            return false;
        }
    };
    
    const enviarTodosVolantes = async () => {
        if (!volantesData || volantesData.length === 0) return;
        
        // Verificar conexión a Microsoft
        if (!msUser) {
            toast('Debe iniciar sesión con Microsoft para enviar correos', 'warning');
            return;
        }
        
        const conEmail = volantesData.filter(v => v.emp.email);
        if (conEmail.length === 0) {
            toast('Ningún empleado tiene email registrado', 'warning');
            return;
        }
        
        if (!confirm(`¿Enviar volante por email a ${conEmail.length} empleados?\n\nLos correos se enviarán desde: ${msUser.username}`)) return;
        
        let enviados = 0;
        let errores = 0;
        
        for (const v of conEmail) {
            const resultado = await enviarVolanteEmail(v.emp, v.det);
            if (resultado) enviados++;
            else errores++;
            // Pequeña pausa entre envíos para evitar rate limiting
            await new Promise(resolve => setTimeout(resolve, 800));
        }
        
        toast(`Envío completado: ${enviados} exitosos, ${errores} fallidos`, enviados > 0 ? 'success' : 'error');
    };
    
    const isVolanteEnviado = (empId) => {
        const nominaCodigo = currentNomina?.codigo;
        return nominaCodigo && empleadosPagados[nominaCodigo]?.[empId]?.enviado;
    };
    
    const imprimirChecklist = () => {
        document.body.classList.add('printing-checklist');
        setTimeout(() => {
            window.print();
            setTimeout(() => document.body.classList.remove('printing-checklist'), 500);
        }, 100);
    };
    
    // Función para imprimir desde el Centro de Reportes
    const imprimirReporte = () => {
        document.body.classList.add('printing-reportes');
        setTimeout(() => {
            window.print();
            setTimeout(() => document.body.classList.remove('printing-reportes'), 500);
        }, 100);
    };
    
    // Abrir Centro de Reportes
    const abrirCentroReportes = (tipo = null) => {
        setTipoReporteActivo(tipo);
        openModal('reportes');
    };
    
    // Tipos de reportes disponibles organizados por categoría
    const CATEGORIAS_REPORTES = [
        {
            id: 'empleados',
            nombre: '👥 Empleados',
            reportes: [
                { id: 'empleados-activos', nombre: 'Listado de Empleados Activos', icon: '👥', desc: 'Directorio completo con datos de contacto y bancarios' },
                { id: 'empleados-depto', nombre: 'Empleados por Departamento', icon: '🏢', desc: 'Agrupados por departamento con totales' },
                { id: 'empleados-antiguedad', nombre: 'Empleados por Antigüedad', icon: '📅', desc: 'Ordenados por fecha de ingreso' },
                { id: 'empleados-salarios', nombre: 'Escala Salarial', icon: '💰', desc: 'Rangos salariales por departamento' },
                { id: 'empleados-cumple', nombre: 'Cumpleañeros del Mes', icon: '🎂', desc: 'Empleados que cumplen años este mes' },
                { id: 'empleados-desvinculados', nombre: 'Empleados Desvinculados', icon: '🚪', desc: 'Historial de empleados que salieron' }
            ]
        },
        {
            id: 'nomina',
            nombre: '💵 Nómina',
            reportes: [
                { id: 'nomina-depto', nombre: 'Nómina por Departamento', icon: '📊', desc: 'Empleados agrupados por departamento con subtotales', requiereNomina: true },
                { id: 'nomina-resumen', nombre: 'Resumen Ejecutivo', icon: '📋', desc: 'Resumen de la nómina en una página', requiereNomina: true },
                { id: 'nomina-banco', nombre: 'Distribución por Banco', icon: '🏦', desc: 'Totales a depositar por cada banco', requiereNomina: true }
            ]
        },
        {
            id: 'fiscal',
            nombre: '🏛️ Fiscal / TSS',
            reportes: [
                { id: 'tss', nombre: 'Reporte TSS Completo', icon: '🏛️', desc: 'AFP, SFS, Infotep, Riesgo Laboral', requiereNomina: true },
                { id: 'tss-resumen', nombre: 'Resumen Aportes TSS', icon: '📑', desc: 'Totales de aportes empleado y patronal', requiereNomina: true },
                { id: 'isr', nombre: 'Retenciones ISR', icon: '📄', desc: 'Impuesto sobre la renta retenido', requiereNomina: true }
            ]
        },
        {
            id: 'detalles',
            nombre: '📈 Detalles',
            reportes: [
                { id: 'deducciones', nombre: 'Detalle de Deducciones', icon: '📉', desc: 'Todas las deducciones por empleado', requiereNomina: true },
                { id: 'ingresos', nombre: 'Detalle de Ingresos', icon: '📈', desc: 'Ingresos extras (bonos, comisiones, etc.)', requiereNomina: true },
                { id: 'horas-extra', nombre: 'Horas Extras', icon: '⏰', desc: 'Detalle de horas extras pagadas', requiereNomina: true }
            ]
        },
        {
            id: 'prestamos',
            nombre: '💳 Préstamos',
            reportes: [
                { id: 'prestamos-activos', nombre: 'Préstamos Activos', icon: '💳', desc: 'Préstamos vigentes con saldos pendientes' },
                { id: 'prestamos-vencer', nombre: 'Próximos a Vencer', icon: '⚠️', desc: 'Préstamos que terminan en los próximos 3 meses' },
                { id: 'prestamos-historial', nombre: 'Historial de Préstamos', icon: '📚', desc: 'Todos los préstamos incluyendo pagados' }
            ]
        },
        {
            id: 'comparativos',
            nombre: '📊 Comparativos',
            reportes: [
                { id: 'comparativo-nominas', nombre: 'Comparativo de Nóminas', icon: '📊', desc: 'Comparar dos períodos de nómina', requiereNomina: true },
                { id: 'evolucion-salarios', nombre: 'Evolución Salarial', icon: '📈', desc: 'Histórico de cambios salariales' }
            ]
        }
    ];
    
    const [categoriaReporteActiva, setCategoriaReporteActiva] = useState(null);

    // Filtros
    const empsFiltrados = useMemo(() => empleados.filter(e => {
        const matchSearch = e.nombre.toLowerCase().includes(searchTerm.toLowerCase()) || e.documento?.includes(searchTerm) || e.nss?.includes(searchTerm) || e.celular?.includes(searchTerm);
        const matchDept = filterDept === 'TODOS' || e.departamento === filterDept;
        const esDesvinculado = e.fechaSalida ? true : false;
        const matchEstado = filterEstado === 'TODOS' || 
            (filterEstado === 'ACTIVOS' && e.activo && !esDesvinculado) ||
            (filterEstado === 'DESVINCULADOS' && esDesvinculado);
        return matchSearch && matchDept && matchEstado;
    }), [empleados, searchTerm, filterDept, filterEstado]);

    const stats = useMemo(() => {
        const activos = empleados.filter(e => e.activo && !e.fechaSalida);
        const desvinculados = empleados.filter(e => e.fechaSalida);
        return {
            totalEmps: activos.length,
            totalDesvinculados: desvinculados.length,
            totalNomina: activos.reduce((s, e) => s + e.salarioBase, 0),
            totalPrestamos: prestamos.filter(p => p.activo).reduce((s, p) => s + p.saldo, 0),
            prestamosActivos: prestamos.filter(p => p.activo && p.saldo > 0).length,
            licenciasActivas: licencias.filter(l => new Date(l.fechaFin) >= new Date()).length
        };
    }, [empleados, prestamos, licencias]);

    const nominaPorDepto = useMemo(() => {
        const dets = getDetallesRecalc();
        return dets.reduce((acc, d) => { if (!acc[d.depto]) acc[d.depto] = []; acc[d.depto].push(d); return acc; }, {});
    }, [currentNomina, nominaEdits, config]);

    const totalesNomina = useMemo(() => {
        const dets = getDetallesRecalc();
        if (!dets.length) return null;
        return dets.reduce((a, d) => ({
            totalIng: a.totalIng + d.totalIng, totalDed: a.totalDed + d.totalDed, totalNeto: a.totalNeto + d.neto,
            totalAfpEmp: a.totalAfpEmp + d.afpEmp, totalSfsEmp: a.totalSfsEmp + d.sfsEmp, totalIsr: a.totalIsr + d.isr,
            totalAfpPat: a.totalAfpPat + d.afpPat, totalSfsPat: a.totalSfsPat + d.sfsPat,
            totalInfotep: a.totalInfotep + d.infotep, totalRiesgo: a.totalRiesgo + d.riesgo
        }), { totalIng: 0, totalDed: 0, totalNeto: 0, totalAfpEmp: 0, totalSfsEmp: 0, totalIsr: 0, totalAfpPat: 0, totalSfsPat: 0, totalInfotep: 0, totalRiesgo: 0 });
    }, [currentNomina, nominaEdits, config]);

    const volantesData = useMemo(() => {
        if (!currentNomina) return [];
        const dets = getDetallesRecalc();
        if (selectedVolante) {
            const d = dets.find(x => x.empId === selectedVolante);
            const e = empleados.find(x => x.id === selectedVolante);
            return d && e ? [{ emp: e, det: d }] : [];
        }
        return dets.map(d => ({ emp: empleados.find(e => e.id === d.empId), det: d })).filter(x => x.emp);
    }, [currentNomina, selectedVolante, nominaEdits, empleados]);

    // Calcular totales por banco para fondos a depositar
    const fondosPorBanco = useMemo(() => {
        if (!currentNomina) return null;
        const dets = getDetallesRecalc();
        const bancos = {};
        
        dets.forEach(d => {
            const emp = empleados.find(e => e.id === d.empId);
            if (!emp) return;
            
            const banco = emp.banco || 'Sin cuenta';
            const cuenta = emp.cuenta || '';
            
            if (!bancos[banco]) {
                bancos[banco] = { empleados: [], totalNeto: 0, totalBruto: 0 };
            }
            bancos[banco].empleados.push({ 
                nombre: d.nombre, 
                cuenta, 
                neto: d.neto, 
                bruto: d.salarioBase,
                cedula: emp.documento || '',
                departamento: emp.departamento || '',
                totalIng: d.totalIng,
                totalDed: d.totalDed,
                afpEmp: d.afpEmp,
                sfsEmp: d.sfsEmp,
                isr: d.isr
            });
            bancos[banco].totalNeto += d.neto;
            bancos[banco].totalBruto += d.salarioBase;
        });
        
        return bancos;
    }, [currentNomina, nominaEdits, empleados]);

    // =========================================
    // PERMISOS DE USUARIO
    // =========================================
    const esAdmin = usuarioActual?.rol === 'admin';

    // =========================================
    // RENDER VISTAS
    // =========================================
    const renderDashboard = () => (
        <>
            {/* Panel de conexión SharePoint */}
            {!spConnected && (
                <div className="card" style={{marginBottom:'16px', background:'linear-gradient(135deg, #0078d4 0%, #00bcf2 100%)', color:'white', border:'none'}}>
                    <div className="card-body" style={{display:'flex', alignItems:'center', justifyContent:'space-between', padding:'16px 20px'}}>
                        <div>
                            <h3 style={{fontSize:'14px', fontWeight:'700', marginBottom:'4px', display:'flex', alignItems:'center', gap:'8px'}}>
                                <Icons.Cloud /> Conectar con SharePoint
                            </h3>
                            <p style={{fontSize:'11px', opacity:0.9}}>
                                Sincroniza tus datos con Microsoft 365 para acceso desde cualquier dispositivo y respaldo automático.
                            </p>
                        </div>
                        <button className="btn" style={{background:'white', color:'#0078d4', fontWeight:'700'}} onClick={handleLogin}>
                            <Icons.LogIn /> Conectar ahora
                        </button>
                    </div>
                </div>
            )}
            
            <div className="stats">
                <div className="stat"><div className="stat-header"><span className="stat-label">Empleados</span><div className="stat-icon green"><Icons.Users /></div></div><div className="stat-value">{stats.totalEmps}</div><div className="stat-sub">Activos</div></div>
                <div className="stat"><div className="stat-header"><span className="stat-label">Nómina Mensual</span><div className="stat-icon blue"><Icons.Dollar /></div></div><div className="stat-value" style={{fontSize:'15px'}}>RD$ {formatMoney(stats.totalNomina)}</div><div className="stat-sub">Salarios base</div></div>
                <div className="stat"><div className="stat-header"><span className="stat-label">Préstamos</span><div className="stat-icon purple"><Icons.CreditCard /></div></div><div className="stat-value">{stats.prestamosActivos}</div><div className="stat-sub">RD$ {formatMoney(stats.totalPrestamos)}</div></div>
                <div className="stat"><div className="stat-header"><span className="stat-label">Licencias</span><div className="stat-icon orange"><Icons.Calendar /></div></div><div className="stat-value">{stats.licenciasActivas}</div><div className="stat-sub">Activas</div></div>
                <div className="stat"><div className="stat-header"><span className="stat-label">AFP Emp.</span><div className="stat-icon yellow"><Icons.FileText /></div></div><div className="stat-value">{config.tss.afpEmpleado}%</div><div className="stat-sub">Tasa vigente</div></div>
                <div className="stat"><div className="stat-header"><span className="stat-label">SFS Emp.</span><div className="stat-icon red"><Icons.FileText /></div></div><div className="stat-value">{config.tss.sfsEmpleado}%</div><div className="stat-sub">Tasa vigente</div></div>
            </div>

            <div style={{display:'grid', gridTemplateColumns:'2fr 1fr', gap:'16px'}}>
                <div className="card">
                    <div className="card-header"><span className="card-title"><Icons.Calendar /> Generar Nómina</span></div>
                    <div className="card-body">
                        {!(
                            <div className="alert alert-warning" style={{marginBottom:'12px'}}>
                                <Icons.AlertCircle /><span><strong>Modo Consulta:</strong> Solo puede ver información. Contacte al administrador para generar nóminas.</span>
                            </div>
                        )}
                        <div className="alert alert-info"><Icons.Info /><span>La nómina se genera como borrador. Puede ajustar ausencias, tardanzas, horas extras y otros conceptos antes de guardar.</span></div>
                        <div className="form-row" style={{flexWrap:'wrap', gap:'12px', marginBottom:'12px'}}>
                            <div className="form-group"><label className="form-label">Tipo</label><select className="form-control" style={{width:'110px'}} value={periodo.tipo} onChange={e => setPeriodo(p => ({...p, tipo: e.target.value}))} disabled={!esAdmin}><option value="quincenal">Quincenal</option><option value="mensual">Mensual</option></select></div>
                            <div className="form-group"><label className="form-label">Mes</label><select className="form-control" style={{width:'110px'}} value={periodo.mes} onChange={e => setPeriodo(p => ({...p, mes: +e.target.value}))} disabled={!esAdmin}>{MESES.slice(1).map((m,i) => <option key={i} value={i+1}>{m}</option>)}</select></div>
                            <div className="form-group"><label className="form-label">Año</label><select className="form-control" style={{width:'80px'}} value={periodo.año} onChange={e => setPeriodo(p => ({...p, año: +e.target.value}))} disabled={!esAdmin}><option>2024</option><option>2025</option><option>2026</option></select></div>
                            {periodo.tipo === 'quincenal' && <div className="form-group"><label className="form-label">Quincena</label><select className="form-control" style={{width:'120px'}} value={periodo.quincena} onChange={e => setPeriodo(p => ({...p, quincena: +e.target.value}))} disabled={!esAdmin}><option value="1">1ra (1-15)</option><option value="2">2da (16-31)</option></select></div>}
                        </div>
                        {periodo.mes === 12 && <div className="alert alert-success"><Icons.Gift /><span><strong>Regalía Pascual:</strong> Se incluirá automáticamente en la {periodo.tipo === 'quincenal' ? '2da quincena' : 'nómina'} de diciembre.</span></div>}
                        <button className="btn btn-primary" style={{width:'100%'}} onClick={generarNomina} disabled={!esAdmin}><Icons.FileText /> Generar Nómina</button>
                    </div>
                </div>

                <div className="card">
                    <div className="card-header"><span className="card-title"><Icons.Activity /> Accesos Rápidos</span></div>
                    <div className="card-body" style={{display:'grid', gap:'8px'}}>
                        {esAdmin ? (
                            <>
                                <button className="btn btn-secondary" onClick={() => { setEmpForm(empFormInit); setEditingEmp(null); openModal('empleado'); }}><Icons.Plus /> Nuevo Empleado</button>
                                <button className="btn btn-purple" onClick={() => openModal('prestamo')}><Icons.CreditCard /> Registrar Préstamo</button>
                                <button className="btn btn-info" onClick={() => openModal('licencia')}><Icons.Calendar /> Nueva Licencia</button>
                                <button className="btn btn-orange" onClick={() => openModal('reportes')}><Icons.FileText /> 📊 Centro Reportes</button>
                            </>
                        ) : (
                            <>
                                <button className="btn btn-secondary" onClick={() => setView('empleados')}><Icons.Users /> Ver Empleados</button>
                                <button className="btn btn-purple" onClick={() => setView('prestamos')}><Icons.CreditCard /> Ver Préstamos</button>
                                <button className="btn btn-info" onClick={() => setView('historial')}><Icons.FileText /> Ver Historial</button>
                            </>
                        )}
                    </div>
                </div>
            </div>
            
            {/* Nueva sección informativa */}
            <div style={{display:'grid', gridTemplateColumns:'1fr 1fr 1fr', gap:'16px', marginTop:'16px'}}>
                {/* Cumpleañeros del Mes */}
                <div className="card" style={{background:'linear-gradient(135deg, #fff9c4 0%, #fff59d 100%)', border:'none'}}>
                    <div className="card-header" style={{borderBottom:'1px solid rgba(0,0,0,0.1)'}}>
                        <span className="card-title" style={{color:'#f57f17'}}>🎂 Cumpleañeros de {MESES[new Date().getMonth() + 1]}</span>
                    </div>
                    <div className="card-body" style={{maxHeight:'180px', overflowY:'auto'}}>
                        {(() => {
                            const mesActual = new Date().getMonth() + 1;
                            const cumples = empleados.filter(e => e.activo && !e.fechaSalida && e.fechaNacimiento)
                                .filter(e => new Date(e.fechaNacimiento).getMonth() + 1 === mesActual)
                                .sort((a,b) => new Date(a.fechaNacimiento).getDate() - new Date(b.fechaNacimiento).getDate());
                            return cumples.length === 0 ? (
                                <div style={{textAlign:'center', padding:'20px', color:'#795548'}}>
                                    <div style={{fontSize:'24px', marginBottom:'8px'}}>🎈</div>
                                    <div style={{fontSize:'11px'}}>No hay cumpleañeros este mes</div>
                                </div>
                            ) : (
                                <div style={{display:'flex', flexDirection:'column', gap:'8px'}}>
                                    {cumples.slice(0,5).map(e => (
                                        <div key={e.id} style={{display:'flex', alignItems:'center', gap:'10px', padding:'6px 8px', background:'rgba(255,255,255,0.6)', borderRadius:'8px'}}>
                                            <div style={{width:'32px', height:'32px', borderRadius:'50%', background:'linear-gradient(135deg, #ff9800, #ff5722)', display:'flex', alignItems:'center', justifyContent:'center', color:'white', fontWeight:'700', fontSize:'11px'}}>
                                                {new Date(e.fechaNacimiento).getDate()}
                                            </div>
                                            <div>
                                                <div style={{fontWeight:'600', fontSize:'11px', color:'#333'}}>{e.nombre.split(' ').slice(0,2).join(' ')}</div>
                                                <div style={{fontSize:'9px', color:'#666'}}>{e.departamento} • {calcularEdad(e.fechaNacimiento)} años</div>
                                            </div>
                                        </div>
                                    ))}
                                    {cumples.length > 5 && <div style={{fontSize:'10px', color:'#795548', textAlign:'center'}}>+{cumples.length - 5} más</div>}
                                </div>
                            );
                        })()}
                    </div>
                </div>
                
                {/* Calendario Fiscal */}
                <div className="card" style={{background:'linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)', border:'none'}}>
                    <div className="card-header" style={{borderBottom:'1px solid rgba(0,0,0,0.1)'}}>
                        <span className="card-title" style={{color:'#1565c0'}}>📅 Calendario Fiscal RD</span>
                    </div>
                    <div className="card-body">
                        <div style={{display:'flex', flexDirection:'column', gap:'8px'}}>
                            <div style={{padding:'8px 10px', background:'rgba(255,255,255,0.7)', borderRadius:'8px', borderLeft:'3px solid #1565c0'}}>
                                <div style={{fontWeight:'600', fontSize:'11px', color:'#1565c0'}}>📋 TSS (Seguridad Social)</div>
                                <div style={{fontSize:'10px', color:'#333'}}>Pago antes del día <strong>3</strong> de cada mes</div>
                            </div>
                            <div style={{padding:'8px 10px', background:'rgba(255,255,255,0.7)', borderRadius:'8px', borderLeft:'3px solid #388e3c'}}>
                                <div style={{fontWeight:'600', fontSize:'11px', color:'#388e3c'}}>💰 IR-17 (Retenciones)</div>
                                <div style={{fontSize:'10px', color:'#333'}}>Presentar antes del día <strong>10</strong></div>
                            </div>
                            <div style={{padding:'8px 10px', background:'rgba(255,255,255,0.7)', borderRadius:'8px', borderLeft:'3px solid #f57c00'}}>
                                <div style={{fontWeight:'600', fontSize:'11px', color:'#f57c00'}}>📄 INFOTEP</div>
                                <div style={{fontSize:'10px', color:'#333'}}>Pago trimestral (Abril, Julio, Oct, Enero)</div>
                            </div>
                            <div style={{padding:'8px 10px', background:'rgba(255,255,255,0.7)', borderRadius:'8px', borderLeft:'3px solid #7b1fa2'}}>
                                <div style={{fontWeight:'600', fontSize:'11px', color:'#7b1fa2'}}>🎁 Regalía Pascual</div>
                                <div style={{fontSize:'10px', color:'#333'}}>Pagar antes del <strong>20 de diciembre</strong></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                {/* Tips Educativos */}
                <div className="card" style={{background:'linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%)', border:'none'}}>
                    <div className="card-header" style={{borderBottom:'1px solid rgba(0,0,0,0.1)'}}>
                        <span className="card-title" style={{color:'#2e7d32'}}>💡 Sabías que...</span>
                    </div>
                    <div className="card-body">
                        {(() => {
                            const tips = [
                                { titulo: 'Vacaciones', texto: 'Todo trabajador tiene derecho a 14 días de vacaciones después de 1 año de trabajo continuo (Art. 177 CT).', icon: '🏖️' },
                                { titulo: 'Horas Extras', texto: 'Las horas extras se pagan con 35% adicional (normales) y 100% adicional (nocturnas/feriados).', icon: '⏰' },
                                { titulo: 'Preaviso', texto: 'El preaviso va de 7 días (3-6 meses) hasta 28 días (más de 1 año de trabajo).', icon: '📝' },
                                { titulo: 'Cesantía', texto: 'La cesantía se calcula: 6 días por año trabajado para los primeros 2 años, luego varía según antigüedad.', icon: '💼' },
                                { titulo: 'Salario 13', texto: 'La Regalía Pascual (Salario 13) debe pagarse antes del 20 de diciembre de cada año.', icon: '🎄' },
                                { titulo: 'Maternidad', texto: 'La licencia de maternidad es de 14 semanas: 6 antes y 8 después del parto.', icon: '👶' },
                                { titulo: 'AFP', texto: 'El tope máximo cotizable AFP es de 20 salarios mínimos (actualmente RD$ 508,800/mes).', icon: '🏦' },
                                { titulo: 'Bonificación', texto: 'Las empresas pueden otorgar bonificaciones sin que estas formen parte del salario ordinario.', icon: '🎁' }
                            ];
                            const tipDelDia = tips[new Date().getDate() % tips.length];
                            return (
                                <div style={{padding:'12px', background:'rgba(255,255,255,0.7)', borderRadius:'10px'}}>
                                    <div style={{display:'flex', alignItems:'center', gap:'10px', marginBottom:'8px'}}>
                                        <span style={{fontSize:'28px'}}>{tipDelDia.icon}</span>
                                        <span style={{fontWeight:'700', fontSize:'13px', color:'#1b5e20'}}>{tipDelDia.titulo}</span>
                                    </div>
                                    <p style={{fontSize:'11px', color:'#333', lineHeight:'1.5', margin:0}}>{tipDelDia.texto}</p>
                                </div>
                            );
                        })()}
                        <div style={{marginTop:'12px', textAlign:'center'}}>
                            <span style={{fontSize:'9px', color:'#558b2f', fontStyle:'italic'}}>📚 Código de Trabajo de la República Dominicana</span>
                        </div>
                    </div>
                </div>
            </div>
            
            {/* Alertas y Recordatorios */}
            {(() => {
                const prestamosVencer = prestamos.filter(p => p.activo && p.saldo > 0 && Math.ceil(p.saldo / p.cuotaMensual) <= 2);
                const licenciasActivas = licencias.filter(l => l.activo && new Date(l.fechaFin) >= new Date());
                const sinBanco = empleados.filter(e => e.activo && !e.fechaSalida && !e.banco);
                const sinNSS = empleados.filter(e => e.activo && !e.fechaSalida && !e.nss);
                
                const alertas = [];
                if (prestamosVencer.length > 0) alertas.push({ tipo: 'warning', icon: '💳', texto: `${prestamosVencer.length} préstamo(s) próximo(s) a completarse` });
                if (sinBanco.length > 0) alertas.push({ tipo: 'info', icon: '🏦', texto: `${sinBanco.length} empleado(s) sin datos bancarios` });
                if (sinNSS.length > 0) alertas.push({ tipo: 'info', icon: '📋', texto: `${sinNSS.length} empleado(s) sin NSS registrado` });
                
                return alertas.length > 0 ? (
                    <div style={{marginTop:'16px', display:'grid', gridTemplateColumns:'repeat(auto-fit, minmax(280px, 1fr))', gap:'10px'}}>
                        {alertas.map((a, i) => (
                            <div key={i} className={`alert alert-${a.tipo}`} style={{margin:0}}>
                                <span style={{fontSize:'16px'}}>{a.icon}</span>
                                <span style={{fontSize:'11px'}}>{a.texto}</span>
                            </div>
                        ))}
                    </div>
                ) : null;
            })()}
        </>
    );

    const renderEmpleados = () => (
        <div className="card">
            <div className="card-header"><span className="card-title"><Icons.Users /> Empleados ({empsFiltrados.length})</span>{<button className="btn btn-primary" onClick={() => { setEmpForm(empFormInit); setEditingEmp(null); openModal('empleado'); }}><Icons.Plus /> Nuevo</button>}</div>
            <div className="card-body">
                <div className="search-wrap"><Icons.Search className="search-icon" /><input className="search-input" placeholder="Buscar por nombre, documento o celular..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} /></div>
                <div style={{display:'flex', gap:'16px', flexWrap:'wrap', marginBottom:'12px'}}>
                    <div className="filters"><span className={`filter ${filterDept === 'TODOS' ? 'active' : ''}`} onClick={() => setFilterDept('TODOS')}>Todos Dptos</span>{DEPARTAMENTOS.slice(0,6).map(d => <span key={d} className={`filter ${filterDept === d ? 'active' : ''}`} onClick={() => setFilterDept(d)}>{d}</span>)}</div>
                    <div className="filters">
                        <span className={`filter ${filterEstado === 'ACTIVOS' ? 'active' : ''}`} onClick={() => setFilterEstado('ACTIVOS')} style={{background: filterEstado === 'ACTIVOS' ? 'var(--success)' : ''}}>✅ Activos</span>
                        <span className={`filter ${filterEstado === 'DESVINCULADOS' ? 'active' : ''}`} onClick={() => setFilterEstado('DESVINCULADOS')} style={{background: filterEstado === 'DESVINCULADOS' ? 'var(--danger)' : ''}}>🚪 Desvinculados</span>
                        <span className={`filter ${filterEstado === 'TODOS' ? 'active' : ''}`} onClick={() => setFilterEstado('TODOS')}>📋 Todos</span>
                    </div>
                </div>
                <div className="table-wrap">
                    <table>
                        <thead><tr><th>Empleado</th><th>Documento</th><th>Edad</th><th>Celular</th><th>Departamento</th><th>Salario</th><th>Estado</th><th>Acciones</th></tr></thead>
                        <tbody>
                            {empsFiltrados.map(e => {
                                const prest = getPrestamosPend(e.id).reduce((s,p) => s + p.saldo, 0);
                                const esDesvinculado = e.fechaSalida ? true : false;
                                const edad = calcularEdad(e.fechaNacimiento);
                                return (
                                    <tr key={e.id} style={esDesvinculado ? {opacity: 0.7, background: 'rgba(239,68,68,0.05)'} : {}}>
                                        <td><div className="emp-cell"><div className="emp-avatar" style={esDesvinculado ? {background: '#6c757d'} : {}}>{getInitials(e.nombre)}</div><div><div className="emp-name">{e.nombre}</div><div className="emp-sub">{e.cargo || e.departamento}</div></div></div></td>
                                        <td style={{fontFamily:'JetBrains Mono', fontSize:'10px'}}><span className="badge badge-secondary" style={{fontSize:'8px', marginRight:'4px'}}>{e.tipoDocumento === 'pasaporte' ? 'PAS' : 'CED'}</span>{e.documento}</td>
                                        <td style={{textAlign:'center'}}>{edad !== null ? <span style={{fontWeight:'600'}}>{edad} <span style={{fontSize:'9px', color:'var(--text-muted)'}}>años</span></span> : <span style={{color:'var(--text-muted)'}}>-</span>}</td>
                                        <td style={{fontSize:'11px'}}>{e.celular || <span style={{color:'var(--text-muted)'}}>-</span>}</td>
                                        <td><span className="badge badge-info">{e.departamento}</span></td>
                                        <td className="money">RD$ {formatMoney(e.salarioBase)}</td>
                                        <td>
                                            {esDesvinculado ? (
                                                <div>
                                                    <span className="badge badge-danger">Desvinculado</span>
                                                    <div style={{fontSize:'9px', color:'var(--text-muted)', marginTop:'2px'}}>{formatDate(e.fechaSalida)}</div>
                                                </div>
                                            ) : (
                                                <span className={`badge ${e.activo ? 'badge-success' : 'badge-warning'}`}>{e.activo ? 'Activo' : 'Inactivo'}</span>
                                            )}
                                        </td>
                                        <td>
                                            <div className="actions">
                                                {<button className="action-btn" title="Editar" onClick={() => editarEmpleado(e)}><Icons.Edit /></button>}
                                                {<button className="action-btn" title="Liquidar" onClick={() => calcularLiquidacionEmp(e)}><Icons.UserMinus /></button>}
                                                <button className="action-btn" title="Constancia" onClick={() => { setSelectedEmp(e); openModal('constancia'); }}><Icons.FileText /></button>
                                                <button className="action-btn" title="Ver historial nóminas" onClick={() => { setSelectedEmp(e); setView('historial'); }}><Icons.Clock /></button>
                                                {<button className="action-btn danger" title="Eliminar" onClick={() => eliminarEmpleado(e.id)}><Icons.Trash /></button>}
                                            </div>
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    );

    const renderNomina = () => {
        // Si no hay currentNomina pero hay nóminas guardadas, mostrar selector
        if (!currentNomina) {
            const nominasDisponibles = nominas.filter(n => n.estado === 'procesada' || n.estado === 'guardada' || n.estado === 'borrador');
            
            if (nominasDisponibles.length > 0) {
                return (
                    <div className="card">
                        <div className="card-body">
                            <div style={{textAlign:'center', padding:'40px 20px'}}>
                                <Icons.FileText style={{width:'64px', height:'64px', opacity:0.3, marginBottom:'16px'}} />
                                <h3 style={{marginBottom:'8px'}}>Seleccione una Nómina</h3>
                                <p style={{color:'var(--text-muted)', marginBottom:'20px'}}>
                                    Hay {nominasDisponibles.length} nómina(s) disponible(s). Seleccione una para ver o editar.
                                </p>
                                
                                <div style={{maxWidth:'400px', margin:'0 auto 20px'}}>
                                    <select 
                                        className="form-control"
                                        onChange={e => {
                                            const nom = nominas.find(n => n.id === e.target.value || n.id === parseInt(e.target.value));
                                            if (nom) setCurrentNomina(nom);
                                        }}
                                        defaultValue=""
                                    >
                                        <option value="" disabled>-- Seleccione una nómina --</option>
                                        {nominasDisponibles.sort((a,b) => new Date(b.fecha) - new Date(a.fecha)).map(n => (
                                            <option key={n.id} value={n.id}>
                                                {MESES[n.periodo.mes]} {n.periodo.año} 
                                                {n.periodo.tipo === 'quincenal' ? ` Q${n.periodo.quincena}` : ''} 
                                                {' - '}{n.codigo || 'Sin código'} 
                                                {' ('}{n.estado}{')'}
                                            </option>
                                        ))}
                                    </select>
                                </div>
                                
                                <div style={{borderTop:'1px solid var(--border)', paddingTop:'20px', marginTop:'20px'}}>
                                    <p style={{fontSize:'12px', color:'var(--text-muted)', marginBottom:'12px'}}>
                                        ¿Desea generar una nueva nómina?
                                    </p>
                                    <button className="btn btn-primary" onClick={() => setView('dashboard')}>
                                        <Icons.Plus /> Ir al Dashboard
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }
            
            // Si realmente no hay nóminas
            return (
                <div className="card"><div className="card-body"><div className="empty"><Icons.FileText /><h3>No hay nómina generada</h3><p>Genere una desde el Dashboard</p><button className="btn btn-primary" style={{marginTop:'12px'}} onClick={() => setView('dashboard')}>Ir al Dashboard</button></div></div></div>
            );
        }

        const periodoTxt = currentNomina.periodo.tipo === 'quincenal' ? `Q${currentNomina.periodo.quincena} ${MESES[currentNomina.periodo.mes]} ${currentNomina.periodo.año}` : `${MESES[currentNomina.periodo.mes]} ${currentNomina.periodo.año}`;
        const esBorrador = currentNomina.estado === 'borrador';
        const esProcesada = currentNomina.estado === 'procesada' || currentNomina.estado === 'guardada';
        const esAnulada = currentNomina.estado === 'anulada';
        const codigo = currentNomina.codigo || 'Sin código';

        return (
            <div className="card">
                <div className="card-header">
                    <span className="card-title">
                        <Icons.FileText /> Nómina: {periodoTxt} 
                        <span className="badge badge-info" style={{marginLeft:'8px', fontFamily:'JetBrains Mono'}}>{codigo}</span>
                        {esBorrador && <span className="badge badge-warning" style={{marginLeft:'6px'}}>Borrador</span>}
                        {esProcesada && <span className="badge badge-success" style={{marginLeft:'6px'}}>Procesada</span>}
                        {esAnulada && <span className="badge badge-danger" style={{marginLeft:'6px'}}>Anulada</span>}
                    </span>
                    <div className="btn-group">
                        {esBorrador && (
                            <>
                                <button className="btn btn-primary" onClick={guardarBorrador} style={{fontWeight:'bold'}}><Icons.Save /> 💾 Guardar Borrador</button>
                                <button className="btn btn-success" onClick={procesarNomina}><Icons.Check /> Procesar Nómina</button>
                            </>
                        )}
                        {esProcesada && (
                            <>
                                {<button className="btn btn-warning" onClick={() => editarNomina(currentNomina)}><Icons.Edit /> Editar</button>}
                                <button className="btn btn-info" onClick={imprimirNomina}><Icons.Printer /> Imprimir</button>
                                <button className="btn btn-purple" onClick={() => { setSelectedVolante(null); openModal('volantes'); }}><Icons.Receipt /> Volantes</button>
                                <button className="btn btn-orange" onClick={() => abrirCentroReportes()}><Icons.FileText /> 📊 Reportes</button>
                                <button className="btn btn-secondary" onClick={exportarExcel}><Icons.Download /> Excel</button>
                                {<button className="btn btn-danger" onClick={() => anularNomina(currentNomina)}><Icons.X /> Anular</button>}
                            </>
                        )}
                        {esAnulada && (
                            <button className="btn btn-primary" onClick={() => setView('dashboard')}><Icons.Plus /> Crear Nueva</button>
                        )}
                    </div>
                </div>
                <div className="card-body">
                    {esBorrador && <div className="alert alert-warning"><Icons.AlertCircle /><span><strong>Nómina en Borrador:</strong> Ajuste ausencias, tardanzas, horas extras y deducciones. Luego presione "Procesar Nómina" para finalizar.</span></div>}
                    {esAnulada && <div className="alert alert-danger"><Icons.AlertCircle /><span><strong>Nómina Anulada:</strong> {currentNomina.motivoAnulacion || 'Sin motivo especificado'}. Puede crear una nueva nómina para este período desde el Dashboard.</span></div>}
                    
                    <div className="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th className="sticky-col">Empleado</th>
                                    <th>Salario</th>
                                    {esBorrador && <><th>Aus.</th><th>Tard.</th><th>H.35%</th><th>H.100%</th><th>Bonif.</th><th>Comis.</th><th>Incent.</th><th>Viát.</th><th>Vac.</th><th>+Otros</th><th>-Otros</th></>}
                                    <th>AFP</th>
                                    <th>SFS</th>
                                    <th>ISR</th>
                                    <th>Préstamo</th>
                                    <th>Otras</th>
                                    <th>Total Ded.</th>
                                    <th>Neto</th>
                                    {esProcesada && <th></th>}
                                </tr>
                            </thead>
                            <tbody>
                                {Object.entries(nominaPorDepto).map(([depto, dets]) => (
                                    <React.Fragment key={depto}>
                                        {dets.map(d => (
                                            <tr key={d.empId}>
                                                <td className="sticky-col"><div className="emp-cell"><div className="emp-avatar" style={{width:24,height:24,fontSize:9}}>{getInitials(d.nombre)}</div><div><div className="emp-name" style={{fontSize:10}}>{d.nombre}</div><span className="badge badge-secondary" style={{fontSize:8}}>{d.depto}</span></div></div></td>
                                                <td className="money">{formatMoney(d.salarioBase)}</td>
                                                {esBorrador && <>
                                                    <td>
                                                        <button 
                                                            className="btn btn-xs" 
                                                            style={{
                                                                minWidth:'45px', 
                                                                padding:'2px 6px',
                                                                background: (nominaEdits[d.empId]?.diasAus || 0) > 0 ? '#dc3545' : '#6c757d',
                                                                color: 'white',
                                                                border: 'none'
                                                            }} 
                                                            onClick={() => abrirModalAusencias(d.empId)}
                                                            title={nominaEdits[d.empId]?.fechasAus?.length > 0 ? nominaEdits[d.empId].fechasAus.map(f => formatFechaCorta(f)).join(', ') : 'Click para registrar ausencias'}
                                                        >
                                                            {nominaEdits[d.empId]?.diasAus || 0}
                                                        </button>
                                                    </td>
                                                    <td><input className="inline-input" type="number" min="0" style={{width:'45px'}} value={nominaEdits[d.empId]?.minTard || ''} onChange={e => updateEdit(d.empId, 'minTard', e.target.value)} placeholder="min" /></td>
                                                    <td><input className="inline-input" type="number" min="0" value={nominaEdits[d.empId]?.horas35 || ''} onChange={e => updateEdit(d.empId, 'horas35', e.target.value)} placeholder="0" /></td>
                                                    <td><input className="inline-input" type="number" min="0" value={nominaEdits[d.empId]?.horas100 || ''} onChange={e => updateEdit(d.empId, 'horas100', e.target.value)} placeholder="0" /></td>
                                                    <td><input className="inline-input" type="number" min="0" value={nominaEdits[d.empId]?.bonificacion || ''} onChange={e => updateEdit(d.empId, 'bonificacion', e.target.value)} placeholder="0" /></td>
                                                    <td><input className="inline-input" type="number" min="0" value={nominaEdits[d.empId]?.comisiones || ''} onChange={e => updateEdit(d.empId, 'comisiones', e.target.value)} placeholder="0" /></td>
                                                    <td><input className="inline-input" type="number" min="0" value={nominaEdits[d.empId]?.incentivos || ''} onChange={e => updateEdit(d.empId, 'incentivos', e.target.value)} placeholder="0" /></td>
                                                    <td><input className="inline-input" type="number" min="0" value={nominaEdits[d.empId]?.viaticos || ''} onChange={e => updateEdit(d.empId, 'viaticos', e.target.value)} placeholder="0" /></td>
                                                    <td><input className="inline-input" type="number" min="0" value={nominaEdits[d.empId]?.vacaciones || ''} onChange={e => updateEdit(d.empId, 'vacaciones', e.target.value)} placeholder="0" /></td>
                                                    <td><input className="inline-input" type="number" min="0" value={nominaEdits[d.empId]?.otrosIng || ''} onChange={e => updateEdit(d.empId, 'otrosIng', e.target.value)} placeholder="0" /></td>
                                                    <td><input className="inline-input" type="number" min="0" value={nominaEdits[d.empId]?.otrasDed || ''} onChange={e => updateEdit(d.empId, 'otrasDed', e.target.value)} placeholder="0" /></td>
                                                </>}
                                                <td className="money">{formatMoney(d.afpEmp)}</td>
                                                <td className="money">{formatMoney(d.sfsEmp)}</td>
                                                <td className="money">{d.isr > 0 ? formatMoney(d.isr) : '-'}</td>
                                                <td className="money">{d.cuotaPrestamo > 0 ? formatMoney(d.cuotaPrestamo) : '-'}</td>
                                                <td className="money">{(d.cooperativa + d.seguroPrivado + d.embargo + d.descAusencias + d.descTardanzas) > 0 ? formatMoney(d.cooperativa + d.seguroPrivado + d.embargo + d.descAusencias + d.descTardanzas) : '-'}</td>
                                                <td className="money neg">{formatMoney(d.totalDed)}</td>
                                                <td className="money pos" style={{fontWeight:700}}>{formatMoney(d.neto)}</td>
                                                {esProcesada && <td><button className="btn btn-xs btn-secondary" onClick={() => { setSelectedVolante(d.empId); openModal('volantes'); }}><Icons.Eye /></button></td>}
                                            </tr>
                                        ))}
                                        <tr className="dept-row">
                                            <td className="sticky-col"><strong>TOTAL {depto}</strong></td>
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.salarioBase,0))}</td>
                                            {esBorrador && <td colSpan="11"></td>}
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.afpEmp,0))}</td>
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.sfsEmp,0))}</td>
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.isr,0))}</td>
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.cuotaPrestamo,0))}</td>
                                            <td></td>
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.totalDed,0))}</td>
                                            <td className="money">{formatMoney(dets.reduce((s,d)=>s+d.neto,0))}</td>
                                            {esProcesada && <td></td>}
                                        </tr>
                                    </React.Fragment>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {totalesNomina && (
                        <div className="summary-grid">
                            <div className="summary-box">
                                <div className="summary-title">Resumen Nómina</div>
                                <div className="summary-row"><span>Total Ingresos</span><span>RD$ {formatMoney(totalesNomina.totalIng)}</span></div>
                                <div className="summary-row"><span>TSS Empleado</span><span>RD$ {formatMoney(totalesNomina.totalAfpEmp + totalesNomina.totalSfsEmp)}</span></div>
                                <div className="summary-row"><span>ISR</span><span>RD$ {formatMoney(totalesNomina.totalIsr)}</span></div>
                                <div className="summary-row"><span>Total Deducciones</span><span style={{color:'var(--danger)'}}>RD$ {formatMoney(totalesNomina.totalDed)}</span></div>
                                <div className="summary-row"><span>NETO A PAGAR</span><span style={{color:'var(--success)'}}>RD$ {formatMoney(totalesNomina.totalNeto)}</span></div>
                            </div>
                            <div className="summary-box">
                                <div className="summary-title">Aportes Patronales</div>
                                <div className="summary-row"><span>AFP ({config.tss.afpEmpleador}%)</span><span>RD$ {formatMoney(totalesNomina.totalAfpPat)}</span></div>
                                <div className="summary-row"><span>SFS ({config.tss.sfsEmpleador}%)</span><span>RD$ {formatMoney(totalesNomina.totalSfsPat)}</span></div>
                                <div className="summary-row"><span>INFOTEP ({config.tss.infotep}%)</span><span>RD$ {formatMoney(totalesNomina.totalInfotep)}</span></div>
                                <div className="summary-row"><span>Riesgo Laboral ({config.tss.riesgoLaboral}%)</span><span>RD$ {formatMoney(totalesNomina.totalRiesgo)}</span></div>
                                <div className="summary-row"><span>TOTAL APORTES</span><span style={{color:'var(--primary)'}}>RD$ {formatMoney(totalesNomina.totalAfpPat + totalesNomina.totalSfsPat + totalesNomina.totalInfotep + totalesNomina.totalRiesgo)}</span></div>
                            </div>
                            <div className="summary-box">
                                <div className="summary-title">TSS Consolidado (DGII)</div>
                                <div className="summary-row"><span>AFP Total</span><span>RD$ {formatMoney(totalesNomina.totalAfpEmp + totalesNomina.totalAfpPat)}</span></div>
                                <div className="summary-row"><span>SFS Total</span><span>RD$ {formatMoney(totalesNomina.totalSfsEmp + totalesNomina.totalSfsPat)}</span></div>
                                <div className="summary-row"><span>ISR Retenido (IR-17)</span><span>RD$ {formatMoney(totalesNomina.totalIsr)}</span></div>
                                <div className="summary-row"><span>Empleados</span><span>{getDetallesRecalc().length}</span></div>
                            </div>
                        </div>
                    )}
                    
                    {fondosPorBanco && Object.keys(fondosPorBanco).length > 0 && (
                        <div className="card" style={{marginTop:'16px', background:'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)', border:'none'}}>
                            <div className="card-header" style={{borderBottom:'1px solid rgba(255,255,255,0.1)'}}>
                                <span className="card-title" style={{color:'white'}}><Icons.CreditCard /> 💰 Fondos a Depositar por Banco</span>
                            </div>
                            <div className="card-body">
                                <div style={{display:'grid', gridTemplateColumns:'repeat(auto-fit, minmax(280px, 1fr))', gap:'12px'}}>
                                    {Object.entries(fondosPorBanco).sort((a,b) => b[1].totalNeto - a[1].totalNeto).map(([banco, data]) => (
                                        <div key={banco} style={{
                                            background: banco === 'Sin cuenta' ? 'linear-gradient(135deg, #6c757d, #495057)' : 
                                                        banco === 'Banreservas' ? 'linear-gradient(135deg, #00723f, #005a32)' :
                                                        banco === 'BHD León' ? 'linear-gradient(135deg, #003366, #001a33)' :
                                                        banco === 'Banco Popular' ? 'linear-gradient(135deg, #ff6600, #cc5200)' :
                                                        banco === 'ACAP' ? 'linear-gradient(135deg, #8b0000, #5c0000)' :
                                                        'linear-gradient(135deg, #2c3e50, #1a252f)',
                                            borderRadius:'12px',
                                            padding:'16px',
                                            color:'white'
                                        }}>
                                            <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:'12px'}}>
                                                <div style={{fontWeight:'700', fontSize:'14px'}}>{banco === 'Sin cuenta' ? '💵 Efectivo/Cheque' : `🏦 ${banco}`}</div>
                                                <div style={{background:'rgba(255,255,255,0.2)', padding:'4px 10px', borderRadius:'20px', fontSize:'11px'}}>{data.empleados.length} emp.</div>
                                            </div>
                                            <div style={{fontSize:'24px', fontWeight:'800', marginBottom:'8px', fontFamily:'JetBrains Mono'}}>
                                                RD$ {formatMoney(data.totalNeto)}
                                            </div>
                                            <div style={{fontSize:'10px', opacity:0.8, marginBottom:'10px'}}>Neto a depositar</div>
                                            <div style={{borderTop:'1px solid rgba(255,255,255,0.2)', paddingTop:'10px', maxHeight:'120px', overflowY:'auto'}}>
                                                {data.empleados.map((emp, idx) => (
                                                    <div key={idx} style={{display:'flex', justifyContent:'space-between', fontSize:'10px', padding:'3px 0', borderBottom:'1px solid rgba(255,255,255,0.05)'}}>
                                                        <span style={{opacity:0.9, maxWidth:'55%', overflow:'hidden', textOverflow:'ellipsis', whiteSpace:'nowrap'}}>{emp.nombre}</span>
                                                        <span style={{fontFamily:'JetBrains Mono', fontWeight:'600'}}>RD$ {formatMoney(emp.neto)}</span>
                                                    </div>
                                                ))}
                                            </div>
                                            {banco !== 'Sin cuenta' && (
                                                <div style={{marginTop:'8px', fontSize:'9px', opacity:0.6, textAlign:'right'}}>
                                                    Cta: {data.empleados[0]?.cuenta ? data.empleados[0].cuenta.slice(-4) + '...' : 'Ver detalle'}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                                <div style={{marginTop:'16px', padding:'16px', background:'rgba(255,255,255,0.1)', borderRadius:'12px', display:'flex', justifyContent:'space-between', alignItems:'center'}}>
                                    <div>
                                        <div style={{color:'rgba(255,255,255,0.7)', fontSize:'11px'}}>TOTAL NETO A PAGAR</div>
                                        <div style={{color:'#4ade80', fontSize:'28px', fontWeight:'800', fontFamily:'JetBrains Mono'}}>
                                            RD$ {formatMoney(Object.values(fondosPorBanco).reduce((sum, b) => sum + b.totalNeto, 0))}
                                        </div>
                                    </div>
                                    <div style={{display:'flex', alignItems:'center', gap:'16px'}}>
                                        <div style={{textAlign:'right'}}>
                                            <div style={{color:'rgba(255,255,255,0.7)', fontSize:'11px'}}>BANCOS</div>
                                            <div style={{color:'white', fontSize:'20px', fontWeight:'700'}}>{Object.keys(fondosPorBanco).length}</div>
                                        </div>
                                        <button 
                                            className="btn" 
                                            style={{background:'#4ade80', color:'#000', fontWeight:'700', padding:'12px 20px'}}
                                            onClick={() => openModal('pagosBanco')}
                                        >
                                            <Icons.Printer /> Imprimir Checklist
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            </div>
        );
    };

    const renderPrestamos = () => (
        <div className="card">
            <div className="card-header"><span className="card-title"><Icons.CreditCard /> Préstamos y Adelantos</span><button className="btn btn-purple" onClick={() => openModal('prestamo')}><Icons.Plus /> Nuevo</button></div>
            <div className="card-body">
                {prestamos.length === 0 ? <div className="empty"><Icons.CreditCard /><h3>Sin préstamos</h3></div> : (
                    <div className="table-wrap">
                        <table>
                            <thead><tr><th>Empleado</th><th>Descripción</th><th>Monto</th><th>Cuota</th><th>Progreso</th><th>Saldo</th><th>Estado</th><th>Acciones</th></tr></thead>
                            <tbody>
                                {prestamos.map(p => {
                                    const emp = empleados.find(e => e.id === p.empleadoId);
                                    return (
                                        <tr key={p.id}>
                                            <td><div className="emp-cell"><div className="emp-avatar" style={{background:'linear-gradient(135deg, var(--purple), #8e44ad)'}}>{emp ? getInitials(emp.nombre) : '?'}</div><div><div className="emp-name">{emp?.nombre || 'N/A'}</div></div></div></td>
                                            <td>{p.desc}</td>
                                            <td className="money">RD$ {formatMoney(p.monto)}</td>
                                            <td className="money">RD$ {formatMoney(p.cuotaMensual)}</td>
                                            <td style={{minWidth:'100px'}}><div style={{display:'flex',alignItems:'center',gap:'6px'}}><div className="progress" style={{flex:1}}><div className="progress-bar" style={{width:`${(p.cuotasPagadas/p.cuotas)*100}%`}}></div></div><span style={{fontSize:'9px'}}>{p.cuotasPagadas}/{p.cuotas}</span></div></td>
                                            <td className="money" style={{fontWeight:700}}>RD$ {formatMoney(p.saldo)}</td>
                                            <td><span className={`badge ${p.activo && p.saldo > 0 ? 'badge-warning' : 'badge-success'}`}>{p.activo && p.saldo > 0 ? 'Activo' : 'Pagado'}</span></td>
                                            <td>
                                                <div style={{display:'flex', gap:'4px'}}>
                                                    <button className="btn btn-sm" onClick={() => editarPrestamo(p)} title="Editar" disabled={!esAdmin}><Icons.Edit /></button>
                                                    <button className="btn btn-sm btn-danger" onClick={() => eliminarPrestamo(p)} title="Eliminar" disabled={!esAdmin}><Icons.Trash /></button>
                                                </div>
                                            </td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                )}
            </div>
        </div>
    );

    const renderLicencias = () => (
        <div className="card">
            <div className="card-header"><span className="card-title"><Icons.Calendar /> Licencias y Permisos</span><button className="btn btn-info" onClick={() => openModal('licencia')}><Icons.Plus /> Nueva</button></div>
            <div className="card-body">
                <div className="alert alert-info"><Icons.Info /><span><strong>Licencias RD:</strong> Maternidad (14 semanas), Paternidad (2 días), Vacaciones (14 días mín. después de 1 año), Duelo (3 días), Matrimonio (5 días).</span></div>
                {licencias.length === 0 ? <div className="empty"><Icons.Calendar /><h3>Sin licencias registradas</h3></div> : (
                    <div className="table-wrap">
                        <table>
                            <thead><tr><th>Empleado</th><th>Tipo</th><th>Inicio</th><th>Fin</th><th>Con Pago</th><th>Notas</th><th>Estado</th></tr></thead>
                            <tbody>
                                {licencias.map(l => {
                                    const emp = empleados.find(e => e.id === l.empleadoId);
                                    const activa = new Date(l.fechaFin) >= new Date();
                                    return (
                                        <tr key={l.id}>
                                            <td><div className="emp-cell"><div className="emp-avatar">{emp ? getInitials(emp.nombre) : '?'}</div><div className="emp-name">{emp?.nombre || 'N/A'}</div></div></td>
                                            <td><span className="badge badge-info">{l.tipo}</span></td>
                                            <td>{formatDate(l.fechaInicio)}</td>
                                            <td>{formatDate(l.fechaFin)}</td>
                                            <td>{l.conPago ? <span className="badge badge-success">Sí</span> : <span className="badge badge-danger">No</span>}</td>
                                            <td style={{fontSize:'10px'}}>{l.notas || '-'}</td>
                                            <td><span className={`badge ${activa ? 'badge-warning' : 'badge-secondary'}`}>{activa ? 'Activa' : 'Finalizada'}</span></td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                )}
            </div>
        </div>
    );

    // Estados para filtros del historial
    const [historialFiltro, setHistorialFiltro] = useState({ año: 'TODOS', departamento: 'TODOS' });
    
    // Generar código único de nómina (formato: YYYYMMQQ o YYYYMM)
    const generarCodigoNomina = (periodo) => {
        const año = periodo.año.toString();
        const mes = periodo.mes.toString().padStart(2, '0');
        const quincena = periodo.tipo === 'quincenal' ? periodo.quincena.toString() : '0';
        return `${año}${mes}${quincena}`;
    };
    
    // Calcular fechas del período
    const getFechasPeriodo = (periodo) => {
        const año = periodo.año;
        const mes = periodo.mes;
        const ultimoDia = new Date(año, mes, 0).getDate();
        
        if (periodo.tipo === 'quincenal') {
            if (periodo.quincena === 1) {
                return { inicio: `01/${mes.toString().padStart(2,'0')}/${año}`, fin: `15/${mes.toString().padStart(2,'0')}/${año}` };
            } else {
                return { inicio: `16/${mes.toString().padStart(2,'0')}/${año}`, fin: `${ultimoDia}/${mes.toString().padStart(2,'0')}/${año}` };
            }
        } else {
            return { inicio: `01/${mes.toString().padStart(2,'0')}/${año}`, fin: `${ultimoDia}/${mes.toString().padStart(2,'0')}/${año}` };
        }
    };
    
    // Filtrar nóminas del historial
    const nominasFiltradas = useMemo(() => {
        return nominas.filter(n => {
            const matchAño = historialFiltro.año === 'TODOS' || n.periodo.año.toString() === historialFiltro.año;
            return matchAño;
        }).sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
    }, [nominas, historialFiltro]);
    
    const renderHistorial = () => (
        <div className="card">
            <div className="card-header">
                <span className="card-title"><Icons.Clock /> Historial de Nóminas</span>
                <div style={{display:'flex', gap:'8px', alignItems:'center'}}>
                    <select className="form-control sm" style={{width:'100px'}} value={historialFiltro.año} onChange={e => setHistorialFiltro(f => ({...f, año: e.target.value}))}>
                        <option value="TODOS">Todos</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                        <option value="2026">2026</option>
                    </select>
                    <span style={{fontSize:'10px', color:'var(--text-muted)'}}>{nominasFiltradas.length} nóminas</span>
                </div>
            </div>
            <div className="card-body">
                {nominasFiltradas.length === 0 ? (
                    <div className="empty"><Icons.Clock /><h3>Sin historial</h3><p>Las nóminas guardadas aparecerán aquí</p></div>
                ) : (
                    <div className="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Fecha Inicial</th>
                                    <th>Fecha Final</th>
                                    <th>Tipo</th>
                                    <th>Empleados</th>
                                    <th>Total Bruto</th>
                                    <th>Total Ded.</th>
                                    <th>Total Neto</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {nominasFiltradas.map(n => {
                                    const codigo = n.codigo || generarCodigoNomina(n.periodo);
                                    const fechas = getFechasPeriodo(n.periodo);
                                    const totalBruto = n.detalles.reduce((s,d) => s + d.totalIng, 0);
                                    const totalDed = n.detalles.reduce((s,d) => s + d.totalDed, 0);
                                    const totalNeto = n.detalles.reduce((s,d) => s + d.neto, 0);
                                    const esProcesada = n.estado === 'procesada' || n.estado === 'guardada';
                                    const esAnulada = n.estado === 'anulada';
                                    return (
                                        <tr key={n.id} style={esAnulada ? {opacity: 0.6, textDecoration: 'line-through'} : {}}>
                                            <td><span className="badge badge-info" style={{fontFamily:'JetBrains Mono', fontSize:'10px'}}>{codigo}</span></td>
                                            <td style={{fontFamily:'JetBrains Mono', fontSize:'10px'}}>{fechas.inicio}</td>
                                            <td style={{fontFamily:'JetBrains Mono', fontSize:'10px'}}>{fechas.fin}</td>
                                            <td><span className={`badge ${n.periodo.tipo === 'quincenal' ? 'badge-purple' : 'badge-info'}`} style={{fontSize:'9px'}}>{n.periodo.tipo === 'quincenal' ? `Q${n.periodo.quincena}` : 'Mensual'}</span></td>
                                            <td style={{textAlign:'center'}}>{n.detalles.length}</td>
                                            <td className="money">RD$ {formatMoney(totalBruto)}</td>
                                            <td className="money neg">RD$ {formatMoney(totalDed)}</td>
                                            <td className="money pos" style={{fontWeight:700}}>RD$ {formatMoney(totalNeto)}</td>
                                            <td>
                                                <span className={`badge ${esProcesada ? 'badge-success' : esAnulada ? 'badge-danger' : 'badge-warning'}`}>
                                                    {esProcesada ? 'Procesada' : esAnulada ? 'Anulada' : 'Borrador'}
                                                </span>
                                            </td>
                                            <td>
                                                <div className="btn-group">
                                                    <button className="btn btn-xs btn-secondary" title="Ver detalle" onClick={() => { setCurrentNomina(n); setView('nomina'); }}><Icons.Eye /></button>
                                                    {n.estado === 'borrador' && (
                                                        <>
                                                            <button className="btn btn-xs btn-primary" title="Continuar editando" onClick={() => cargarBorrador(n)}><Icons.Edit /></button>
                                                            <button className="btn btn-xs btn-danger" title="Eliminar borrador" onClick={() => { if(window.confirm('¿Eliminar este borrador?')) setNominas(p => p.filter(x => x.id !== n.id)); }}><Icons.Trash /></button>
                                                        </>
                                                    )}
                                                    {esProcesada && (
                                                        <>
                                                            <button className="btn btn-xs btn-purple" title="Volantes" onClick={() => { setCurrentNomina(n); setSelectedVolante(null); openModal('volantes'); }}><Icons.Receipt /></button>
                                                            <button className="btn btn-xs btn-info" title="Imprimir" onClick={() => { setCurrentNomina(n); setTimeout(imprimirNomina, 100); }}><Icons.Printer /></button>
                                                            <button className="btn btn-xs btn-warning" title="Editar" onClick={() => editarNomina(n)}><Icons.Edit /></button>
                                                            <button className="btn btn-xs btn-danger" title="Anular" onClick={() => anularNomina(n)}><Icons.X /></button>
                                                        </>
                                                    )}
                                                    {esAnulada && (
                                                        <span style={{fontSize:'9px', color:'var(--text-muted)', marginLeft:'4px'}} title={n.motivoAnulacion}>Anulada</span>
                                                    )}
                                                </div>
                                            </td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                        {/* Resumen */}
                        <div style={{marginTop:'16px', padding:'12px', background:'var(--bg-main)', borderRadius:'8px'}}>
                            <div style={{display:'grid', gridTemplateColumns:'repeat(4, 1fr)', gap:'16px', textAlign:'center'}}>
                                <div><div style={{fontSize:'10px', color:'var(--text-secondary)', marginBottom:'4px'}}>NÓMINAS</div><div style={{fontSize:'18px', fontWeight:'700'}}>{nominasFiltradas.length}</div></div>
                                <div><div style={{fontSize:'10px', color:'var(--text-secondary)', marginBottom:'4px'}}>TOTAL BRUTO</div><div style={{fontSize:'14px', fontWeight:'700', fontFamily:'JetBrains Mono'}}>RD$ {formatMoney(nominasFiltradas.reduce((s,n) => s + n.detalles.reduce((ss,d) => ss + d.totalIng, 0), 0))}</div></div>
                                <div><div style={{fontSize:'10px', color:'var(--text-secondary)', marginBottom:'4px'}}>TOTAL DEDUCCIONES</div><div style={{fontSize:'14px', fontWeight:'700', fontFamily:'JetBrains Mono', color:'var(--danger)'}}>RD$ {formatMoney(nominasFiltradas.reduce((s,n) => s + n.detalles.reduce((ss,d) => ss + d.totalDed, 0), 0))}</div></div>
                                <div><div style={{fontSize:'10px', color:'var(--text-secondary)', marginBottom:'4px'}}>TOTAL NETO PAGADO</div><div style={{fontSize:'14px', fontWeight:'700', fontFamily:'JetBrains Mono', color:'var(--success)'}}>RD$ {formatMoney(nominasFiltradas.reduce((s,n) => s + n.detalles.reduce((ss,d) => ss + d.neto, 0), 0))}</div></div>
                            </div>
                        </div>
                    </div>
                )}
            </div>
        </div>
    );

    // Funciones para gestión de catálogos
    const agregarItemCatalogo = () => {
        if (!nuevoItem.trim()) return toast('Ingrese un valor', 'error');
        const lista = catalogos[catalogoActivo];
        if (lista.includes(nuevoItem.trim().toUpperCase()) || lista.includes(nuevoItem.trim())) {
            return toast('Este valor ya existe', 'error');
        }
        setCatalogos(prev => ({
            ...prev,
            [catalogoActivo]: [...prev[catalogoActivo], catalogoActivo === 'departamentos' ? nuevoItem.trim().toUpperCase() : nuevoItem.trim()]
        }));
        setNuevoItem('');
        toast('Agregado correctamente', 'success');
    };
    
    const eliminarItemCatalogo = (item) => {
        if (!window.confirm(`¿Eliminar "${item}"?`)) return;
        setCatalogos(prev => ({
            ...prev,
            [catalogoActivo]: prev[catalogoActivo].filter(i => i !== item)
        }));
        toast('Eliminado correctamente', 'success');
    };
    
    const editarItemCatalogo = (itemOriginal, itemNuevo) => {
        if (!itemNuevo.trim()) return;
        setCatalogos(prev => ({
            ...prev,
            [catalogoActivo]: prev[catalogoActivo].map(i => i === itemOriginal ? (catalogoActivo === 'departamentos' ? itemNuevo.trim().toUpperCase() : itemNuevo.trim()) : i)
        }));
        setEditandoItem(null);
        toast('Actualizado correctamente', 'success');
    };
    
    const catalogoInfo = {
        departamentos: { titulo: 'Departamentos', icono: <Icons.Users />, descripcion: 'Áreas o departamentos de la institución' },
        bancos: { titulo: 'Bancos', icono: <Icons.CreditCard />, descripcion: 'Entidades bancarias para pagos' },
        tiposContrato: { titulo: 'Tipos de Contrato', icono: <Icons.FileText />, descripcion: 'Modalidades de contratación laboral' },
        tiposLicencia: { titulo: 'Tipos de Licencia', icono: <Icons.Calendar />, descripcion: 'Tipos de permisos y licencias' },
        tiposRemuneracion: { titulo: 'Tipos de Remuneración', icono: <Icons.Dollar />, descripcion: 'Formas de pago según TSS' },
        cargos: { titulo: 'Cargos', icono: <Icons.Award />, descripcion: 'Posiciones o cargos laborales' }
    };

    const renderMantenimiento = () => (
        <div style={{display:'grid', gridTemplateColumns:'280px 1fr', gap:'16px'}}>
            {/* Panel lateral de catálogos */}
            <div className="card">
                <div className="card-header"><span className="card-title"><Icons.Database /> Catálogos</span></div>
                <div className="card-body" style={{padding:'8px'}}>
                    {Object.entries(catalogoInfo).map(([key, info]) => (
                        <div 
                            key={key}
                            className={`nav-item ${catalogoActivo === key ? 'active' : ''}`}
                            style={{margin:'2px 0', background: catalogoActivo === key ? 'var(--primary-light)' : 'transparent', color: catalogoActivo === key ? 'white' : 'var(--text-primary)', borderRadius:'6px', cursor:'pointer'}}
                            onClick={() => { setCatalogoActivo(key); setNuevoItem(''); setEditandoItem(null); }}
                        >
                            {info.icono}
                            <div>
                                <div style={{fontWeight:600, fontSize:'11px'}}>{info.titulo}</div>
                                <div style={{fontSize:'9px', opacity:0.7}}>{catalogos[key].length} items</div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
            
            {/* Panel de edición */}
            <div className="card">
                <div className="card-header">
                    <span className="card-title">{catalogoInfo[catalogoActivo].icono} {catalogoInfo[catalogoActivo].titulo}</span>
                    <span style={{fontSize:'10px', color:'var(--text-muted)'}}>{catalogoInfo[catalogoActivo].descripcion}</span>
                </div>
                <div className="card-body">
                    {/* Formulario agregar */}
                    <div style={{display:'flex', gap:'8px', marginBottom:'16px'}}>
                        <input 
                            className="form-control" 
                            placeholder={`Nuevo ${catalogoInfo[catalogoActivo].titulo.slice(0,-1).toLowerCase()}...`}
                            value={nuevoItem}
                            onChange={e => setNuevoItem(e.target.value)}
                            onKeyPress={e => e.key === 'Enter' && agregarItemCatalogo()}
                        />
                        <button className="btn btn-primary" onClick={agregarItemCatalogo}><Icons.Plus /> Agregar</button>
                    </div>
                    
                    {/* Lista de items */}
                    <div className="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th style={{width:'40px'}}>#</th>
                                    <th>Nombre</th>
                                    <th style={{width:'100px'}}>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {catalogos[catalogoActivo].map((item, idx) => (
                                    <tr key={idx}>
                                        <td style={{textAlign:'center', color:'var(--text-muted)'}}>{idx + 1}</td>
                                        <td>
                                            {editandoItem === item ? (
                                                <input 
                                                    className="form-control sm"
                                                    defaultValue={item}
                                                    autoFocus
                                                    onBlur={e => editarItemCatalogo(item, e.target.value)}
                                                    onKeyPress={e => e.key === 'Enter' && editarItemCatalogo(item, e.target.value)}
                                                />
                                            ) : (
                                                <span style={{fontWeight:500}}>{item}</span>
                                            )}
                                        </td>
                                        <td>
                                            <div className="actions">
                                                <button className="action-btn" title="Editar" onClick={() => setEditandoItem(item)}><Icons.Edit /></button>
                                                <button className="action-btn danger" title="Eliminar" onClick={() => eliminarItemCatalogo(item)}><Icons.Trash /></button>
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    
                    {catalogos[catalogoActivo].length === 0 && (
                        <div className="empty">
                            <Icons.AlertCircle />
                            <h3>Sin registros</h3>
                            <p>Agregue nuevos items usando el formulario de arriba</p>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );

    const renderConfig = () => (
        <div style={{display:'grid', gridTemplateColumns:'1fr 1fr', gap:'16px'}}>
            <div className="card">
                <div className="card-header"><span className="card-title"><Icons.Settings /> Tasas TSS</span></div>
                <div className="card-body">
                    <div className="config-section">
                        <div className="config-title">Aportes del Empleado</div>
                        <div className="config-row"><span>AFP</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" step="0.01" value={config.tss.afpEmpleado} onChange={e => setConfig(c => ({...c, tss: {...c.tss, afpEmpleado: +e.target.value}}))} />%</div></div>
                        <div className="config-row"><span>SFS</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" step="0.01" value={config.tss.sfsEmpleado} onChange={e => setConfig(c => ({...c, tss: {...c.tss, sfsEmpleado: +e.target.value}}))} />%</div></div>
                    </div>
                    <div className="config-section">
                        <div className="config-title">Aportes del Empleador</div>
                        <div className="config-row"><span>AFP</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" step="0.01" value={config.tss.afpEmpleador} onChange={e => setConfig(c => ({...c, tss: {...c.tss, afpEmpleador: +e.target.value}}))} />%</div></div>
                        <div className="config-row"><span>SFS</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" step="0.01" value={config.tss.sfsEmpleador} onChange={e => setConfig(c => ({...c, tss: {...c.tss, sfsEmpleador: +e.target.value}}))} />%</div></div>
                        <div className="config-row"><span>INFOTEP</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" step="0.01" value={config.tss.infotep} onChange={e => setConfig(c => ({...c, tss: {...c.tss, infotep: +e.target.value}}))} />%</div></div>
                        <div className="config-row"><span>Riesgo Laboral</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" step="0.01" value={config.tss.riesgoLaboral} onChange={e => setConfig(c => ({...c, tss: {...c.tss, riesgoLaboral: +e.target.value}}))} />%</div></div>
                    </div>
                    <div className="config-section">
                        <div className="config-title">Topes Cotizables</div>
                        <div className="config-row"><span>Tope AFP</span><input className="config-input" style={{width:'100px'}} type="number" value={config.tss.topeAfp} onChange={e => setConfig(c => ({...c, tss: {...c.tss, topeAfp: +e.target.value}}))} /></div>
                        <div className="config-row"><span>Tope SFS</span><input className="config-input" style={{width:'100px'}} type="number" value={config.tss.topeSfs} onChange={e => setConfig(c => ({...c, tss: {...c.tss, topeSfs: +e.target.value}}))} /></div>
                    </div>
                    <div className="config-section">
                        <div className="config-title">PDSS - Plan de Servicios de Salud</div>
                        <div className="config-row"><span>Per Cápita Adicional</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}>RD$ <input className="config-input" style={{width:'80px'}} type="number" value={config.tss.pdssPerCapita} onChange={e => setConfig(c => ({...c, tss: {...c.tss, pdssPerCapita: +e.target.value}}))} />/mes</div></div>
                        <div style={{fontSize:'10px', color:'var(--text-muted)', marginTop:'4px'}}>Monto mensual por cada dependiente adicional inscrito en el SFS del empleado</div>
                    </div>
                </div>
            </div>
            <div className="card">
                <div className="card-header"><span className="card-title"><Icons.FileText /> Parámetros Generales</span></div>
                <div className="card-body">
                    <div className="config-section">
                        <div className="config-title">Cálculos</div>
                        <div className="config-row"><span>Días laborables/mes</span><input className="config-input" type="number" step="0.01" value={config.general.diasMes} onChange={e => setConfig(c => ({...c, general: {...c.general, diasMes: +e.target.value}}))} /></div>
                        <div className="config-row"><span>Salario mínimo</span><input className="config-input" style={{width:'90px'}} type="number" value={config.general.salarioMinimo} onChange={e => setConfig(c => ({...c, general: {...c.general, salarioMinimo: +e.target.value}}))} /></div>
                        <div className="config-row"><span>Días vacaciones (mín)</span><input className="config-input" type="number" value={config.general.vacacionesDias} onChange={e => setConfig(c => ({...c, general: {...c.general, vacacionesDias: +e.target.value}}))} /></div>
                    </div>
                    <div className="config-section">
                        <div className="config-title">Horas Extras</div>
                        <div className="config-row"><span>Horas 9-44 semanal</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" value={config.general.horasExtra35} onChange={e => setConfig(c => ({...c, general: {...c.general, horasExtra35: +e.target.value}}))} />%</div></div>
                        <div className="config-row"><span>+44, feriados, domingos</span><div style={{display:'flex',alignItems:'center',gap:'4px'}}><input className="config-input" type="number" value={config.general.horasExtra100} onChange={e => setConfig(c => ({...c, general: {...c.general, horasExtra100: +e.target.value}}))} />%</div></div>
                    </div>
                    <div className="config-section">
                        <div className="config-title">Empresa</div>
                        <div style={{marginBottom:'8px'}}><label className="form-label">Nombre</label><input className="form-control sm" value={config.empresa.nombre} onChange={e => setConfig(c => ({...c, empresa: {...c.empresa, nombre: e.target.value}}))} /></div>
                        <div style={{marginBottom:'8px'}}><label className="form-label">RNC</label><input className="form-control sm" value={config.empresa.rnc} onChange={e => setConfig(c => ({...c, empresa: {...c.empresa, rnc: e.target.value}}))} /></div>
                        <div><label className="form-label">Dirección</label><input className="form-control sm" value={config.empresa.direccion} onChange={e => setConfig(c => ({...c, empresa: {...c.empresa, direccion: e.target.value}}))} /></div>
                    </div>
                    <button className="btn btn-primary" style={{width:'100%',marginTop:'12px'}} onClick={() => toast('Configuración guardada', 'success')}><Icons.Save /> Guardar Configuración</button>
                    <button className="btn btn-warning" style={{width:'100%',marginTop:'8px'}} onClick={forzarActualizacionEmpleados}><Icons.Refresh /> Actualizar Empleados desde Plantilla</button>
                    <button className="btn btn-danger" style={{width:'100%',marginTop:'8px'}} onClick={restaurarDatosPorDefecto}><Icons.Trash /> Restaurar TODO por Defecto</button>
                </div>
            </div>
        </div>
    );

    const renderContent = () => {
        switch(view) {
            case 'dashboard': return renderDashboard();
            case 'empleados': return renderEmpleados();
            case 'nomina': return renderNomina();
            case 'prestamos': return renderPrestamos();
            case 'licencias': return renderLicencias();
            case 'historial': return renderHistorial();
            case 'mantenimiento': return renderMantenimiento();
            case 'config': return renderConfig();
            case 'usuarios': return <GestionUsuariosPanel toast={toast} usuarioActual={usuarioActual} />;
            case 'auditoria': return <HistorialAuditoriaPanel toast={toast} />;
            case 'exportacion': return <ExportacionTSSPanel empleados={empleados} nominas={nominas} config={config} toast={toast} />;
            default: return renderDashboard();
        }
    };

    return (
        <div className="app">
            {/* Pantalla de Login Educativo */}
            {!usuarioActual && !paso2FA ? (
                <div className="login-container-edu">
                    {/* Panel Izquierdo - Login */}
                    <div className="login-panel-edu">
                        <div className="logo-container-edu">
                            <img 
                                src="data:image/png;base64,UklGRjo9AQBXRUJQVlA4WAoAAAAwAAAA/wQAlwQASUNDUMgBAAAAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADZBTFBI8VAAAAEkh5Gkhs0dT/9Ng7GTCiJiAqrKrzF5FSQxsqrcnRxVnuPEuZi4A6ioLdvegGtQgTA3RQVxZaDiZBxRmvmAE7CqBFGF7Yyocc12rySdvpZ/W75sW3IkSbIt77/2KjCGX4lxBmpCAhsiKsK89yYiJmJS/4gIibKthJHEPhaCTiZGQMyk+wN827YkSZIkSf//a/YX/iW+iIWZCBDgDgBIpIsiQqJku3Xb3IAFCdFOBeJFWvEHyIJt23SlpG3b1pdt27Zt27Zt27Zt27bdfXdVn71zb53zqlYjyYsIB24jKZIXj++Gjrr3ARQkSVIkSfv/vzAzMzPTUN8nZnqlqjIj3D28qudkKSIk2rYSttJNGPuSTBfIBdG2fgDtgG7jSNLkn8ueYUxEe+9WFQk8QKra/owICm4jSZIkmy50zZ5msnDPrOrueYAr0P/p9R+v/3j9x+s/Xv/x+o/Xf7z+4/Ufr/94/cfrP17/8fqP13+8/uP1H6//eP3H6z9e//H6j9d/vP7j9R8v4Xj9x6Pk+L0soaqOg5/hcQC/eFbF5Sih1hwwfuPyE6pGjfKtJS5q1AdQBIZTZDX4XL4YgR9hoG1JCcDPNaROfeTh8uPr5xkqOk8zlHSeZSiipxlqZj3KUCV8jKHwLpJU9fW04tMJhSxJVb+PbD+ZgEMrf9X3e+n5A3Qrh1JK09T5pWcPUFNqKUlTgUvPne/dMkzlWQhdem4wS1Sz9UQRP7J8ugCu9iw/yinT0zMEyJIee8BLmeXsaQPy2aqZfDlb1tPjZECWcTNF0edEx5QHERZ21MeH3FnDxfEzCHUz4+/jyvW3Q8PPEekDA9aW/AmqcPx/F4rVhf/p2THq4wdXAXRtiMWvP0p69CCPYHFWgD52cElMCF26/+LdZQ+YLl3TynABFVfie/sb77W3v70+H4Rd/yS6fALS6cKdJNJKFK3g8bxy0127vHUC7QIVo2RqnBoUocZ34j/DNsjQVsT5PSehv8NFCfo1AXrbBTlSt9FIV+5CTCxOt4KFZWLtDjHq3JhaFcavII1vux5tpET1DgnSXJocFu/l8UCTGK0hN5AS4HaTKtEG3MhXhpqsVxOAcwXHr0DBU0IXEI2iSDN/CQqRE2wBrCTnil9rYgL1MFES/sqvNDFCBwB/5ReamKEBCI6R8OtMDKEG4qVEE8DP/GUmphAOlyK1IIpqrfp1JsbQDZciteKKVtNfiwLnBjHwqA7VSbqioMU0/bUAxseZzYVsELluufH3DWO3DPcA7wC5QnhU+n8/fzb+9z/9/rlbuLnJPBRc+XvtdcD+CG4U7kI0A+vpSaqpdregkOBu4Wj4ar6NSxj6iegGw69VLAjuDwhy1nVfxwtmTGtt3NHaYQC8x0FQ585PTsxIO3fHmAxZYYD/R6Ijo0HbAG9D6lmIonAK/dkRZHRuDc7VkvMgX4DAqSyNewCEV41mRy/xWPjOABWs4jhXhopsBybpmUIjWcL7YszUKlikc7WNE4BKWmBh8QlfKiRReFdwJk71se4bqVE0n0vkPhEWhDwe7VaA50c1UqNoAQRyKwjtcg+eI5bcmhluVogdBA5SNjixf5JhIIwA7G5cyYooKp2oM1L155F3xEw+QpG0slTWGIE0mVZEUWGhysq9waaNR0SphwlQE2EaqVG0AJTcGJTsv1SbyIg0YRBYppspGLkpKP2BcHurEkTVs+LUgkD2nxREV6di4f4JN7JyN8xpd0eAcmF5IoOS0IJTi4MyQWrb1CiKw8u/Ia2TNeZnwdkDNTATJqAdaVKjaD6Ytpj1tUaVGtWJTJqGXABJdXMFLpufwcUIG2rFgLahvBBnKOSoAjekRbAwXlhEQlN8zCtnrW0lgr66kAOKK2bAawv5Aa/B1mBwKpXDIivJwAFYQ2uSWKuCRa2EDvOSKwWTxSOnTl5dFmSY2McOl1k7a6piAwWeP+2EXNB17OhU2puRjASOlmSrCjts8VdfC8mxlzXhbEucP5MkhyW81AWpKOGJjl8qmJMM8ovm1rg4Rsqk1MlhBS+EhVoPYwUHnrHdcGmUC2htjao2wLCnyaJaEge7T3Bz1xEE7NXEpNrdmngih+dPOyEUkN/0jiRB0lVUJwT/n/Hk2MJaTZ6Q5s+syK5NRUUBXyCpWaC7NbyUqQWwp3MEfR0PAjlHCJqErWMjI3nHSNQyVQBLGpcgUx029G34tsJob6s4mPFnU0WggpnuQmBEACn7HMOr2lJJGvhFIDrV5S9jatoDQXBkxUqj6G8rEc2HMBjVkfX/zYlxxBxhZaWiaF/N608mmOn6N/7ftQJBpss+xwjFUi1BKIbko201iL+UkIa+VQ40A4FPivPYSCQtGIIUoHO1eTX5U9FENzeUisdHgh8l6G/NpJ7JnzQT3eRYissr0LB/bE4LCN1mURyQw0KQ0Llrqkn8D4/0mDH6lfMCgqKggTIFs6FLjQSFPOONZRvJCtnj6MjZhphDsGOPI6sc0kSptqJJjgplXTfr1hHNDQiHi8mxqIXPDe7hQcZ753M6JqS1JQ1H4bhEClGuG31Dj2Ua9+YlyZSPdbSDY+U4cBLp96543VFpTeOQ09Y0ultx6tLo+gdSquag85H0lVtxrB4b6/38q2aTtfG44f0nVuMBlkwdMAxQ6bjA9Q+kVLUtdAJWvBKBjdeoWX+l/ztvegPSWnVYjCPhUFgN+U/qUQ5Gqlud+pmFrJQaRFu5HOr7eCrNd7gGVFNYSTSrE3GtvxE2vBOtbr0aZqwTg8Lk7yVu92EpNqLRj8NEaAuhHiTJaq6x5CQW0ijxZuw901JsBAHraDIocSLogY0wcZIcMla6T+TWkmiNCg+KywPa6/z4ZY8YOc4tCc7nr8C62pRC+TdcKZGZQJpXDrdsEVV+iAZkQRL1TY0tKZR/CxIFGGrzYmQJbSI8k4pB0bpN+XzGucKyS0M8UAnBKlNtpRDqELF+EwNddYx31ZMb4a1LNr1Y7sl05IxiFdXLyY4dsiCRsX6DjcDzH0PmaDXjJamdMBLTmMED1UueKFFBcq5QJvOmJu9Me1gluRFbtbtLE6FAFSyzkLcoC3VpQiIL0WjB+AhgCnDTymvsh5veYSOGIcMVC+aCL0ZqhrG/qVtcF80aL6ug1pVt2hdEIHNRMAgZJlDYLOFH1qKXetXSU/QFo3rUjhJlUoAwoKLgFulknJhCVYhURpHsYw3Icb1cYWrKDs3a9IxyQZxwJhdcE0U1aWQijEXnUlFhascBFRKGeExQoXsEDF3anN+gYhNw5QvD58tKQqv6x7yycJ1tJIZCyqw2VAS4AbRhWBoDrbkj8svCvCy+X3SRdg1JqeAVRXcK5lwZw+WddUKzIs6BOEdgl96+IOhDbj0cdGdgzSVqglZBO6Lch3UFbuFtNhrUImKTD4WALdeoafZPdrH6tfnmDBZRoHW1PrLqg8rJJ+QkKHkMytdanGh3cOJybcQmOMiJkcjrNlxeIiYc9RzWIZgVt3vIYpfDpzMHgszrBAy4wgs0MeXYRbIuwWw4+ocsdjlWePMP9dVXMwJRV2N8B/GaqVfoWL/Y9g9r1naiMPTTC3/+XnkNXWqp/Dd3GTpBEpuNtpJ4ZlM5Ny4CGOuuwZ5Gzv3UX1jgS3kDkfgRty6rwSIERFqlHZWb/9v7O8yb3RI2oBZjqgxxBaIyLrlGehppuH+0D4XxJgjN5R3GijrByxuITDjWWxN5mtF7ofSQukkKVnndntaDEA2RUogqp+Duar64chndhvrLqrt6IjGeuykPUXm5fGREZfVX1yvtF4wHkw58ei8aF+3Fiusng+WSNE/Fx75s9kHZyjusNZnxmfC7SOKZEF3VJXUIHWN3RdhL57OVh/GBFT+vzIiCLtETch1ZDhSNQRRkUuMGea2pNOPLaEESRMXTk9uGZWHIRdlGYuJBXuR4V8Je7MW9UR/lb9HVk9uBVRtg4TDIMBv32kgYMjwMlq8XZyTvntwxbLAPU8TFViIaM8f8/Rl4ciNoUnYhzHA8K98fhGKOBHcnIObjMMLCTytIGPXaUhgy1cLem9lS3hVW8G0GfRBSQzAL2CNK9gcW0obJ66M54FI+IV8RJj1HwgxHkGwQojB5TN+XaJicpyAeqh8RlUCFw9+hXRL+DEXjSFZsSlg4NQDHFFDACrQNXcixxC3gyQixPErek1iYXZUAOqg+AqkcjgUsq22VM1uyYvV9x0suEHCf3nqrc1BDgAOWi4ytUgy7CTxfQFQYMAG171b3oAQaGbC2ZT4t8GAjnlwkSlyV0QoYatI++rEZBB6ubZwiXUkVyXqyqMMZlIozDpvOAYRF5QEGxKYpNwO4ktqx4lgVAtjyvt9sBUfDQ4PvDFY0Gratu1IThMIXU5dGSRlowAq/0/TlyVHAjQCPEEjbuO7PHx+34a6k+lPNxKPVdGyqWgFf2X5LnCNBXOtM28Cm0T9qH6TyedOWbsBbHJgM4CxVntqOPwbSGNkrPTN7k+DruzA5uSfBlCpb/hRcqLDHtniu9puP7fv7/2q354gdXicYv/kf5XuHh9K+6Uf0AmuNVIsHzFnEeN7pob5MlI/3AeuV42JtAuK8XA3m/Btwv7sEgysTJTqGrQuCZgDxXFuCRhGKStAXaQYqwZgfPsRcTrVCt5EANfd/ETyg+Y1TFiGOO3xTP4poF5Y8D3fSa8w097aJe7Lw8xvahdndUAtAvCMGdhtSeAmwbiJfGLLlTx1NjGYTqlcGOwbIo+ZZH6Zi7BCh+Sswk/ewrOwqEPb59D/99NNPnAMOF1m5EPs559y7r+BeDb+UY7OCgyWFxjjC9nQgDncHcw9ca4EXrwmfHimiLKkmFUbYLqDc/pr9cDja6HBuvf9GxiMPeJOj4cgwwHaD+Duuhm8fOhKgtQ++eAZ16JvRa4sOI8S8UbxAs14pHQCstYFxlkJtkqS6CFBidu82dKDj9OGBao1gBLwZMjqqAZi3eUa5PbppA6NXKK8fWsybwTjxSgNFz1rj3JoX+HH32UreE8otzRnlSnEBoMfUGoLoAtH64YdGjgwZadKzutfI2oIw8eCuMJ5vQdi5v/gMFsYN40BQrvgSrQuyMm50Is2wXewNTp74XLXuUQhSsh02i93BkUf2j0KQkC2xVczBZZ9OI8L1bVn1YvdWUUD0Hwl5l/9zCdon+49i8E6RGi7W7CYle95K9KCp6PgHd3tN5UAnVv69nvZA70kffLk2Kqw6AKSp+8gDC+ra/UQDipqtD04O+HZ9Zy84ploErffWoT2PLxGMqCZB4x3rzo5f9yy4oHjaVPzbBGSfvjt2IKdXCXAnoJVEhdETC745A9c5DaadhT9T27X44dHpx6G0tfhXq+I/+LE5oxc7epbULWguM0wixpM2frnjOIIq0y++2EX809/r180FlGhmCwXigp9MZOVnhO0i/u5MtFXz6LVobK/D/kJ2n0TFF8XPLdY+4s9+8HTGDvsNllKess+tNTOYrcT/f2cA9rMn/WWckynbpf7dxI96z8Pd+PnlCz2mzCgi7ye+1gva2mA/NHF3w4/buRjzBqTUn34SgX78/KUeDLeZ0ZHUR9w02MqvPb8/4WySnID2QT1g7jTjgKJxocNNWU7emtgE7Q/oOZrNeKNgXOztlrqaZA0KyD0Qcb6OUy4uH4zr/byJz6SAIRJA12u4HwrH5YawkJzswMOg17oxH/8NxgUHXUYyTSEg8br2SshufyGRyksN9V+SwS24CdSO2GVWNkdaSauhUKg5Swzu8XS4TmcSpWd6B+4aX/Q60yg6y07r+Ac6nQVUc9aeVoj3pdioSYX3o9iw6bhsV07Usb9wC9n+nwStLb1yrSkGXi5cbAqCFwtXm6LgtcKbio4+g1/uIzzgf9tHFzYE/w8bSV55YxEvLn9Db8Bvowy8V7n2zJzObeg8BmNSRO4cUOmWzMDFOx+nLa3mUzSKx10D6HzyHy1cX3hbKjMjJIrFxNeR9AamfU27Vq0N3ZaYcimc9NB86ZTxKz4K0sbAuM1H0z604diREyMWQC5bqb9+H7SP8B6gRT8tninh2ZEHBGHqkg/REEDaKn9aPFOCzKX2vYLzbsKZZRcMMKYEbkjmxtDcDxhYdsEAk0cp7MgY3pn66EupEYW8hajzYqXUFpZU6gI+WXDNlxNUGOvjiWUjukNYElMqtcQ9cDwy98nnkdgF/PSTNfvpv4ndvy2JL5Uant4tcxddbwj43buffjqaIvLEshXdAfIoZyq1M0bkHcHl8sSG4bMTJ9pmdC+1JGl2hH8CziWT3/u1MbieVq4fH6A01jZFKbQk0XbkkcmrLiOGmdINhk3KVkvNcM88/dJB6yGURGO0JCg7WigPT16/ktIPZk0qtotR09AEHnYNI9YiUguiKbCk8xBc0VkBs7ZSCVE+dYV5k4LNYtQiPlVDugWrOlCroRFZErIhRWf2smsFZTY9evkBcFqSrWJUHaAWQ7vGatUUDktiMKSVca2gzaVugN1aEWwp8tFUD62OBrn32IceviURGRJxU9gK1UeVSgdGMyhy997WB3C9uMZHE10UJCak3mjbWqolKTCk6m+q0TCftosl5InUBjrNnz0eaZdzpcJHsyU4grRO16RplkRpSHh488DFEqo0OjE6ADvwjrdOW4WP5krQBEmO2oAelyXV78BzMinfVT5vV+s/kyTqBNyt6UJVy/IU2NiX56juX6XVktIMiazRF15Q9gz+bT9/rFTgJokuiizojhDTkgQYElcrt80tXEuUPAm+wLOQ15JUGBLGu/nggkq/8CxRdES7FEe1JOW0JCWGBCRlU2e1O1Fpcz3I6KkJGZakhJYkxpBIWrltVNL0ALuwgOixaaI9LWHdBBkSQ9sJuRokxThBnfZMW7UkTYZE8Lxhtc/IZczFYN1HdQUPR1IeS/JjSMfZdovdwCdIF3vk5dOyTgw1EkuSZkjITVC5klxNcgSXSFiPbNI6hqYxWJI6Q8L9rbapu6C8FKyGNYVhpCPS1Twq0JBg320vbL6wkEEKrpxeNSWV8YpuQJvAVmpeCg77TwhoHRd6tKQ1gmx7YVsKUtK/xkqlGW2lQFdjSGsa0v5WhXbwztiOb+HygEUNUtgc0aImyZCWlKT/j02bW2FDrvBQHKCQ92s9sX7qp+fSklCIZlHurjufV/NUzLG7yCWKdFUteVoUJwo34uSKdxLyvXK0xwe/HKbYTzvQlqTKlAVCG2d7XtHNaIz1UzfR7KcdaEuGZI+2znY3asCNj1Y1Sldo6fPhkNxyfW2+YJS8hJP7tpxHxR2mIBD8WzW2enaS07CXAhRHfFKXdD9tSROpNQwCK5ENss2MLOh/PGqUhkSZDCbCKO0Y6+Ev7YgzeUyDzL0EAAGBKLeZJe4vCkJgRkWu0AL+MjaKxyyxlgRBM5ZJ5kGW7Cu/jvK0bNIE7tIKSiNj2aUxe7BJLMd1X/bnNWOc2IHNQBzs1DrRHNMoECPYTssg7ivJ2qEFbteS20m5BklmtO+Z7qyTDIu09DHPph5YMTaEIo/F1I6fUHWA7OjeNV3ZQyeNNkYVO2lGB/zkzkH8BB2viGveNz1zoAsb/bgReEO7ijbR+P5L5IWHTIMQLMmOIc3vI5sU3zm3DSxTUUPWDTGUtybix0/tN/eadGGjr7YIUGZTW9vwYzwSnzeUMCnTodIlP09QrUsfNvI8OAoo0eFw55Z4iSocoYxTq1XO5B8+bGSlyqCozJ276iiNxSdb0cclghnHVzqJz0AP4ATJMwNTblUankLfbLXJBF+j1vTtK5O6szHMnYcV9aB72jRm/OKwTZdHdeaZvGnbmkq9SW31eLMokDtzRlPqL7rOZSyTEV0bNqQoNri/Cqkza7ThTLONt0TFo1ZzqcaeWkPabhYhEmfeaMbxRd/CzOobOMk0MUWbySvQfQ1hwzQxciYRZjSrKYnhZBct56XtF/XGkqAbG8Gm0OpxcmJGgLpRL5GzrkiJBiWv1HotYzmLfxuk6UU1/hPtyZnBAE9ZDeEzIKxEatKQvNtmmhHnfOiXsYs1BJZ8JmdUvUCJ1KUhebc50eoCdSfi3JxFCop+jTaf+vVtu71oY6xlDYeSgU2U2mSmZKEC22l97UASPOhvpSX/ueOf4vD/0ekoTCL1mWEcd7I+dwG+d8vOJieX2ahVctTsG5L5t21R5OHcyRtjsFOU+tyRYt8m8Q9bt0FDahMdiZXJnqdm3j9/Y0E7gagZONwORokM9iQAc6hWiiHJUzP5TNG0fx3ghZ3ZYl7aOcLTLZuADXK6MtulzcXTxiL0csG5Sq1l2bSvvCuQXltgSJbSa/9aGH3bNnKRAqJquGuGTaBqFWZI0JnGTvrrXxN4Zp8izHCdUi4Zt9k3+eWoqcZOeu1fj15Cwmz1kCDKBpH4MQA2y8yKHfavilEJsbSJUs8MQeLNACYzTTY2V/0rBvh7ZCLaTNcp1RK3BsOJFCrd2Eh//YvYS8gu12y7aanEswGE+86kFuyufx17qdimSGmTmw4s7g0QluQ7kxrYPGllMgp7xZEfJzXupiW9IEqyOmPNODP4z8u5a2qcUWvdTfN7RB3p3UxoIS3WeQFBSOpqpAWm9vLuptnHjWSd5CWT0hG+VqG0xlHFObT9cdNfCWEne1mn9QoqO2wsMQaZQ9sfN/3usXasZK4raciPCt6gpldlkNIQXhSlkqTMHROZ7Up67Ug1jKNXtK+imUdrn633aqJl8KfuHixk+qKEKo4bK2h0lQov9c8We0XvF7+P++n0ilymL4oodX4hYSvpXtoAttTLf23WvfM/iiwN6oW0AKJkTtJ8g9HM/9ncUzeH5ilXSfbSxrjpERhzr1Uo4NIkNEoX0qqJhPkVc4/BQNt2i6/tUmP7duzFBWj74qafmFhwreLS06BThAtpCUQNQfXGfTM1rMA6crpFnfNv2+KmRzhMk1yqAeltER+RpZwSiBpCipSnhX986am3otIk95StePRS3OzziYS5EoRLsoGKMk4RRBGhvPf1bzj5Knt0nqQu+kpbvPQIcetumhsE6wRWqb4MC2mG+qsoskku6ykUN7S7RyZK+i1m3baBXbbk+dDTkRtUh4V0Wf91FKgOa3oZY1uTKLmnZtx2hH2iH9t89ZgLsZAmLEDN7zv/fKS6l2qvr981mZK9aCvLXtoSNz0iX9J86A6f9FkqnzgNioW9dI3v1pJMKTilgoROuOlZy5nP3uE2EpUQZfT1hHVdL2c8W8tSJf+UbbvmpZ1w05OYl9Hj6LBgFtLMV9LAEtRR0X74oiWNx2tVqpRcnGHrHNFYlhPv4Duy/H+lKiykaGtQ1HtyEij5zjJZqhRdtJVmeOl3gI0loRSpkA5aa2WwkmquKi7aYsClc1muVF20laiXNsNN/1pCj67DAUw1CaykUG5F1lYDrpQjmyoLLzq3AZh30+vA+glz6z3yDnSfctpI0G+riqZZf3/ef/7aajJFeZGVdoyR0tDiDOb0IA3gJBxJb11x1VYkeJQugvrkBGvcF6wnKB2/I6eFFMuxeKQeoPwdVJCfhLgNy/bdNDGcyVJQVo4kdmM10BZlolC7Ftq3wPUHG9tnydMkCpNwJLDKgqWtSwjJOnujSfqLjgh4aVMQyE7KamRoIS3HIUXzA9EyVafuDjaVnGD6drvjf5glFUZJORJYaUHSvJis8R3FNBt8CknfbncawFIrOQmzsiS0oyWC5klI5rI+/cFitRpn1KBCGbbcONkSBJZGXJkMOVJBDvGbK2GMf4mEya6rFX9+M6RkB4YJ07QR4kgVOYRvzoRgznbj48ePn0w70qzfSQR+ubcb4GM5I5vipkllnJZZGRLc5gq5KRPq/R/7jqIPdNuWdXvSPHn6PFAezKz0pypbHdYv7RjZDwTWRV+lXKSFFBlKy/BqT4WOYRfeFj24K/hc5dO6kWeGM5JuIJSW5FFaCync6RIwl2mXC1YpekF0NtaBaFG5lWi8DSr38sX65/qxIyGb4KYLQUyhqrJyJLzygqMxCQi9ZsGAVd+3dary91y/bvL+eBTDO01g8RpOW67IjvCOlwhkTPllULCJ4sDae7/OdV5TH67Y3WnGP4FFEa2sHBZSxPoCnfNPEcVCLco77/nzNaI08+FK/Z2u8HAEE50tslhJAc+X0Bvz7I1LWSaga+G5dPMKaJ7CdDy03okWcAr1VRrBAYVG522RqNKdTm3YZegK40LfUR6+dFNNCJoTT94MazY5AK6dqQ/fNwa0B68eE9MBOy7nXztZ/WFh6hCOXPjYsxGe1B66tGtttURTYYByQd6gDx0Abg1GLlf0xUED+Uht2qjJckoAllVZyxh0QxfVLDwMxK0BEgPIpJE/yU6qmcdg3JhmgEpHGDVTosQMPAa3l/pJCzHLwslBhYncMmZKRNVocC40bIQsC6y+xBVMVSDZG88K+M5pI2KJpoL41PU6wIHnNH8MT5oeDlzctWgb8cqGAush8EBkC23ScgB87cGiOQQjWK6pziCYqBllRgsiWaRLeCN14SaAl2DlhKpBPFyacCzAY/X10I5YqPJSQxeXnEhlSN01W1zCb/gVJ9dwz6ORygsrLfmQKx84SCXiezMWjV9tggg7gcpNGqk4iXmFi4VHcyhHrE5Tn0ggUXDSsjak6o/bekc3is0FgG5pp0xzkEmK4VmckKYrWmj9++tlG4ktBSkLqaQWrsUKD9+4gg6679/ZZDC1STUkSp2ul4ADQpbI83TInpsKlko0U8X0oxINJNClqlUoZtxbLBj6ITPFCkZpoRMlzSXTlZoUJGYRtiMVmqMeOMwiGJ8GwJS4WUqpBKcKUZqipWLGXyxr7eF8HAxPtlghiCPYfKaxrlYmZRK+M1m9D98IRSdjGaWuBGeYzwQpSiA1M8VFTu3lhLPg5C2l1IFIYs2nvHXVcj2bdJ4ErsNLoAfeYpO1nNI+9LfFJ5ym4VWj9IR6XqjA1cBdaJoAY3AzNIanl48pTWRbtan1hK1skXAXmcxllbaCyC4f4ppIrlv0nnjDC2vAANs8Vpi5Y12E3xhCfH6mJR2vHMUnj7+1r0afdLRUghPANw/pfwKMwc3w9ppMbvngg4Hh008/+0xYlB2zvHp0/9afZG0RKNAHbiextBnPtEEaPvzoo48/lqajk/NDtwQdMBiVhpBZKNyM9MMGbTX2bvm4q4Rmwx/rAhArLX+cH7r34DJgsShzpNu2AJC54wxwUQs6YLEms6TcyLAHgCy0nHGC6L4FKwMmz+QmMCRxM8w444qzwC01qIDRiDSAyTRuhijyxHnglhpEwOaO1CPrAUDrrOy5+xM23W9AkgGfn0g4mtwDBDIsJRN+H0FYBTQXnb8MiYDNesxnfW3ZyAIWBsqcWNPB8SJwnVEai1bDkc2h4z3GpeJlBZkBJ9Pr7HUI2Bmlseh0OzqBIc8uC5ccWJNSTjYhAVarMaPDBgCY1m5lWY3qD19jFyMyMhuMfA67ANA3MLcmZjzUhQRT9LoZNTZsCKBLrMVbodfjzKVIAczWYs0fsjkZNFla0zMeuBQJgN1Q1PshnZNhk5E1SaV9KWouQpGo9UM+J4OvsCy0LJVnJb07cQJTVGzF3EYit1nG7iFzxMfgOyvXCJak1AalK9of917NrHss8BeJLEMt2e6Na5EE+C3EzA7dg6S+0vXP2tC6Fpl+8NBv1ulwlo0onaQj6Z+44fW3WBs6jNFeHTZ9MJVXtCX/pvGf+6zEz39BizEaPofr9gVyF6Mtry4JZmKpw+k4jZGMRMdlWNMv0B4xUZZX98pqqf/8bsW863y4Viblr26KRDQT+56a06ybo9WUc12JPA3gOAi1PdXQPGG2LUBEoucizDnrdsm9NR3HDe8zd8HENqcI3wYXClGJzBv74oLxgtszrM/cGkPTIch0+HF+ZW8MTZdgrncZxsc7YzhcXGbZ3QHTrjhtGL+yEy5sPvm+sjeGGxx9arYrsFlr2+V4t2DW1bbv8d64YHorNtscG+Kb48KoYXu8O4aj/rTd9nh3DD1vQIedYvfHcLLoQordHkPPsL3FcD3eD0PANR0XI763GJ7HG4RZxmQt7OkAz3uqLTIcNLYHt+2OmxubhM0Z+2Ns2x8HDcN8WyCQn6eKgHk55rtieB2ITMPhQ3gd4BuFzRTX2dUy3yjMXQHWBhjm9wErAyX8MKlTxJCRbynRLMIbgJB0jXRlc5BZp5zHpG3kK3vjMGKnE0a/SLP7lBEjYdktzQNGtrJfxISRrewYMU4AfpWw7JcfMQrPdpUaE7JdfoPREGR6nOxLZK8GAdQlnpGsbBIRMVibQ9PIiyssjVrscJFr9dA4YrRI1dYnIkQuYdGmAI9K1dYoImK1NoOQY56q7RUiHCNV2T4YK1KtG3rFFLJcjzCcULNaTjHZLSJiup7AlicmFZ2pbCCTxzLM7jhX7iCTo2EBKFPuF1OM3MJjnZ3mE6M+gsMLbjcTj0TLhZYxxUzYn5fODyh3jQiSmz1augQtpDnaGgchKzaYWPwepWRp66Q+ZhpUpng7SQEXmiS5lfoYiUIpE+hICe6Tqm0yuDN1wnWH9jSdXJC0FGwEIZ0wU2iDjtRRbG4vY6KpyYSqGWT3mljv9InBRgzCD33x3O71FvpQB1HMSU00QjhEUr6EoqUOPDQLsqBsFjlFSAexMQ/lDm3x/ACZXxdsIRxoO0FgS2hD/YyJxgtPXHK7c6oSGkqqV+WFeWEKGqTU58XAV81K6Fd4koDEC4I1whJXIaU+rdTJQrMTnjSOLawZmXpJqg8+aKrBnkX6AXi3kwIkXh58pqX0CF1YcDz6yGTIftX/SnijeclLSKz649xKlFC90ERSvTviz9mIxOSPc8inTxfZPDUmM7nj9KPYxfsYJHqItT9sTf2VNTWhWFSYGUmnTwd1ki4lXjLh7rQTYDdcgXSqhvaRptr44qBQ9cbHwHsl06d/bLqnsXklL0GvKLJ1KZl73T0su0clldRCVbGgTEEYc+nT453mGYX5fJm8VjFTgkmnJ5faoU1kaAeqWqrIJ/mYVHdTXJ4/MunTOTbVPerbBXQVmimOutvSFR2L+sYmusd9uYryYZXPTcS5Si1cUbKoRaSJdmpcGpHu1SxlUaOpysLUNJ0EK4+2qksVo1mUnq0sSoj+YKUeR6YPLoHob7unLGpkbGRkF16Ke2T2MNirWc2ix6SRc7Y6g+qbBA3TSXGP2z3aLDzKsyiUd+yXrQREu3RS3OMenlmVarq52Z2nlfWjW2xie3zK0NRqOgk3hUimb/m/qldssj9qDkfPpKizwodVlQrESWCPhd59qE+r2KRKEqqlPPVjpcqSubSAfi5igu7rvP+Q6JTfpVOSGCbki3i091zIFN0Xjj7ppFkSDJsIFVsKMlf7z9VMY1h2ny6xiZTkhIcjZhkgQtXJVrSzacl9usSmWBKMmBV71hWBMnNcZlbWtLpZgFbRHrHJk+QFhZKwtRgU6Q2k1nqubUJDf5g6mZo/ksweVOCKyuRpQ7zALdbUilywL84MBYWhayGCv2qWPt9YbVx17hmOSJBZCKHRY+UMt8ygp64W7XEGcZSzDayvbUHj4hlJiHpqZ/QRbZMyRdEKESO0h3xchawuoA68Ii25tmgDm/jwEt0fgxRwaOPq5mMhKCJ1yAWpJ06gOSOrpHBoRI9hS2a4h51W7amQ6A2WJ1p8AE4tCVUUo9w8tR/6yLZGkU+XrOyKpRKPmsA68ErdESblxiiRxaofnuJ2sYx3e1j9tsoY20LB4UTKMwZgKAsAqC1xWEWACQ8u37rBJN0SpesMkxb5G1cOBEmqt7VXGf1gU18zA8Yzr39oZVIPk6m2Qh/teVh+1tBIVMoB3Lsu31Uh0Q8s3oswyW0vwKdhSFYhJVctKEk/hparORLy9rIxl14cbFw5PjXadxkyQQuqwwxsjHEB1rW0wJOq1y86wdaU0tnT583YVMITtNoB0h/CclE7s1Fs66JCIG0VSllZBFwFpYf0a0N9kLtbsteivnyCJf0s2lUL2seN8Vk4R6cTLsnqI1Xz6G+/Obb5MFI/MxZ5wa08mgfTVQ/Ax9lLf4hTIluJ9I5sV3MJu/23Kc8hTEQq0bS1xlaspdFn/21mkghquDNROBMA0QFvNn913H2bnY/QgSMeq/DZDZXGIV9NJ/S22O9iKomAiVZI/lHSNt7kZs9hSJPQxCsUbO2miWQZRd/g38HVQQLJW0DhS8HCd8wWpbYedk5cmpVLZsBWMQpS0JIKwKnLfGmTQwhV8cxBg1C23X1cGVvHqukRsOKFxH7ICu3YFRqbOufbYpsNY/mEgqBljCXRhOyHjydlmnjzdp6APQsnZj1T1WeZheFw3yF01GLu8yT8Dha4PEEjYkJ0ba/7OMuznTtRPQCvY8QiazKmnDLt5u8TdXhhZIrdM1lo2uY+7mzMn17x7xWaSW7GUpnlV4tM+nf5UywBoJnkZiSyBKNxl8lYaiQ+kOk5omaHnEOzu0zGUSThA5tKchFDUMoxIHvAHaZXk8pFv9H5lo1fz3CAN6UbbDJpXDaLa7IxnzlF1OxyT4qv3Xm22ObCp37pxvwi/ICUJSbcjNbX0Hc5L+Ul6BkKy9uQgit4wO9gVcVcYwkMvRzLU4x3klcdU401MPA9faaYrszsB+y4tzhfzEj1HFEzdETPFbOV2X3CSNMYujzEjUTpBudknzi0m2dgYT+dwPUhrCy5zVnuJ/BrUI4TDej9uZhO2AgJGs0zLk9m2ARvKEBjBslYSsTAjUI7apqHNcHuGTnGUvIMrGxLTY53E661jXhz8yAVk2cAK/dNjVHPudR3tU0wVhMxACPQpsLyWYrvfIN3a94mFLBOhJMlGaZmRbYTqXON6+NwkRIviqctJiqzXUK4I0wHBQuV3rKPcxpdC1mR95LbGUUSmh7mavc5y4Mq8zbk/szB17Ai0MNc1V7eaxU7GJgJQZVPvo8FmFkkWqbPQGqfWottIfx/6OT8WJHI0QbePg2yNcCDHI3pGiLUPL8Zvq5+fnPaYD32RX6GhB+cYCpGV3J8c7pgPB1gbigQnGSp2YvswH5lYM2U7UBEETcDug5OutTsIuVMcM82R8sB2UV6PRamZge2PlQtw+Ihu2nEAjg91qFmYEHwUqcPbk43zKYJIh+juV5VIWpGlplKLNemV2Ci2waAnaTLY2Vq1lLQXDtBw5vUCwdyeSyN2dbozp3XgagZKbMZDuRgZvk8srp2NPbXXrApyYIZsxsOtOLj2uLR1tYNGlKL2Us/HMjdsRg1I3fZLmFP7fiqI9bSkqUwzmy08amyfjQrs+xXMKrndMRYerIWqz6uKyAtbf0QDajFbKUnDmQ6isDC6lEzcpetknVPaE+2mqiycJlSQyJ32SbDzOsQa/B2UrWr9EUKmYVtXKdYTTCTkPt0ZkXshhBYWpFpRl+Xj8uTt0CWzI8sfqRKLRvIztC+lOlTixuSqWUuuZTGXyXWMq1Jkd1ZFaPrD6ytTi1ra/LuePNUGrpC9qaAyEDmxlKxrTs0KFl7/CcDyg2m+IQg/jonh25PeuzQylhQZHGFMmGFOqQN3d4wDmGGsbh2RYubWU7qbC0qaebR6rE50KUYB8ditaxLzy2iGbUWMQfHYrUsnYrJzOmUXfSIyXPZdZCSq2WNbTynWq0yiyZtoPI4TqopgUsDuFMGO4oGe0WTRKkcS7KqYBpms7PbMTah2WdqE9l1lFKsZd42nK1do/YEzVqkXI4FdSVdl47Gu/uVERslMj2WXGYPrwpz2GbREBrsD60SCef4OkyJDhacnMrxVsesoVvM8Fi0likeywZvE+0GuHJLdsGBFVZdZhO2ofh413Jhu0RWUnaZzciWUfsb7AntEmVFRH6FuWeHXN0Hzh0Taa42sMTCy2zc1jPWew6vgz0TmUjpwQKUbaPWN8gL2rZiNiR0d4L8gxbsyu30ptH6xiyOlRso5rGNEOzSy4k+WQC27TSRugnNHYUDHlqXATu1asCM2ZBsEZQ6ShXvIXefQ2vcuj0U8xxZZN0M9NidQOcOgJu1cB6kbCqgxwKX7e1Lfu1auUncGJEP0aMHYl5/HfEo2NyNpNGxboZljQpiArKCTd5gyqykaoZ7bPVNJVz4SjZ7g5gxIh/sUcW4n4CsYeXDQNocy2ZYxqgiWt2gWS/aBF6mzEyKZqjHlhG157JN4TOFaoq2yDr7oJvH1rBP8c9QNpxSk7JiLiZZhLpsIUWVJbTiVW4Wz2CxOhbNQJctJcpuKx0dU2Z1rJqhS3YlTWW3FXitu/YvL1uWmot2nexAsBJutUiptO05wErlUOFaP+BdwnctSKaoJ0pua/jYTaSodxqo50LX9LEVUbm3gfWc5q6Pt4aotBzjPR/bYeVEsbnlY/VqxHy3mH3qSsHW87H89I34bj3F81+ZO7V8bECRsxxRxHwAdr38luraej6uv5GzH1pNjrVS7geZ31JYW9PH1deOBBqoTQhTeCkd9+ZHgqayzNrlT7Ksye1/gXGxjy5t0ahSSR2tg1U0cQNIDXJaiAR//pa3IV8ZEloc1H+uAVGhsLyUWsQv1kJahIZSzFraoiV46ukpls33+81EK+sA7F614erMzlJeSkBnEqiiRa6URoMLw6G6zMJr/+w9LXahOlllKzEh6BUsoqVuSlIPMjDD/pBc+zP2Ci1judo3YCyNtwgt4l9ajIO/uMwdz9ETfZVK4AQft6m2NHcvzU7X+nuGxkKwo7cDl2gQlFkayqpqC7cVG4OrKCy3Z2zcGgZIqriWXi6QYGkSLrldFoE2L2vUfCD/99TNdSB9GkRAn2hNXfoYBnraXs8tdoMtkUhGhefTSALqRIt3SYoTIXcyW2CyZ39CqB6egNrS8LKIEicCC0kLSxfOkLzNoBCph1jYEFsafI1mJKMYe2zvq94HpsAf9kFq8p3f5bFQscGrkLyGUGK0w0+o1k7f/FebU+ARaUubhNADj1eclgbqvdw1hAZl3rKt5RpcwusUSZNRqi/N4eMV00YDnpi3UAqUOflZS0OO1y+29bj4D9R+l4ZByJNo8Ym3hMA2Wp3Fjw++6aZ45CydssrExNMhsTQGogW4LjULtDMfjObAs0iZnLI6KVeHydKgyxfaLRS4LhUe6i8H8jlwjoSpN+y7J6xTVkdTMFIXgtclPZ0+XTCi02RMXhmClCNoOTA0VsDrkl3NvLogtma6F41Avz1KITo4mCWQLup2rEggBBDp/qRZ1CwJqVB/ovULxw44D4QQIl1p9kJBRiIWtgz4Rkv5qOfBBswR+ZJZll+QUwtxIUJt5ycNPd5RfKNlfNT1YCeREEVsLaWfR+gU5pbT/Ct8/VTacV+H3zjg5o4Sw3kWDBgJe0vZjV+IaWg8K5z5Wf49BTu4o8RwPtpBJPQQZTYRJB3rTzLBP7o2IrzUOd0joYkosckg5VhcULrrcsn7aK/5Idh+Z2cprwkh4VhaUFFXC2IwgqAUMRSSJbtvld4kvL1sLC+oqgBVo9HQ9FZYssvymmRhVk1NjeuqY9BVCeCp9E6XWGgkyml6CMvOiBY4ZUWlu3BtcD/YSyw0EqU0ReQCl1tv2uQcb51EGU0TScb6kpptwm8v6Pq4yAKuM+Ckq0y4udNHMdBKtM7lU8KxAhGQ7jj+dyo6EOHhVCvRehNGcs0sLSraP4tkA+qsPUtxD5JGIGBSU+yOfTYJwFvLUryAEEf6x36VmwWLSyCPtI99z8cNg/D5kUCSDufzcbsgfnyukJQiuKqee90oWFoAH7RUWhPD/TD14tO9w729FH16QqZLFBsZk36uEWCczEhJbi3Fm9CaoBZMy3t9xxHm4+6B1E2RSBCmNWYkdLy5FOZa3ULylRDTccR2WmQkK0GWzpSDTaxfVNoYMYJkpF0DvyymfLn7Iom4zGu5UT7He0yXYUGvZ5SBSjOXxp0bRXigEE7uMF1WRYpLA4FXrML/YI9pCyZ3nCQHALnj8lE03mG6jAqaz4bE4q14FCwyDt5fCmleM8nHoic7Kp0TF0nuMV1vCk0SmfdygasmC0rP2IjECZPhBw+xFU+1QbLo2cAr6HT6H+0zOAJx40EdFGSzfWjxT5Gi42gTh/RTsG2my9wFkVOGjz2hnqgywtW4fbhOXhCeOMSfoKqJmLcPt9UrBE8ZVzWRN5qVf3PD3W8CcKegPlqdah3thr5/mCKcmP4/NwwWTvdsG4bZOcAkv3dz2sGvFdbY0j8EmcGjTRqnMQFJQrqaWiLm/cNwCeui/86UjtO7Xk0mtscUBoPGmRljGawiNtv+9hUxltYYT3RGDhRpdDl52Ir86/KKP/gf7Hz99CwGDoxefDmJSEdMmriy6wYiDgaNEwtGCHoKlvOxopZuAhioZzFuIBiqiDJP1TJHuG6eN9Aa72nbY3UtDQTi0Z7FlPFrwfUBb201qVCNFuiwFJVCLehjBifHrhbUxBYnzPCgNHXoFiJMvrrZRPcWTQvvuJ3wv4QPGZB8Ndjge4vYu9jihBegTuafYg1yq2C1sbG1tPhFgNFOBllEutoZOQbKeG0h+ZiAqIJTPzF16YI22AaAiS7lMUImWFyZcJXUu4m3vqSrbxykZOs6vj1AHKSO+IgQ6+I9SsYTlQLaiyL+4NXeyDXH+M6FK8nfCm4vFFXYBkbn7GcxfVHUC6tqGRksM9djNzFhVS0jg2eyzM2C6vYHiBZ/9wz5DhUZ7MPXDq10HcUnW5mGJNbxYc1kFnXcZhth+qLP9qNmR+CcivDmv5Mbm+KP+2wiekGWdqe/3NGQOm4jwHhNiUzPCrzIVGw6gSFGEVHst4y3jMi44OKSqdLMNZhufYrwfknWVJQ/EzmDp+FyWg7zHRwaMPX77cxITu3XVWIhiO3Oz5IbW9rpJlrxdr9RWGBoXfq5jgimkH5LT9GUKHwZj3UE2EUVegfTjQ8fwCN2ZJyvJcPUhRcN6Y1iCO3z4borBt9lnvH1TEPAJrVnydc3SqB3mei2L1eXrejmwjgTBqMYu7obCXQ694gQYf0PKzj2TMFbblX4YrFv8tEuZ44NHXsjOiC80hjW8tY1W8m99cD3eDGCosyC928b6TTOAWgJfzUSXGSTCRxinAhfoPT34Q+f4HEETsEx896EsbdiyZnC9zq0v5I8MnjTNwkQFw5HQdbu+cJb/EEWmeYiiC+FG+fmBXKTH8Dg2Cs+I2BO3c8BAC1mQbiqL0gCWpqLt/eOiOCRlPc2iCAe0mj5tUvmtG0UQV683rqY9ywnTWc1IAUJ7HniOhZ5w7yluPTWtPRWawqyUbxTQfzBqLtkQ4TZBmYbqX4fWxoiXBL3YMhrk0ntAgqYXDbETCaT6mHa0BYujBe1tqUdbWHFW0yK8uLhcJFbi31Q1LjAM42Ucv10kZlcuuKt2OYyqRG99S1tqCTDYE17rRDLcVEHwLG49zl9qRDPaXkDwHGbt0canUuZsekr5yC5z8uUxlpYxq7UqMS4Grb5uaZZAv3jWNEC39kWoqxkE0Ck2ZcK0dRCqweszp41umOQlnX9iq/jBrcI48e7B5wrERo7hsVPlqKIDfuP8bFFVYekHSvOgaeK+6ZBTsbAlecAoISUldHy+AZB7ECuss/gIrrgPYPM3sF7UiCtNzQeEkgtDy3MdPVh012D3BKRXW4Ycd5imC2Sq8TmiyhiuMgtFalAmOroZsHwkVxZKaIDbnvUs+RqsZ+ZNwoAqrgVU3LJ6OfKjYa3jqAwfxy9cZBdNqJFSP+7b5BdOvq68uiDz/Fdg0tVVlIK6X4bHwCsuBTmo2G2EeeDdzsXpFdCep9rhBFbF3/j2xsAf3lXWYqzMQzCl47bgRBYPSmi83k1p1cLfa48/GByfPPgrMxSS0ku+c2D9EqzJy/ivBb8NEJI17t3cPlilr6lQB+8Gw3mwiIlhXg2dYg44lZBRM9bsKZ/5TGWC4Geie1/TIOFdLx//jGVYaBXQpbgS9PdQMNgEf3OsS09RtVCDxAMa1Ua3dkeoKGwaJ+IiD94/cBBRLdbtKVNDpzh+1uEw+q288VWrEBfCHALAIjV7cHf4/x3nbWQXreIVn7xzGQAxIq38b00RaTlVGoQccTdgXlTpHJo2ZT2OBoxZN35Xlsem9HdAkBiTy00hJHtfGMg+jTgJgAU8/NADMWyB9aOy+YyMukWBxaz80CMP2QcpWxxYDEz3skLoofh7gJoZVRBiQaBlSMzuYzhDgcYc+Kcf1okncn1txAZbIdDKqMKSl9gWPWA4XFZ3F0ANObDN7+zSAdg6lmnzQA4ZsM1v82AEWRj3xc4V3kwgGM2PJMOlJVQmh25AxGbDPCYiZ3ZrxLxEVi1Ow54zIxj0rySdSOYNdzfAGQWDubPlIi+6AG747K3NLa/IZAY1+LUEG5xyBRRbUnPk4gz5A23N2QyqhO5C0tgA9VzIIlse0MmMUWkSx1iI7BgVOaWybY3JIvIYiHVK7nMLZPtbqhkTBtSJiUet3gPQiQxnceFlHho0dKV3KEfnGm0cwCPV1z5UCMxxaOwFmlAZW31TPzRyny+eIFtPyBwDlM5tpBGDCGZOQNTpT8XCGSMvhGcBYnAWjFZWzZzBiI2GOgjttJgpfMR4L+SqghKZ1sbwkjQEnw6iRyns60NfcRXjK1Pz4Ly2c6GPGLbi6YInk0JUAVtbKgjuqO41EsORhoB0WegJQ6xsYFOOnvf+s+9dOlqO+MRo2OytRJ2C4CwXOErxPKnXprMxkqOEravAc8Et6oC1GTCqVHEtjXwSWhDmCoebGyNeGytivYYCIOOIFKu+UuTbrBBq+NRdBntNHDZAwEpfX+cAlSR+qJWx2JphU6xq6GFiMtuyKlkrmdHHZs/iGIUlz1QkD4p6tTr6aDBriwQi6VVkiFshS/egg5Bh8PKk0K/HfBvzepYLK2U7IDLyCcDDqEmqaRtB4mlAZPMp0xJvXww0EJcdYCqcxcKhcvxC0JPO/eGLQAekiOVZXcchqaGEXrauZtvA4h4C65DIGUfvDEYWjntaBAJhUi1PXlAYGj1tKFBJRTRk/foFb6hMZGopw2mA84dKJdQdo8tO4EbmpwTFMZCo12gDEx01sAmZO+pND55hnaQesznwWsya2DsEEt+bV+iENnQJBJ23b0pQPci6vlKO7jnLHqIz9F2A0iDymcC6Xy5HUw7U7p9QM07KUBNeL0CoTVwvo1YCW96kpZnYYjOzy69vDucdlPKthlg7pDtt4UL0PIsmuXA2srnjmD9LODlVGgUIzsMIe/wzJcvQNpm4BUJqJnyPCCipZ18Lwda8V6B7DCEvsMh8SBASbOQhoPY+3Y/UDeLePkEWmArwPtZGO9HMOgSG4K/BULwftDUidY7cT/I4Edc5bSncX8WJkIALHFz6fKjpm6Gu3nANBfIihascngcvFWM6CxEy9ka1LUzK/f00tvprNwMtwNiMCv+B3Jb2ioH8JY7w5jPQgRtLBHmXpi4ube7/xZx8EN3AJJlLJxDhT6iymHx72Yx22ch3/vKwtde2bfT3zJIweS8uB//X9qsvLZ0M9cWBh5x74NjDlXlUEgbRtbPQn7KqfLXeg7BVDK6jjuEoeRatjIFvR9m4ICWbJAT9FpG/s9CArVUtPyQYtZFSP1fKTM1YRIoQRTk6L2uEb5UdS0lL9xWofz9mpowV6qTF54nfIy3fdQcixjN1LNjwJOtAn/SpJ4ZiWv/5e7xScrxMFSZbipcPK2qHoHgJO0L3rF2LDv0bpuH5Nld3b7Is+zSSd3tQZUO3tztC3ls1CgrblZCMTMsBx92p4/HXIFQe0fG2N7u7r6PuD7hdinUPuCmPvbC7ev/z+s/Xv/x+o/Xf7z+4/Ufr/94/cfrP17/8fqP13+8/uP1H6//eO/E6z+Oag6Z8ovf95uacV/4URcHoD3cX7xTV2XultW949r4qTgUaNRbMNyO7StI+/+6cHUAysN976nrulhMkZFZYRGR9SSXd4LVYpD5FRyYbqJoL3knmCO8RVbh5+RAWsgrwVjhITKfpa5eCfoIl5GxpEFeCdoIx5D5KHVxYJ97o19emMP9/qopbEfmtJTXM4k7f1HBn5O3V1FhJTIdhLMurwQZhFnQanweu/heFu8EMYVR0LjzD5w3rll41/9dF4f/xvVC2Ai8FbziWnrvuctV/2PSfFfACe13D2y2yhj+bsFWuj1H0XEcLa7zQFc92qVUla66ffYO1V2NXz4lgZpcKtrfIHc2xXmuCGoFvNtvv60YI2cBTEXUjP7bjzBlJtXab0gyFnkmP5Sx0f0hD8ydfoKOODmDnVGOLGVdYaXIMLENbDSSd4X73LDP1XmqcXtAG+GvmBKqwnGSjCvnxHZ9IsVBLi048eLFixgANH4OPB2BsyVkDmhGYgiqWaIcZNEPy6LO0MWWq5f3h9ox1jLmFGYDvS13xNHD/URX7ErRzpFxYi9/lgPiWGql2CcKlWMDzgcpRCg8Uw2yaeNMjQOgnYf2UI1hCqjNXFRsEhHReM1wWoVe1AMhTsocRrOQO3g2sPbI8EbYco/kjJamBxsfizC3gmcEOQKuYVdMBWScGLGGOZJTVIPdWTEHsAFus8z4TBXIxo0jlQ+AEhlJMh9o1qwzpCXMV3DbrEQ0zzyAVNXgf+fcUAtjFwQ0043BkTBa4px45TG9HAJOYSCsTc5Ra41/AxmVdqbSsiUAzhmBfbLOBjamp8N29pxsoXGi+AB440wzY6MOQvnhBGga8wKc0kS01rSReYgT1ciog/EmCVR4NwgEzxDoDFawgYzW5oeKZacVGNEML3krPpeMXhhINsd4WxM9HUpUKi0lfrDQBpMT2Fbjx7LzAWg0DlQ8ABsVDdnpuvQnqgxjboNTn4j2uJ1RSu/bY8eOHesdT4IlWMeUYe05WT9OxsxAtWkpEKXymCYRQtv7IcOmCJ+DCxcvXT6IqiiJY7bj769fyjKaBIVJjkyYaRZK/EzLkpqrE3Y1aZeQkYb1kIOuputt20VzQATt5nm3hvvYTOOjk0Z20meQPWncKzwApkE3HXHINdsnUnTlObm/RyV0mccnHRJKkLYmNYbMVYyRKhkrIz0CbkXUalQN6RXDzdIjkZ6KBFv7ojcjZmrw6sKkx5WrUfoUOEac8eHjedBFfs7J0QxTTWE7IpVqYBqhXSW0FzJ5uVHEyL2LcGSIjxEn0VYJCkjWpzYsEAjDFrZvXH5YGZx54/q0qB48NIDxBdakqsoS3LuS2IuOV5aCqglzAJyBRHTdIb2MinSZqxZBZESGZTpHRB6NB3QxSmYAY7MXjqOY9KqMZ+cgnQgre/1Y7QElhDMta162q+0u7crSdnvLjaiU3FvjZueRZNterjVxkHXB1mmDPjE2T1cAEY0rbAi2OqG1xmXSTc1DU9k3V4asKU9wrsppjx1C1GKYAqoiOyjBRnAmENET/SAfjnkrylwVQAiPhFNnQhASELsS7AihvfXg2PIQPh/pdz2IYdYx6kHWj1SGqTH6sTYg1hWQMoaQqc0l5PeWuOnZro1tmhWhjOvcpRMvPxzAdnD3r+wImkNBG4+lMQiCZlUCezMkhQNimxRMeZnF4Cwgoo92ehriRzaGBhJmLj0Qm6eOyJXOuI6mH7zHUH6TAmOLmNpLrN8N6kQjA9dPi3i4gKhmCDCPJlWufzEyYG/zZ8Qfrp3tZVGYY45pnZE3x7eOrdw4MgehpVNSVHoF8/bCkMoIvB4hpWTPZDK4q6wjIiusHfiIKn1AyZOjLXHlVoGUplg4sRYAoBEgjx8xtpyp5zJbb/YxTMbm2j7J+tE8PaaKKN/l13ZlU1ExZGZEV1IlOu977cErjo3awE2t0Q6ms5kbNA5EG58s08obU7LcA2p1wSvYng5bVxbSFOJSIIVhqyGA2Hx4UkWbyqTWh6ePpJmrACxNW3VC1SSYh7AU9MccWye5sbcOFBDTn3zSPC3NRH7asN9KV94tmE+6uZQWMsiDuGYCQP56vbyprDzawcSxcuPLBsaWTQrujbrRzojjkhTOdQXDd9D2eBVCwhTsHuKj0hmc00o+7XKiN9PRZOpaAAlNWwymNqrJ4c/mXujzwbFlvXsO8drtjuoUxPT7cz4cK+QZpub0b55iteiu6lIPeusYN7y2NgeegU3+nq0J2zmEraJgy+PSf3s2/jw2F2hdwfgdND1e/RRIT5RG4NxQKhkUfBibV25u2A+XO6eVTxXkkfcAtIvHg2MLlCXQNVRsbtH7r4I6nwRhFEJ1dUCCGLh1LCkG3gAbrjyucULPYCskg7W9tmphSr4dkzi7fFOGxytI0dR1pTw4z5Smpl0ZzAEqNzF4riPUVWAF7QhhS5FV1/HWHBTk3c+dIog99GNd7StGXcULDkinb83kdzscWXlr7cRapuMIDfWm5IRssVjpRd+ncK8HSilOKjnB+ax0Ne1qPRRZZhlwQQo//W8hcCd6Tnvaj8nZbq291+3ikVPGrFW0zp6LcETBlNyk9B2EQypcDz2GlinJsQnPCnuYW/8dJVXDtVkjKFk9ka0uYLhbirkc79BYs4B5XtWjq2s0t3zzhtvGU+f8U8q+SkJD0mgc6timLIzkQa1VQSnBsUnDTGW0jX6IijfmjmEkmIjsja61w8h2hzDzrKtZVUnJnaMhdgz4K77+Czdo57lY7nrDpqTR+F0qjORBzSOi9+DCrvMzSzQCi4ubM0VfBbeRa4cDGe4BoLdf9tfrR3Av0r6LUT7mQsi7ytVeXOeAbwTy1c5pbWzvogekI1Nym8ohH1aqGk9Ej8Cpwv9RNaf9YfaRGSLjVD0YNxc84CTv4V4gz9giB2WZrt5AxTevBwz7tz690sYvVG0kdx9V9SOiq+A0Yw6a02ptDDadzQ4XZXBfw3oriVJohFHWR5G22Hsi0H44wcZvFsp4jdqpZwhOD+a8YXfnh5Fbs8SlWSPvwb0PuH4P5vHTSDPJn4A6PpxI4++jV8arVFsF1YEznLlj2D0/SIncbxo4fNF7E6KwAmyCYB7XW4KP7zR7e8VPPrc6jd8rGPKgSqpeCc505pVh9/1AExm5cmw0dK64D6H8PUxXam4t3pX4eshz0u5W4Q8vMjZfb5alH47jJ1Hxsb4QNRu/SzolPF4HlYmI5oCzjPlm2IO5Ifu/45XRUEMcR3CZQmmCiFW7uZmLanpYTsk4qi8Fv8buehng9S9OENo+1UdT2vgr+nWyKdcX/MHx2t6qiv369evB4Gzl1RTLmNbHD+zAMjm81xrqA/Mdpw2yXxdKoeLfopprGcC4J7N4XON9zo7a35M3v1dEfTqkvV/eQPvtgWz7g4vd1Xo0Jve7ttdOAWxy+LsZl163yNNtA+WtWtAS7RVjA4TtYGnQOABzB3DpWbtDs5We2v/oeNKqMyzyYjWmhGzC0dz90iG/TLrIFXNG2DxEcMoN0zpVr1q3VZY7sv5o+XwVwoO5oGf7NepWLytzHm9X/64sXFcHNd7RfA+phsPsu/G7BY7Xl0r3uVoBz2k7tEv4E7pU6Y6TWH+IgNfP20gFNebXqF2nFrFTH2Fdii4yNE7o9dKOg+xh44tbS2uf8v4Lxwum+CroNdfaDI7c52qBTysntK0b0G1zinZ7CR1YifTu5JyCZoT/ivh/aO++ts4Bny4w77xOfC9oxJfezRrZU01uufYJSM9N7XgVTuH/s35wffQLKAEPYudbwHOUXJ1AO5bJk2ZdpqzH3lZzi4PHAdYf1yEhyOpR8ruT32K1X7e3JUK57NtFW23ga9nOL7MkyusEftdKLWG7QOvm8YTwD53DzAphvrzn7wN7ojJ8ClHVdRfuWNc3HjRxxS/cY5wpbS5RJQ1kYqAdCe5v4feu2VklyvuDQB56HFmyOe7TAHFM9AUav5FxZPlWIsCXIb26muqE/SHG1lbhmgrszN0fNl6URtgR4vwvTVFQqO3smTzNg4ZNYKWigiv1Y514NRlX4wBLiRsiDEOYySEgKcP85D93yPfXkbYNlGX1fvv4L02fTODmB0ugWQPaumkiWyltPjBH9zE+ijRrim1mOqr4rMzsYeMtKZzTftx/cExgioaGitK5hExxGeFgBsPu6705gDGpzgAluvQMRlOjGP6uJdA5zNeMgrCItO3OXJD0QIIub9ROXVnA9R3Lifzwk64obW/439riMsDB0aLmXJbGzqNRU9yL7hXKpiRsnIv7WAcgvnnl+xSnsH0AXZHFUwQM28RqHlPnlCjcES/exEK642gilHpgR0RN3urhsf1ovmbeI+qiTr1bqbTGsQPTRuncbE7XaW6CkpRLIUr7e29x4Q0LSQobdHc1tNpkdnckuK0W7CNKyCIgRv5Rkww4/dOb18LlFaRYhTh7QF+kbmDYHVhHVJYBYXDmXrwTjauhej3fQ0049WJ2J0xGCsVp0wU9FLb9oT5H3Yb07u1Y+pxB50OBkuC9QqxH72gtID79wbgv2OYnJv4uLa5xRkQv6BCJg5aZ6+w8HXRZsWdFU3tiW3BPCJFlR2r6dcW5C15PMiAhqKcjCqmGCOD6HtuzpEHA9BOuOmtM5BGq2fu7+yXLvTiiY/XyqEjUA+Iw1KRlcqcXcE6v9NDY9sd+xN2GqHcnltY2QT4kKEWwnnqfMvd2/wTSyPYsK79i1WCFZ0gcIkkLBHmaq+68xwioUBOj8i+uG2q9LGxnxMiSI7WM2OS68aJ0QEBQm49DFlJQex+kjsCMFx7Zk+yaFLo7cuODMR3hCbUPlPbXpY0Owzs1SKgcx9OgYETtNE77/RZGKYY4rj///O3br6cHibsNUu/eveb3dtFrFIa4R7mn/zrtOEDrYDx/EF/NPhM7LHtEp98aMXtG5nVaA6et2JPWrVPaLWHrKT9TiuxiNu0q8nPF6cbLIgGe7u3yJh86JGNt+6CzdkrKCsw84b05UzhF9A5pBTBn0A7SfjCyAR5PcVBG6vcvmk1n9tO9mnIRIArbr7/uZTrogvVH/+L+/ftRBItmxAalZHmfJmwUXP38/2toZ+7NwHdFHY9hV7RLehwKTJy2Yv/UhXadO1MLW0/V8IYZblyda6jwAATDLU/e/gM24PEK+sCror1wEMfNHOXXClZwE0BNAV4l9uQ7y/VIoxUyk1EryyE9uaAHeIQRLFoSxNXdJsOigkyEBdkLLSNiEAW2DVrpNdo5CB1sTZ0KD23JC+4jFVR4AID9ZUWHZMdbxDBddxbKTIvdVxpkGo8SU0SdME7kvOuZkwYhQL8QoeFQpNAMnMglhgtqUwb9QYUY8eEU3j9k+quqbXdrMu7qFWsRiLKfINaw3fEGUBdpVrBVdSh8bGvYmQ5TpWO77TVGkuHwBh9OgNzZu08eXCMEoLw7z0UrJpdOKCcSYk1+7bWLLcrZGYBmWGYlplZErkjqvKfYgv4AQkyZHQqWfSeDB07K4/lap8lWbh3LZK+cglAF2wjKyetZJRPA1lXjSBGwsS3d8fYGBQKaaoS94vGylTkaAjSySVtjFh1IBGTEarUDwiSnX2sEFE9RMMnUSjsE4dFBM2yy/uitUqaIjGWIqSZtMkdmYrns8Snoo7HAKbGnOdNotc48U46t33jeS8uWSzUz+swpZGGveLxACkVDhv1jm4KMTCuncm+Y4Wm1nLvNzmB91Xr76+lpy2eB39hKO9OxSq+ekreGfH0br/8///zH6z9e//H6j9d/vP7j9R+v/3j9x+s/Xv/x+o/Xf7z+4/Ufr/94/cfrP17/8fqP13+8/uP1H6//eP3H6z9e/9FPvP7DBQBWUDggUuoAADBpBJ0BKgAFmAQ+USaQRiOiP6MkcTmT8AoJZW7+eHw3ClM2qoKifw+a5x8SAeGroDd3XSTxz/Rvwg/Qb+IerKGXhDx7+gH8A1lnFfIF6AfxD6INfb6z8m/o34c/oN/BvOx/r/wr/TP+Z+ar6lv9U/Cb9AP4Bt42zYcqt+TdHP+u/sX91/Sj9CP4R8poVv52/rv7N26cZ9+/uX94/yv+p/vf7TfL5W/6x/bP8V/iP7Z/8P858jP91/e/yE7vOlf97/of8p/1v698BvkH6N/lv7d/lP+x/ff////PvX/jP+n/kf9B/2vkp+i/9t/hf3u+gT+P/0T/Kf3H/G/93/I////7/Ut/3/9p7iv3F/6P+Z/z///+Qf9c/xf/h/xn+t////U+o3/S/+D/Rfvr8sv7b/rP/X/sv+7///oF/m/90/8/7h/+D5z/+d/+/+t8If+l/7v//9xb+xf7n/6euh/+P9V/wv///9/tm/qP+x/9X+g/f//7fZV/Pf8h/1/z//5v0Af//26f4B//+rv8l/q39r/yX6T/pF/f/rb8v/bP8r/hv1//UrzRfWv6j/AfuD+vf+b+3+/f2x/9nqh/NPwz/b/yHtq/s//P4Z/rP9p6Bf5l/XvCP2tVyPQL+B/x3/c9Gv8n/vemH75/wvYF/pP98/8vsJ/2vHG+7/9v2CP5f/l/+V/jfx4+Xj/p/2P+i/dj3Yfof+x/+X+x+Av+Z/270yP//7d/3P//vuV/sF/9f3DHtYvQvpx8C4TijRaQSxehfTj4FwnFGi0gli9C+nHwLhOKNFpBLF6F9OPgXCcUaLSCWL0L6cfAuE4o0WkEsXoX04+BcJxRotIJYvQvpx8C4TijRaQSxehfTj4FwnFGi0gli9C+nHwLhOKNFpBLF6F9OPgXCcUaLSCWL0L6cfAuE4o0WkEsXoX04+BcJxRotIJYvQvpx8C4TijRaQSxehfTj4FwnFGi0gli9C+nHwLhOKNFpBLF6F9OPgXCcUaLSCWL0L6cfAuE4o0WkEsXoX04+BcJxRotIJT67jOTke3er0slBTzKhgUHw7viJv7mnu1zMyVHOKNFpBLF6F9OPgXCcUaLSCWL0L6cfAuE4o0WkEsXoX04PsvJtdE+ysZ1ajwPnkEmMMbBLndPtrrhf0NaSbn04+BcJxRotIJYvQvpx8C4TijRaQSxehfTj4CcRLtACm1+UsfzJ9hEH5I/TaufH9SJ/JGn9jkdv0nxOkOgNug1djm/AUNYox51fAMtwXRX31ShOPgXCcUaLSCWL0L6cfAuE4o0WkEsXoX04T2st8RjNxhsvlIiD9yJaMlrxGF5HWCXrSJF5oDGD9PMuIqxigYQr2HgLjQfmlfqM9dTPoyG+0Uu+jnzhOKNFpBLF6F9OPgXCcUaLSCWL0L5DaO2B9SxItR6R3kv8It/IV9vYRWKLubaa372bSSCCr8YhEPng8Sg4Ikj0FLXdhqnZ9GWvo2t0VF+RcTSoitm8lHaYDN4o2hw7si+MGqG8mYMzSNFpBLF6F9OPgXCcUaLSCWL0L6cG5wTq2QW+kEFjKOrFWTPPSfpSR1gltvQpCbTF7pDpSqiiq3HxQkALU8PODwnappj4nCfxOao90PQxfDjXn95mSJwAo5D488dHEajkWLPPBGq0i9C+nHwLhOKNFpBLF6F9OPgXCODZS9pi4RRw3Q9S4IT/2NMMWVinuKwcxOtFyX0jzelEQypMF69RbMcQtAUoH2CUAUyp9Wi6Jyeq7FT1LTZFS/4KQd/jnu7ehlDOjI6bS0+6Ms8YK1xFhNAesC8gts6qQTOCaTWrfWOK5xeU/8DdQYPS1yiJShBrkMn76cfAuE4o0WkEsXoX04+Bb764E2qK04HyFpfZF7xcXJ/Kh9in5TKpbDkzpnFuqidQT6fmneq6X3bu3pVuQA6F9PCQGMrSGq+m7iLebZNIkxNBGtvO8d3pxduOID2AF/qVemhlZVv5v/FOA/NK2LhOKNFpBLF6F9OPgXCcQ1o0pKMqyORvyn7XCZj6pzRWI3YcJN3keLC36WMpOYaY7EGlvzbAekSq91/fz6oZF6F9OPgXCQ2+0dX4fvY4rMmHubUUZPZi4Ztngl/pcAwECbOuVYhCFx6LhPY4l1xcUgKtBcJxRotIJYvQvpx8C4Tbl4m2yF443LQro1DskqTmvDTKTa6HtzGhQ2ug0WkEsXoX04+BcJuSlnx5ZC4r/XxgdUPHfnGLi3IRTLZL2d0xpNcN9nk//MPcgUc7/wjVxRotIJYvQvpx8C4RwbK9cfJCGlT2ZXtdKZX6vuizosPWh9GLWlCFh0Oq5cT4dpbivkR8C4TijRaQSxehfTjuDD+B04xUi7S7JZPUYjdJcN21s3oYEePU9vcXDgsCKpPgGTpu0kgli9C+nHwLhOKNFhO5KGBpxSsrhS4Qvqm0nn7LDq0J3ZoSfJEstrDwbFRbL2HdZVxHwLhOKNFpBLF6F9OPgW/pij+Y70jQWOp2tTNrkfRzkMqbjkpJHJRHAuRehfTj4FwnFGiwPb2gU5eNNUQrJ/2sHY12GlIXsCpGI/Mep8hb0mkeSQSxehfTj4FwnFGi0gli9Bvw5wNoyiPIi2l07cKODX5uI2evW9P/F1VmGDtMXJE40eCSZ1A4LWN8dipkHLLBkXoX04+BcJxQyzSHnJce1SvJEHkw44oTHbdcJVmcG4C91bTy4GC2fWEvtGcyoWthN88bHgXIvQvpx8C4TijRYHt5X2oWoFhf9U5beVNdaejfho07YUkbzFHlxlfwLkhXxLP2eDJVpBLF6F9OPgWLrS7U1iE6votLNBIT+002LKQII8PM8/VV9psh5sDnx/CxL/RJCFGzQVjnpuIUeH5C+a7VPqV4sG6xSPaXX4uUcKeCNFpBLF6F9OOjMb8VdLirTCfwiDgeLoEgcK5S46JDoUv+WB3S9iarS3m1WuM5lyNK45pvriVi27mQpbMJTuFGQ4yn8m6qdKj7FMDCoLvvAZjFtpVylUwcfAuE4o0WkEJTftuASnN0B2tPwQI8tEmemRR17YnKui94RjoqxuP/cC8vuHYznkcz3R5faSLWO08STQdPYqyYUvP+J3WjFj5kae6zcpZ2sxLEEphTQnHwLhOKMlVJswjLtOdNNZ16VrUv//v0A5kdM9vNmYhLY/07k+PDMX6F5tAe9nT9XDJ4SMGuTr2C6aUlsTGb6hQTdTCgsIF/0iveGV3NQ0xiM+OvoTj4FwnFGi0QF9ZT/EbBssvoooMyXOG3YT39+9ReFxT6cJdInWdb/eN6HEfg/XX1KNUEnVCce7rfBn2I07TAG8b3zhRuLjkt1GBEXoX04+AnEr1/WzrGBseviaYheRVs0VJFci9B7XHzT8e3LLtdFCVhqi3HEqrJbpMOt/X8vhu6SthBXo5cgjyVjGPNJEpA51EelvgyL0L6cdc12ScCXutoCvaAnaZ0/r1gj360lAKcoGELj7eaVNcu/ehfTjuAydq2KN8QgxLfOkGbxHxbHOYi2LhOKFQqbMVW0Z/g3D9s1ZUB3oGiQGkQJBLF5k8ku0COqnWA2DaDPFhHtDeKrxC3RaxA2xNX60ybGCAZwb96h89KlR732YeF2mtod3NeIAQvpx8C4R2AT3A8sQcDL5ES6zllj60186PL1QTD51dvLzQWhuYd4V5wnFGixEl1Bv/tCT/i8iCR47SB5RVKCHbtk4v+Gta0+9cOKzpNOCGZNnzH5RQnf1Zsh9J0GVvvyOUOhhPsUgli9B7WovBUmm0J0i9710lgP+jBBOhSuzKqNCQdCWQ1yK0AoTMRZvpx8C34J1SM1znNQGogO8lq/Xm0IzOJeRW4TfGqv4xM8mVS3NQWnHwLhOIVfm7jvGgpODp/UPLrk9fFarM/z4yC3FOXWT/uG/0hkMR8frkcm1gahOU2JL/WxOMkwpbpYPox3Lp4xaQSxehfKdU8Rn+K3HH8rP4uPRwctCM81wxVlG3vWG+LHXenZ8E2XkePvq6s4TijQ7ZywnbdGlY7M0hD2KzrzUhrAE7XRova5r2+mabJIJYvQvpwH/rJC/bEhClnQvgmzGCBTOtEfIARFKnZ4I85qezLM4j1BNcxRAxP0p9B5HRTqGlEeSQSxehfGijfRJ+da9a1CyYReGkAY0zxQG/CJTJlD7uMj4vQvpx2UKppsxMH2kTdY9N8EP687wIQSWlPuuUTrUgli9C+nApv3zg0J9GNB1gJTBLF5gb5Vgd5/Y0FzWihbrwsrKBcsqSCWL0L6cG4bJX5RcB+I42uKzLhIhKctjRi/PJ8RcxWP443VQ6F9OEcskOrkDphoM8uUAth0gu0vLuhmz83wuCH2xB2+55rDQnHwLhOIS9oeAKw2coqyaXQp4tIJYuIIsD99H/26l7dMk7CCaBZfTj4FwnD8qYtJpoe+LvRxDq+R/Abt/oKOV8HXXk+WqodC+nCMeZe51xiSbUjEnT/mEGrf1nXpSkNobIBkDMpMF9OPgXCcP1RKNCs/vtUnOE4o0V7iwaKWo6im7B4S4TijRaQQM9sKLC3vvEru67uSy2pUEPEXlvhWcJxRoeqNaWJ78HsFTOoZAtlpRoZL7ziQspYIeARRotIJYts9yu0mej3X3wos304+AvQqhosrhLhOKNFpA/044+xQJdjl6uNRlF9PifShIswbabhuW/P/Wxmi0gli9B6Fe/kR8A0pJUDAOC8Qsk561IJYvQvpXO6UyWIBcP9OPgXCcP6ygc6GT5bWL0L6ce5JnDWQO7Y4HM/Ass7cHGi0gli9C+nHwLhFsBTmAi3CTHPuutFbGRfTj4FwjveUQQYv53upci9C+nHuOcUTVQnLAuRehfTjpUL2XZ+2SCWlVbc4o0WkEsXoX04+BcJxRlh+vR0XMnjaufqneBPoBLF6F9L8RC9n+Lb2vwLhOKNDZBix8C4TijJVXdVfUA4pu+20djg4o0WkEsXoX04+BcJxRor5QZuBSwloD3+jBXL8FlSH1aQSxegzg7bHXnfaOQfIxXqcS4o0WkEsMVB1z9EkkpaMNCcfAt99aSfwYqpeRCZh/Op844o0WkEsXoX04+BcJxRotH4nDfypodEreSAn5Md75KFJBLF5cCyAx7RxmnaLKvkxpPYbF+dTlzpQnHwLfLPDObKSWpXg1xpcdXy49rvrT5OkBcJxQtUgnuOm6TnPJwkvcc/Hua0L6cfAuE4o0WkEsXoX046Y4QbRlVHY+0OhjG/BkXoNJNsjNZIPz2oIfz8GV7M8ewStx0X+GoyyxFCfZuT/Tj4Fkh9sMvE9+B83wEeFvNDErXEzZQha1pZuJ6xU2ZfisUaLQxjj6WXoM32wnB7Er9sqD5PXQvpx8C4TijRaQSxehfTjpWsZcSS040vDKud8wiD/zWLhNnCHgoRFGv/T7+vrssw7RXiPyecyLJlv+pGoNCNB3mgCF9OE4wtey6rMJVu86uB9gwf6l67OKA/ZYR0yctL0p4h0L5TpxKJgZOoQXC8KnD9uNX5lUdm+nHwLhOKNFpBLF6F9Ky8Y4pG0f/27VqNrZRqRZvpx0V1IIRpBj34UA9Yb3TUcCNy1Rnc6rUYL1o+Ow0hyMZUI6aKQQ+AnEMO0lGNgMUX7hw3hrQS4754OE2gzFSI21UG4mp4h0L6X4jbkjxxeKNJ4zRx1Z5JBLF6F9OPgXCcUaHKoxHcXv1XRMZ3Ol95IWMo0WkEA5yAAvxuvhtu83dq8VScMFl/G/zs73/hCaq+yT7RaGbcfYsRgC5RxcWSEoFraTzb4MIe84dC+nHTVPWMB4LneEIXNEv0BhmsSDyf6cfAuE4o0WkEsXoXxmwHmvivpJ7DixAgMpJBLF6F0VzG6B69OXj/kKTwZNZdmbSSdMb+cOg85imPz3Lu8uyMyPr0xUjtKzbHn/03zqkZF6F9OOkNUN7TgXP96zBA7I6r+8zY00CNFpBLF6F9OPgXCcP5GiWeEqyOiXZfL9rQ14dC+nHwLBntWgAb6v/om0TpHyD85YgwKT1h873IwkggH328Gvz/DoJUum44fioE212jXL4MubfAk7SU4JcJxRosSZ3o/lcR3F5pmsfbZRotIJYvQvpx8C4Rbr3N4Q4DRejpPEkFIip0/tRotIJYvQV8yDOVxAa6m1kItkdYx1K4APz1vmpas8kfPN7VJwhgtkex5sRHYi5Ty6gbiMphI6L0VKMiekkEsXoX04Nl2EKx0avpvvXuBfsADyxjTtfgXCcUaLSCWL0Gkm2uadI5aFud7ClH+c0ni0gli9C+nC5TLej8iLcOjy7AIc13Lgjt1mpkxhJBLDboOxL2rlEQ/UkuWdXt9Je3u2Vw5ALhOKNFpBKZVuhwKEcfzNAf+Gaaj6vOp5JBLF6F9OPgW+PL6T6AYRjW/IRrOyc4TijRaQSxbmPLkUuZz3XSzK2ZqudXHHLgo0WkEsMVV5Nl9hDRAptlVW+dLhWVcUaLSCWL0Htah3vw8DxTuGN4giNddx1FOtRzijRaQSxeUqiCWK8VV4uCjhd3qaGDcrWYHNAfnTxKwYHSJ2abdnY5OeynqQpOhiQXN8ptQPIhfIasfLIZ+89kAUI/oOdWpcoUKwIDAkFsSHSLrgOxV2zfOXP+ClinGkMf7MJRgoP3hWMtT7P5UIlNuJSAOJJMS1hfoQ3Zg/dgxSnqPGRR1Z5JA/wmrHyH+CetI/bGZHTU3yVM6wTjJPawAn5hlTNL4vQvpx8C4RQitfymA5LlMcQVTzO7EIEXTTl+ziWwL6kaiRnwonCaT/VhOe90SSHoG9nsvqCd3Y2mPk7UDzal99eX3fZ6QYqjAU2Qh6mtXVfU5K5/+vL5i8jZT8g73c0gnCxC3iw4KU7g//ncZ0MIBjojE5cHa5uR8md2LF8LrwlSj7AJWMlqBiQgYwibmR3uONjEpkR35lBMm+OSZI96Xu1PPfAv/mC+FrsO0asDvYLiuEXTjGTJrlMJ6Q4vk7Pe5WtiZ+PUmBeGQ9yXpPDDOFovTZ19cmniGv4YzwH7W06hXCH9xn/8wtPufvJcY2pbfHAd67ufkSEAWA+fJgQKwQ4vwLhOKNFevswF6McLFnGqKYjgxyX/zQubZwn9m3Nc05qqQk/dNIzBv/RgojicnHyzrdxR4Fun1QiiIFZdOfkzAfFWxt1lFNmDylXIoyyjRmhxCC2UE3Q3YCIMG4pVYNZIgvYan2uFDBPp9QTsyCEOgP0Kgr683Ry4GbZLb+yX+e26l8nemwAZySL6nZXNaZteXTt9dOevVK5Sq5cFJ6EU+bC71XyWy+zefhDnzthEGJlz99U3o5rh5JBLF6F8c3dIC4TijRXte90y+F24P2GTZw8zqtnyLEUwwDPtKcjjDxdZx+XRxdCBwP3caHof9ZI1mgLPVSR2OtQ5EXv9wbHD7OYl3tuMGnpqqsTJJ9yxxfFXX8kgG6ZRewXRQZjrqZPnFprfVHadNo6t2U22MuKu+f3SM3iVKwszonDFwawYbHFhJXwGj0MVwH/z41gIuOUi9C+nHwK/31750Ii9C+nHuNXN2KO01mIxTYjLbZpgFzhPmgiMmPdMiBQhv5QQhC5bXj/qEm/ba47OlV14H5TeIy1H4OfcPfkJA8/XIwy57xbQItvC80aSJGoXKN3j3MV396k0pw9hycLYovdnd7xnMrblkmpHttchWb0P3Sj6kPGDuIk1T4Yuw0VsoEWYhNoBZmSXppNUpt/fl9A/7d/ydYejFCxQvt26iWL0L6cfAMKKc+uqJ5cpPp7NZDC6nY9qC9vUQPBiqYzh4+gqwvr2pEcONxDmvXeZ6QJaP4eLHQdWKOFNl/VW5eCabKcPVzmQyZpEEd4XD6bwMjVjh3O/iTskuFK0Vnmut8K4Oj12u/537Tn69ayWgtANAu9ZpOrfXFQyNH5F9S7VmNmnbwnYCaXy8/gfjjrwe7tkqj/nqXfpYwqaKiQ1YLme/y4WmNSbFonGf84+AHYE44f0z7JCBUhwyqlGKc0mIo0WkEsXlXOjAkhE1Ryn0LxSXQnL71Ni9YZGy299HQk0YlC4wfxAj3Sveub//3tNhpesKnYnOzMvzDkDZJ+EVY73ZWPQ8FtFb57ZWinzhi8HisnoYyg8uNr3q6XIUZ6nIphbaC161WTEnVCc2kSVzRtIi8sXV2i9FOLGH+FtcncTKs9Jv8dgvGjiq/Hy7h12VzR9Ay9U3OXpLxZpg23te+tsYDu5StqX3M6aUBwAduh0tL8C4TijRaQSmV8jy7Z0/oRbwWf3BjhoQ9UpV2gBZQvSCQC5FlGsz3nAsGDeN5Yv6G0aAcCskIVTspLsCEN7s4iV1QAp6KbNlwSLs1m8/4jlsBvVSR0siGfoIMqQmehwJAiS51X7g7mlR/q4y47SnkeHAKcnq9v/ZIJUPuNYvQvpx8C4TZbNBzQbX1ARDK24u1F53ZYuE3QZgyFiv3wN7KZrsn8fbQ0a2WQbeGIId3X1wnLVyZX28E1aquWslVKOJGJd83LqAAhzbpUh9tD8q3JWmYdC2zj/4ajDDZiUqWwNpEMUQdsoc66vKuuhwsIArYOlb4d6V5QYbKEaLSCWL0L6cC29TijkEb7rN9UIjqhrZEktdQ5EUJBBKXenpQoJrWKP5asdT52TDzqpftRWrG11EQhLr/fxuDjR+/CfixJpRk/ui0+15kK5BMoYzK+Ykgli9BrR9qtqjTLJpZukQt9NPk6EB8Pm+xhUeLQWmuAg2FBEKyPGwTgTKH4gWFsiKIs304+BcJxRj96V8+cCFvqhEdULYLZqwy9pEuUBXxvQrotkzu1BuwFcByoBNj6kyQkEOO4PlVQhhJ96di4SWUSZ0ks9N9+yuIqA2VXIvKnvdjdoHR5rS/tTo2TzZIxJiTkLm9E0FXM66rtGeB7/08p6+OGlHSwT2InHwLhOKNFoXamI9/UBEMrbio66lj3JqxMgLKCBdM25MwjmWkm35VusP59kUXU6cUR18HpQHHkeSXwfihpKGTEpsWNvQXOeOo/CmH+o+gVDJ1UZQDZpe0Pk54oh2RbSnpQnHwLBDAI7wyqOplx8z9HiCOknzEApmKBtQIhcJxRotIJYtxLw/DdQDO86p2eIYEYhM8WoB6ZFrcEdrLPJIJTBhx3tTgrn9ymoMAvv62KdU+346k9gWb3wkLl9tdiE9cHqgMSqbMBcFvauMpqyeEjWL5CqdY0OeobW1KpcJxRodCHa7wsIvA6znLAFGgfxqg46h6RhdAJYvQvpx8C3zRnr2dY6UDE4TN2lOFA4gv/q2eAGrYy+U0gUFXFDmnP+h6oawX7FxveQ7+AVth3UJSr8NgsqmglmQ++yW0dmYenUwj5O8hZzFRTZDA7CKtWWZYwq4UgsNDLsH8I3U1eSgu63gAMq08kq6iK/R3Exo7pise78oTUwMCBA3jC607IIpfdQ9IV0yD9amMerbnFGi0gli9BYM6b47bvPrBklCEFOBeH0AWzyEmd4HySSECpcFEevP8KSouxtE6Yy3ywpCX8Pj1H/9MV364ZJ996AToMZfokqSclQepYstdLirdnnJ+dLFcTysUYIk7luf4fHnhRO+qgrYuBATtAssdcwF2o5bOfLrnK5pwJkAt1mHBAro7R8lZwvWD1QW1k+DhhL2SoP/8U2StjS37xsvzhYzkXy68IVRPQGbxCzGgI5QNyDziijQuxpe1npSti4TijRaQSlFqBXgGsiM6umxtmuSqFLGgOHQp/L9oK63Ce8LWicNrU0jsPtd4PHUxosSZyUb+dPW7mW4ehwZeyckkmeEdjpCUqbz73OrnqSTxw+AXY4Ggxlm+nHuV63QOvgU9i6/MY00jMWBn3uI54e4L6HsjbphuC0CjRjFQcPmONCZTpxmYZecQg9TThmWrvUJk5boCyYTpQz8Z2q6BXP2oqPmkQzwEXWFZ38j/sXC9lTrflFxKwGt9fzRi9x1LIOT06adE3hFuq0jbX45ZCmNokFg+19kNUbKycrlXngzZDcEU4ZqB6rBkXoX04+Bb5zwlbKMoKQpy9chdca8EkiLQL9b9s68N988o08CKndCce7r5hQr39j0aLSCWLzJ/XbhEAsvbqrMwUEqEcdG+3VWBI79DxbapmvfDc7H96lis2FI18dIiK4KV5vC/AuE4o0WkEsXoX04+BcJxRotIJYvQvpx8C4TijRaQSxehfTj4GEnIvQvpx8C4TijRaQSxehfTj4FwnFGi0gli9C+nHwLhOKNFpBLF6F9OPgXCcUaLSCWL0L6cfAuE4o0WkEsXoX04+BcJxRotIJYvQvpx8C4TijRaQSxeg51bbu1kkrz+pm+YflXZt2VUUKhZbMHWsChhz7ae1rtZc4TqBEuXjFUNXzTUMoQxviNRXRcjSA9zVU6fQUJVn0JmAIHiXcNJqta0KknX74kfCAs2Rcf5pwL1DMuJsX/J0/ZfDQOi5O1ucrAFEPQX/laTR5kBWY+BodaZYJQLQJ/25OaSYMpu1BG1+8wTiAAhcaVjpDztMOCp8wJbycmiGAxC+nHwLf0xazj3aFzyDDMR0c9EffPR0I4kSuNn5Kl31KlpSg/OX1WtltAYMU499zorYnYBumz/JwoCa0HuljyM3Dzet6k/LQ4xVVRrHJl9i7m92v5LQ5Q8FG96LhS9k1SP952tK+fNPg30W2jv/+eztvlbFCL151YJH4Eb3Xf+tse2L5DuOnEekSP+0t+7tzKtJ8CUGrmMJvn9HHwZYFA+r1b9Nnail4K++Ivy0sYRRFMEeRBAMGbbvtcItNylm6XbsMTgJw8+iEwKM3xFlymx1PG1jvl/7eRKSnoMVJRGlvWuP9HIJJO48GCD59co9p08zpGTq7V7FEOqoGS93Ol3ZOT2M6NahPTzQGPDoJDCjWUaLwdTawKr0x52JNZAI46wMqpuINa7Zcp6NheFSiz65MJQWhbCGPHLwTrdThm+ay8v2SKlPpuvfqoxxORnn6M27F36lj6GgN2CxbFwnFGUobiQpKYxB9geJmaLFB1nedk16a/ekdgbMQcykGy7KuhLQh621R2tA5nfli/C9B0MSdZAoTpZiDF3nBSDr4Byq8FmidDFBnkrrwjuWEjyTqFYvCgNwib79luGCWtR1SPkpDGoIxnUERFD7iBXGbzIV3djdApNhCQPVTNApeoGPQgUi721DW0c7yqj+m/a2whoKYG73FOsLIPCTL6w/lAMjz1ZFs9v0RgcdP31K1p+OTVVeV41MgREbhNJrEsjVkLRCf/5Ique3pvKcpvOMq0tUfhtbsXfewl9U5GKwtOIyum3BvG/n6qdst1Fzn2yH+l4Gqqa67CcUaLSCE0aT4lx3dEReitUaTOPd627imegDdsxC1mnFah6BE+g+v1eC3V7deMIkdQLzKXgDGA3mg0o6zPJiAfvgEnoj1d39VxtnNkNtVDHiGs24L2H1Vp7D+uoynJ5LCtEkxo3n+qptHof0oj49ZVGbOjzFhMP+wlsLWRcga33S+RB2FhXD0nLx8kqG8oUUkxgoIUTQ3Lm2M5sD2uKrc13OS4ydVyGkxddNlXZsJ/YtDD8jemjOa6j38hcrRqJSoVbq/szj62Sqsv5U+/B81DqAVdUnSmBuV8GY0o7vaqNMb8xUXXsPmisCbe9PTEC1UHUOCiMOp/atjomjsyhdABQ2hmL77i1e0A5m7JDP3Yj9Sv0sJbXla8GOgEIIhEX0xG4bKUvzV0pxn00hoLR5SQbmRpBgTSeSov2XZE1NtqteCBsiizfTj4Fv6dt9mGlPgOWOK3NC8v0IKVBT9+/fx/l6e5VlO2+0e0+A5zFcC8v0IKWXfv379+/fv379+/fyI+BcJxRotIJYvQvpx8C4TijRaQSxehfTj4FwnFGi0gli9C+nHwLhOKNFpBLF6F9OPgXCcUaLSCWL0L6cfAuE4o0WkEsXoX04+BcJxRotIJYvQvpx8C4TijRaQSxehfTj4FwnFGi0gli9C+nHwLhOKNFpBLF6F9OPgXCcUaLSCWL0L6cfAuE4o0WkEsXoX04+BcJxRotIJYvQvpx8C4TijRaQSxehfTj4FwnFGi0gli9C+nHwLhOKNFpBLF6F9OPgXCcUaLSCWL0LeAD+pT4AAAAAAAAAAAAAAAAAAAAAAALj7JaptJIiiNq4RrDvzS/W5UoTJrIPiGD8sHlgPdd3cf55Xl+yMdPGSaZCTGzoMnsQw5GHVefSTojWxFupBu+EXMW0U3KGMxEtI3YcAAAkFjuYhRnpZoUrrGjpEoE4wmRq5GEFRD5GkUKq4Hwiw24b9zSPfet0j0ArwaXWO/+H4WfomNgKBQ412tACMC2twizO1E/XE/Bta6SMRuOajyHQ9DtM5r+0MjwC/zdLce5k3z1O/NtWNSKVgAAX318D/2ji8q5yJdbHqoPlHy9nBYlwEV7YAbWl2uXhTz+x+l5emHa1KREUWEnI16ipT1+bcC9ofkmAySpPa/hlqa3BeDsgGywq4vqh0DWuodNucXrvmsLx5b/Mc12Mv726PI1nhafLgof7V7IeKRWp08A/f6YsQ42en+CxLAsWycVhB7rXDyHtwTBjRGabyZf0A8T9qGFqHqS2fziROzinUE1LeOdYRx/ZKx+u3Mg9KJpObgopy/68q/ifaKT84I5/+1xdJP8UZ3k0mY9QXLV1bA28L/buvUq/BkAAmeEZRdyffRVaEKu9Lbt04kpsRjRTi692RkMtB3lErpVln692j+lnivUatH0NXZEInFPy6OMcDS1DPYZoRC8bC9BPtG3LsfAz6Jey0oVcLXctIFy4KsIQcrQNoWfilkaqmvL6mglm48ROge5gnFlvnLe24hptlIojhV/1ZhVgkDDhiw0YCJO+vmtnUPnWymecArdTagdnsB+mw5KVIw5UZUOFzfDFgec0hrkkv/kwRZP65H6dM5FOOdSy2Cy4OudWg+YNB7yfngpfsNngqGYjSDsNLZhDVpzfbBKnk0aCPMrCVwhUStdE54AANH7DvjiXoxZmFwCRXVUSXqePOfJ5ZArR/N1tnZMUdAWAG4P6y0bWLW13/UVcYYsmB+cUmK6W2/ABmR2vD2ru0iBDZLchgJiSJycWQKsvmRV9UorU6Waguq3IomZjBrvZT0hDIy3XHFzvhoaWJVwXZFMJMzl+yNePaNr9hxGHfiIBA/wexvJUdKvSfrTQGxlCrgcvZxo/h8E7F4VgBnSwtHh2Giwv6q8+xZHVzF5r3q0sJk/PKl+pWg2CD7pF4YwGr7VbgnF0ZQPT5Zel70f11So6iWTl6VYwrDWozTowT9XIp5bCYv1NWn5SMM4Dqz644fmUIZ0egf4aB0HIFIfeZtObBNrs9msziAW6pNcVK4XSAAn/gARX2HCCN7OGO7H2X/Yd8cS896khAX9hvxQbK3P8rkR6QFndpE6fDsQjPpd4gVl0NmfQiNkyts4+pxG+vAVVKJWawbBwPADYJ85MysCY3CJAIQ2/swVi6lE3RwFfViSHwkiYKOxki0kSMJ19mlSM/DyF1mZgdyS4Y4UqwQcF2REIDtkow8RLWGRoJkY6RxxPsP49G8IJPX5OdjuwiIKgJT2VOinSiYliIByq8JiZwudMAM5GeXUUSYqii0mwjfNomQ0mv8ZHdtdC+Do5T3gegAREryPAfYst3/ZwVUkDGnH0QhqX831c10eJh9LP69zd2yuczeopT/wUn8pFMlfZJIxgzKEayGimORrxzfB0MC0fnaAke+sLqh0boUF3yz/E4w/v8mE0+u2DfcBQrApvSjaqzqAzkiHuLJ7g8tFwBVwAA9fXw+AwQ3lY+DjYQzutO10kFyNr1HEX7mQmjx/kQjil9wJGOEdw+oZYlELXI1a5BqVvEzroJlyxX9gcLfnCfKTcgnLP0AZ+7ITkNH//+k2Xt9V2DmvG2J3/6kYCSIb6Hi/AzjGiLGlXX9IxdgzxkDh2QxwndTZK9KxcYgV1ixFihjFj725pIu0dY1bwCby6wCNqodisgfZJWC2pOl25B1qcTNBOBuEMLQrd9dViy2slEXJCacEWByRFXkACUUbNzkcQRhumi1vK9yqix8yj51LLxhqHR5HoiBWz5k80/CFJ1U2KMIQnTcf9oSHRRz6nzx1IQ0JpKGE1Gjxc25xEYLRAQ9zJD23qM4yKcHLVlIqmj9bPux/r/RxzsdigER1lH9hy+8n6c2Yko2s9gPsVNE2Eemu2K5cgpI4f6uRq262GyDNdn+YAAF7sLDIhDXGmZteMyYR2BcppMfZzXn/pzufHBJK4SPfzpNsh1h9tnWV+cym6BvOAAGx9nRp1Wdbc63f/ZIyGvxRu7+82ZcMSRC8X6zXENYlzqBU2VCCe+sdnVBpIlcVbXUgHPNxuFVnBJycxT3J0OMoVRhWhfheCcwP+qagXMxeN4WlV5otZZNxvyqtemGfzuOX25mbMcqzIStR0BJCG/MEm/njTmyfCuQp0CCUaAO0iQr9NgGhl7+cALXiMrA4Z77WJDOA33uGvhJ1wBb3KDUjXO8L43oB4AnBT8FwuNGecd30lGSO0mBScEhGY35r1u/D19I8/9L8gEuMTk+i4xGgddjTSO9gCUcd268T6+FTNtQFHhlI0ZPKtak4CBCfADD+uOLnSqeWVcvZzGHCzpGWbm8cwSehfcLV1mshrngEAGV9cT8AHP/sO+a+JhlsGk9xDZtouK9qwQtczjQY6eoECcKvl9lb+4meeQCbivH7M59mhv7dPjgSxcAMoxAkl6v5hCdcNHcjwM1s7iDzSMj0/rhXN3ZACwmJcdHNx3hJhYmqP7pY2iWo4BqwZ9a/iFh00K7yiFGtt4ELvf7PKqW4C6ky5HFniuw6i/LsZHJv8TNin3aESSEABxxeGmTcwmvFBBFEsIj1gKm2rxw6ON0ROLsDxPGbl6/B6jKukFkUF/riffsPBDB7SZIcNIjvOXDm/icxgQZCGw9Y4XT5HViYAZ3FOdUJknmcEOozqNdoK1Cg0bBoA1apNRlcHfXy4Ow251HeELBrBGlbH1hEfACA+zohNi6dQ0ZFlip2AnSxzo/5W0qqwanpkyE+uCwFEAdKChalmEOWaYEefhXCN5kqgbAISEhgngep7o+Djpeg5o1Q5N5gc8rxlZyc4VNX353s+bA3K9iBbPn3qc6YOMxJCqDEg4rXtDZSE4URgERMyNh6AImd0EbwrQIxqDeKVs52CjQFIlkngZUI3bfcFxO/S2Fh7JHXBqBQXVKjGAvMSksLlQ3Mz5/Co3t3wVmqmyBEvGYoMLS20Wq3PGCEvl0+l5NPmT+ykU3ahE9HYwS1nYT/zNW7/QrovSXGJ+lYGJQAvB/9nPDGYI0FvBNNJVwRAhTc0nj+zo1XC02I5hB9JYQjjUelcb13CO6DKmxeykPes4ygoAD19pnN+zhLnF2P92AIYoGbhQTB76krcugPj4OV6qHs7XCZfe47JxA8ACdfW25YPVk0vAAyg19C0d0YeNgNAm3CmjSwHawYJw4I3mnj5RDL+ZLSja4uuvAPyZ0Dz7IH52gJKB1jnf4zfegJA3g5n88UW8/AAO/7DZ3UvrU4+6jbR5BfrnpwgXUzEBfiUUPjDekWP+osRgTwmAKa18yoD8amIbzqunX1/pE8jqTTDLhDDOPzruXvg4aos3wStHVL82LsLgHnLl12/Ruv8LOtKkQtsfrfzpBCB5eyRwUB52OZsKMx9oi1xru94eFPykr/gR+vFw6Ail3nUV+JuV94Q8onreT66HLXgIxPMn4gDbsaXBfQBvooOgXpgtHCBtS3uhTWl6rzjl8WQto+SuVwBFM91SQklIH/12dDOOKZ9FVNnlhjArQK6H9hv4Gz5f644dgG5Vkk1DdLUl3wAfq/BWdLiCZn6yKpF6ES1vXk7VOl73bkpoFzVk2SgBI/bByDMck9atYPMIffaFMvZItLakHE1xknbg7VkR9QWnFtoEolJKB2Sclns93Jjla6G1Y7HwsuaqkcV4QtRsHtseZbd49v4AAf0CGUxKoiCv2gBigUFs0mlZRwx+TCjFibkJiwcDiNKmDErGoC4Tefs6NV4XVI7/p3y2tVi9RlPSuLJRNYobsO84DE2NwSZWEeYM4N/RLljJeTfhIkiKuXBcfggvsja/3eqAeDyp8r4YxdYszmXuqZOAmiigWiQ+s/fvte8zfSR4rx91Q9RSnC61LUuQuaTVjwHPLooXW/S7Ij3ivsITHzxxXZrBN95rhHpaoibDbFNUDIllWCKH0wquFliV+HQ1g+RufZ++80lUd7MdQ0fnA/IHEDs0ybD1o60Nru54GJ29U338fviNjr9fG5M7Uzx/IrJGZvcdjBVIWCGYsbarJ5PBpuj3IP/HUnTje4nb/fbo/6HjdsH6Lez0UhZjCKo52eAJr6g4MF8h3HO4JmxPUbV40hfR+13hTs4foCkPWibCbimkQ42pdTsrcA9+AYccC8VzRWSHzgzDk2ad+s/lElYIRr34bkEkQ1HtTZZcfdE6pXRd3ZasmjirWVW5wLWBg/DikyYgHKuAnlw1N7X1loNDyJarkRJGlp3Rbbu+zkKvTuIQS+aO86vMrYZXUEvpmxYCHAfKNtFEXrvhfZ9wNb7De5cjr37+T0grBba69w66zEmyxlziN7iDWCbfBEq//9KUMGH9pkdtkIqD3CSo/1UdHgyqG2TYATMK+uPGPb+o99drpC4BZGmbFTIvlYIUPrsfd3ooxmclaJS54ZkqTmTxL2w5Zcjk09tzettSXxVxpORBPSgb14rLyuv05A4aC2yyLFFv+RZpQ7Vr9q9vsWQCQu/Z+/TYPQdaVcu8xR/n1iDP3LX0cUgjCGsmnlGqpk0Bl+oroiFd/FS1WwNu9KnPzbu2UV8XMSV/aubVlz0rBmv+JrECMJ34k4kYI3oSoPqkkYkdReq3CX0JkNJpv0ikMLiOoRKODIzo7G7yRISULvTv8OB/W478iFI5odTZLB8aF1lCHGMsAvt9lT0F/5Bmg403YTilspPRtZFlRKSMcOqKxFD4paF+5iLUJr1dyugSAemuJtBmsusJi3+WEam4vNDVoubXbQqH8WIkzANXuCyWW8QLcyoHKG/d3kE2+Ksw6TQCUsL7FTydD0rULPMqdw/P/W5atJGOK+sIQoIereYCVSxzqG0o+mzBNBXNG0pnKj+jLRB5mtLjfKsvm7aTPH4hBjcGFSe7IpSFdagtk3zscfwyf2iU4HUCKDdiSpmNRQXhM+2pXdDweu+fsVRdHHH2AW5lNWcMlQQ1MpxL7dE/Cb7VT0n9Bda6/pd5BlAHTeAMwoxYmZQs6YHSBxHNF663/LmQS2hOC9EQ+5FK6unlLYQbqheBakm/JNbSfveS5pYuQ3cIgvotm+xoGsaMuCTGeRt7bk7zln9L9nY3Ag4WH8O6GcMeDzLY9MZg7RdGoF/AD9u8+eoM88kOPCpCyiXBhMSkQkFhENKmwJWoTGHCy8k/wcmgmKg4NzPLJj7+zGMYmBk2hjSVcxlhfNsq5EXdJGvEdgguaKFt8dw3FnLJDRPX9mOtvmysEPPwLGwgNmKPL9SlSTugpsKmOjVXmBGzYhW/l4PyUuXqkn7B2U2lPiNLsJZU31C1G59A02V6Mf6T9iZ3nzmyiESIE8x2YS/osf6w1oIZIBoIP1ffxSjFAF5C+evj/YBn9z7RybNDHq82jnV6Rp+KImCk2O0hipSrAQThOdksWloNDi0ZZ2isdispXhxIkO2HuCbgck0xW5kHtABy3H895ikgmqXy1XsH4N0KQK8vz/nS2yDJYiEEkZ+XMt7WNAa2I0ZuZfM3Ej5EkdG2/zTwKZ9DPSa9ENaVd+1WJsRyyyTfGxmyC3AQ4IYaHbsYMAjES+pWBSERkgvNBEbKFVrDwdXDeqy11ky73A0pMT/Zg7a+vczpZMbXReu1LMIm79T0dQ08YhXxxo7NUiLFbTOMDQ7Ut2IrCWb9Kg+WCq8kqYfDoJGPr5eXW4LluEfgHtkNpqiz9eTQA0NY99kb0XKBxBPErtnInVd1riOzLFyl+z2OcAVY9ZsxBRAqPtNz4KFHTjFxp1LXrjMSnR8V+by9ii1Yqz//74fAbgADybghuSCF4Ov8yOghJFdBoD5ONhrT2IxC9NZwaBlq/BUXxRVaTK/Raxq9oawG2xZBtdMqo7Z0/GH9ESljnFEjFUvbb77puSfB06tTk8hPeM/SslZjNKhmMcDbVO3HcsNtCcrdvg4EDttcI2TmjLw8X1NxkdF0jbGiwoSyiAX2dNQ1R2v5HWKYO7WG/EJiwt+j5z/ag7DDJb5zMLL8zk8zgYF/I9+yAlh9yZRtN28w8J6vpSFgI+CymH1ZLQ9vxXD8/TUA5zKQGpTKb4yqaeFgvhvNUdYLK6LOC2DSYG+xxcnhgwF6y+kv2bqMs8kM7tkJ7IvoGPuhLvmYTp2WbL0PrCEM5FbJ1WT2jVXgRc4ACli9FEFNhKHzj30snNl7TRF7iwnwPuuUljG9fSAvl4AA7Lr/j8s5hbqO8eADIMuC5YsLkunU6kvpIp+W5T3sGsdnAaqAUHt9o5cdkObNFvgVzID+GFKt3aiGwMALpQTeEBcW2+H+Po2a02IPQD1LDOzn24YcePbuLPEJ4yi2jVfnP+cs2EuzMSTF4n4Jk1oB9fDIjYYNGL4h/p/Wbqvtof/n8oURq9JS1ZHQuRsz5uW1wVtcKZrAL1PpRX25XJE6+Rsr3H6F1DqFUmaxIV/OKrQUl7aesHl6CiHUpMW8blP2j8SD2GmZMpO68iueF4kBSxlsn726WtT6Rty739fLgoXhSuLjROvw3VM1W7R9lhCs+hdfDqteT91u91T+OHa+tz6ulNQpRQXMAf8clGxCx9xGgOLxcvJcnkdrzb6Km0Ktcp5ymN0SEz3CCYsllOwrdEoujjCOHT+trqXDafZyjs1LAhelk6VLC4h9mQyzhq0/KM0Qxd0BlrKZ+RRRblJozk9xo4JZCkW8yWwL7GTacRebqyqj5tAdbVwA1gfvnkZ6Z2irhP5AaV7RIjWNjlR7eEbtuymWt7sVMe00T8OjZ3UVpDzI6x0rFIJghVun3zZRrmK9NAs5oLb7L1F5RUj11E4v5AEyj8DBgj8yEtUwLLeyAHmw9T9vCD6mTICKvEcpa2zYmmahRhtXwW1iQJ1wyKis2TTxs0oEMhBuRKeKJzAADLUUBzvp8B/Qbgk0ymbOdJn+eXmglp/UyH0knFGmBGfyOO+XVWGS8l38k/0QER2wg04HVy1HttnLG+tIOFbPNqb/zINLRCbRpRw+L3VKJbj/oF4EFcI13mrK2JxPk6eiK7rFQHmPdSRRH01bbtd6XzEp0nvwyw7T5X1bhcPVyBCb2wpcJa9cSECwMcsRASavrIYzWJHpHvFTJXZnc059uJRCquTRcWmoK3gWYhA1V3jtcXuBBFZzer9yOsbMo+DGr3oH/uDHEJpZndAkgH1Rg0gdnWT6uRA+e1biGeZuwPNfmHT9lSMJfrW3G3x2RLfZw5m2g5/+yRkJuymcjWkKuA5mvgiBjpfudzYY/aIT+T7yUfYd2u0qLOLxdhdkMtyotmeXYQ4RIY7IZaUoEJjodAFh9pnl+03PrrS5QMSwfsd2IQzGe0AzYbCiS6c0CxWJt7OiDBkRsLNY7YR4K1zAnZG91/eUK/IC7TBwD3Ag1stf+OyqI7hlgj0F3ZZOMbsWSXsiW7Wby5Qu1HmPRryhH4qIOFqPUpRaPa2RELj8SJwPESv5lCeNq3YVNk7OGGjIVgG3JF0za0JAHr2dh08tOsL8/mEyZloZeufWUa5X084tD/AdFZq+dKxIeelCcrlcdG+BvGzgKoYV0c15fz3SRVxXJTQ1AnmknteM12lxxxuJmBn0cs422uwE2OV/KVIvmX8FbZ8lsJi74V05FrywAADHv7/YIqZFUVxOHxO4W6NBCWlWdH+dMTFyZ+oqR/xcd8Yr9ecRuY4jpd54UNj/+mCq/XKIkXXITTU5u6bBhSVrWqua8RY11lcZTz9X4qhv76ShXjwgwFNpJofmBd4VsWRgPJTRKeLXndyce/sjZCeW54oi7ScwxhvD2UNQLHnAEZYNDtFGJSb/0TlYWnnDL4JrtKCv3jfHEKMdApanHMleOvoH/hoHFejkuaTqVUk2pBAsJv4UeiHYgw+rJFqBp5Fi6RJ0iT9EY9FadB+idrFgFeGGsky84JPFLkeif3wgeAhNThMdo+porKaKRMmnG777oubKq5WK3UfnM1dYv2RKljTD8+nZI5JLKG4q41DlVWgPggaKcgDVpMuU0GhW4uHyoOjWGRv286fn3yL332SRYOUwGgfTQaT3SVKf5DoADeTNlBvEQopsM9n0vDhHUCq4UBVQRyTyyDbTvtvA7xXYZSsf4/xC0dfBY9Isw/BeEo7u2e2w5ShbfKAAABplOVvefh2EwcUcUxtrayPH/M+uos4894wVMAC5/lm94fY36FBAzvaHGeqpz7CmjE3eW8Hii3N4hML4qsoH1cL6CLYVfGnzrhgPEe0AJdfFx2JBOIw20FqSQcalTHu8HKAJYKAEQPi6GuaZqrA8jGjo1dZYsxOKvMXFsE7E94VpWxP3b7OP6fXIBdQ0A08wZ4+gcq6bMkz8jUuVLlHrIZV3Zoooubt7H69Mwdk3lq33nJ0wf2NStAx9XDEunl41b4YOOmBSCfaSefyGTm9lWPRQF4ojes7ZD9kb1B0NaJ+w7rNWDQl12NruuuKwDEjBX4szAvm7//yZO+IYFYdU6+yN5FXA+fiKH/JmgAwPtM5W6WMUc//43THC75NXPczT1EzDq7LLZLpx9teuYKBtowhv2rW7mHH4AOtNKcd5dqcyzYG0EXxOBA9iQQjFg52MrRC2rrRNqD390zYY2mNoAbZ1Yk9Y+YUPS+BQ7R+u2Qs2Nc47TRKVLNIULM3q6UzQQY0KmgGVRXifwCGWO8fdG5r40ifcI01GHY5KjW8HSGhOqTXNo4dJ1rfccsRlcrkVBMglyl8iykZJ13aOQMdBlSkdo7xj6MXcBbNHG2EINCzEVFAArRA/mpawR+uMjc2AEt2n+HZRsVN/l7lo6xmZ/dRpnfhLfxAXLhXqvUTqBWnB2O/Yov7vAtyf4UN0GyXwvIQhoL18vkcEvVEK8eDMD2S3Z+907n4n/GZNEggoLgvTGiDpxGGAlHI8T8P3JKmYvY0uenb3Y4kEqanSWCWTxWYaXuDz5hrR9uQVLib3GVqH8VrOuFaFxWWcq2Tjy+4j19AA0dRAJAhelk/0HCntuRz6CVlJMoTjN8ubhySyP2VADnL3Ol21S0yOimaoFtupGoGPo3LDR8BEBnhSEfnsY4RFV+UdbYLYQMJhAAAPH8tPR+kVkefOQ6+eqiGpws3moXR5XDVG8UiWGaIa3xuHnOkzCw+dO+j8yg69hl60EpiGAFvi+8RE6nIUyva2PDlIsIQfmq/KcfB+3hJT4Hf32pI8lhFXs7Hx8e+AAqaUV/LlfemK3ajFfeJXbwWaSSTGmp2mAgHU16yy9zf8YuE58SHDUl0kty0SaFTQsI1XPc3h67f0SKcIo04RLC/Rh3qB9QkmLkKDSUATLs3tKOp9TnhUk4VTbeNT4PbHNRTmV2Q+7ZMs7nHamaTpG4JD9my0aCmwxtqaSHsBRnJMMuCbvLoQ/r0eGFcRAuYVZwL0LJW+9lHHr4Be4Db3/Zw6inOPpFv7ggAJSOpFj5EZhVeq9hM6C4ChJbF0MjaPKkeJNaVKAbkUfwX9h4AlVJvh1GQmLRa4pOFkrGoAepfYBuGxjTZA+y/jN3Q3LqimgrIZrmGeGnbsQwQcIIJseK4377uo3/kcnWHEfjR70ZLU1wYdw0g/AduBqYM1EMUHZhLWlT1s/L4H5Mb1PbKJvfjvXIRoapPYM1eFFCC3orl0vFYFHTiCA6ypq5txVLkM6ZBbV3shtL0TAU9sHvtg0fwpKltmPUo/HMUpanAyvDgIEuVsU5LCVeMYjPj8djJHpKiQQvLRubfe6tKo3baBkTp5a7mY7+8bHcRy8qAAUaSQ9+jATw7UO6jY4fgLHm40wNIzC65pqz6wzoM/c0rGj2efa1IM0Z7dtm9j/y4AtUOPibu77ec32FDHtr9jKH3zXta1nZYRnf9uy2muEbb8Ll7t+KqW8MpSu5hho6rR54L9henyg7f0va2pjI/o7DIn9HBKXEF6LwBhwX1onhAa+oOEAhemH4woezET42FqQQm8Ju9/SgZLVK6tkoCJrDy4AGTCgPMsLdLoFIPv220i2bMCEbSOOzQXsbiIvgXdPrZi2j6MFE9PaUxje7Ia2v/pJMjrVgCdmTfSo/hgEGoQ/aafPfBXcruJHd755CtrO6sJIjskcHOPJV4MS+I1VmZwLhC+7zkmBcjlFczDhf8KiUowZkzpsYBaNpivhc1Xu2XB9osCZpUJXNR0lJ/RokUugK1yvaTmHFJ/kQEmW19t7/tXJio74rfbeL+h//aA3UP6M2bpicj6CQtI/iQyorcfWYB+AlOAd7aXr26jvklm+brCo9w1f44ZLu0lI7RTGArcDad1+6RpoJIyfrP6w7cVWzMhW4RwD4wAg1tIO7rrApPuNCsLlkCkUxbBs73kLfKf2s1nK/4471L3V++n5K8/ImnG1QQANPUJh8rItiZNi+AA9KIjaX8E3g8DrQyL1S7J9mdAdUDzwBka8W+XnQKgI/h2xN38EUw+hkdf7qM6r91QNBCzafdy4fooUJeBqEllMiJ8Mt3ff5j4FFQ/OCw4+B+jroTkAXtD3T6R6oHtwV3FyK6k7MaTknLD3dLuBYK0/cPDCIQw9h0ly8/CursT0LSmfQkrA/sO7XaUdKIxY/smzwtT/iH9A/birIy8lbhPsTGTVE4pyF15tagxJj+nKZdfMv11497nThJPpFAWaVJKcQijAEksq/pn47US22020c0VgDC+yRwWJlAm5AjgoGoiA6LX2hKogLTyEkZ4ieMPxG6nfxXyuk6+QH2rvJSbTug96KpPrDLU24nEJe4PQ9m3BpuvffH4d8XnXwDFYw3HnuS1+9wKB8C7rPUJyh18jZhj/L6FjM9hUtISFAwp12ycnZpYI41/qJBBtdJqXO06kVQmRhkgtSEGErvS0GujQEKR/F1CDAGn1GGhF1w620Z3WkVZzLsTOMgbUrGugPg5bZ+gAtzYCxn/9h/THVq1V1L4X/1znY68nqABqLoaGIZVAv+VAAeVqQxCEyuyxZAFBskUVO7VjvPkowecob5y7crFBn0UmElEXGUIjYO6Whrt6H27y9fwq55SMuxyDXVb0QWxOhtsj8qDZ34CSCEcn3KL2vnjIxTYokXtaFA/e64TF8EDCeaHrgpZblfJrHwX27g8YGYS/lduBxDSuKLSbpjN0IKIewcMU/eCsY07k3botbveuswXGd6t1TRJKu0HgmrtXI0BtG56KXRXNRx6Ou9KC7x+72nLF2JvFxPdGfkpQbz4+5nvLZ8PKVZbg67+Ves3iAxaifJy2PfX67uGS95ueMHRjsLP3FOcI71INbCuuRcnVhmDi2u4TtOmv5mWATyGiPTALMNRtV3jxJVpLYDRWKTe5F+PCpYEkoIRyRIClmA7MQdgEKoKv7NtawVcHgjMMbM0mcVRX94MFZUQXeu/7bREosnyQFORpxOhp5Sg3dYDxkKx4Dq/tfd/F/ebjXC+IkiCgHgDfpkbfCMB+assXGyxRkGD9uCnBu5hnC4vC1hXeIhVy69vj+r9aMllO6yZtvYRlF+lVZ1TW4Qw4knpULiZzvXBBSxpvfr8ETWgEISki6thp/HAXIagFSZw2Acs9k4uvUu7F5gQ2XZ23w8RKyvMpPdDAbU5s5hff/96EXssQvwpVEFPIscDvU7BxzKTGOvcg442DitOrcaJptPdij495Tbo2HaqY43mFzKZgAlraI2UPMuLffii/+K2DAQPuyCj/r/lArI1tbyVtG2t9MXOSsW7B5c6u69Wpm+l2jkVm5eomib6Vf+0NHncZ2DN9R7yBobSV8lfgk9dDvFtlPP1lR8UGOOTd4RT04POiqkRF74pj8Joqm05/fLeh6ETi4ISfCwq3TQgK4m8IlRgOz9/hnY5qm9j7SdlhKvHsRmxW2k6B5HwlFOhpi3Spvyj8Ro9SSx06UH+sn60xIlGw3In+eZj1MeNx16rKjESchNxrQST1JsewQ3OpquxUrbsztr8KniOhKHwzyMavCocng4v1f9FmReWrqXKgkZEx2NBbA2RFvld86CFZpV4gzh3jpV/sjTqO3c74WG3pCmlmIyH02djB8npP7Q2viUstBcBy3E29svNp/fvQAcJiQS9JKCuvftr14JGxdTWfg3JZ1EQcwJDTSa5nFLecrNs1+L2kBOZIGOMVn2KCxrIygsghYsb6hpO8Fm704cp5G6LemiXTWnQN3RZpDOLiVxSL7DlwF9SSTHAXGXNaO1YYvnkIjG6ZWWwdfbJAkDEsiORtcROUDEFbxeoyGm8MADwgePMOIa41yTLeHYldcI4DM6EXQ9ypQLF5+4hX1T2KTSddrVFyjDKBVNukXZP0TrRqOVndN7ER4F9lswWC9IEbXGNiVySoxPfZ1gUdrWN6yp4I9rBQtrW+cs8vN5+xEtEoYugAgAgeYvf4Poou20RP+XWnvXzpsvByCuji77CmkmUpbdz+sYItOMmPe52DveYyksuZK5GMbqvgX+FKedAsUO2fTvyos8kMKBdgj/O1uUjJDoT4pvigqL8bIKY4IsEEN0voZO+D9OAe8QtBaXdX3Kw5i3zGxrcCeXAACFkxvGQUIKQdsVhcJ/9br49XDSmTUB6tLc3mJ0hxW8kYDo49htPx7vPocv0jf720fyd6japv/fjsTUtj3uDN5uB3asThrHflIkIW/c1ShnEzg2oAfqDr1DgPfN0olhXo5dh9i+0oLdCGYvWw9alT1pamtXkJP/XLJM1eoJW4TTbdidwrpDUNZitMjLRdsiHP5G5BdXySHFjNB0omlNPchYPkMBr9WC5LLtB1CqFZC32Wj1Kl1Vfc5wG//VyjiXtL/BUK8Si5HLz1dKAjngkAFUTyxD9NlhMq9sPIy5d8gJvyjpPelzo7JQrGr0KhifWXJgJdL45ZJ+Fs5KONbIIHNly20vRHXhmgpcdDBVVz1pQ3aRcZTczn/DFfyo/jEvauI8S/laOiR8zZy2oWco9FcALa4rLsmvGzroTk9//gPg06038ABGd+zmFqgH2SOOel3i63QqvQBpOD4Ak7sFNBMm7chm1tqmuTcTATtWNPfJwXhQTeRLNxbU6FOK5L92tFPDHHCa7xUXsrkesyfTizlSdUOFKS5dEYA6ftCZdbC7xzWFRqWWvO4lpolwHW+xsLGCpBwrKyrp1GVY4xbqTKnx/f1Jh8D8LL4nbTlgIsU78kXcSOE41MY9DKKRKqZhREutTULxi+mcS2Uh219oMPL3lC318uNifjQ3ilouuUzUM6+wtRDHptp1ZFgpiVZzEv3vfZW8GISylwPnPnd5g/ZbNgcveQ+uHJFLAWuhdPAVLknMASsWhVtnTtzUdEassRBh0+fee/fmJx4gR06mgB4inHB0/qov9jTleRmidB5MHuPiTehN+QEQRcYMGuGuChTbmfmNrhmNGPrad2tLkTOHhd6cmqBisIV5ZdQxPvzFrC36x/QR2a/Y1jxnY2rHUxmmVsSWzTR6NjqVJDrrj/hF/ECSgq0pUuvfCwOhYALDWibSordoYNRVDZ6lRZ20GPx5EmI++Q+UYGdAKjsHNbieCcYb1ltDpvhXF1PmZDPKwytirSYR8giCSwbclkKvFt73jISDVjgVJSGuk4yCb9PwF7HI78rPb3CM46i3WUcNVocHm+MZ7+eykZ9ugxb2wOgz8YuNLTH1PPA7KtzqKXKtbSXqVYDqfYnnyg86+GYMyz/P2V4WkAISrxhAoEtsclqJzL09iGTvjDbH4sIlEJHng5wJWRLAGrz7z0Eyy9nZbk872gpIHwnDKw3Y3VTwmSzFlKQgJYnOfZzAAxXakFcThzda08DQqlcEtNVBa3hQCF1LC7k0QeynyXImN0LoMuTldVmyScP4g+RAkubf7KLOZQKz2lQvOJQl+IdEDdxDYzAj65xccvZRxRc+qqXV5w7oEYc4LcFY1JhCLBN+6Cp+rAohTS/a2qrakd/rSx3VCyNCojlIoTVqQKqhYx/7H4EdyUzMbIAQRfOYcbaLN5oErifrR0jjni0Qjp1lFQKIP76rteL+phNGWgk8rbymo+k1mS7wgSP0pev710aTx/fm/2tWD2YG6lurQ0opPWRWcNgHra2YP8sdLWa0qaM6lzxA9ChudnUbTOPa+/LBPOC24zVAXf9Oz6RO6Y55QObjsLu3VQgpgTrAetGSYH2qfd+Af3GpDpetzQJXUAMYgAcBf4TOg6maiP+Ujn0GDw6xLwlSdXebeVUCnSjbnNm1+Ff+2JSYDB4xPc5se6G7YbREhYDKzSvrLRBnJjdBxZpXttxVeZBuoAYolQUcOujM5YFWwOikNjjIES9u1MUluVnuAi4IrcxFQB4qGc5tKK/2XsWBWd0kEAN/cqLyj0ziEt9Hu5+jxO4HIdS9peTlrSXm7WVO9PELWYM+XemClih4y22C4MWwF2uqimdbY2wXeVQi4NDagb+crX/r5gCJHesAE3zA0T1za55fGEYcf1ezW2oN74GRAHKoqsK0n0WqMmg3V5oMRAqSDN5jEek2w4UfzoOlE4U+gogOKVw2geEsu7E0iPPg5svIyDGPNbJEox4Ij7BOTMxLtciE7yKbotjm15FgGmrieF7EaJVaWtyaTPFHTToYQRVa11r6PrYEpDgCQNQySNA/lrYEDEIBwyYKeoZW6KrVCe4bwxhxabZRz5rq4x9MBoaQST+OjvFpecwNYn+jabATqB+TrtH4KUU4G3g7lwQ1IePDgVODFtqLVboPS+eMYuDQgAF+VrDN0XIms0RhQmwAblv9XelgXsIFVPBW/AFaO7nV2vGL7PH/IVMoqOyFID17xsdc/b62QiE4A94ksRZS9GI/3ls96FT5bUt6Y4Fj02eXMRIZWrGDVmIfiMzSqgTp2jLwYuA1cMD/FAki7zFSnm4VgXHstEfL++E/ul/uPRIpbTYFSM0UlvOSe6aZwmw1m6yu8bS9PR/J9ZfIwxC1JcY0R3sD8jCncKL9Uir9zCS8mvj41PXBDDKdNIerhRoGkFgEeUaFWcxYjxe0EMNa/eqkjZxXhbb64tGwBNcgvUtAen4OkPKtA534Myp4YeXyaXNXvCKLzcsVq23MOfzx5s8Qr9T+9kV5+qP6wewh5Jja8p/+EVuHoyJ4jvVsC54yLH2hHQpKwBGakUkPArLvRaX8pYi/xykDE2jw4Y4kq9zhg0WEZ10S/bwVRDEjB5Toqe+FDcsDw2exHyumSmRfFyp1in6+uFmMje9hTHugohBH5wroBmWoRoLEfqcxme+aR3SdiQEsiFcoTN50N9eyaNt21Qc9hkNt3byGLM03F8XS3pGt2xCCO/lG/5gAUWWPi/7JmLHFHMsMAIoabuFzmoF9aJGGaiVluDivxVSesD4GN1bvHkcmlusPEMqYo8WXLh5NLLPnQLajOUDJbbixg+fOnzmIq9/qK42/PhhshWQGapCNsIEYVU7UQokjy7un8I+IAL5AoYxFNqvfwFKUSSgUiWKOfXCnU/uW84T2+OzMwga0xJiq6QiVVuNBDcwniAN/r8LbAHJl3mQ9MCwzdqCZs+9JB1NW6tLb2gDsN/Is9IgW1z4/LoYqy2aDqT6cJJ9ztMKZBny0woKOAPP9VtDA0Dh19zS4ZiefnFDidl+42mGS7MXO7Tk9o1RwUVdF3A07bCDSlnwq7HuSnq4VkW+FCyRj8ivv5a0KkEakbvJcBuh9+rJ/9tUwPLWWAzErsXyG9Ddute6TV+ztsHSrQ+3jPMrCiByXa+QA0noYGmTX8IJjmEWDu1K+ClahxgJ0idCb6koTOj4eaxTgNmsOleoEZPVyFmIY4hBctERquhu8GZA03+P7Q1c4zp3Z7AoGL/aiAPp9JAkslstiwP87z2pnVvYvOTOHiOMg5gl/h4TOUEXxx8zkHX1MXOTTmxlPvPw+ReverSU5IxUlGj0OEKDtqazHBo8jzxfBWc1EnbDGcT/L4DM3JGCyOk8z8BK/2wgrEuN7O3Y0cgtj2+LMR+CvFBORyY0KUqWY+/6wl8f+cV0QsgfOnO5ZoAABLS6tL/gD34OjMriXNW8/ZHIr+2u9IdjNvpBey2ocdgnBPkBa0fhnDs6+yacn4R3VJFKYqTbTe9DDpGmEjJA7ZeBupMEr2UPWsznErUDMDjNtyovvK5If4i6O+XtDtMhf+idVZ/3fUyWBwXqmwu2zv95DMkuvQEGaqfINTb2B/XEjpX/FaJ7NRgztnsGtruR1+xgwGP0jUkEwZKORh4LpAKthUG0qux7gMiKfrDktCkEx4Ju0URc4XeluqFT5G6gZUdV/DQy+/pUCUqvSP9DIPWliy1SHB2j1T5tviOBCNf2OR5GB6kEJdesgAWa97k5Q+wbJL6mVsPgpajV3LNwY0dPDd4rCkBaDOtXY1I8fM+NZEKwjX9/5oBeD9d1vmV013KVY4pGP5x+jiK1GbIwWp7mY0Cn94dhmQtVXDeqllKTbSzzRKZaDvuAgL4ABlWhtcazn+jMOyGpkgzMtKOgkB30ejAfIwuUpo6zdZ8OtUGeoCdDjSJxGfB3TTrG3jDlTWHqGjLJliXsuEwsyApHtDvptDvZKjVec9sKdatHbff6ch9EJvQk9Fstw0CJnOCp+qSWN79z1n8lBSFVOwjwFj5307fPrsKtCHzTBgcrhMSwNbbKJFVPtyQmlZaYeWRLXQUqHKB6w0ugI9PL7SmXz32YhqmL9qZnDoNARpHxRtyfQ09HwflmWudxVuKKbQXixuxwmirZgqNmroBTNkoS9icK4ppYqfytQm2IAUHwWTNmCPzKGMH9rXVbKjFv5m98FyGkvxU83r69lf734RYWPNXz6FAYgFi5Tfi2Aq+Ua+UZaQnvaiUCIu944zf2fwdGbzo8Wj2LNkFmrDyj001oR3rmpIDtJm8wXfdxC5uP8EZRa2ijkaIRQWXKtOS7QLvfftqBwXhJr0GYq7/+zupvSgFgpKngH0G+U34jLoBRudAAAi0Ec5j79CDC13biw00EP3yIvkEhN7YbOAd6O4VKu2s/7riIEpLAzkDbw87fey7AJwDT7VY1b7yKAPHYrOZa7AiqnwFdKyN1pNHfhgEQpT3UaoBg28pAe+EOaaH6KaKFcl5pDExzISlxNZuFy9ZT/wck9XUxdIqetD9WXY5P9ewXYbgGFN7OSkDtrxqpYg+Z2fQuJChy8GUqMfMvxZoxniwIXpP38mrg2YAYqGk89SXxe1fYuI4b0hCDHV7sRtKdEjkyAL223IxwF7mOvAKXrtDTbMFeWJ0/ydo7Y2sK2LQjtUnQPaFmTdNCMkNBt38iTEWP7/32Dixn3NNBHarj6URrursoFlJYNKfSyGnz7mrj9Gf9PVwoAkJvfJ/pF8w1DcVZKqAUSTJvgYUuIPuQQAL4nuwFiV0RrPigL7IKjpvoqUjdsJ884vmZcP1iKi4FvcrJ/qqUDv+gAiNz41qwdRAJAhemH+H8AWWWItGSsxtUJDyWNYtj+z3ZCNeiSCyyAVh5vmZIQ6yqRWvqF6i7IEdWSmXrHJx2mYD7hKMSlJJOc7274Sz1HtDwDaoWdN27mw8zmTWXAxqW4sw8z9PFqZ/c+AnSoH/M+awfaOfBYsvAi6+MVD+9FdTaYjEKZQIbxLmQmYv/XZtP++b9fP4H7jykjq1qAATrCWE2W75GanhdVQpTivsztF2hInXO7zMIo+x9Yhu4KA+v8xNFPTVdhDKO+DBEIQG3kYgvv4Ty6wTjH5eOIOsB9LFmp8mtHzQ7mGev+s1iY0rltmls1f/85jEBf5jbLYTmsKAwP39myPvLgp218a2rGT4FH3ZW+lRztk0TbjVG8SosvBLDI1jeog+6VYZEAHBQYw6K2xCWICA2EQQ1kpPzF7T2PSjA94x531/l8511G3kg+B/DhTNhioWK7aCYDXe+cOIM4Lw4nYYbs/jGBOXzrI+sbyhMg2oFh0qEn/fHbYsmc927BA7eP4Wss5SV0fPyjLAqiG5B7mGWeXv4v1QCQSAYagC0lABFcqeDYnJF/tHpp1+y17A1ioaOxiMBXCngSKWGNgKjVtUD3PvroUR3ydq80ovrvfR7KkXjyPCAbFnMQm9Il0KVIN5o/6dM/CF2yXjPMMUMcbHyR2gKi1hH2x6Kbq4YEv8tdiY2WzqVhnXNDFN8om2b6M2yYJplnH1pBUB/oSZDtVgKKSCdwkUQbL8q7lFn0cBjgtnL2KdPgVTVgzMKhQEmEDEtCbkyYmQTFmQm2GYwbYLQXy12p+84pWJXsU1bXPjvgOrRHp5MyX5JJ588hTg/sX+w2uVG6mj4wi4M1399W1s7HHrQCX+/gSWCe/CwTIqz8brYFgILqPY9Yvb9Z8L3jlaVl83BjM01quadUYjv95Fx9JPFL790qMFlC9vr3ceuRsqD/6KmAYv5uNvutAimMDt0Uome6muCR1CSJV+ixWSpqeh/tD6rmOhIG25mdQTYJ9wMYWxxThSA20HsXTImBJ0MrWfNaGg+lfS0WC5GWLdf47IES2Qzr5ihlk4aiHSiRNHi++NT4Pz7c0n8e6r2XtSRayHMAWj7+6FisDEcO2p5AIlKtCQ/W89Ulp4TrGp9iRh+XAEPmiYRVS00UHQOho4Ngn2CAY87hTHDvVbcoMpssB3o1cQbOLetIWfwaYCdt16cXZ4EVEDWg8yOk8UPmIFxofotdWq7Rfa1dvHwJpO3fpKmXMwyQj3HAhNPg82lpgG5m26lWA1jozf9IMBSypolZD6By6eYiVxrgKSvpRV4YvD1xmVqw7lzAN9Mr/QNaI25q5nNLmxBypefglfmnqzbSnv/lUhrYfi/TRAgVVKMsU/+HVR5+GtebLhuvXl3gcmHngYMcWmFOFRm+ln/faNgMgr/TCoY0sObyXeeihJ69LC6SOvOQTOx4Z7n2IwgQvheute/KvggqbrTWyJpkju1WYIVvPUudapEHaVCMrxgPpq9gO189O5M9j4lpCIYkGpBQYS8GVlb3ZDeEmcJZ63EHCpdULd5GTYs95COV5UeVPi7G/vOzblMmWDFezepGDJvk4uP37dxnYlLOYWVatLGcMhmaoxBBW3ySD6sVmUY3eLms3GVx7wv0jJJS43KLm6ckr3RzYnlcxO8mk6zRWO36YP5iZ3nzUcji9wK/zk/uMz0oLPDkYnIOfcZPb8QGBHPo4RbrUo2yNQdM19P/y0dST+LojmZiefGffL1vyoTS42WJJykgHxBMDpWx0P3BfIliPRPPHJ7lY+AUTvfocGTYyBbTG87cZxl61v1drRE7y813QbpDBcAA0ixrHUpWMrW5Qfktl6wZSGL3duOJG2SkTaJSRrIDylIz8BP0NrUwYUQi6tdDfZjrw0FIAs5vXTjnRN4lIUb8ZwgYmLMf9ZmX7vVCDQtjWRAYaoQz750kXT+m6JDFwducRxdlI1IqL7zdfOZWzykQFqr82Zt3KYZoro2v7/6sKE8wl5j2lXYCuuxySKmmI4oWbKIqisorWtCFH6A/C231y6M+IwxL+CyjJofSdDFT5EFI7yrf1Aroxc2tAXh/1rZBluvEsbG65ktJlLm10pAV5bJmgHShs5E4jvl2sMGmoMgWK6y9D4iJk8b8Vxcdqd6QYuLTIlkOOoXhtYi/gu6jfAPmAOjnJsWT+zigYPjXuWvf+TLBJNr5eNbl+Mf/VKGY8GFRvzqPDX6lncjsZ8bn8THQjlo3YrQudS/L2Jw60XzCUzzdeBe2lvfJFVeFowPv4O2gA5oaBPuH5t73GPleVWQUlWOkZm7K6v4cT1O8J3WqkHc3jmwKGjs5GWATRcc2DmS8oC8Xc8NAwnfzxDLHL8ZLfN/3GKeVK7bli85NM+x2nbiL6RmrajW0anVwyy0CPTwk5CtGqT2Dbc8/5NeFlQHkBpfU4izgXITV3aDz1HjTYSGjC5j/PJBi/mmR4G/W/5jkbic/C4XITBVWmQtYbh+wkrV11D8QHDDQ02BauJx1uVyC34GFBdLt9YJGCOY1m8go1l2Z2lAk7BciwI8rGRAB43WeH1NGPp1kjUGhXmXxwvfNnXiTyPN2q0OW7aprsNo4RVexE27F5Vhnu2m7ufBFn0m5TXqsRL9i2kuHVnu59DCaxqn9Fzhuq3OS8dp9asq79S9tnYWY8y1QB4YUlxKDc7YhDa7ZTu4aUXeGXgZLskT+9qH8SPHe1/VPZgqSrre4e3dvFz/Bv50dsBtP2BaqP+hq88RoSk/UgALhc8bRVV11roRYWj5k3yrh5s3PwWz6Sj8scseCrlb630y8uPsguWKVnPdWxtAfrcc57djjPY0OGByRNJzEOB1M/f49XNa1EP7Xhi5BmlJSUsmruWtO/rH5SlNowjogC/ZIRPjdbwe0gJQ23hkgE2ia+tsw38yesQVRDsM/xAGrqccNCM8U9Vb3jnopzHTCRRPh0JG/DVSe59C4CSMS7W8g7SJkXyULumfy4t2sE5p0J8QTCAl80kIUysyS7m/o+6kKs9uSiDXRh4LuDtgJwHT6yZCyyGVrMSktV0XGgVyeD2Squi4z26lvUHFKc94PY57VGWdaj7jIlMWczTFoIGKjfDRQcPNn7TYDaOZIaSuFFq8w1T5KJ3gxn4ONaZvuBeNCPwwhlEYLdzP8p1oraIVNAuUtGBZ13mCtKHozEB+k2XOlJzjqISeRRK1uk9upQSYgwip6WTyxzLFOYOJrqAycO6Bu7C2e9OxpiOEAWsqifWCEEtfBLV9MVGiWYes0TMKPKaB5C7hN6xZacv912KOPvT8/+IBGSoCe8J1dIx+LHfGFHopZn2QLDYuq5J85okve8i4LmNCOi//sN5UMw9yx0fc9khIU6YcgKr4sTEdac9WiYEDzr3eQnh1Y6Inhqx4ZVC9thMXFM/z8FY9TjjIZzOvtjRuL0uht4tL0Vo6Z+GGnB9NTUyJffFbfeDHcDlNffnFkIcn0LQBraYjvJXACgX1ACsO5w0yeTI7h7GH4SCLLGZ3pIiAjr90GKv65gxLs279Za6dpAB84l2kJ154FTxHfvC2rEKdkc/e4Z6LEd/pRdRHsIR9TzNyAL6QWwChCGbFx/rHNkxdB1VcOR5uLhy8qtoxEMAp9i6hI7Z1iMXVFay1RWW00BQHjmtJ94QDM+ADnoKOuzUtt6NLDUdnKYmXlGuKE7j6YrZX34UG9PyeCUmSjJufd3tgy1dCQP/y9kjJz82gS551RuEmyCc1zK32Jm2MNdSbfmdvyaropbbFL6kFZK3E/YB6CDM393CMi9GkLgP8SGVqUvYSRnWGs1cE1L0QKMUWM3QssAYGNlbcFXePWZMKKhP3pvATiIoymxZzqHGvyPgSSb0y2OIAdBT944bBn/JaCUZ+AZUsdpyqz8Pc8SlxgoeKM/RVmW5/g5ypatE2Y6qPIeBTu7OcmDXa8sxvP51wEKhxfI/aC7oFuldQ+AvjwptXFz4mStiaFFO+/Go2Cb5YAClYrYjgDPDwvSnPvhvRqyjkepmwGOyCH7P4I/31gQKbQtMDPI6UeOYsqAafRBzxAPeVLfG0XuClHFrN5ZFvoysv74/aLFDgVGSQqG0Ead5sSFK63jY8DYDQRzeZuO6Rzj/SJXQ5SfT+WG4E7nSxgH9h3Hv3VF4T5+vI0M4GvYYafVJbICoiX0JiXMwgCNMEAz9Po3LuiT79jPrpS5h5FbjuHDioC7uyBLyQ/0PRZEGL15kb0v+baqmJfwbXdni4AIfzFGG3XRbXXP92Wi+Jkqj31tAjZ0OWgPmcmjivI5LzHUVEgxBTX4cs9tVsNo5ftKV4aSR/oeUq8ycvMOMezMLEYYg7UGpMRvu1aIfhOoOqLQt956QiJS3leT/tU8sxNbwTka56F2tJHbhGRywQUjq2luACC+J2/Z1erQukDectIvg5TfCt8Kbf8HZsvh29b09OmzxHvz5Mj6/jTOrqtU/Wq4p+rhFA985AL3i4zmXbMENNPhV6NObdLsjDkHbe6Gk3c4N2r6kHSo7d9BcqvbKKj95gQAbyjDirLBliOer0Hyjf+HFaru3ECHZOJuAnhmQ4k0jhnLp1WYr1b7b2rS68oKveWx9ltUeZ++fdc9d1cKAX8vn+9/g3eFN7ozzXcJ8OD1eqdjidyoM6N6DEMzuyh4Tilsr/QTMsCryjTVog0YVbXcd3/gnEYMUKurLIO86uHFU/yd6QBOjE7WQ3vFpj114ykdrQpTkj1ZVjSsU/rHWV63q/r5mR6gMhrNoP+pRQ17x+l+9ZNG3dibj090Uj7gHe5DAAXGk71kXh3zstzOclBk12GuXA2gjYs+oroSt50hr+zhWJm7VNm0d8hAwsDeV+vHFfTKpDczViSlHbWcTJyYhqeqlcQRJb7Z7ISnKefY+Drs1fVpeu50VCTvrkKaRYBIuClYx4silj0FPW8NjvSnAxmUOWXc8OkPysG1/SCihPBvlgWCBdX2k/luPMb6qySKi8g+LmucAYpPlhzDhLeBYG324uOBX2jwz1DpUoAai0usQyfxWkh6reCjatMnF96PXT/iqzzsEuSexPy7MWBTLX6G8mNcl+amDKEUt2MwbI9ozIwUChRZI+0Eg8jbxusLPMLcKxQoUaGiAtwQXsdmEjqGsfrBUuyA+k/Yl5/BHyLFnU9Rh21w6f+wjzREdksG2pxgH4kWreQTFXGIIPXcK7P9+xf914P21WisKSmta2ic4TISFb93EATGZxxsae1Ya1t28XRBUvFx2378RXuTxu1Gf/A5kMIlwklHqT7r9B0F0sFDWfkGzgYUuebf6ITIHmb3pwAyeT/GzbvHB57945N04vKEoFtzvM7VR9wjek5rRUYn9r3eOaSYlUslPukP9M4QDyYbzTiFH0udYGMuUa8NVV3uZXpzJNQmmGAtuO/cIzA1tWaXFgLPutMQyj9042kconpr+rARFNBVWlrPMcyoAPu3IimGLHIBk32x+BCmmg4pjWMiCfmA+IPhmPewYc5e6rlr4Aft3fHEPfrk20Gag7UCWy48oqIiSPGS0oMi4hUbk0IQiE6FaCQvlEOYqsmgNO1QeVpI93g6qx4Y0m3fMnkfuSK/z+CkIwDzfHUh3+L9YlEd1Lq2RwsoLU6CxENPYrO+3tWQn8LLJ2T1mAiOIHN+XJOW7L8yugaZLUhBZzbxvOj3MU6dPhD4PfFMLBXZAndGqvQppKUvZzn2bLNy4WauynKpbLJl+sf54uekKJUzA/Ugt9Chm+ZabTyCzOah/M1GGvyuzDym/hbc6Zhom+PRPoYIOWjxQZ4QWoM4lWdnGim4eBURiks/XMAcrmWMvPmWCAPg2pSTnWCIiy+2KMfAbfyD9YVVoUC6U8lzgjfl3gVFtxeXUpoLPmqTWGKq606ti7FHdvg26vB3aqonKukLv3AN4Hvwl12xOW7/VInM7+21ne6RidKyo7EfLMowP/c7REhc5f5kWEvIHK8bcaNOFaXafhlNsBs8AUqRQTZCjLCg0URGAgmg5VqMSOM7bxt19Nbr18vfrZOPJ1qAHOc+B9lwuY7xGxTiO3peKeqoowRTzmlcYyIzwYAYfV1CZJlW2tuSfuCgwCrLeM2w2GXVBho95RSKNFauEcQbmPu3lCy+bTQbUwVUSIc9Z4zgGF1iSTv1m0XHVWX7owNy1C4KzOxAL+P4rmEIvTfkYpAEkoHa5w3uOsq8qAdxS1Y30RSPtbq2r+ZFzm3T0lq7O3D3ZcOib+mqS5ogtH7WMcp2zDKoQ//cYxF6rAF6eMIJOz64mixEjcmRyflyRw8hgqdxtNEg9gzdMUtoeXV9Eng3n9b3t1L5YU2cUwAq4i9vY2cHDS4D3Y2/gsrMAflxlZ5QfrlNkZ+L7tKsZRRlCysedKFKNfikD1yFRb2I0GhglTh5YfCElfg9sV4TanJJLn19m+SpBq9q+d1ugN0A0PkSTcgy/IB2ROrUFmTmv/0zVfTQfO/lI+d41Z6K2zDlQoUSRx6xab9YVTT6xNQEkB1OOykYw2NJMDMu8SzNx5bwRXwqMs0TUfz/xOYTHtB2QKQmUYwlGhZAG1957efj8TIpgcqefrLqM1ENxMQOFQqYWC1QgFcfTuDxmMN0w0QXeTSgewK3vx+X3U274cUtDIVLa9Iu7mABmRRu7HLazEFbFDjd5MZOTccE1x/96PYMkZirgJPWYxqA8uXlmuiHP4udHwMYdt7MmiP1qAd+P0HbuDvcHG/Ndc+GE6ekJO8Wv+bDCbQAF9ILYE5Rl/708efHA1RNayY4L6/kEXb/OFhtz20/R2r0g9lMJnVzrlBG7DwHLCG9XxQDXMNr4v6TUFcPX0fv2AW6rIUVLhnZEmOX9q52lyMtduNW8LYEPt0EAsyIfPfTzwTSNkrfsoRiX1X9SzNA+4CLRKvwPizPSr/PsLvib0UqGgLOx74bY8bjfjYC5GrTlrApm4dM7laEkngHwiUhkq1f5tizQT8YPKXyQtQ9MRHwvTd5PSF+bnbkJ9aqhEHmGg1faYfHB+gxmWgIfJfPodUYSfCGLFlniLWTTfyDail+28tCLQAtFMufBH4rPLLfj2VMQIWvMPv0yT10WXfTSJwV5WVYreAwXOy8q9Wnwye4/FISnKQjVEAeMucafDNLvwj98J/xxLiRPvEOWHvAnoh62JRNwoi3yKPRP+Eth0EPzHoM4Yuo9kDNmZB6i2rD2PoHtCHOFL9RcjQGljJkKp4jH7Oht9OO4hfhFRHa9MfVNo3VeWBBXykb/IqyJjJcr4XmEoQ8k9xTl2WNn2ANUZMS3fez2rA/eZrsMGssYJqNcWZ5+lm0xIywx7XxS8Mn5eBaQlg0Iotf+gAYslHRM+jBEkcwL0SjNdf1ZDqd5Id/UA0YuIxbIEq5PLSsxUga0E/h1ItYaAaubuD6XeePew4UtdWY3yuyLbhESVpOWrK4rPqPsOL62ccibYdvXvLcYd+Si+xGOyhYPw720vX2sRWijIj/st71tTXynSsQ8MT6r8BQyhAtkaM5+NKEh5VNs5fgnmUsiamlzD5WQsoVxhxK1yrEqk+xE5XOvleqL7k/er53Nl8/Fmq2+loUgoRx+C1qassA0DUbK6rvZ7m4Oeef7EC47MhwPzM9IjGo3Uj3n/gbtpYw+gZMy+604MSbEFsQMCKVCS4+gumFlcOnSYzsdwZpVJ+LH26Xus422CiMrKbtNL//SltpmVOo8ugMYBhx/g5loWb+augB7OozA6b3vZo7U7McLyZbFPqN+rhY/WJ7FjXKuqBcNGJEzV2Papvd1kF0LU0kPYNkwIoZOK7+FBFyNgHYjA52oV4NhCHoSYQbBVIl958CeTnlS01b/7rc6AePzTvOhIaHC53Y5W3BQGyP32ha9FsUdqXeDtBbgQaxAjlOfyYMFwlrAms+muHxSK8VE0VbHYaGrW+qzmnC/RK7YtFfU7GdWkYhqPEOYRoWTJzbYTOO8px9r/RTGlBqlGhF7AVDJ4ojGb5qA+SUYpoJAYA4aUg9Tn1SIwGg8oBeBaZRwEb8O4JbkHkSYV4TEZ2UHEVxqhLnHQAAE3xAOANAAliOE52UHL6HQBmQdM87kpQhmB1ujsZdVA+BPGge5ILt7APWmADIYDN7+5OV8oMsjtQXZgEgn4aKiQXBOfElewHzx0bFk41DUvhGAqt+0Wlc33wEAM9U3sZG2OubOSWX2t5wN+SN+Vo+GOMh/UAQV/iE1Bfyw0wwuTiJ7hQ9zGhGkPrbRqINAHR5Y9AIezdnIrbqLtaUQF+mH6rf60puh8sNIUwJlaQnJB5fl/NuNCHIm2W+4lhvJKXQ2kIyMHpX6fOg8xx35ENhoIPMWxeogADAFaNVs+wCDIPAx47ig7OVhp8kCFl/CUjvY7BPQss8syGrCUIqUx4h4tg73VMx1EopZJ/fWGErIICWMx0H0DOm3mUGBretX1nmFyrSr7keZRJn+YNCH6vUSSIHGZE2eAumWNBkJBWz03vALxlhVql2rbtRuLnLHqhKz+DcbliprJlRO8HrAeFYgsfrwiZyWzMJ39dmAKuz/u/ocmAh8EYa8+l6UTvu0DpPmUmQ48zX2TSNE74+GMKSnBLCu80ChEBiRZ+okujBweY7NAc5LcPksoderyw/vHAc2JDr5TptHj9Nay6/6EII5tg/AAsyvAyfXoDnlsn3vM+KcmadzyX/oVUgkxFNqPHE634rp10bYHKa2RCD1q6Fuxd7GaoBDc9J8A16qD9gQ33YpeeQsXga0kHSy7+0N20M4+ZYn7jN6F5QWryCqp5WfV01VYDEEOCMjQlulEnYvmIG698uoq61ifArna+KtC2aSRZUp+5GvxvDfhF1ASvdq3nZtnbTM9ACb+Wk3sO7yo4skboNEAXA6d0M8lUoSUAGBihaYEK6tRIUCRLKFh0wYuM+Ac/amO5NTiNpL4qGMXETmv+gYW0GSUrZ5fkDe70HJ9wTqg9DZsG6JZyhKiBX03ZzsnRRDcKpumunuoKOG9XL95nCYIjTHE/tknRsibKLzCVauevBtoDjQDt5NtFfTKTnN/tpbw2u+elBPR+48hjhqxgAAf2Ys9uOfAD5dgrZRAlf0c9wdJ79G/dekm/8Vp4TDdJJAyM/pj/12Vd37kobKa+R8lL/UvfUkgpaarGjq8+JMCe9b2rc+UsLRlTA2vgKLE7l90xaEYCi9rou5aajrl9U6zPWl2lW8zC2XsJuh4YXg2KDywfCkDSuzp70xHoNL4YmHUYdUx0xSIr6PP02RSpsiXNZB7Wa9eybBtq7VJcyibUS0tmOlYW2iNCjBqtmRiOqXU0sPjhj54Mtl2umog07D5bQ8yQbSe+VQtBG6r05rIk+uLMKnPCel4P/qHiR3/U9B6GRG6L7ELP7XwbCdiCdx6v5Zv87CzZmdXdh0HITMEm1kGihgcBuc2P1xBikt9EdGdsIkmtm8uNqJ3oIufcZHoA/dbzNoSHF+pM+pMLSWbiTbf0aSUSqvBsmRk3GzqB7bojBBLan+NxE2xwh6sjEiggK9yMwmQnXsBHcbKzaE4CqgzL2Zvo1AdrYrSELAIridCdPtaYxB+gMEXhhP8X95EP9EPDQMqpDa8hz1Bf2mAJLcFf3T0PCo4hdtk58RDGoTApYZh0BAfc/vvCdDRWAACmkbFaWUs6H17GZDcE0G7yTBCZfUsbuTCPYmByMYL4b8Xo1/gwm38Cs8AaJKCenOR7vuUri5y0prSY1ZK0wcdqGPiZyPXJnPhCgTCP8rVDMzIbPix7dMNTd8J40XkQVTf8taGdhyOt2aowiw/rT4qkmSokx4JMOtG0OJ8Rc5C8tCnmff5yGRiLk6oO+sgvHOk7B+YwW4EX0zQPh4G+syfIK8XGH5oK0NxgK/eKlZauWQF5sxH3e8pXgKXrSg21+o19tMphwvnD6mz7t7GpOJrEDVuE+KlNu+ccGpzYTKpOsn8KDnsxRcwufUZ0ulTPyqMfB6Y/Y7++Qena90mFRA06fd7iIZram8Y4uUC5a4m6z73uJCEBcvypc3rFKfg+fT90OsLgZzAzVGSGSzz1NOAuAylgBKd5TlH6EGiVvyhalU9/0769SX/zRlOLV2ATcrIF4XxaookrfhR04xW127webhCAHPhJGdZLCGEsRoPokuno7NRSceHB9MU+b3xhs5sdKYwsweqwrTgYgzoMmoxCoqnnbywWvdynwgkvRp2pT7BxELk3YWwWJR6eD+J20YNVYCm83NBUzANfra+qeUYckCfM0P2tWJflV7Q2FiTX04L9Xzyc7GrLp40JXhsIJAAYwpJNPoJvRIPKPqPQLbz8uD7qRDH8HmmQT0vtG6hQ1pULZKBZ65mKAk+a/n/NJ+yUqgAY5/Kjwy9JOBFP0YJ2FXEgXn4eE3CjZvtnn8qR5yMYIAjJ/7uGQnUJCSVF58+AanWQ2XHfua6h0KuXF63zHz3Z7Jsbz2P8DdCx50pq6VaZGtMAbDx4ALx0iqUCs/qJQACn2za5n/yYBgtlRU9eCbCXYgAmiuoa+DPZErL31ScSyTU52DuXam1FGUC2esUOb0nBBoy/qewkVubrzkPnvifpzF0vKu3cXGaGmAGU5gzYC1jGQqSP2ESL2s2r3RyUNOCWSH9/Gkb637wfQLLMOdL0m/npiXGnKprIa95IexOTua2DJCUWJa21Ms0ooAE/fMUdU5ap/aYLd7kUUfnbGC0CH7s/utVbiXvO46+2D7rO9X/M/6jm5u3iCrLWMHUHJo5WJtVtg476fXmiof48MOK6QbhRmW9sV/H1v6E3J6LzN537Or1aWGlYO/RRpqUfEQ2k13k7Vx2TuaqJlr622a1HgbOwg43KZEY9Qi/EXYQkhDgdTizDlNoXMiQTeyxol8OF/IplJWJaNYZyjULcCoSDCIkilu6JtJPwfC42s5lMNXf7QsqjQAVvVluOqfTuAaXPs97H1hpr4zqby+B3wtLqsGVBt5vS9yIR0CG8l5vLLGqcSdS4PgEO4y0QfIvpjEJuks7NgDTBepFBvAiIm29nj/bxhKQsyZcObnwZ8yjeH/MNz5UiXjGbmaf9YsMThDTKQhOyLD9JH5bI7sGgio04/fOpZVFF2NH22RNtDPgK8WmHUalfGlvhMsv9nvRf4yDfFZxgXcRsY4yjNrNpL/EVHem7zZyG8iMAoL/u5rtd42Yi9CYxW16rGw4x0uWwZxoWWU6J0+TaeGQzeUsZ9MkMqJel4+fU56WIxU6iGHuGiEpQ9iBXVFjQLe6pQjXQdTYJpW4w75Go6n46N/O0hIu+fQlCmNgnXnJgoGhTYqQl26lkOWBDg+xMBenzKpUxB342PTKIX7zjv1PVJ9vk+0zEzqhzxQcmFo5sb3nHu5wkVez1OS2oDqJ9i7SZmyR022C55URUl/GmdJKNY8h4+KK81yJR3AwcQoz4uPlrrraIxMG8gRnwGGWxZFJb9jxQpqoBEDR48VmAeXIR/RgApxBaZpGLS/sYDv0M20wtX7521sTy4ysQt1oF9GBJ/at250lPz/guzEnRL6YVKwFIpp79WShw6ThnT9c2aVIWT9mJB6jYSoTAyFxsetQe6dVYX/HSBoMrn81JLsP3yfmzz3bKM3JrYq+PaqaFbB9doYdTr0QZW1Q6cnxF6Kv0u0t9akJOTNQb17SB/yTPU6r//juqFjozDAfLa9dwqFxkGPksJNMztryOS5yLTOjXS3xAdM2Ir8O31u8JpncImXFXXzsRlbV2njo1Uyt1chveVJJsOBCrzM3F4koTJ75H2kvsNOQZlYRU6WzqLmySHtbJ6wgQCpV0iiD2OeoAVgBB1TPKc+UzIgKiZ498WQSRZYzSwdZW3I95OxkuX44LDdFSr2MbFkTtMxWmUP0inz9J6VZxhYtrqroNc5OJUYLJRe1kjVQOr0DEnJpMfWWf9FaIlgu1TaQxc2lMwfVpjs2t/ccyHAshgqbtY9k51mLjYo650TVICMU/OTK1VYuqHA/HCsfU0X98X7W6vvXPQoHQ9A/aNNGOoVT9x6LqkXXh+qpYMqSOSGJAnerB55VMw4m5Vkosvxgo8cjtvvLpvh+shhAR6DpWNRYCIDLM8v2rMUSB3mRHm3nSSogGCQ8aXpoUjOK0KD13kamEvrgDsiqM0g2V+lHyLAZoPjs4DasqRBqKi4ZA2CsxPsw/Nyn9w8pSNNpPnoSVbBWRpLcQZrHe54DDaolJ8RrLKzzxm/oIiClTgSGVL674rhrV2le3sxtuzw7en6hpJS/bMaKrJ3oZcBI1+6TOLe5u2Lv2LnqNUCxeXk0VTILu/XE0HYeLRo4Gyoy6B5PsAx1e8W1WryyDbGYj4cFd53/13RDf2VwliTRRu6BmlsyjkAnhrLUqAYIXRSusoORlPrNVCLYSizVrMpi4cMHEvc7APhCHZqSRRNFg+7z2yl28xCGMt7ox+8yEGEGHBK0x+heKS/Gyw7wpAgtSz13GO0dYVdPIxiJf1ev7YRe8hJjXd6+sgwoilC+N+HFi5H4IzrnupqT2twQ9E7e1vAA5O4yXTEJe0CrLKKfDO4HQXFi5oIKR1NEh3TfsKl+nspRjVvBigR+FDywhMlldw1a/5/35tGgKzalu6ueCOEEjaqiqoD/Z3HbYiinbQThOyc018Lqg8PDC6jGYu5tLJPs7MCSL4Eh+xalLdA9w7gglabg+xNFjzwUim47K9ejIggGGJQz5WqAhhKtU/opjeApKniSRGVFLxcfQ8dDFQKwJCe99wfigNxw67SepyeMVl6TOoVYDChNbR0Efs1coUPOM4+VopePzQgWqNI3/mQ2b+fz/J3hNT6Js8U+4F29+6zHkSEj2Xf/gHwpRxPr5FWXAlEKaGclnnm2regObu/uOAC2QgCQjccmvHCt+TggmyzC8obhQRteWlxKXgxzds+H4f+4EDmGdwP824T03FilQbMELDeRCynq1+AWlxvq9SfNWfH+xLZwG9I2u9NuxMYcs+s+dQ+U4WleTH4QhrccTZ5fbHV3H5WRv27TEKDeXtOli1VUv8zL1PZCfyuUHFC16FaMNlLvlpSPbgTFAvjpsNrcKyxObQIbVpW0jubCjw8izM9jUI/hqTnLGfkS6vByVDpOwL9FJX2ovK9GljH8g1vSX+PWJhYmyB5DmknecsHMJsFfwJcUT4dy6PURWrM6ha/xbFv4sogI3NKy5+xGjco7CbFI3kZ8ipNOhGz4mAUCFMfKeWE9yybJ8v9kmVFxLdGbSR9jv56X5wfkX977MelPglj46dLB+cIKoX6vOHQ5PDii0QCtLLOPYQySqWHt8mqgJ22oOxz94WP8TZWdTg+prM9r+xDZEluaOKYbE7iiYDZ0GSZ5nMF5si/QOTTCyo1p3jkgKc6rKEnKPiJWtwAeZUjb+4HfzFD1mGJQJzjYnGwcg5BROE3kDt3TpfcPDqIyp1cKo4JAfJGbjBZmXRGknb89uaMUD32BqUPfO6yqpDJHOrbI2S2jEgDY9aLu5OMGjYiYpyhMY9Ie7Jo/PmUnsTrQO/YtQKND51PGWazrjOgO6D+mBbqbGgFcuS4V6TVHVHJhU+W4A7oJaFdlhyX9C6/gLdCMrZ73AFDCEWAbGbT/eToktzS+pZ8VnnPrCl4D/IwibH9lBNHrachmKzbi0XFD8VPs8/qqGvQNnCJd86Xfbbr95CQgneKrRp+uIXsKzPO1ZKdIemsN90tp90dC5LyZlFfjOQnxeZvvW/k2gzO425ZS0UbneAuAsVrV9F4Tc7h0bjqA2Xh6/rnXQmDYxXY4UiunzrpaKMk0CKXUczwexrcSPNWEpAkzoc8+5bTV9eAKDHcKsSpgVR7ykLbXmZ4GJvbAx49zxuWzpgtlzFGtiIZUoFhdOMXzX5QwjRUKYXYith/sppIVoRRjPOjdK0nsR3ozI1TR1Z3ii84SygvJkk9PjT5QisTBTVHEubXwZIAhmyNEfVcMFPCKqWDKJKSv12CA9Zcey3psQm9/wKRh0eU4T3vYZvAWxcV8gp7t09IYxpShRVVJw8sNkYppMh2fTmARH8Lv/PtEEICd43+1FnxvfFkACmdhnW2H3RLHXqCNz+HTLSvQSD7y0uSJE6Tyy6ek6YBUTq7mis26800Pa6bWyxcUOgk1ZC2hRMULCYxYf/RxkMsZohX0sKi+qThcvlgcM8QEBTljF7UoJ9lu5WNuygzjBr53jHiWYm21sEc+T86J/w2X+f662omTsVjaUJesSJ/c0QRJzFOPECEZOySfsLjv2OFUrYvWx134cQ/UKp3VQvFCRDKVFf9hFLJyuEBiAxhsLjZQLk6mKIpB+SLZ1HvLynye9akZy5PiUgRNTMzl/5HdMfg4zDBV7yTcgIb5//SMmtX8E4OC+RLEeikPK21fLY5ccaGWmnBGPq+1IStTzLphBgFR9IZIzQQAVdymq6lu7CccPb5dZq2EytMG7D8k8YlNggCXV9c40t1vcWGPflvaax9l5L48hva0bqKwcOpSc8ZnpGLe+8UCv6bbNkke7B/pZ4X9La+o3ESltKa8+rsqlW5FqPXWTLlELhJ5xCdqfhnb6eQCv9dcPs/i7f/cyVvvdBqy0RtdrN+dfWFhpgp8vcc6cs7AUW9mMwq7M8kIJV8BHAXJmzNJQSmZMNhP6i0mY52vT8mFf1DbDfuNDzCJl4UbKYZuEylnbWVD4L4GLhuEECN5ZxJKs2EcGU7zdOLoLdRO/Q7weyBqufLKIS6fpBdwfVL6moldgfxpunmhhGGn55IJu0MYYt3URgANd8cG7oaDn26Lrs10eJkkq8bAE5j9GDJE86B7yRAU6tKUppZTz5g9nHZHMOdwZVjxkZlEevTdVhQDI/gUdvpNVfglqm5vWFLMIeQI23PqTiEJw9y/ZiVAwuCcvED8or5pV6QeD8CkbWwqmA3yBsZAM5Yp1adEXYZDLJZS2l5Ca1cJZ5LUDcOe6Kj3gQOm6MeOgDnWS+noxU4AgdN7y9qWxOfRbWLurHpRBq/She/45zfPSsSfaVS4zkMN2ByyaN7FKBPwa2U3tY3wsVqYc/pklLZ7wBBf6lJyGe+LQrSCNXFnr4786lE9CC3FYrYJcOHxgCPnAbzReU7C3dn5jKtCI3pyE+PYViHNTCA5kO2qoFtu3z1P9X+suhCDnJc3RfJ613v9Fux3CS6rRhHS0cKf+W5kKnVBR7N3nPfRL4Nn1C0dO4rTZbFfm3+7iHrFaHZHNZG1mjaHYgwLoCcSTa6yKg+nIVMdfGmFUu8ptKQ7R8/IdNvXJ/3iedS2wk2vkm99LSwLgr+kIevJ1/PvpfKK0mSkCHf5I8/k5hM022OTxmvKu81+HdUGeWehjbP5JkCAA8tCPyTUsTlRaays+AgTdKE6a6dAwhX7PwqocQsheTIICj6xzsVKeyyprsXy3tDLIbYI3qRQncstgQOixGdH5uJb23vhr9XcPB1ydHtsiIQ8OoWw0G7uetspnHvBIb6wf/nxOJXffrHu+Tn5gLmrYeRDN2WBzz4KQ3vT12lqe++0BFNAdwCro4UAkiBTgJHzOOANdQvKjav5PVPuWRHAaENCgyWETcgS2HeiqWrgocyRnm5Q+4I2TcJZuMy7BtcRAJ+SKn9TICMoClMB7ojaUJDCv6Rm8hicIfeb9q74FsiMuvBQOdn+hFfkM5Y9/9waJ/9ccPX9XMqDSxaU2NxHLxnNhAAAAACvzU3pWyl7aYn/S6xsTYkRhX3h1G7LikrDv/173mkK7jRqyOUfWRR12mvGp7zHynHkhiQ1h9muvuBzZcbweFLOE4wOYV+oYmBJN5As8Aw4P44tG76GVAVdxs2NJLu1sIvicBzNOsdhy4WV4ejAETgfRsIgqvjCKcHo99560hvl4phZcvTBxJydvNXvY82iH5r1ic7NNLg1i3B41BaPxBYLEPnRkoyPcNqc6/tBwCwrCiuHaPDKivRAgaFMSBs0SAwh8Jr80BgcaTbGRZ2LU7lUCQ79eSVQtpVtvfZp9qqq+OQ5dDbooLEwag4Dg3uZYQzDo0vOka6J1rk6dRFSUiA+M+3ZXGEcuWEEiEZM5S82ZBJyZ0hhZVHLz+j51x+Gb3sMh+hQxN4FGUhn0T6tnHO+7/pZO4AwW7TH0uANEaMNcfj993D3gG9Kv8H18pNOFyluVBmPXV5DtaaFzRhaWZFu+rn60CCo2WKGIdi/X/S5zOCBUF32/9smSLd9XWR+szalk1bH98dGup1O3nEAIFgHpoQjUwFnxjgurkny4e+ekj2juvfplpmkyu53gIraczmxHU7QNnkddyO6/EfriRwBHD+svHtkttJTqWMCEv/2j1plNFtKfd0JGpnYh763O8AcIm90E+eCXQBC/VotT6U0qgzjvgCPg6HjMhnouvOd8Kfe1Sn80W9WlrkthvNaLMf7NwEyYccf2a9apeRKaTz2CEEABiQWTSXKRssGAkDbEEtc1/0pDUuytKTt3Ufe13puo33tK+VgDar+y9RAhL/GgNpQk6/gdwshk6gdod5J4MYOAn0yVBx9BegbEE0X/gA6037gIYV9I/cp6mwbeob2KJqJrEU55VOABq3r+3AUahGs/E/y/JNNgBXeh7dbZUwBconOuqkZsuEjbDiskxawfN0o9m+uQhuemP+pcwpfCZsHaQpGdhIAdQDRsO7uDpYzd1z9GO82CXla9BmwdAJUu9rkNtRjyafpIFeRGd0n9Dwm2NMeDtaetd+BT3796salnWrEpnCY2Gf5A1EzGlnkaup24KzBQxA5CcVw1umz1N7rY+km1B5BHicKqaj3139KxCUuvtKgBORzKl2DJDT76j+bF2voUxzo2SBLdTwYDVJ/fnPLbiSXYBMFhyTaMLGmEMUtEih27Z2N2BjUWUDm41MLnoxRVQSJtQT6eHEi+xbLE8RXJQaN5LxE4RXk169lMD0EH7CAYrTombidWq0h//GdMgqwYdr0ydbKjdV6VPFnbgNLNUmJGBvVkgvjLsMixhcy69l/GlUqME/ngd00RdJidj1bfJWUVLdEl/7DzO7rSvhGxlIE5cSyIQ8Gknb0hN8wPcNDMTKtl8gn4yC5uIFcSrCacfVM1Mh7tVMzUyXAlBm+gp994btr0XnV1SgPfg8AAfMXarjKOj2bvFrmPMQICh2bIQ1A22NRNzt5JQ8Riglv7noRN/6AoMZGjYlvia9iEY8iN7gfVpb7S68htBe3HuOG/WcrINU3FLOizitNTCO8Mrx408ZsJEyH9F5Ph6vdhRVtiFhoxAuuwNKg2yMHsheCzy3RBFAoz3pkfWTvhSKyOHhxJX4SvGawmZc/OF/Ks63dDLRcVv5TR5D6EvniG9KGIkZnSZzNNm2okFlw26nwH4OIWjJkxipu8JzbAhSadCVSd6yao+1BZZMTrblKA4cLBO9B5h8JpHTtjOeAy1fMqWPb4B9Zy/COu26wa5nTf9RoC4r8xBrlPYeQLb4Krr76VzmiQ3Xlb5KM5JqRj5BD3+OHtnQd3ACf+zj8Hn5MupJSJA2WseTXJ1b25RA/w/invlIF1MUydcZBXWtJU0ei6CoGmQMO8g9aMZyoytUgMI9jjb7jxxzIHqIpXsf/w0Oies2nWcQmsnaTyNamy9wnGrJAyxf6QE130gsy+WX072g+Ra7VbnKtWmLmom/2L2qAwJwJdaqbRsG6cGOrgHI9XiCtooVL0Ylu6neWAADTePEAU6xq1KPWsKTHU600QI2yTs63oNhb7hcKjj93V6PiAeH+cdykBBLzfKG0pOAPbr2gxaas/sDR9L0AOCf+VIAwZM9IdXZsaEircN3P/b34DdCrv7d64nmzV7nDBkwcwHWEjAXzALciAQJa3Zs96FZb340nXTjt8IUzeMH+V810rdyr5trBiUCysybUtcecmKsvG/SsfAwfiFHykXStXFWFkkawZg8+HQbIRUMpRM5KbSc5zmFMu/GCF8Soacf+3SX7zBJaOgppjxYtW5vKILNaASQxpIjIg3WFIM8K2mZADz15lCMY4p/MMPmN0P3mtUF6Qcx3zwQDS6QFK7f33OugLXJkIeJ3iFkpsWX6zSdHDCyj3TyylOv45sDuiq11AzA/1qMnVKlbP1zId/+JRUqg2mTQRzRq+AgnlVVXoVrWJIwZEAzTTOCVTqAh3x9XqWSQzy1rP2nYmTZ7ZljKAeZjnHbWxI/rrJ0BekCvcv0s7XQ8efjvZ1ZcJF9u9NgZQmr8VmJg1UN/NuWr79bwoEow2M2f0CLbfZf73oaW8NCr+thKi0E/2WghbP4aiiC4+tptATIGjMiZkqqjMBuRZGNplRjrR5yLqHJpXFc+25o1jQimYKQGiVrALDcAmm/nVfGUdSJfejEq8AHhpR1Lui3RDnyoWGuBRtsiQmjdtvCxtPmzEBE/fVjCfRFsqMS3voQ1Gfm+Oodxdh0d81s/4s4QAokcrULkvyCK56g/SOilD34lO1nRRP3P3VB2brGM5tU+DQSeF6SdUfQ38zYS8Nv+k7DOFEu7a3kPmeOW8yTSBoiKTxqL0r56VLMt+Pe7jmCte/3YhbT+AVSsh/1BsQakGx6AQMSqmS6SFgmRC+4GtnfxP/0GxfWrhtKCNwKOlZAfhdeYJXizwOG3F/g/IBwFHp4wQBkfWQo+Dy0L1cS80R66dfQAbP+I3UcUZ1aAKbu2qOc9tmsyCv5Pjb9XD+ZzW0Io8zWU0T8TbpZDOoO46cfCsSE//0YpqZ95V6vxhuBWIoishCjT95XfOfiaF+VsNDLvIS6mNNyN1JGWnYvHNAoogtb6oTaOUC35gnl7pt64itN9BaLKj+pQzMLgvWHpZDEdvLFy/dKfG89+EQXKlp+AWzzsstlSrnKu814GYcHOJ65VhQgMrPl3aKQ9KMQ0jnv69Tz+dJuPFkQltN66PbAgFSddWzm0L1eiQ5JAr06m9XebBPqEC4mu85sdG6/1HhHNTnTsMSZfn9RLpUtlD9dU+5RQC9tRB60LQ/+0OOz/Gp/V/mcYm3xl3kG0Pu5opFyZKq0FXnPyVOwleLKgYP4iIjIdSa9qOfetbLlYjo7vz6V9jBZMUJZzE98GbGAJ4io90Usf4dlXlmFY/AOXXVuqBhDvgi6bD8NPXvPM8zQn0C21DY71cUu8TIUDupL6Nfcue23bVFrCxJjZ9T/LBlJl9WNAJCvsHsKcBr2zsG7RSMK4W/KQcCxH+7luNWZ6HNkyBYv5uSaMgkvgEvAszJb/2v5UrSKwtkM0MmTjz9rpRK3jtBOklywF1TRB4Hujk3LeJbtHs8d8JNO59qZudoBL5UZW1LkQnzTeFZ89+lcMe7v5KKrdFKuAYR0DZbzdzgMYKrwkq1oW4z77w3zzGGa/KGyiJJFcRIf9Z5OZq7qZok1ocv4UhxzEKb3acl8AiB8bl4vAeVo997np6SqVxyPKAOUL1b85dtYcPln0B5nYCChBRjPFeE7DwIu4+juaaHTSF9lATnfoKLVrAfpDASVWfLWelWMuddx3Sujjd/T4ZUxpNgogAmEQUN7zSZ0iL87w7ArLA+r7K9BjM1xJL9PXgxe9MglLmJxdkzRzWoQfvMGlbDgtbV1fAzsXgEcXlF+x6iK1IknbS/rlO4p3ZaVJwxnVt2XsFe16q4eVkQYcser3MYza9vQkwTn3O6cPedPRQBGCYXVwBhiHz3QmlqhPyaj078YqzCoX0xm3OYw3tAp2dQ2lbsv7zjIt/XYKTdkWF1uSqDwK82B1v5FK+GfTeDEzeiHTVZPLbjj6s6AaMALQm0GCLJyNrGAWA0fthPGpvnWiPkG3jZtqxbJ+VcHEVZ2/LPrNy0YjIewTCE9hk+w3YDZsT9v0QtkHc0gGQrV+jfnJTjKkPzCK5OCcuuQ0Jxr58pWKPRglmvO50ICLaWrn6KdNyn0uybxNZzbqyoR5BJo0vm4k1NdWv2k9aXbMtJgdBIh0nKrq1bC9fdCv4al3ckUzpN1cX2hiJeSwyg7JeA5VxTh+fUhgNKLgXGMAIv+HnxKZG7yEARGzkWkq+ICFHe5ZAFcInMvwwANPO7x2E4DFebbCCwV8DE7QPQy3OUTI4hU/QqAU9l7/EydyDp/V0uazko0F1uhZGJXPGvNPKnpEfzssWK/72eTLbicHqm0Ir+pl8YJ5kvsK6/2pT0em/iJcnxJtSOUMcHLkrNynVR2w+8dCdXo4bcVCmvhbvI4K3zLyhI+BEd0GgbNykZqQMbUR8gI3o/8WI8DEapWoxhK8yrzxNbc6RSmCFXurxFFJZKxSAnF875P6bYNVAtFjmDm8s0Oju8EKf5OT3bocQ1phrCrOom018CwdNLtZn7XvU12D4fgylHVpaLY7/9WCw21g1Fd1JU5OcvX8/8v25Lyi9TjaBfidPRBMV/6FL/cz8OVMZ9BanzjIAluFm5q55LlYHtfU6Ii8W7FkWpW6/5Yk7dYfO/CkdNtY6L7KqSEX8W+U0Ssb3TCEsk8L/ZzASZgiD2YgC7lePdWZt6fsvyAiuDmKs5YKk7wCcEgKobNlVf4Gl0ePujadREhY9Mx2sgkl3Fr8Zg2ezZ4JikU9+1auYCS0NFAgc+p+Ja9agtRCbESXuOE0q+QCgSVlZXUlB0eJjh7hvCw2FgYf464dSVjHoOymLG0/3CpzssGvsR/r8QwOfwuWHV6k2mcRBSVpQeoePAsvPi6Ywxq6ZLLnsJEhg0vvQ88M15LgBl1b+NkhiuaRF+v6hqOGAk4C7GLGvVAq22DTxh6Hyx9S6rB8/CrIUb4DuaPtTloJVphGhkaFSE7AaxwpiGv21iGoh1qt575akGXpXrDQSmzvNRFiBJwgpF3B8VVUWLyko6UxJ40z0COOlbPLspl0s8E6o7EXuHhWbjwly8doYIot2IJu4YRsaGYX6xNXL7fUddr5mxh4Oi8XBVIjLt5drq8wwfNJRvrCuORqiEx2avXgUn4I/zJy17hcWX4NOU6XpoguEyWJBMZQTitCGHFR3vjqzqBnPlubAhcWJgxrjVX8aR0hRtSXEKLPgPPrXZHYZISDw8nOAYFt3cIQYaFzalLWKjsXEN5Asdnu8flcRVISe/1oJ+iFKyl1ryr+jP/o1yNORocSTDWi2QtsRP3IUIUdvuBuRYh/v10ekQdxgilgkKdyZVfaK1tabEZJIpcBcsUE2yXdG3DzmnPplzgKWrTruIAcsjEyzjVANRkHoItr9eInRvcq14mUnA7Xreb228+OdQeKyiM1oawbgLRuRvFJd8vKfgfyaVORchEEc6cw/MyStSfv8pf/9lYBuat/IpQGlRgQi1uUxR39tx3ahggHBZRcWhj8/KDQshce+lCJCMMlf0+66imF0TWO2F8f9QcwKORziNu7e00aq7DP6+p2qCFoLq7L6nQk3BPWNPOfQpgBNaoI1CCJVVR7g+VqmqqL0lpMxXn/Vr0DPaHeFxXu0oYnclWByykrFUr6iccs8fvxWKqyevcPDLU6YAgN5Ktbgehaxf2u+3pFoo5aa4AeBc1tF2FCATVGBaEQxoXKKOaFIZW6MD7WI7/LakmGWFe8SN5ui2k/KDiEO/BubrDvfCaoLK+ofU1PGA4dXlA3DMm0hRmRT8M3UpDmi4jrvxjgnnp9zoHwcgKuBWx+LRNzhqjOV7LNOrmoB6GsSeGqAqUF5gz1An8Gh1DmFSl1lbv5BPZDCmfMd+SYVj9ffXtOV3HOYCrOJ7ERRY1r2AdZqGoiXV46XUp9QO6d1L6DqIR4urhlAcQgeTVcGdoWPE70c4OwOkAYJ2gazGdIJvnWmEEbNaM0bqejSB2E8FBJSaSDvs2eMgx5R4tL+vKrArs0HFB/C+f12oE0InexP29q9UTsKWJBM1pQF3WiRIpDyQvtJ8jR1o/Je+Jem5yNsnjt71JL88gACgsaYlO5ge/Ec9TAqPAPca6JCCe7jsA5zuuLb0fPfNCmsP5ax1j9y2l7oazPePjhaoQijzrvEe9ZFAh1bbFm3bl+ze8lh2nQwuWo8+wAEGLE6ZLdyrR/QZmH2uUG+RQZM8Ai6SXI5yE7EGDoWYra50zvmyTLu4fz1C00hMCjkTotW/yU+6/ebIq6Q37I/Hf1iYYUNOcBh9qQhXbz/X9GsNVR6IbbgtdRw+GdOcIMBZvuCgraEV2JKsoxAX3X0KC78ZtCbsfCr0De26UVC4HCQaTSarIBXS2NYQeYtvwNu2EffYAnb5uluMu1CTLqPBCHGihmLB1lxG9OD93K4OmaiOno5iKE7U5+q2HRw8RaHuSP10lZldpfrP4vbNPzr6zDFBBE0h1jLcXePnIXKadl+qI0cDdaGQjFdGtXPyBdfLBah32Pt5Oa+BYyx5Dtscr4zQ6MqQAPrFhKA54spBVpDuP2cR/2cIOd74XbMN5OEfvHvBz85zwYfTVU5EfbOTHfPuCaTTs0Moion+fI5fdoSPAMLNQoblbwjZYHcXzx0ci5OQHYV/Z+OXB/ELc9/DNoyUjQZslOob+04LzWF48xrQfCMPDHN7tWF17hbvgqm+fj0D4DSdk4LSHLuMwlnaXoOmAnKG2rw5BIdmB0iYrkPJfCk6lvMa3XHtrwx5TUB26ySjAfN++wZWahdNRMzssmCiKpoWZodrbLrS33G4qv42YAAaikL4uVy8MLdSlpX1P1sXXHmstCIPth9El8ODs80zT/cDJv5rlG+QEYH7i2ndxhihKyMiALe+5ra82tw55yNS1rgNwmq47x9ow+uNOJWFF5fqIaJ2bb2s8ndZbo0XP00IJzfSF1STLj3FhzD909mCErJk3htxxezzfB0tcygwqbLff0Q5qj1/j8LQtXxv5D+rQ/rb5j4Os1lxAUoVX7y9rV5dq6LdeC4TjtB8vWTS1/RUG9e4j/kSaSXq9v2jIcSYC+jAv0gu7/2OaaG52rPGMy3z5NxwzIAaCJmZU4wznB5RsXovZWEcbEtew8QipNRDTjsNqwmP1UkuDQE0qFxT9hX2fiMMTwMZwbwRH//ZdWXoqHTavAAFbsw7qbIj7ywEe9IiBrMHbsoBjU4xnCJ4qAG6tawNGK290USmeNCwsC+hjZEAZyA9iBNfXv8Aav3o/xkE6SAefqouis55P7eaUxFTsTaITuEuaRnkz7yZaCs8U2ECwWI+b8snH8G005J8X3PsRci9rzTtcYqX5CPZmU2xVHW6gkTojvMtIB4a3lqOUJdTA7jGLG1zxfg2v2CCtta0Eb0cbx8i589S8wDbcHKJJ6BuL9IXwDHBWuLNTH2ft0yd2X8vOLFrPS6AeFYdSGAL5eh6LTBZv8rNYRWZ0gmpRXuuj+J0kNMfjDINA7VwFPEjKdvj6P7IlBEWcVdkjdb5Xp3q29XLAnSsisENn/OLVC0vDMsIVN5BbEL9RwLTnh7sunZjPRgF/tJS7G3PG+ANMPRSL7aiqIc0EUMhLgBvKNsOXmcQ6wLg/nH6brOe9TMIXqAuIPbZRGPStUfJndm8IZuAmp63UrGHKq022AoXZASBXC2Md6QXl7VNUyxWQk+RRb5h3xKzI/efgzYv6FpgUoNtB2sWPESr8bH+uCH6PaE5N1Ftv4q95xXSMy0v8/zrsX5EdW10Zc5Q0+UjgK9RgheUviynAUu7ndLvxT9NjKO7LaQW0qA65uYN5C8p/0hApZ4WYVXILiizmu6QuM5sNMq4a7neRqB2gTNb8AXzfTimGVWZ8DVmmhuqUUmSMRFJ1gx0xI1YnpDYCO5AfbwXCOOvS50ebdnOHRg79FpYplPlHEQp3vKyyA1s/d0IGhezn1HR2e6aedjklQEzV3ezz/iVe09XyKW8ba/CLb0puGYbWX3mTFi3iIRL8r91W5DC/Kb9HUAl38eDJz5qUykiwUjQXEvjkJIlonyOnXEcKlKJBS8QkFLEU4Kc4Lt4v6OeUo3QmXgWHLvY79eEedmXBggTRuyC+QMLWJtY3WF1gUvmTnTp6+0q3IFEuQ8pD5RK3aT0f12PTt1YtjZtvecG1PWY8wmnJjvb+Nfvt3j1rXe9YAkGp53E50z/Q1RQCrCzQlNndVEQlS35ijyHd5BJmhJ76trWkR2Wd4dJyTDhbfen7qXjkjxh6CpNbqJYWKi8g8MOV63ODC80y6S7BoG26V4xN5zY5+R4D4oUQevRmud79bkvy1GPAX844D36dQOtTyLXqT3/vOABD3yUUG/u2U2GlZ9XI4khf5ezsRr3XDl6XWn+3Yk0vRb147GfZV+69X8n30tnRrBwaktJYm0iyhA2ysAF3orm6BCFtyWmAoSPn55cXqRF2wxWRTqGMxCAqV48eBhGEoq+kjJsIaoYN+5NWIsBEchVQsnfVQOzOl6g1YxrKXkHofu/CePLKBu14TOiMTvWUmxjeICRzA3qzKOYUgteXATm+OlT8We69YIb7kbs3B3H9x9zIlxCyQqKb0dsNTG6Xyxau4d7uAdm0LC9shfJkMEUgtKpECSVDnXvoNF1a/GwIL3RJgyshhwC3Y1Jrl26tB4MqGa6+kgyacmQ8lOqQt2fhrrcBPpRpw06VZk0upnVfY6THV0ecnw0MV1F4vPKw9Nn+Jx5BmUeKuTCOZJuHlPHllhFNkqMkrIFqgzw180Pt/EGVhN0UFWDD+Jil22d70CZO9OjgfwXrFkRLT26U07qiOH95uhdDoPg8Tm0MG0h5Rib3SKHoXLaUUYF/8eShgEll9dQqDfDB7gWEZPRbD8XlntkKpmQ6VEmzZID0dnSSX1zpACcC1o0j2GQng7B0+eqYptzu8wNipCPPQUZcs3GpnI6A12oD9biB8HY15wdCJF30L3s0QAnGYA8mmk+RhxK83aNnR/qZT1lZfXts2AvAkLEElyA3f0NNQnT3q2aiFIsTuLPKNbvAIPGsecJLK3jZ2qR2NXgSuGuciwppg3njeL4lGGRrFA3eoFPY0bkBmYLRqOpToZDr8zy1S+B2vmyo1kMOANtvjQ3H78WvWvBRZQPFKgqSz64t2UShMckw6DfpORHXDJ3aYIWe2d7jjcodQLPD24rlZ5tcO2EyVQH639ilhzDSvjsBYMdplGujEaD2uqwnbnmFDEJQa65OQVC3OLY8n9xlmBpEV5SmwQbktBBLLSQaaRziSGufoTrFs+3dH2Wxrl99VX6wQzGOlspUGUTmiCdpyyh4YOPZilQKHu/7mY6G2DbDms1/nvUJ/5wlu898QoYgV3xT53wPR754BtigvKde0x+x9c9vZzYaLgfijElzIC5k73ytKovfUI1uQCymXS3PgKl9AdIsEWNKFP19NKckW47TeTvTlfIt5GEQMaK48QBjxIOj8td2MMbSYMQpiI9Ri2X+HMAHUmtXAAdiIZlkEOEx505GAC4+lBFkmJNMgBtwPeoQtJmyNVNOKGtXkyHNrFBpOedz6X3ZSPv/e95VptHa78b2CsO1+HGEpsXvMR1y2gMaiL5dqKnDP4IyKUf0W5UFfryfXzhOa1oRgW7/QnYW0fO+M9IjU51HTpIonwbZTetzDUbRwgegvv9PstjB7tikqKA4zNf5dRs/26jll6kDV1VQf72vY3cOrcy4QQBxZuMcLjGcYvokYNyALv7xpm2oYWJuFTOcWeyRUWzmfnPyF2kLICQJHpyt3UnfRoEpoDQt78eRXb4ck04nlx6aEHBOVkVJR3Ebswoa4ElfVLTTO1DIxqmkx9jV8DShJTZoYYlNiuROO27pXgm7TBALkiT2Ij98PNr9g8hNYawPLl+YruXpOuVy71VJAQhJVz6HbYFyMLEFCu4J08UfmXC8BjWDRfHZJliqp2mV3e78UZdl0/Onh+SACeJwTDDlygfBjH9nUCAZg45GDNLSa1HUNHY/D663WWgEZe2BdMT2fQOpnOkrKwUyOU/iuy9CM3ke/XEH/YomfQFNdB9exZFReAJINl9ci81ge7hHH2LF9lAoPwm5eWllSbcNvBqF0uVm9cHN7YPoRncqw64dZHmVZs+JBUoAZh6uxlBuyQcYTxEnhrkdtKiZ06iufIq8IHjE8DlR4GzO5lgr+K9LgS0qIUsDVBu14aD7FWP/sIwAbiEJ5GvcEkCbW2riRPyOipJYSvjxG79G3tf6HZsvEo+eBR8luGzcWtz2/hNVrN1YSY3zdJgzSW+wB1cahxtLpY82gVG/hyDERAB4A7VqvpxrSCI0FYp+4Rq/lUofZqi5fGyh+5vIDEJC+WshhI6r0vWzSCmabdDbsdSuIfPOC87ocZpSD7k6eajJX+VK5x64njVrJX4AEB68Jv3JWa3kB6SMkVpA/Dl7XdgxA2wtdrSvFJbgdu7xCc5qirnZF2LclLM6KuWleZracmfJQW+hLdzSj1BKae6An+rfMrAAEGbbQ98pFTJ3vI2T84sCOoZSJ0SYTNThE0T7pfnfX3L8CQm5qE7p7Pgc/pgqajmPpgPneixjjR0Qv/TUngW5+bMdpPzEMeE9OYd1RtKxNdreQVoCjTnKm5K/F0rBI/Pva/IRORWpnjuindzhtWBWg8G9oYV2eZuTa/nbaJa5dLJxfcLG6bjNLP3u4GkZEQNX6bPbo2gzftqdR6lI2LyLI0OYVauMYy7tuUpEWjaPDeXFEu1oR7EqS2PkofgwrSt2VE3bUuZGY1GT2oOZ76soJU4DK7Tzx/s9ehOu8LHv0i/+SnpbFcDoxhp/iVOS5wEiX3VSa42W37oC/OFXlCN26LpsIDQrLN119pkzvLyWVCZxFfKA8xgNccf27TZ8gVnSGu5cnEro6hEtXXdPXVKDUqAkRzE2M0zbhKUCZGqMRLEOitQW3V0NP1gRnBn5m9QEZl9yCqcacttSY5k/D8MrFPWwcFxnzsm5xUwbj/6ON4SdB6B9Gs0EbBYrUEcBwQ4vyFDZcbwIkaOJw/Z7Yzv+mhjyDoWOxaLWqVzvjZ1iM/a1M405jXqXQbKMQA568qdO5Y0pDsIb/fN+pMJ4shESxj4TW5HqdY/04FY3mp7PUilK22jOsKtUQGKa9zt/KmsXwOXFJ2JVhYLd8tUBKaNzYPAKZDW69u1z/qS8q9cq1uZIvYBnudqk2J+mDpszJ1xrVTwS7mvYh6MLRWKicl9K3FdDUzOq/Mdj9vdVI9/TNaQWBU8BBgd3G2aZs/3sWlnckVjGM4hiz8KQ0gGBVj5APwsKQJkCHSc5XGG+4Bx14Kc/rvOcmvZmg14wlFkAbDUUG/oU2o4AMLfVfsMeVYfiP3SGLiMebYRVIgtt0YqgPeUgz3qqBWpP8iGISan3i9cRBGlt/7Wkt8DUIv8gw20oTSTSOFm56DesrZ+vrr4/kXEtQDf3GXK5/B3kCv9pj7pvbFSOuvAqweukMtzG1+fw4QOSylPBXddT+qswkkTCQ+fx6Ynv44ggZJEVMt/dVSGGeoSPch52Ar0at8Bs/JWA21u1NydPe44Rt1zIHnI2E8B8NXgt9eksFQjExy1ahp4jhaqhT8O+PtWqe91ySyvU9+dEbbS0P+mIbRjljESMkjVcmNwP252s5JoacQO8i2XChF9zjeBOpQJmnvZr0RcThLXVs1r8/zpy5cWXhUZlYhUgHxMJQvofKpRO/4/1CPhXqyn9dTZPa018WrcR7gkMj2jBolRAXJVs0yE6uyD1qvFaEibIaIw72zSR2L3lJ7wKlm1FUyJLWbJEaSXVMD+yOU77jx1vT8CIbex+oyZM4jpWSVCcJs49YHBcMfpcd20Zk36PruMpRA18pBIl5o3/C7pKWJd+naIAJKOqK58PNTK8ahoFIRN8WrcOhTm0ydsz+uibCO7qt8rGLmeySEV/zH1bAb3O+3AGwb95pP54LcIgmDAJbJ/e539ulols6WDwhe1XY0gE4myIrb2HvE6H6j6xE1RmsIuD2+0q45MpqguMMw4J84lBCASnULO6JPoHfuzcXj5ykueLBA9pii9oAVh4zLQMaZ8RwMAYdgHqiGFCmejfVPmc5po2XL0PHsY8XWsycaHXUOYHkvWJxtx0yztwVlLtBeOQ0Swv3pYChnUE4Isa82KueW71OLNe7HLsXPVwAAgaJeGhVTwMMs1xyxNiSVAQM/ekyH71v6yPh9Yg1jExriBAYoP5QlQz/oTnB/NajY+7swlWpE7Xjmgta/xhChKoiWZccvzY3dR4MeWyljPJvbUblUvrOpjR3VrINs/LWt+j2/DP5wlX0Zsyts2BylJFunNq+JoWmc0gf7N7ueeQggNvulkCjOS86sKC2dvH0vp0jk9aveNAGPNbNhhNR/S05/MXgS802QnGt+X5Nzzuj93i1ekuUYNG3kipCVvuxOjau6uepYMBWH7ckMIDkJ4/kjNHBiMd0j41va2mHKzogAzAtOGY09aTwLgEGgo10LArfWupgcRckybUhUXwyPaOwvbhGEEOhIYSLK96GZq/YK3dh+PmxBAgSSbmg+mlcGgLT7070L8DJnN3DiOEi1ZSIHVO1yOZhTiED/skFx/nIpTO/pTaGDta3z6alVfFR9e9sMbWuDBRFcJ4w9CNhlTZrzLZaWXEiOI1BIDSXk0fGRgzVNN6TSHEeQcVyZtj8suNbAxcrkqeDICeKnCaWo5bPpDq6nGWctbBCN5xdFwhZSXwIGzEm4FUzDJSgkRQjAW0AEVtL6c3DuGiWD6KNrXqUEnd3b1PdXAzQMTen+w0o7r6wTqE/fCeIE+A2TjiZJfsy3UH58al4X/QBvlv1hJs9dNkOyB9jANf3eMNE3IWLD9eoN/+OlINJML7BNo0xfMBuk4/8GuSSRD/8KWyoSl5n8LVQilQbYe2TgBi+/5gcPrj16unMeayb5LI4AyyFKAsIhh37cgbBLacW9Gh9KKBpG4tK6YBwdLgBQZvbvHFwvsvbz89VK5sI4j/b0fUeRLwBEsKCFAxi/AiGC06p3MFdfgITopOLZM9lmBcJjDFoevWd5wfYJVC9N8ZTCYX6yhveWG4EwGxlpRpsLVZYoQpKmYA4y+MLmbLWOD5ACm3hCjP614OvHvm948spjO/TnNMAdv5+utJi3Eu8XW9cvafHmL5cOdEHQI86s+Bo9QJu4EXItOQ0G71+oONy+XOXU1BJ1VBEmLJuut9XC71ziqvmwnVHHy/+IauDxkVScuczHHsCgsSBJ4Ks6O9LFrQAbQqCYWS8ucVgFkd/kGvgTIBPPyY9QEdBv6bXVB3wkB70Q8kYM3gtReSRUrxGCGaHjZLVn7BPXUYVRiqPrsk5aat/Gib/M1QYCaJ29jnZsFEogtJXtNXt3gMwgeKhMJIL7xiDJMxkz9Q84ugQICciReqo+ATspUZu/JJIipS3Oq0Afx+GUwuTlzytgrmuutra6zsc1hnzhXoWRdhUS16jE9we4hc4GypwCPX9zbRRdPkWjvsAjL7pJGcREbQsPmS2RuxJJPe7T5VZ9UvRokoe2xwycf9ivT94eUHI2ijVEiVXcQ7/J3jpgkIDJahW06e3ufctJ53aPgvxq62H/+9MQuy7buMV/a9KuQn9+s7ylZgLcAduQZHnBpLukgD/TQvKd6JFxaKsi6QEBlqk036Q/GqceYZ0uz/lP8f0IDpgmWEpy7d/mlGo2KJ5HJeDxBB16iJv9WDllmIoGaeMuehVc/yq8KiTuH+CuynBw1duUdoKlt5noOZxlfyh8Lmrc2gZlAxSHhHX7YF7eNwJORMQvp6ZzqarDf6Lx3GGn8E6vF8kHbc+BhD5HwHERNenCXjsrODWr6WGUXY2yiWhoH5BjsAx2rR+1v8QLl9VCnT+0aXAIu+U70NIJ8xGaqV+/0jvgm1TCeYRgUKYvCGuy0TOPLHAPsCAEcq3ISRxlT2PF+uW+nZLZ+UzFxmSEIumK0oRJysl1d56R9eOoTzM02H1176Uy2ttjRL9Xu9LdgmZ9kA/uVqwvuPino6sxVXz3zSTO5lbHWQKixYCTSpGwj9zZgmgA+KJCzDMbBrKA2bNZ+YAEq8hS9U4+Dh5P6hdFVenIT89cytNIXvr78JLPo5xtaRhnfGQO4UnHG1sfb4HuWpWE+tp+dirk6Tj84tgQTZiwElsV3f4c8NvMzA7nJc8q4o8ERxEuus+xMAZZgCGRaHPUb51JxTb2XYdrnLiREb4bYJDHJDiPiAKnIpiRyK+D7LvlFrOdAcVmqA9cb0DbDPLX6xXsUYzF9WkExYCMZrk5r6o7Lq2J2fnCyOhLRmlIDSYKgWskrHsFgY/FBoGXmy4GP+KxBBPZNB+eXXPutHHt+AH65g3Kk0WG3X9RKAN5fqdutC72wQ8U5+9Ki5UTI/1U7Q1VXyWgAHP1H15ziKGFC7EPSFKpRP2To1y3cSXTAHfZdaZ03eF2odNPJaOOM0qvIuuZrRWEjwVyIAGX9g1k5gBdLONujdI5XPgvfXbRjyH+z7vhHh08L387joKRRwKuwEPDBn/u+XmwwzV8qlOHdIIspXFFbP0sbHJkhgrPArVct6zfC2cuD7QXziNN8a8vZTIWoAcNK2XqNWpI8+22if/veRB3OcGENKD++msz2fhPa28U/L+X0/soIX+H5FvNFDbX3jis4WKNV8PMszsoxlmbjM4UtNm5OZqLv6F2o+XMsgN33BHNFTHAVusf37CYIR/ti7qNv8A4/rdcAkuy53I4fZUX8HCXEnIhoV8HLigvGM9hdShJWPtk6FLejCKf7qxfKuA7uustMHLUMXOODAMv3owEZJf1eKUx28L0ZaNM+fS7FyEKKxI+/c+8JRF/pWlbwjcnWu1UPMHkNA6vVRb6bJZKACbofOyLaZIIgftXwgoKIzkXY+n8jYTmZ6W9cMYSyj4as1xXAmpW8X3odgugaDfT7llGkD3OAaDL2eWqbTrLQ0TTyXqsGPqNUcBP2JR3yhYKET9KLwm1790UatV3T6Wk1QwzQ0b1w5v/5oeiGB23vMxSmo6X1IthV/vrLesucNgA5V6hS6uyUXkn9h/XNHLq1TRFdR55oqpc2BQASLc0uoK3bL+XWH0gdfOhkAbdGS07vnVBkqW2myTBGRzZbFg9V5sKB0E1sblpbEYaW6/1iULoPaNLm5kzgGRzeu/GHhUnGB8G+hoTnp9Mm/zX6BYmTQf0P2nYG/B3DSYWsxSmgGdHPNd+GS/kGg1iJWLAQjPhF3MVXCwVMFAoe9LxvJwh5PT4tPK4+pJuKbwG5M9B0xrNgPVQuE3OdAfNVhnou+6p2UrFmQ5jRaOVD+WaBGcCz7T2/whxiXQk4HiWBVNgHOC7qPBSX1XUr4qUBQMQGbcrmaCtclZL5S4bImi36qV/eX3lAKzqLfxQxO07b4KsAAVwi9jBF6PjF8YMx4HeoDlMulfIuEawX9a9GclqcbKjm+Py3ysmRbiHSOXHvphepxx4P5d3oh7OsH4yH9qAbsPn+wtvRljko7l2azyAY4mXcGdXNt7iY5nYQgfv5aGbf8RbH7bjVGHysmkYrbuqBYu96hQXlAAvDzSRoUE4MtQohciHu6+fbFW85rRGc5nJEUzeFcNo69t1P6r+yC4cDnDDx4nZ51qvwvQ9S7JtxokrsUlQdWAfnpvsFowIcIjm9iUbYHL3wyMTc3M5mltIQw43hB0fhIOoGvnkC2v0ykdBSTnZaeLRgn1aHxMO+gEUmZ2ttCmhOUhn9CtA67fUUEnxXEsRvXiCWrFPtfA6XCBPcILip35T+wrpjyNC+CIVL7YA5rN6InB2Ue7YtOpKii3RUIwOy7su6HNtmhSsDu5vyT4d7QIjS4MmmiyIuqACDZPk5RLKQn41ssfnUYnTHumf/sVw6soylaGtQgocJP4im4OptmgKNjxA5NmcqcNk0ABqATQ12eAfExQ9/8pU39ShEYiki1D4q4CTyiCvNCiNAX91hd37ADZX7sWcBE5YVVAZ39SRpgjyWtc9/3cSxDHOFmKaRjrQ4DEmiCmUTLz6bnqAAjK8euUgnfCYP9sx23tqrSO/Y8lL7OH+N/t1Y0X3olztbiOSm479UC9v+GayHvFjPGXFzhc6kPgLVZohhqwcNTMBe+MleBwnYTE4gTZealN0V2LTkr7iEp1aNTnVF/CnjPesYpVRr1rk+7xbJmXOvyVnL3epGDVJFZVuQyXeu3dkPVBucCrprxPliHNp2o966sYrbr9d2S3aU5HlufBMhbCQHMIQ7jdHb1Z7RXTzW485DNS2KolB7WXUjWVyXgmszEoZfbKdHpFEiUNVDj+4Tch3wSfdmHHfutoCHoNLfSjw7e9OHkCJCfMtJN007pxnpRZvE4uBZz7+JTeH7mxNh+pVEiwVT1/q3bSC7Oh05aYDstHVwEM8JTf9UsN6PRmp4DGr9VhO4kdw3+cCUnvSlTvP3CC6+Qot76hdQoil5wS+b1TwLUJLum1hu8Lm3EMm9TVhPzgSpOrOJj/GV62cWiAlOwO2XAdESBwZCi+97ckiTFAHkk+J6PgacpQRXDdsRQ6pG8OP25Ggt+UsR8Lcf7vLzAt8YcHl1U6sbjUqGLwPNDn/4Qu3lP75GYSla5Ua/3f0Hlu+O8PajdYZ8S3kq9ZPFI9mxAL7hLyVH5h1hfE9hYYwSAfcgTyxEkxAw5qHinOq0Q+Mw0qGWBYPzb7d26ppGcaO+qmXFz6yagoJKizxFoxllFTkcdktUckUxf79CIzERGxyWclJffTbvcVGPq2YkLsE1EAkXQybskenEQ9GIXNfFI43D4thGAmPLiVy7/MIRRcSuyvSGfX3c5GaP3/3tLcr78CI4h9jySzvVfP7vGWh14Cqmy9UnO0Ft7UKL922sb5vzwAd04vO63CkfMEIyxpDQEACXxlrZ/+6ejQFfrHvlYGCZiSpynxMP5SqgTQtiZxESGdxhJnJ9WmxAyoziQxleM+lo1UQoXNawG0Y6jWT8Wcqxlxef5SrexQE0wnpzBeYu3DDMzXCB417nKTPfgyo6IAECDP34octssPwIHRn/Zo6XMDotJOSGQ84w3i5aGcxtSzUkl3c7dTrMHYN8mzB6elI+PhRzwugQnWrITbUkUA+p8HLx7wUrI0SWBU0nuV9jRyg4TqQuxaEq1iagI40MsJgrYljh4nCM71gc0nw9ZzRc2aE4kh1OwzmJ/rGinapkSZbehNjeYlyhVACpvmyOcdNPlP/aCCZypYETgq0RtXrM10nMij/0/jC+PZym7zlRPbyzVV9i9HxDmXKKZeppZK8HUYo00HUpsW1gd8DgJ010RlWwicYeSkirMnLgFfGLGqZFnomDJKBhgf8mOFf64tEDUW6MKZVzHIYXSQJCVHvEIY5N6Cur06wbdN2InGOkPzR2o3/U4NsLv8N04VQxRqrcNiZd2H90SvpPGgnRjO8+VLN0Uo/zpafY/IYKqNeCYYhShZECh/cwpblrbcG2x3iO9wgwo1QGM9mPZdNlSiiWxdYMajQESuFGuagZUezQBmY+0Vnyp1h9aMjilpcdNKSHS8g+vFRmg4UQeuhTGiFEY6QebYPRRVdM7oKCX25td8Rz77/ZWJKLgquU2dqBkzRX8/JFJfLKZ4JWoxsEfIM/5NvxeEeEio8B3c7I41mLjEKfcqKBJdoOt1RBaOA8cqhH869fUBapYpPsn3JcfVCtHBvbPsbGk8LXpagrFvxz49C2ut/2chW+pfuKp12hGzDDRcyq1qkxugYrYX8/WSZRzT25WPTJ/PcSZ2ahjITtTBPSY4g1vyUttrNcvcWSi0Wbz5QTMiY9GFs+LUErWdewEp85Hhg6kuVPv8v9q8CTsf9VKXZJJi+3uraqhfMwYuQgygl0Vq05x+1gNgCeSHTe6dpnNw0Q1KgW/z87kAP0oAguU2LoiUO5d/e0WvS2VjeQQiYuCehiMU4B4WG9mC2bEfoxKcHbfgel5J3tVn0WjEA3UZfAOofDBBCqYdtDNGm+OqbkmE1LHb1q1xkWQRAC0dY+LW09SHkaue3kUhCCkI3z5gnI8TdCBWo7jqvf4WI51wKIoBzHdlgrITs1VBypt0VFoRKclQpyYSfLd+2CRVcVqxlDDXYeD7dm7Y2lcMzoNkDTkPqE2dHA9NAG7FC0VHCRW9AUvla1RAwim+r4FkNTPMA0A5e1DHqbmNeFGw3hevBlStJS/q8IR+gmg3jQFTGdcLR1+bSp4uIcDf8Hx7Qk8yAHrVn0r8gdwhFOWZxhF+4ee48RjCdbGOLzgtkfpGiN3At3SX7J2lri6piPCDqdBkpuAdtAL+tbpAS2/LhtMqx9OEoJ9N1BdZGKpcVudwfAuy1CcrUXdUsmex1rv5el51zRyo+1sQNv9U/bdKGhlv/VuhY+7oxx8xfX4PhNS/3lWotfeRfc4lFh5Kl0rXoWusrf4bhW/whz53b6ymwoNuyXRHBMfUFIp3M22cPt+PHtgCPA9DtqYVxliQ5t3cBOX6RF76OaX0wZRXAJ+cOMzE+f4B+Oow9ihguqKA81PR5eXYYbrB83+GEPuvpUqrFdpcPY2PFDt2D5vepYKGw8wFah8r4ZPmGzo5QUQmHqHgYv9ge1Ks0tq3ss+iiXnhWRL9XOLb6oq+i7IQwtJrCdbPphM+G5ePXa71s4pUEE/GByAfkzMSmaBzsnc5zNAgNS8PWTb3bUdDs3pxW0DqVSx0/HaZ0MsdzQv/+SYa/kAlK+sPM0TCcJalTjjpxx6XfZLdJ0/Wn80TbBTBG/Qm4hWOjm6FJ6UjM38aYWZTpOSpWQsbTTl3dpGAC7mCdY1fyD1b0DoVpCAPXkRD6eOm1ae3PgvxviF1VwwzRHYry3bLeRbqA2ZvahiKw7uahuWxt9aEZ8FrTZyAvoND5OHLzoRODK665pdEI5ku3JVZUha0z1VXRXKI0fUjvdu17e2esBIs6NvYVPZybkINwJEpZ1L0LGgSoqFD14WXf7ReS5nGKzlJ9Avt/xgH9lpVnCysIyRcbDwugytVEGL6RwIshOGwJLEI23BitNHt8YOgsTthfdNapIUMEa+ckISPULuq8DFgJ4O2fS2NB9LPUiOrK6FgpNQo8BvSHp40w27waW1y80O0ClR2FSVLlOXFIJYdiAe8PjPJmneMHnuxzZpvtx/Y7Otbj9g35PjYydSBCroVKdAWWvjqvpsV8i2XlqVjeqMEBmFipFigBncKjTH1K1j2vZp1rluXnZHAIYY5HobNSXV3KiWPgZw9dcwYZFUgezELlgkr25jBX+8dHDUtUU1ZkSNIky2KHUXtzGN2rFKoH8d06NNd9Ygq+GPu6ZO21ZOq/x9lirldtUey5FT/3eWj+hPwxT74wqcNuMadSA6JbZXrT4BOSGN++krBSjjfW5Hp54A93I5T/+YsbqK1N0Cuk9pjV0dRnlfBkZ0luEm+LMiDvmlfipgeCNOxfY2AcNkbWKnRcc8+64YXGqdL3rCc5RFDLxV5Fqj2NH8ggCsO9go/XF9b16/xLl9/3fDKFfVLr98Z3DfB55Ua1/WCnkPF44Y94NhVL/HaJf+5uNKy5qYLuDA/N+qTlzS+VxVXgKZ4EJbxkIed3dWIJj7kljfstojhgWHukhPxSgHXjeMXAAEpnRZSKCjNryK3mbe2yfSO9QTeSKN28RBsjqh5CEGWepQgBcx9xZPy/0XcHCG4vrErRCakT9jhQJXMCWI5vAAKnXZbLtHrHZ8/iGT0suZfBfJA6f7eIkTY4DfHxuEx2GAbonxw3EY1mYAU4+quovpA7f9wV3oe7PoNUaKIQ/FaO7XbpxypTC7dgYsBzu9sCciRKSwMTIHYlhDAxgKCUVf7HREKdNphATr3YuhBzVI8znniBKN9WkExiN6NZ+MIqAWrnhcspu3sodvnN06J0e73hXANntMvjeU896QpgadWziC5ITrN0yelDm36HQf+wsYA0SLUypepROzsEIH4WKScEVPpQm5M28fqkVPrz6RT0g7U3X5ieRiYSMWUfXFB1aOujI22V9TmS23vmonEev1oWREg2oDOTMpTs+1Z16xs8zqcx6TpQDFuv+oAryZavruK5EMJpo0P6levC6p8+1EPyEoybxzE9y4erGcL8iUVxNOFKaQaZ6+eTr1DGgXIvDeUn3ncpSqKk1mi5nYimbEq9PUc/iuw7mcNNA31YUxWEvtzsIdNAhG4z5b1u6L70vLH74GP7wSPNEKWBwCAUg3ENBIhMxpiFOCKuMhV40qjbSru9CBBYiUkS0rw+omck/88+8rfG4sXzN4EbfxGX1TJuVdBBU0NZCm5nQUqU04tApga35PeNwgVZT+quwSSlDgoQPHYfPYWgFR4k/lCSH6nxV9Ol1szztEY23miLLBPboCRfVIpyGk7hYw1wzbqid8zFHkNFoYNlVs/8LXe3H3V6pis1wXKJZGjphXm0mIUBz7ElFlB8H9X7KOFmUJIVK8KHdRmKO/1ZxOZOuZRErqA8GQ6tlaR9cT+zmhfxipsvBZ19LAeU7j4vHeTTzDcPK0D0C7qZSqFFy/kjuhcW5uOD5JQ0sg7Pl2BnnN8pdUDXI5idZViC+Shs+A+YkC4Hfqd2TxcJ91Z3Pm5DBYiwMElN3tm8b0HHtwTk0qE+V8SE9j6QVKUVr6FSgRWLa4WA7l7z64k2RDdbhOhI/r1Tx83GC3msxHXCuHVz3NgUSUM0R7veBHnxVDgu9/ibJ3q95kxSqAqXCMor6HjVyzDfwONENBdSLJsqV6XAhjv1GBJf8GJAoE0cDHeucUDk7PpGUh7NFOSzqzT7MPWNVyq3QhY7XUahCWftphKKy09IBLAMiyCJik7PYPVLZG11wkQz7qGpaiCf83C56bI5IO5IBPSFV2ST+ZJ7cVuGe6BVx+V2oI9TI1bu0Wn+y0VSxBI0EKS2RsfYHvPKwuklwnwztmsd7rlCeXj6VJfVm4tAg3yoE2h6XY0ZdsKzRCFpxJE6VjnPG/kSLtfj18/KwX2KsGfLZyoBx19f/A5izjNIu3p66t24kkdv+q2Xkt6Wg34BpxX7IvBj1zdKQolWnGvdc+ieb5f92zLjLzTKsQM5KWBiN5sJjtdJ/VS+Xlnsio5FuZZKuCB8S4nlUbil9l6kMcgVEIBfT8Vmoa7aW0kvyzQrmQ9JBQy2JAF+0jUP3mv3u+t5aX8TuXJZ99Z5jwTuGp0t7rt8bInflCncefipVZKaGKLNyj+ITeEYqqU0hfR3opATQnsSd9PqHVMdymYOXQP9lvutAhVdh6E3xRwNaGXTFIUdMVualNGAUL214tTLGcUKRD8zRntVQ6ieglLWyP3+x9eUMkW4YyXT7qCrPB/LkFE88ntwhmU9KmVrrRSqJFP79jOdtqgniHlNgh/rZaD22A99aTokzdWk8131pfDmllECmbtBZVQY90RVqh7EKBflrK+uNLHi0GBQACUDqrWrYWhLzBtWvXQIS30z2dKY0m2EVBCzRxR5cGTCD6tTqBwoxsvG7D8VdyDzj/uQiJIDa6igU6pEXEqh27d3jwBUDecIBYYn8Vrs5vQP0zqiDQgXOG7e6E7S64LjdzZ8ou/8p5BNqS2KbgQ8L+cYJl7Ejg1vGn05z+3oEChuTjkQPlGkF8GQJhXX3XHzimT49tkOhzTKi6hPg5tS6du2wxYnPA8E5edom9j0XGO8Ict1Fv9ld/pOpww1zqI+UaNwLUWXYJ+PuhDAtiL/NHcE4KQ9hbgKKL+1rIUi0bw+8doC6FrHW7Qm92+Q3z7gt0FZ9U7XGvSK6nN7sFOedR5MpnjG/OgG5clfR7m4vVOG7O+iLaWRdemNwikztEumgU+nvqRXf3RD2SiKQoWb9LtasLMAEcp3IcVnNcJWGB0RvT4Xx3Y8q8USlc0skrAqRA18MSmyps1wsLdW0AQyYJ7I1yMxQqBZ+QKTgFaNzhQpBaVfQYV0UEmfGoOSdJfM5tTPc7LUz3kpPWRiBA9hnCoR3OoRjzhW+144lSkkuoCnmiQJieO9m3j6MJpup5id24uNnzpexT+eIAICe2z2gGLEFdevCoyrTlxqri79G5jfBFFzw2sJ7NdYckH63q4sxKE5d09LnL61U4mwGX39rCfHQM/K0bU9FITSgGryUwpuO6sXY0ejuAenydMxKagFUBrMtj1a5egSuwxpD0/l9EuA2JWgcWYvsG98YdXNKKSCp6Z8gsR8OXmuGce3E73HuR6FWilJdYwyitQVA2/wjww2lPCmE0oUOyRK/aQA7KbFDrQv0Fg3UrSyArJ640d+rI9CKGNndK3smACGqZULyBCHcmPwm6E5aeOSfY8kG5EKKAUZ6XP6tZXFA0sxMwxA3lIuq2wRqmotKa8J0kRak7GKAQwnkiMTWV/PYJyKN+6VszyGveozookJRlwlQLUU03BeeN/qT8AW4l1B28Rwg8X3/5LSo5QP6gK8JU0SnrhJTsaU48fQIo3NgiXYxixAMvM4+sD1uYtq6eMQ53Xod4+k992ovzBH/20okiYcGbzLyX17aqk5QOJwQbNj4uGnyKHOv20PuAWormLhaJpv26GmQzTO5BJOJhX/VJoXuNv7+a8wzZfqHtU2Xg+Y6hwrYx6NBDWmi92ZquvaykJ5eDAUiXR7M5MFAzykAOjDNJmq/EeW1wtSEZk01XfcHPJiibsQHWe1Awdaxtrp2GeLMHeopC/0M77nps3IKTWKbvFcC3beSP5/VbM4JUgG2+LBd5T7u8N6FLMKwXVD2aiqur8ZPAYTnDJgQ3RIPYPaNbO0QyeyQ4Cq3jt8BKWAJUJvporLgcbHIltJb7tpVDMdVG1baVLQpC01M793zr5OXisIul1l8xJXj5a2EWMTSjrIuJUyUaoUze9Td8T0csc+D9Veaf5Zhs/SSy6qniQoL1bwAItMrYc5AVJ2kwaSuvXxJStPg8U+P1hhJreRjVKAAbOL3Vq5p9WsXFM2/+9WVuR1lTuzc+SArncRW+n8sL/Pd9x0Z6hte6qXmOR55QaLLksUwi0OC02yjnZpshdK1ILwln8L2PmBs/G5d38mSgo0n0nxx/7wCeZiGrHtZwYMM5rmxlNw/cUgJEP8sklCxgSoD6vNnEMSK0l0kBvE7EPy4vkjQsX/7mmrnCQBUKBxnSZ/l4HBRLZaStRr4gTuTGC4zYp1B5NymZCw6w3bHgNsKb7SQBo3O1OGYhYkvcOltW5J1JiREQsRJ5UxZlC3gHJn5WiWzh0+6UPPrDPdMRPmWckMFQUsXJa7ojkwcuLhkDCQAGa6YeUZ97ipKVgj8KwStTf8BPEXYQ+e6QgBH2AOVAkZi5Ss/1SFaIxZp/2zshBgDucSEl3OKnxVZJTuXK56E+Y/0tlGNVqy3uzzxzUoa60ymSOFd7UMUXLlfgZzOuDXtj0YNc5xIi3LUnZnOQOuLz2BKBsSW+3iMlvGtGq3hSUm7jX9xK9do1sCsuDXpdMRsYt1p1XqJPq+BkH0FaGAtvWZzXmd7yTlCR7tefgQ5CeMI8BV5mzR8ixaVZfQ3l4Pr7fHdzdgI3R06yqldznHdQV+5auflWNCri6LcilAzJEvTFsGG6ztJJqa+yvsgJeruna28VnlHxpe4V8xi//FjBaKm0skqvJiMaC3hhcePRfDTBvYY8rwiljE+MCmNPhjveRjsE9kdw/w2ul6Z1IKdj7KFOCzYKc4eEZiCE3t3Dl+IIxCyMmMGYt2hPylYBDf04wS0GWFOV10c9a8Yep9bnRAZJk7NKRxuRAQKHeDVchxe6CEiWymToC43mmrU2gTEo00mtxt/TGmmnhrEP45UhHCwkzc7++QOmjL5uvIVLwYpjwMXQekXFRlDmHu63xOpygRuN5f0Njat2HvPncKYvaIy7p3BOKzds2tZvrHZK2q/iXD0DsPKHyAzcL9laBpOVMbVkSeAFbJDxDblSXHbztR4bfGH4ZBLPOyLKIPc4To8L9Pk8nutV8n+UlR52C7YLG/BuS0vIkJ2V4xh6Lx6hlyXeQ0hSHjo04/cp53lEqHOHZpSbrEBOSk2Cv1ZTrc+pgCYDzlipgko2SLoFN7ieOYQox/srtJLJ94OdpA5NeLklaxs+3zAkixYTXzo5z0v+6h+f/bb7EocNJAb97qwm45qKIApMw4lpo80ILwTqYuu1sqXI7Ff85aQBCLb5PxuRaqHHO64kWqV2n14pQDBiS7Nqn/SJO2Hx36bfoQCthCvPxnK5G7g5VRnv7v9j3lrk6DiEqaqqCLQ0vyhHqR5RV+m+M+EHQMbdFYETykb2bY+HWMi4VIxkSM9v2irVupEuRSL9LEvcK8JbFqHMRWdY0XlNyi55aTv+URTFgaO2hxov2vkbW1pWhZhnM0TvQIniheOb9qjWaB/Mb2rlSJ4hAu2oh4/ddV4H6lvQMLdUhPy9s8oh0B8+1msxSnHlSmurPJEjQPmyyDgJcW9HVl4ncpD9UxZwvNks0hD/wj5gjmde+6UEm3GUNDEOCRaLx17td7I5ziz6AF7qusSGsY56o508wzb9HbaznjhgRMZvveBlVIzNi5gFQ1/Q5qtX4ioxTmDR20aLjG48gaOMAn8V9ffv9pG3bgkxVxHqnl66NuoshLLF5aB7q9hyQvzv7Ki25vdijRLoHXXVkWMirIdar5LJv8+t3QG8AUlib9CZHyEBbjTTsWrta7btV8WSRZSCTT3aF3IXdq8iXVeHOrzAtv+kM/s02DLSNoJKnz43v2yYJqRtJ22J71fxLlQ+w+rJerOo0fUdzwoUFgzyfKuhu8Yq/bhUDde+ZlpjZWaDQ170ctAId3sTSf8/8lVy3SmV8mbImOSC4jncOFs1JXRfl7dO5aModFzEAMGzm8MKRHGzANQBB8EkF3CDH7bze9PPjPcEw1rjHsCLAWnGYW4MPilINc6A1ndoxdojUftjkwdF9P1AJcbBHA550AW8zsTXYvDficFAWDXa8+Jyp5FJWPIzFtp9YBIvT56KjN6WaTREflONB7dSRo6taRRFeuz9IOHlIlITi7Tb+DwAAAAAAAAAAAAAAAAAAAAAW2t1WXvpVaRseUmdKabHSnMT0JFvtjIoiG/hARQv9aAhLdOsdhLspAzw4pdsGuD0W4ox/Az01v00QLTMfK8jv8zwbYtRfE4QltkXr9kYz+Aqwtknh2+VNIrMOU4MVOAxoTfDflEe3tqsrB0Cr1VU39bRizo0PH4I1JTW/p/TuDpxTlzgppJS3+noRPP1078uECNjhh3ilY8xFwcxwquRLRrHngJuP+MwonnWRzfEFCyufwAAAAAAAAAAAAAAAzrGvroBgOjj5roUy7RvsXtLVNWIa1VjAhE1uDTfoeCgqJuj/gUpQipkckI8aZY4PkPV6GuaoHbMVhXhCuMWNLaJTni7bQ7nfU4Zsn/BZ7NtNr5eDb7fs3tDnfk34p+5a5xRMSfw8xPaZiLBQknKmqbBgIM0/+JgR3wH0AcsyinySgciY2wcorxWcN/1Z98qjxCp+jSOF+Ka1OQogAeP6apRF7no9Hj14JtZ9c6nSLC/oAPSa0WjkQ/wSqb8LU5mLEZyC+X6nC+T1acGItwrfqxl5ufX9T38h+5TzWLYJloVRsSgabZpU4l/MPajDO+rS4knXrp1UHNHSt14vko/TVU53xgE2nmfRYTzagJ++hz6yvDJvOwdW+CBjeIVtWPMC9A5318N5WEt1XdBl+gA+Nl0TCmlqc74d3l1XHNdPMJb2/t9v5bGbjoczYqUsP0W8z+4jtXBE0oAn3asdkYKii5QeULj6AY8AAKmZ3tzWw/YbUIrjX1jcMGWNvWi2tZogDthwA1oAuUQWhxH2z/r6OFGKw8s56SxH1iODFfL9WffKo8Qqfo0iKT9VP3IMN36hLMjf61PJAFd6Mm5BQZCE5WrZEcasrq7bIqBoDxnq70py2S8DG1844FEnX5mRGa04knB4KrZeMKmuLq7i3H2g1u6xa437xaneAMr6nDSXsKKb1GWjHNdQkmL9cmevfNAEWm3l1rH/YDLE/o7bdrbjrO9L3gWyr/S2N4zaeoKiRh6MU7x58oVF2vd/p2K4pARmZXQNyRp0Wz9pHvZVz3Hzor9Nob38E2qWz9OCbddzwwhVY7Q04nmWtIA+0EkmYOic7VJbHWROLZA0Rn0cMQnaIpxV78h1zLB3K57E4wuFG0f154M2lG+XekfVBz1X59TfaAKyJw2Mo7pzl1Jg4kG1BoTAff/1AgeBCdWy8np2CwBLrQgb99kz2U3FTavty8FPpc4f2Y33bWMB6pkzm7SZnw7Oyvp6b8XbF7XU/uo3U++CaNwobgw5ewXem61Q0Z+tSA4Rg/hUtyQnwEeQro/ZhQjjheItlbvjKvDgH/PN0GJRVTnQHd/Ee62hDs4qFRyD5ydW2YnyAP4RtLS7ZxUHDlpVgwysQjQypu010R+wUbaA5Yzff+G+fckTFoU0Bm65T7uxwXMqqSeE3KLm/83a//2GM6sLgb8+wxuY87DLCcNiBxUldd0fU+qBKbmFeRjHeMZzzxb9Z5zACBxZ4o3cujXGiRkvNcN1lusyS3nK5jSut5hznj+s1fXNBur92cKOuPJ5RB+DY7nuxTpa+By2yviKjyRvcGrbwXFoo+Ix/Ob5dEkwTCgxrfu4U+84lvDIDGGBplXuTQXJk0PE/lgj9fibXKL0/sERieEagU1qBCJTaiaoYh4HiSADXNcYH/yN9FMYAznhoTjKmWu1ThdPpUqBQbdFGhT0U1LezaOE3G8IUD0z4knAaTaQNUBy7T6rWknhZ4UvYX0QcAwBGzAMeC8H/LW/FT9bvyO4y14nVZiSRbK7vxxxJ13/577h9kvlcTostqhVLX7a3imaj6O0SbbjvWpmMiAW8yFg61dY7KlZ4Waf8CytoZ/g87lx2M75ZDoXTu/wgLq9e9iyT0ZtDIrNPNvyOFT0s7Et30n57Ej2Go3D7LTXVAODSqIkloPUBr0KL11DSE6Cqj4H8UUi1Ec0PqX5hOobffw32XAIoI9MertcoOguwJCNsDIvYcy8cBZcrfDAHo/PHE4PSXBrZBX9XatY9502pX5bB94ro0TY0gVdIh0lvmEMzTP+hMDlhFrDtzGj2XPYn2WgmHwCR68++2Aaa3SVg56PnB/dlf+bIbEYPROqvBjHM10UuGpvQy59QHBx0VcLDZU3fKog2cjdJ9i31bQPeeRzP/3WIKOulb5lzAWYBAWpvICy8kteuZMfZwV986QZXfYMhaHze/cEj7QryHy05xW4fxSETtcUXBxh9exh4/PM3//lqjzEs4dvtaL3620V1lONhnuy09d2xxlm05b4WDkDWxMjkm8TS+6c6p19suqaWA6d1aJFmHdTatzdGgjHCbgOTVr1u/mkiZKH27BUTtM4mR+5qmi/e7GO+SnlWAQfBAf743qnyLesqK0lG2CWd2GO/tvlZELhK0aBTXLsYWvf3ygiMeZr44KsIri4E3gTMRkphfbb+KScIeDUCcsWpeyYQ5qIjDHh3CzB4ao25dWvTBG+r6dTw5j7arNWwuYojsEhcSPNoh4ren0JZfFwQ73b8F1LlrRNRZQelWgbOxAJ5vsjSww/SIBVOJCb5imsf1wr21tjMsusBk0A0tpZNihREMEZGQFNeHLPGL8fy9rXe9gfcSreq7zJbaRsFlpzYxOa+mZ8oGHMdZ7REywcFoe+tFFelrcXB/eyO5iMgAhRbXoe1YDnpPikAhqAZroeSWDHXRO6yqlUwpPEggxBU8Kk7AEO2JC7re8oWPN8xvcXDAEk2Be3ys3oK/pvQI017sGiiXC1XqdhvRjOp2tgp984uVsLeGByYlNzBoz4jxqrHElr5M7zi5+h4EpMGklGqjkCrf9VZS1otH+czYdL/6E67vuPUjANVWTFB9BxRT7zGN5RvL2Gfic/HngWHtR/EvrDnPW6JGHbmILMrm+E9GK3nN9/e2FuGc3SRkAKb0Wul/1XA/7eyjQKd5xF+E/naOEVBI1IMCSmgqXkhQEC0wjxJWXIw+UrVJFz2fmG3VVRjayfhAVU/DgEadLpc1JnWWlZZf50CeIvotVlRbTzJmpS78T5SjzQVErN+rwcb/w0c1DTGh6EBv/uy1AG6iS7/RTCMZSlJeavsWstji8PcpLVR9WpwMChqrCwHQby4PS74QvLzN3ffhrNqSqOweMjQsEWt4/cG5N4urv0Cwy+9YELGJPq1vVmJuoG23wvggU76f93lxozqTzU+vLCW3Q5aU3WMlklV6UXTQyQbi4MSgA35RRIqeF9S7/STmVluRnWYFy6QeI4+xHg9irl65f2+leoHOHch+XGCdeAGf0rucLBj5sYt+TOjQ3dduzx64CYeZRyl96mbrQDi9bJOlGo0FcYD4a3VXm55+XItuRuc2bfukVmpTe4rJKkVMbH9AQrqwYqxpjpFhQ6UPiuAn/3EtLh7HqdHgCApzvN6zo9Hw/zkaCcuhF5JsZNuMpKrb93Qy5X61Ur4+r3f9Zu/Izzbeg3pavoCDp0oa7Tf/wBXHyz2DNILnhW0oJsgp8TZESixwg34u7XOqtVnkRh04uCOTkcP834Qo0P417AatJmTVWsnRKxf/QMZPV6xHTDKeFNsGVBoLiBkrBFL94AmIok/ym1HpGy3g9HsDJzlVoKjim1A0r5IiOPaeGsdfujXVqFHIWCLjDnqgvkvB+ij3457TraWlIZSpl9EqX3aW4FxIJNKwRfrK0Dcg/ZIvcA+3QIhIxtnRxaHeD+mBvUC1WdG4URaAdNDzoRrtONXhdz2d79gTAK6GSAT0AeJaYAI1JMZjcIIf8dih+Rf9zyGj6o60IPP20iP3T7y6dTN+tHcij5/qV5sFaeQr9fGdxyzWPD5R9dvN9TqIz/5uhvE9xA9smre9ftxOS/IqBKu9F7/jPuB6veVvUOCtEI/fnbUCtVGQuWPuRVe6LVs25bA28pWT4EigFV4K7F1pDFFCqfTv0AEd/YvMnfQZEKicpU4P4MhH6L+69U/uAU/ixhZJlj2L0gmtmo6crjIcLgVgMbyA4A0jHKuPJip6a3f2qbgTqFQh29msXvhxGKUxrm4XsnkAMzmLCu+Fun9bZJ5/NzLb+t+QXQhlc6HP7iC9TB1ZCcBICiDsmgBpG/hP4Q38UcAponPeqwB+WZT/QkcDAOmdvbQ3v2wN4n6SXFMb8H42PiYFfagynnwIQQ8Wp4dHXiIXgIGU0GI6KdXDUPn+SqR/U60As2HTgPODBElgJaPJ9aH1SNtlUo/CnvhNKrMSYHegqcD9rY2gvgT80x+9XlZQGQIqRBdyDEib48RjtA5nm/O2ykSjkAFiQv2549KmFkUIMB2sVyKb/JV7ZFJsQtkx+0obpk82pN4Pcmmg04Ew+okWgMfSK7nl2uj0G6eG+UWyRnmRrXxWxVzwchFKxa8aTuGZZpg98nukNt3d6Imq4/xL3tBTrZH1GaXBzyzVM1RVlERb2usBA9irT4jwyRcBtgZSz94IXDE3n5IF8L3DRdWgW8atHkcFdg/n0H/9Ak8E5/cbJBSAVGZZcxm+7KEaJ/TAjT6KAnk/VsZHFdzWqSRzGZTXBiu9LkfL2W+iLcgaRJweJsgPhaK1JPkKqFjjptZ+jnOK4Hk9l1Embr/yrXHPy9xpe0UgXfG6nsyJtH0SOn0x9SbZnHFDbBae+NimaKL6ccpjj856OUAKizX2XlknSVLS1Wbejh/z2f/qW/jDXxzL4c2na8DGhEVCcKiHA2dOXVUjwx5QBJyM+OV8dN+VgUJbXedzNaA++48ngwuRzzi/Uf5OGNxj/6Zi/0ecuBZjijJ34YUoEBW5OFcxMHbCEN5XMZZgPU7FuwE4zzephzh5VnmiZOUHdypHkDLBUpfviP+3fbskJ7h9tXLsb9TSzYJM/4ZzKX6FE7p72RdJ7f9smnL5LgZJJ+69j7W0lLFDaGvyBnWibslBjlAcTnflDSBWhduRTtzwikC7RTZB08e32iS5Bz1FbHP83Mc9eqqlPxKZHkc0xCnvkf5bDEz0oxz++9OKvSy/YmByET9MFUkeakOuA+OURC+NZ+RhbGgbOHrvd2mJytUECVlDFStW9r+n6F/FvSmpVhcuAMC006wZEm5VFOB7MQF9aZMGfxoJQ11d1b23xG3S+9Rp6tMINZgfBFYxC4+Glpm5+x0kOuBk8/viK4kqFc3vQXrei00vsOK3f/bhDNsVkoXftvAu/UR1Cs6bPBSdd1CRGiLF4vYI5RJAXY8tEOpxbKcoa/zBvLTuKIVuaBTtlnBQKumcYx4kKSuIMUdZcBpLh7A8wxeMkzMaAaf0CkyfjASCWrfv7xCboOehOUGr8mXS7Ozid1OoMZl4Tj7SG2W9Ir9Y3Txdyn2LHCoCWrLMUElkOJAoBmqVnoG/kI+PlKpa1poKrgrnadg8JtSiOf6/ClkkFKHOLGnhRTgt3s+nzdqqLv2zObZaxz68nw8NdkW9xHz5stXTYfFlFTVrPmr7RarmupQA/VRhPClVSCE9Xw0egqOa9dyEh79ydrDwUqi5hpB3FCxwO8b9xmCICDisOU4fQ7jokFYqXvvQBzRTvHAk6ePr1KybHm5H8myFCTQOUAA8hpO6eCY0DD/GeaB79F4rABiCKitFDKjNp+4JZzMt1x2kRz/7JatmZt9ht6WVRWIXr4MMZYb4qVBKpil7KgPTzpo9ymmmwyGaLwzRM7+soTSPKJ+yBdM2QUSDgGAliQ3DPjGDn9To8LAmhmKpyXVPMlpPjmQzTuinnv1bqSZ4KE8tevIn6Wz4EbqcVlXd+2WDM8vVEpAvVQjH8stWZ3TWoMudEqUSrFDs2nf6rQTxyRblvkcmCJmL9XuKgPGZCVbn35zMDd45rpw/F/zhxE8o9pQJZXI7N6cgZn+5aaYkvQPY4DO+8G2mxmbbHj/SBC/Vt4FTIbVLNBiu2tfVSpybVzPUULwcZHy7brTLP/AYLrFDfoyXzRwDpdkj+XFsk+q4psSSRWDWNmkfmXQqZbqRJN+UDasTk85WDlY9oqgOQgyzB4gOmA98XhNNT3KqHMpFt/UEwO6mqiselhjr0yS0N2zybyaq68hvpPf3m9tGXpfTlAiTd5f2OCeTBhOV2YsuAtL41DSWG5JHetyPrX5rQZ9IWjcdFrUCZ/xbfbmIn2YFPqALb5W+hxMTSkAqCtWoOdRm9DPkJ+PylXszve/VWlLkIqhgHGaDinVlfc6rwtf89fY8DM9q1ZX6aaezFLTkRznrdfr9CfIK/+bHJBYCPMHNQYgRf8X7X7cDm+E0GrNlxoV7wcSJfHnEhOnG8YNIHt+zGqt6Lf0OK+KTzMQrksqt2wu888DvvmK3LIzhWYtB2Gsoh2Afg1ltvbNSllWyOooZu85fqvGuE1YYMn915RNfft306MnXTEzdZdW66owPErw7F6DRE+WWBWtk+UHdOtws6+ga2/uACdvt0QNLyoEhlOAnjpOcbuB6Fl0TepJLYbFT8kfEbt23gT0zmE9c7C913z3l+f4KG7n811DZIjt45IsrjPy8iqLV89k0BmML6tgry/W1A1LcAOU7upR6gmFO9H17pCWuES7m5fj5Lp+WPbyPSzUx1lbDqiN0E/hD7+cS0oloug0IevLevOTEPjTjYOcl2yT0mfGLO3BjoTIG+MnL5PnJVZmA3BUerWWPLOzQlav5FpR9L28L/smgbsUOoCaixpa2z8+DzXFVVayG9AbQp7m+TngFQzJUe06Q03sKG3lNCJnvYhzemozcUTcnFpPOyktejRA9LQq5QbkfXh3L1SZgj0jtzOYCyKhJxzAmxO3aELqBiaOPhKNA9mZqO/kRoSUStuYEF2qzft1C17Vjib7SqXoE8QbnWDnAZZff3XoTtJ5Vc5of4e77g1rgHgqnKPu38P4QYNJUnYJ/wYNOQh/jKfM0aC5fgj0YJubx8tTTTdoGfPDPuTBd04Wu//7le/9af8NvYKwA2ROCx/O9rwK0RkYEK9yTsTlQo1pRmq6mNG8ZniD053y123GCnnc+bPMS66G1Xu0jCcZXEsHvcc2WKptbiHa8M5llG4xYQD2dyjutmifVhHK6Os+CoqlVYP+m2q+Qv1Hc/TUMxIopJYajjlluJLlcoMHwBf8G21MCSyxyEkbMsJ2SXZwNqomYKUGyBcP8MbHmvhLOoydjGAtYfSfNmP5EJBE5w1j9g/VDV+/mDR38Pbff8IRPYdr7SMhoPp6KglUKl4BkdlODGnIktrAv4q77wJdzOqg4wRePzG6IPupgVl7VljMnRwFLKoGGtTYGtaCdYYFpIT55xfbTRzvOf+k7LCdtJ4G/0BgEf4YKmfFqO4FvRLRU1Oo0TQR8Mb7FjArip9k9pT0Uu+b5EKBWaTAo871WiDtI8BuVlPIWQ+sW/y/6NWa4VuX+CaCRi376LaCDjAZOsA3bW5yWCfKkr5LLPNdvC6unIOXctOl2GhWqZOZQfM5dakOZDtqZ9MEovKqyErH9HgXX1XE+3ltkUb1mcy2fboAZR4N7k0PMtZCFvDMlJIi9HFAncnRtb/9WO0qejuZok5v/9VZt+cMaMMPNkzlmfgTCnvfbwOpg2McKbSIWIrj8z1GYwHjuUZ8ecVK0deDm20BVmiXeQFSt7c8GkMgHcJmNfT3PIJ/gxZ2ceyrtaz2vgOUPIAwH9flG3mfCO+McuAiBhxh0v6cNDXWJdpF3mOaUTei8+bUGawjZ+JdQFg0SjN9gd6mI9Tvle7PqxSGjmGXrfVHsFt4nPU8IKF7QR+bk5/g9KnUxANRAJQMkTHgXdQugNXOz+DvYV9VhlKB6A3Qj4J2hqIya1e5y7GPxLixl6xm8b1VL6thyNl+Wd0yd91j24oP9aTypNMUXgtdbRYi8qwYdrsh/d/Eb+1dFNuDJFKs2E67vSfi41Gg4/6lf4nWPhBCx40/uT5XFocDnhaTWlHgNo/m+3yobU7YGKCBgHKw+644jyvQT5zjnO+loT1SbZQLEOVwKEC2v0ixHo5ujVEpBGNxZlXceyh07+vbg5BLkUWEOCZvIuXo0bcg7xxw8wgQ9rrM0GqXDv0l+kx3tFeHnfVt5M3Wu2o1oaRWwMRlUglBDIn3BP/E3Wy+Af9OJ9M/+Yvkia7iz60WyOrLLHBpIoD0VY5Um4wwnxM9oiF+9HPE/kTsu8acONeXHT+CyIn66YGv8ipuCdWlmdiCoroycf2c+PJ4Q8W99nLve+KSD1s3oVaXjSHK+EjX+DuGNyYy31Jzuu14Db0E0orBI2bmfqm2PlngOT6F7niVZyvwWDIRmot33KYVjPJBIqz+igz1Se7oz35zkmQMtwU4hg6WCm92OAPlYDvCYwoEWAJhPPMTbACEMmM+dZCy8eQaK53l8q4ijOcli1nTSEaXjaXOTCgI9MKp36XIqqRZTAafcAwxR1D3A2ki52Eq7014JHyd5Q3qX/ji1sgK9LPaaaUc82wMe8COWuqYm5EZMq+k1ApHb/wcGwYFqdDRVARCzkt5xBc2qmmeSdzKaGPxXLo+FV/z44UQikRNYIVhQeS4pDZ2gFp5JW8vYjZkK/GjwO9cISml/B4W7yuVp1f2Y7c6Sge0nYbwe3FyN+QoJpoWgwJrBe1mNaZJ3L6zRALcmDEOU3W7kEJXfLxKrKFR45CQbkpDv+vcHz0mVmDDn7GxX/RkyTPjF3pWnV5E05BQLfnCy4FwEp3mh173rhooCWIwlYUjhH+ij5xw/6+/Hydl2RamkIVyh49nT7X0r3aO3u1MMq6vK5AVtnKl2czlv99a7NlcgbSxgthluptPq/iyT8j7k0ENDRdtUE9RU2Jj0omtnO3AE6T5bamCP98wRJbYvtI6z35gDMV+rspJIV0Dq5Y6TIfcnrrfBLsQlZk3uCqx28GEYn6ZbqK93e1MSM7cAJJVZq8/Nwrl3UxOHE3aeLUh9gJrIuuyZO/yoKxlJOW4+wt1Zd4TB9XTI4krtwghJaEZofIsW93LQxkzZmGgp5NxducsoZaXUIWWaLicJntI+JdtjRhpe8rRKf3EthLn8rZIZVQePDobcBYG0GbMuH/Ou9vFtj+t1MMzAPaVH2Fm/3+ksp0zdiuum6hl/z1hwtNBd7GirAubrJCMR1cQY+n39Vl2cbMGrzYTgifpCSA60LC3U3N8au6LjlKMsLvfnnxQOtise1hY3BdJAkO+1w8GiWk+Gehhdsq00Mg/B1UiTz0MJHUxb5UStCosEhO3sxs+jcF40EPTYvVFQarCdWOZFOd7UQ6wK7DxtyPO33WfviNY9HBOUoOQH2NwtXfErNpYbMooMeaMAGi37SBzOFFc6+jtci0yqMSUPOuTTMtbQmdoN9FCviC1s9/jCOmVbm+ZH1a7Xj9omSyPdolEQ/XQnrbNfDYMobuLR07obr3uMJGqesiUhHHF7s0o0fBYEWRIhLhC/50dtgxIV7DvpF8OkXNB6FdmgeqcSrd7nSc9J2PmHiRs+XjwGK5r8Q5q9VuTmIWVpgzmlQnI/ttrPmyFoTnMvbr4JrfOOUe9KKuFygbd5Xrs2gJdDr1kBwaaUoUjadxLhnlqMp+PpcgBO5w3JeUhk95AjI/JdQtwvr84bLlIxritBh/AaGshXkE6M702Tg6esMKgjPFFSEGJEZGZNPGQdwVVVC/cbYPTu0UhNpEbj/Go3QFWr3gn2lS4TZMXTiDrVnNLNB2f1UJusvdIp/2CGTMji1OhLVAx8XiCSa8wtKq5QfMUPvM28gg/2ylzJMV+0JAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA="
                                alt="Centro Educativo Tehui"
                            />
                            <div className="logo-subtitle-edu">¡Educando en valores con calidad!</div>
                        </div>

                        <h1 className="system-title-edu">Sistema de Nómina</h1>

                        <form onSubmit={handleUserLogin} style={{width: '100%'}}>
                            {loginForm.error && (
                                <div className="error-message-edu">
                                    ⚠️ {loginForm.error}
                                </div>
                            )}
                            <div className="form-group-edu">
                                <label>👤 Usuario</label>
                                <input 
                                    type="text"
                                    value={loginForm.usuario}
                                    onChange={e => setLoginForm(f => ({ ...f, usuario: e.target.value, error: '' }))}
                                    placeholder="Ingrese su usuario"
                                    autoFocus
                                />
                            </div>

                            <div className="form-group-edu">
                                <label>🔒 Contraseña</label>
                                <input 
                                    type="password"
                                    value={loginForm.password}
                                    onChange={e => setLoginForm(f => ({ ...f, password: e.target.value, error: '' }))}
                                    placeholder="Ingrese su contraseña"
                                />
                            </div>

                            <button type="submit" className="btn-login-edu">
                                🔑 Iniciar Sesión
                            </button>
                        </form>

                        <div className="footer-text-edu">
                            Sistema Nómina Tehui v3.95 © 2026
                        </div>
                    </div>

                    {/* Panel Derecho - Ilustración Educativa */}
                    <div className="illustration-panel-edu">
                        <div className="welcome-message-edu">
                            <h2 className="welcome-title-edu">¡Bienvenido!</h2>
                            <p className="welcome-subtitle-edu">Nivel Inicial y Primaria</p>
                        </div>

                        <div className="illustration-container-edu">
                            <svg viewBox="0 0 650 380" width="100%" height="100%">
                                {/* Nubes */}
                                <g className="floating-element-edu" style={{animationDelay: '0s'}}>
                                    <ellipse className="cloud-edu" cx="80" cy="50" rx="40" ry="20"/>
                                    <ellipse className="cloud-edu" cx="60" cy="45" rx="25" ry="15"/>
                                    <ellipse className="cloud-edu" cx="100" cy="45" rx="25" ry="15"/>
                                </g>
                                
                                <g className="floating-element-edu" style={{animationDelay: '1s'}}>
                                    <ellipse className="cloud-edu" cx="550" cy="60" rx="50" ry="25"/>
                                    <ellipse className="cloud-edu" cx="525" cy="50" rx="30" ry="18"/>
                                    <ellipse className="cloud-edu" cx="580" cy="50" rx="30" ry="18"/>
                                </g>
                                
                                <g className="floating-element-edu" style={{animationDelay: '0.5s'}}>
                                    <ellipse className="cloud-edu" cx="320" cy="30" rx="35" ry="18"/>
                                    <ellipse className="cloud-edu" cx="300" cy="25" rx="22" ry="12"/>
                                    <ellipse className="cloud-edu" cx="340" cy="25" rx="22" ry="12"/>
                                </g>

                                {/* Estrellas */}
                                <polygon className="star-edu floating-element-edu" points="150,70 153,80 163,80 155,87 158,97 150,90 142,97 145,87 137,80 147,80" style={{animationDelay: '0.3s'}}/>
                                <polygon className="star-edu floating-element-edu" points="500,35 502,42 510,42 504,47 506,55 500,50 494,55 496,47 490,42 498,42" style={{animationDelay: '0.8s'}}/>
                                <polygon className="star-edu floating-element-edu" points="400,80 402,87 410,87 404,92 406,100 400,95 394,100 396,92 390,87 398,87" style={{animationDelay: '1.2s'}}/>

                                {/* Sol sonriente */}
                                <g className="floating-element-edu" style={{animationDelay: '0.2s'}}>
                                    <circle cx="580" cy="130" r="35" fill="#ffd54f"/>
                                    <line x1="580" y1="80" x2="580" y2="60" stroke="#ffd54f" strokeWidth="4" strokeLinecap="round"/>
                                    <line x1="615" y1="95" x2="630" y2="80" stroke="#ffd54f" strokeWidth="4" strokeLinecap="round"/>
                                    <line x1="630" y1="130" x2="650" y2="130" stroke="#ffd54f" strokeWidth="4" strokeLinecap="round"/>
                                    <line x1="615" y1="165" x2="630" y2="180" stroke="#ffd54f" strokeWidth="4" strokeLinecap="round"/>
                                    <line x1="545" y1="95" x2="530" y2="80" stroke="#ffd54f" strokeWidth="4" strokeLinecap="round"/>
                                    <line x1="530" y1="130" x2="510" y2="130" stroke="#ffd54f" strokeWidth="4" strokeLinecap="round"/>
                                    <circle cx="568" cy="125" r="4" fill="#ff8f00"/>
                                    <circle cx="592" cy="125" r="4" fill="#ff8f00"/>
                                    <path d="M 565 140 Q 580 155 595 140" stroke="#ff8f00" strokeWidth="3" fill="none" strokeLinecap="round"/>
                                </g>

                                {/* Pasto/suelo */}
                                <path d="M 0 330 Q 100 310 200 330 Q 300 350 400 330 Q 500 310 600 330 Q 650 340 650 380 L 0 380 Z" fill="#81c784"/>
                                <path d="M 0 345 Q 150 330 300 345 Q 450 360 600 345 Q 650 350 650 380 L 0 380 Z" fill="#66bb6a"/>

                                {/* Escuela */}
                                <rect x="230" y="180" width="190" height="150" fill="#ffcc80" rx="5"/>
                                <polygon points="230,180 325,110 420,180" fill="#ef5350"/>
                                <rect x="295" y="260" width="60" height="70" fill="#8d6e63" rx="3"/>
                                <circle cx="345" cy="300" r="5" fill="#ffd54f"/>
                                <rect x="250" y="210" width="40" height="35" fill="#64b5f6" rx="2"/>
                                <rect x="360" y="210" width="40" height="35" fill="#64b5f6" rx="2"/>
                                <line x1="270" y1="210" x2="270" y2="245" stroke="#fff" strokeWidth="2"/>
                                <line x1="250" y1="227" x2="290" y2="227" stroke="#fff" strokeWidth="2"/>
                                <line x1="380" y1="210" x2="380" y2="245" stroke="#fff" strokeWidth="2"/>
                                <line x1="360" y1="227" x2="400" y2="227" stroke="#fff" strokeWidth="2"/>
                                {/* Bandera */}
                                <line x1="325" y1="110" x2="325" y2="70" stroke="#795548" strokeWidth="3"/>
                                <rect x="325" y="70" width="30" height="20" fill="#1565c0"/>

                                {/* Niño 1 (izquierda) con colores Tehui (rojo) */}
                                <g transform="translate(120, 245)">
                                    <circle cx="0" cy="0" r="18" fill="#ffcc80"/>
                                    <circle cx="-5" cy="-3" r="3" fill="#333"/>
                                    <circle cx="5" cy="-3" r="3" fill="#333"/>
                                    <path d="M -5 5 Q 0 10 5 5" stroke="#333" strokeWidth="2" fill="none"/>
                                    <ellipse cx="0" cy="-18" rx="20" ry="10" fill="#e53935"/>
                                    <rect x="-15" y="18" width="30" height="50" fill="#e53935" rx="5"/>
                                    <rect x="-20" y="68" width="15" height="25" fill="#5d4037" rx="3"/>
                                    <rect x="5" y="68" width="15" height="25" fill="#5d4037" rx="3"/>
                                </g>

                                {/* Niña (centro-izquierda) con color Tehui (amarillo/naranja) */}
                                <g transform="translate(175, 250)">
                                    <circle cx="0" cy="0" r="16" fill="#ffcc80"/>
                                    <circle cx="-4" cy="-2" r="2.5" fill="#333"/>
                                    <circle cx="4" cy="-2" r="2.5" fill="#333"/>
                                    <path d="M -4 4 Q 0 8 4 4" stroke="#333" strokeWidth="2" fill="none"/>
                                    <path d="M -18 -5 Q -20 -20 0 -22 Q 20 -20 18 -5" fill="#fdd835"/>
                                    <ellipse cx="-16" cy="0" rx="5" ry="8" fill="#fdd835"/>
                                    <ellipse cx="16" cy="0" rx="5" ry="8" fill="#fdd835"/>
                                    <path d="M -12 16 L -18 65 L 18 65 L 12 16 Z" fill="#ff9800"/>
                                    <rect x="-15" y="65" width="12" height="20" fill="#ffcc80" rx="2"/>
                                    <rect x="3" y="65" width="12" height="20" fill="#ffcc80" rx="2"/>
                                    <rect x="15" y="25" width="25" height="20" fill="#43a047" rx="2" transform="rotate(15)"/>
                                </g>

                                {/* Niño 2 (derecha) con color Tehui (azul) */}
                                <g transform="translate(480, 243)">
                                    <circle cx="0" cy="0" r="17" fill="#d7a574"/>
                                    <circle cx="-5" cy="-2" r="3" fill="#333"/>
                                    <circle cx="5" cy="-2" r="3" fill="#333"/>
                                    <path d="M -4 5 Q 0 9 4 5" stroke="#333" strokeWidth="2" fill="none"/>
                                    <ellipse cx="0" cy="-17" rx="18" ry="8" fill="#333"/>
                                    <rect x="-14" y="17" width="28" height="45" fill="#2196f3" rx="5"/>
                                    <rect x="-18" y="67" width="14" height="23" fill="#455a64" rx="3"/>
                                    <rect x="4" y="67" width="14" height="23" fill="#455a64" rx="3"/>
                                    <ellipse cx="0" cy="35" rx="22" ry="20" fill="#43a047"/>
                                    <rect x="-8" y="25" width="16" height="10" fill="#66bb6a" rx="2"/>
                                </g>

                                {/* Niña 2 (extremo derecho) con color Tehui (verde) */}
                                <g transform="translate(540, 248)">
                                    <circle cx="0" cy="0" r="15" fill="#ffcc80"/>
                                    <circle cx="-4" cy="-2" r="2.5" fill="#333"/>
                                    <circle cx="4" cy="-2" r="2.5" fill="#333"/>
                                    <path d="M -4 4 Q 0 7 4 4" stroke="#333" strokeWidth="2" fill="none"/>
                                    <path d="M -16 -3 Q -18 -18 0 -20 Q 18 -18 16 -3" fill="#5d4037"/>
                                    <ellipse cx="-14" cy="2" rx="4" ry="7" fill="#5d4037"/>
                                    <ellipse cx="14" cy="2" rx="4" ry="7" fill="#5d4037"/>
                                    <path d="M -10 15 L -15 60 L 15 60 L 10 15 Z" fill="#43a047"/>
                                    <rect x="-12" y="60" width="10" height="18" fill="#ffcc80" rx="2"/>
                                    <rect x="2" y="60" width="10" height="18" fill="#ffcc80" rx="2"/>
                                </g>

                                {/* Lápiz rojo */}
                                <g transform="translate(55, 280) rotate(-25)">
                                    <rect x="0" y="0" width="8" height="55" fill="#e53935"/>
                                    <polygon points="0,55 4,70 8,55" fill="#ffcc80"/>
                                    <rect x="0" y="0" width="8" height="10" fill="#ef9a9a"/>
                                    <rect x="1" y="52" width="6" height="6" fill="#bdbdbd"/>
                                </g>

                                {/* Lápiz azul */}
                                <g transform="translate(600, 290) rotate(20)">
                                    <rect x="0" y="0" width="7" height="50" fill="#2196f3"/>
                                    <polygon points="0,50 3.5,63 7,50" fill="#ffcc80"/>
                                    <rect x="0" y="0" width="7" height="8" fill="#90caf9"/>
                                    <rect x="1" y="47" width="5" height="5" fill="#bdbdbd"/>
                                </g>

                                {/* Libro abierto */}
                                <g transform="translate(460, 320)">
                                    <path d="M 0 0 Q 20 -5 40 0 L 40 30 Q 20 25 0 30 Z" fill="#fff" stroke="#e0e0e0"/>
                                    <path d="M 40 0 Q 60 -5 80 0 L 80 30 Q 60 25 40 30 Z" fill="#fff" stroke="#e0e0e0"/>
                                    <line x1="10" y1="8" x2="30" y2="6" stroke="#bdbdbd" strokeWidth="1"/>
                                    <line x1="10" y1="14" x2="30" y2="12" stroke="#bdbdbd" strokeWidth="1"/>
                                    <line x1="50" y1="6" x2="70" y2="8" stroke="#bdbdbd" strokeWidth="1"/>
                                    <line x1="50" y1="12" x2="70" y2="14" stroke="#bdbdbd" strokeWidth="1"/>
                                </g>

                                {/* ABC con colores Tehui */}
                                <text x="60" y="170" fontSize="28" fontWeight="bold" fill="#e53935" className="floating-element-edu" style={{animationDelay: '0.4s'}}>A</text>
                                <text x="85" y="190" fontSize="28" fontWeight="bold" fill="#43a047" className="floating-element-edu" style={{animationDelay: '0.7s'}}>B</text>
                                <text x="45" y="210" fontSize="28" fontWeight="bold" fill="#2196f3" className="floating-element-edu" style={{animationDelay: '1s'}}>C</text>

                                {/* 123 con colores Tehui */}
                                <text x="530" y="185" fontSize="24" fontWeight="bold" fill="#ff9800" className="floating-element-edu" style={{animationDelay: '0.5s'}}>1</text>
                                <text x="555" y="205" fontSize="24" fontWeight="bold" fill="#fdd835" className="floating-element-edu" style={{animationDelay: '0.9s'}}>2</text>
                                <text x="540" y="230" fontSize="24" fontWeight="bold" fill="#e53935" className="floating-element-edu" style={{animationDelay: '1.3s'}}>3</text>

                                {/* Arcoíris con colores más vivos */}
                                <g transform="translate(325, 95)">
                                    <path d="M -50 0 A 50 50 0 0 1 50 0" stroke="#e53935" strokeWidth="5" fill="none"/>
                                    <path d="M -43 0 A 43 43 0 0 1 43 0" stroke="#ff9800" strokeWidth="5" fill="none"/>
                                    <path d="M -36 0 A 36 36 0 0 1 36 0" stroke="#fdd835" strokeWidth="5" fill="none"/>
                                    <path d="M -29 0 A 29 29 0 0 1 29 0" stroke="#43a047" strokeWidth="5" fill="none"/>
                                    <path d="M -22 0 A 22 22 0 0 1 22 0" stroke="#2196f3" strokeWidth="5" fill="none"/>
                                </g>

                                {/* Mariposa */}
                                <g transform="translate(200, 150)" className="floating-element-edu" style={{animationDelay: '0.6s'}}>
                                    <ellipse cx="0" cy="0" rx="3" ry="8" fill="#333"/>
                                    <ellipse cx="-10" cy="-5" rx="12" ry="8" fill="#ec407a" opacity="0.8"/>
                                    <ellipse cx="10" cy="-5" rx="12" ry="8" fill="#ec407a" opacity="0.8"/>
                                    <ellipse cx="-8" cy="5" rx="8" ry="6" fill="#f48fb1" opacity="0.8"/>
                                    <ellipse cx="8" cy="5" rx="8" ry="6" fill="#f48fb1" opacity="0.8"/>
                                </g>

                                {/* Flores en el pasto */}
                                <g transform="translate(30, 340)">
                                    <circle cx="0" cy="0" r="8" fill="#ec407a"/>
                                    <circle cx="0" cy="0" r="4" fill="#ffd54f"/>
                                </g>
                                <g transform="translate(620, 345)">
                                    <circle cx="0" cy="0" r="7" fill="#ffd54f"/>
                                    <circle cx="0" cy="0" r="3" fill="#ff9800"/>
                                </g>
                                <g transform="translate(280, 355)">
                                    <circle cx="0" cy="0" r="6" fill="#ce93d8"/>
                                    <circle cx="0" cy="0" r="3" fill="#ffd54f"/>
                                </g>
                                <g transform="translate(380, 350)">
                                    <circle cx="0" cy="0" r="7" fill="#81d4fa"/>
                                    <circle cx="0" cy="0" r="3" fill="#fff"/>
                                </g>
                            </svg>
                        </div>

                        <div className="values-container-edu">
                            <div className="value-item-edu">
                                <div className="value-icon-edu">📚</div>
                                <div className="value-text-edu">Educación</div>
                            </div>
                            <div className="value-item-edu">
                                <div className="value-icon-edu">💝</div>
                                <div className="value-text-edu">Valores</div>
                            </div>
                            <div className="value-item-edu">
                                <div className="value-icon-edu">⭐</div>
                                <div className="value-text-edu">Calidad</div>
                            </div>
                        </div>
                    </div>
                </div>
            ) : paso2FA === 'configurar' ? (
                /* ========================================== */
                /* PANTALLA DE CONFIGURACIÓN 2FA (Primera vez) */
                /* ========================================== */
                <div style={{
                    minHeight: '100vh',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    background: 'linear-gradient(135deg, #0D47A1 0%, #1565C0 50%, #1E88E5 100%)',
                    padding: '20px'
                }}>
                    <div style={{
                        background: 'white',
                        borderRadius: '16px',
                        padding: '32px',
                        width: '100%',
                        maxWidth: '420px',
                        boxShadow: '0 20px 40px rgba(0,0,0,0.3)'
                    }}>
                        <div style={{ textAlign: 'center', marginBottom: '20px' }}>
                            <div style={{ 
                                fontSize: '48px', 
                                marginBottom: '12px'
                            }}>🔐</div>
                            <h2 style={{ 
                                fontSize: '18px', 
                                fontWeight: '700', 
                                color: 'var(--primary)',
                                marginBottom: '8px'
                            }}>
                                Configurar Autenticación
                            </h2>
                            <p style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>
                                Escanea el código QR con Microsoft Authenticator
                            </p>
                        </div>
                        
                        {/* Código QR */}
                        <div style={{ 
                            display: 'flex', 
                            justifyContent: 'center', 
                            marginBottom: '20px',
                            padding: '16px',
                            background: '#f8f9fa',
                            borderRadius: '12px'
                        }}>
                            <div id="qr-2fa-container" style={{ 
                                width: '200px', 
                                height: '200px',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center'
                            }}>
                                <span style={{ color: 'var(--text-muted)' }}>Generando QR...</span>
                            </div>
                        </div>
                        
                        {/* Instrucciones */}
                        <div style={{ 
                            background: '#e3f2fd', 
                            padding: '12px', 
                            borderRadius: '8px',
                            marginBottom: '16px',
                            fontSize: '11px'
                        }}>
                            <strong>📱 Pasos:</strong>
                            <ol style={{ marginLeft: '16px', marginTop: '6px', lineHeight: '1.6' }}>
                                <li>Abre Microsoft Authenticator en tu celular</li>
                                <li>Toca "+" y selecciona "Otra cuenta"</li>
                                <li>Escanea este código QR</li>
                                <li>Ingresa el código de 6 dígitos abajo</li>
                            </ol>
                        </div>
                        
                        {/* Código secreto manual (backup) */}
                        <details style={{ marginBottom: '16px' }}>
                            <summary style={{ 
                                fontSize: '11px', 
                                color: 'var(--text-secondary)', 
                                cursor: 'pointer' 
                            }}>
                                ¿No puedes escanear? Ingresa manualmente
                            </summary>
                            <div style={{ 
                                marginTop: '8px', 
                                padding: '10px', 
                                background: '#fff3e0',
                                borderRadius: '6px',
                                fontFamily: 'JetBrains Mono, monospace',
                                fontSize: '12px',
                                wordBreak: 'break-all',
                                textAlign: 'center'
                            }}>
                                {secretoTemp}
                            </div>
                        </details>
                        
                        {/* Formulario de verificación */}
                        <form onSubmit={handleVerificar2FA}>
                            <div style={{ marginBottom: '14px' }}>
                                <label style={{ 
                                    display: 'block', 
                                    fontSize: '11px', 
                                    fontWeight: '600', 
                                    marginBottom: '5px', 
                                    color: 'var(--text-secondary)' 
                                }}>
                                    🔢 Código de verificación
                                </label>
                                <input 
                                    type="text"
                                    className="form-control"
                                    value={codigo2FA}
                                    onChange={e => {
                                        const val = e.target.value.replace(/\D/g, '').slice(0, 6);
                                        setCodigo2FA(val);
                                        setError2FA('');
                                    }}
                                    placeholder="000000"
                                    maxLength={6}
                                    style={{ 
                                        width: '100%', 
                                        padding: '12px', 
                                        fontSize: '24px',
                                        textAlign: 'center',
                                        letterSpacing: '8px',
                                        fontFamily: 'JetBrains Mono, monospace'
                                    }}
                                    autoFocus
                                />
                            </div>
                            
                            {error2FA && (
                                <div style={{ 
                                    padding: '10px 12px', 
                                    background: 'rgba(239,68,68,0.1)', 
                                    border: '1px solid rgba(239,68,68,0.3)',
                                    borderRadius: '8px', 
                                    color: 'var(--danger)',
                                    fontSize: '12px',
                                    marginBottom: '14px'
                                }}>
                                    ⚠️ {error2FA}
                                </div>
                            )}
                            
                            <button 
                                type="submit" 
                                className="btn btn-primary"
                                disabled={codigo2FA.length !== 6}
                                style={{ 
                                    width: '100%', 
                                    padding: '11px',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    opacity: codigo2FA.length !== 6 ? 0.6 : 1
                                }}
                            >
                                ✓ Verificar y Activar 2FA
                            </button>
                        </form>
                        
                        {/* Opción alternativa: código por correo */}
                        <div style={{ 
                            marginTop: '20px', 
                            paddingTop: '16px', 
                            borderTop: '1px solid var(--border)',
                            textAlign: 'center'
                        }}>
                            <p style={{ fontSize: '11px', color: 'var(--text-muted)', marginBottom: '10px' }}>
                                ¿Prefieres recibir el código por correo?
                            </p>
                            <button 
                                onClick={handleEnviarCodigoEmail}
                                disabled={enviandoEmail}
                                style={{ 
                                    width: '100%',
                                    padding: '10px',
                                    background: 'linear-gradient(135deg, var(--tehui-orange), #EF6C00)',
                                    border: 'none',
                                    borderRadius: '8px',
                                    color: 'white',
                                    fontSize: '12px',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    opacity: enviandoEmail ? 0.7 : 1
                                }}
                            >
                                {enviandoEmail ? '📧 Enviando...' : '📧 Usar código por correo'}
                            </button>
                            <p style={{ fontSize: '9px', color: 'var(--text-muted)', marginTop: '8px' }}>
                                Podrás configurar Authenticator más tarde
                            </p>
                        </div>
                        
                        {/* Opción para recuperar secreto existente */}
                        <details style={{ 
                            marginTop: '16px', 
                            paddingTop: '16px', 
                            borderTop: '1px solid var(--border)'
                        }}>
                            <summary style={{ 
                                fontSize: '11px', 
                                color: 'var(--primary)', 
                                cursor: 'pointer',
                                fontWeight: '600'
                            }}>
                                🔄 ¿Ya tienes el Authenticator configurado?
                            </summary>
                            <div style={{ 
                                marginTop: '12px', 
                                padding: '12px', 
                                background: '#e8f5e9',
                                borderRadius: '8px',
                                fontSize: '11px'
                            }}>
                                <p style={{ marginBottom: '10px', color: '#2e7d32' }}>
                                    Si ya tienes el código configurado en tu Authenticator desde antes, 
                                    puedes ingresar el <strong>secreto</strong> para recuperar el acceso:
                                </p>
                                <input 
                                    type="text"
                                    className="form-control form-control-sm"
                                    placeholder="Ingresa el secreto (32 caracteres)"
                                    style={{ 
                                        fontFamily: 'monospace',
                                        textTransform: 'uppercase',
                                        marginBottom: '10px'
                                    }}
                                    onKeyPress={(e) => {
                                        if (e.key === 'Enter') {
                                            e.preventDefault();
                                            const secretoIngresado = e.target.value.toUpperCase().replace(/\s/g, '');
                                            if (secretoIngresado.length >= 16) {
                                                const resultado = importarSecreto2FAManual(usuarioTemp, secretoIngresado);
                                                if (resultado.exito) {
                                                    alert('✅ Secreto recuperado. Ahora ingresa el código de tu Authenticator.');
                                                    setPaso2FA('verificar');
                                                }
                                            } else {
                                                alert('⚠️ El secreto debe tener al menos 16 caracteres');
                                            }
                                        }
                                    }}
                                />
                                <button 
                                    type="button"
                                    onClick={(e) => {
                                        const input = e.target.previousSibling;
                                        const secretoIngresado = input.value.toUpperCase().replace(/\s/g, '');
                                        if (secretoIngresado.length >= 16) {
                                            const resultado = importarSecreto2FAManual(usuarioTemp, secretoIngresado);
                                            if (resultado.exito) {
                                                alert('✅ Secreto recuperado correctamente.\n\nAhora ingresa el código de 6 dígitos de tu Authenticator.');
                                                setPaso2FA('verificar');
                                            }
                                        } else {
                                            alert('⚠️ El secreto debe tener al menos 16 caracteres');
                                        }
                                    }}
                                    className="btn btn-sm btn-success"
                                    style={{ width: '100%' }}
                                >
                                    ✓ Recuperar Configuración
                                </button>
                                <p style={{ fontSize: '9px', color: '#666', marginTop: '8px' }}>
                                    💡 El secreto lo puedes ver en los detalles de la cuenta en tu Authenticator
                                </p>
                            </div>
                        </details>
                        
                        <button 
                            onClick={cancelar2FA}
                            style={{ 
                                width: '100%', 
                                marginTop: '12px',
                                padding: '10px',
                                background: 'none',
                                border: '1px solid var(--border)',
                                borderRadius: '8px',
                                color: 'var(--text-secondary)',
                                fontSize: '12px',
                                cursor: 'pointer'
                            }}
                        >
                            ← Cancelar
                        </button>
                    </div>
                </div>
            ) : paso2FA === 'verificar' ? (
                /* ========================================== */
                /* PANTALLA DE VERIFICACIÓN 2FA (Cada login) */
                /* ========================================== */
                <div style={{
                    minHeight: '100vh',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    background: 'linear-gradient(135deg, #0D47A1 0%, #1565C0 50%, #1E88E5 100%)',
                    padding: '20px'
                }}>
                    <div style={{
                        background: 'white',
                        borderRadius: '16px',
                        padding: '32px',
                        width: '100%',
                        maxWidth: '360px',
                        boxShadow: '0 20px 40px rgba(0,0,0,0.3)'
                    }}>
                        <div style={{ textAlign: 'center', marginBottom: '24px' }}>
                            <div style={{ 
                                fontSize: '48px', 
                                marginBottom: '12px'
                            }}>📱</div>
                            <h2 style={{ 
                                fontSize: '18px', 
                                fontWeight: '700', 
                                color: 'var(--primary)',
                                marginBottom: '8px'
                            }}>
                                Verificación de Seguridad
                            </h2>
                            <p style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>
                                Ingresa el código de Microsoft Authenticator
                            </p>
                        </div>
                        
                        <form onSubmit={handleVerificar2FA}>
                            <div style={{ marginBottom: '20px' }}>
                                <input 
                                    type="text"
                                    className="form-control"
                                    value={codigo2FA}
                                    onChange={e => {
                                        const val = e.target.value.replace(/\D/g, '').slice(0, 6);
                                        setCodigo2FA(val);
                                        setError2FA('');
                                    }}
                                    placeholder="000000"
                                    maxLength={6}
                                    style={{ 
                                        width: '100%', 
                                        padding: '16px', 
                                        fontSize: '28px',
                                        textAlign: 'center',
                                        letterSpacing: '10px',
                                        fontFamily: 'JetBrains Mono, monospace',
                                        border: '2px solid var(--border)',
                                        borderRadius: '12px'
                                    }}
                                    autoFocus
                                />
                                <p style={{ 
                                    fontSize: '10px', 
                                    color: 'var(--text-muted)', 
                                    textAlign: 'center',
                                    marginTop: '8px'
                                }}>
                                    El código cambia cada 30 segundos
                                </p>
                            </div>
                            
                            {error2FA && (
                                <div style={{ 
                                    padding: '10px 12px', 
                                    background: 'rgba(239,68,68,0.1)', 
                                    border: '1px solid rgba(239,68,68,0.3)',
                                    borderRadius: '8px', 
                                    color: 'var(--danger)',
                                    fontSize: '12px',
                                    marginBottom: '14px',
                                    textAlign: 'center'
                                }}>
                                    ⚠️ {error2FA}
                                </div>
                            )}
                            
                            <button 
                                type="submit" 
                                className="btn btn-primary"
                                disabled={codigo2FA.length !== 6}
                                style={{ 
                                    width: '100%', 
                                    padding: '12px',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    opacity: codigo2FA.length !== 6 ? 0.6 : 1
                                }}
                            >
                                🔓 Verificar
                            </button>
                        </form>
                        
                        <button 
                            onClick={cancelar2FA}
                            style={{ 
                                width: '100%', 
                                marginTop: '12px',
                                padding: '10px',
                                background: 'none',
                                border: '1px solid var(--border)',
                                borderRadius: '8px',
                                color: 'var(--text-secondary)',
                                fontSize: '12px',
                                cursor: 'pointer'
                            }}
                        >
                            ← Volver al login
                        </button>
                        
                        {/* Opción de código por correo */}
                        <div style={{ 
                            marginTop: '16px', 
                            paddingTop: '16px', 
                            borderTop: '1px solid var(--border)',
                            textAlign: 'center'
                        }}>
                            <p style={{ fontSize: '11px', color: 'var(--text-muted)', marginBottom: '10px' }}>
                                ¿No tienes acceso a Authenticator?
                            </p>
                            <button 
                                onClick={handleEnviarCodigoEmail}
                                disabled={enviandoEmail}
                                style={{ 
                                    width: '100%',
                                    padding: '10px',
                                    background: 'linear-gradient(135deg, var(--tehui-orange), #EF6C00)',
                                    border: 'none',
                                    borderRadius: '8px',
                                    color: 'white',
                                    fontSize: '12px',
                                    fontWeight: '600',
                                    cursor: 'pointer',
                                    opacity: enviandoEmail ? 0.7 : 1
                                }}
                            >
                                {enviandoEmail ? '📧 Enviando...' : '📧 Enviar código al correo'}
                            </button>
                        </div>
                        
                        <div style={{ 
                            marginTop: '12px', 
                            textAlign: 'center'
                        }}>
                            <p style={{ fontSize: '10px', color: 'var(--text-muted)' }}>
                                Usuario: <strong>{usuarioTemp}</strong>
                            </p>
                        </div>
                    </div>
                </div>
            ) : paso2FA === 'email' ? (
                /* ========================================== */
                /* PANTALLA DE CÓDIGO POR EMAIL */
                /* ========================================== */
                <div style={{
                    minHeight: '100vh',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    background: 'linear-gradient(135deg, #E65100 0%, #FB8C00 50%, #FFA726 100%)',
                    padding: '20px'
                }}>
                    <div style={{
                        background: 'white',
                        borderRadius: '16px',
                        padding: '32px',
                        width: '100%',
                        maxWidth: '360px',
                        boxShadow: '0 20px 40px rgba(0,0,0,0.3)'
                    }}>
                        <div style={{ textAlign: 'center', marginBottom: '24px' }}>
                            <div style={{ 
                                fontSize: '48px', 
                                marginBottom: '12px'
                            }}>📧</div>
                            <h2 style={{ 
                                fontSize: '18px', 
                                fontWeight: '700', 
                                color: 'var(--tehui-orange)',
                                marginBottom: '8px'
                            }}>
                                Código por Correo
                            </h2>
                            <p style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>
                                {mensajeEmail || 'Ingresa el código enviado a tu correo'}
                            </p>
                        </div>
                        
                        <div style={{
                            background: '#fff3e0',
                            padding: '12px',
                            borderRadius: '8px',
                            marginBottom: '20px',
                            fontSize: '11px',
                            color: '#E65100'
                        }}>
                            ⏱️ El código expira en <strong>5 minutos</strong>
                        </div>
                        
                        <form onSubmit={handleVerificarCodigoEmail}>
                            <div style={{ marginBottom: '20px' }}>
                                <input 
                                    type="text"
                                    className="form-control"
                                    value={codigo2FA}
                                    onChange={e => {
                                        const val = e.target.value.replace(/\D/g, '').slice(0, 6);
                                        setCodigo2FA(val);
                                        setError2FA('');
                                    }}
                                    placeholder="000000"
                                    maxLength={6}
                                    style={{ 
                                        width: '100%', 
                                        padding: '16px', 
                                        fontSize: '28px',
                                        textAlign: 'center',
                                        letterSpacing: '10px',
                                        fontFamily: 'JetBrains Mono, monospace',
                                        border: '2px solid var(--tehui-orange)',
                                        borderRadius: '12px'
                                    }}
                                    autoFocus
                                />
                            </div>
                            
                            {error2FA && (
                                <div style={{ 
                                    padding: '10px 12px', 
                                    background: 'rgba(239,68,68,0.1)', 
                                    border: '1px solid rgba(239,68,68,0.3)',
                                    borderRadius: '8px', 
                                    color: 'var(--danger)',
                                    fontSize: '12px',
                                    marginBottom: '14px',
                                    textAlign: 'center'
                                }}>
                                    ⚠️ {error2FA}
                                </div>
                            )}
                            
                            <button 
                                type="submit" 
                                className="btn btn-orange"
                                disabled={codigo2FA.length !== 6}
                                style={{ 
                                    width: '100%', 
                                    padding: '12px',
                                    fontSize: '14px',
                                    fontWeight: '600',
                                    opacity: codigo2FA.length !== 6 ? 0.6 : 1
                                }}
                            >
                                🔓 Verificar Código
                            </button>
                        </form>
                        
                        {/* Reenviar código */}
                        <button 
                            onClick={handleEnviarCodigoEmail}
                            disabled={enviandoEmail}
                            style={{ 
                                width: '100%', 
                                marginTop: '12px',
                                padding: '10px',
                                background: 'none',
                                border: '1px solid var(--tehui-orange)',
                                borderRadius: '8px',
                                color: 'var(--tehui-orange)',
                                fontSize: '12px',
                                cursor: 'pointer',
                                opacity: enviandoEmail ? 0.6 : 1
                            }}
                        >
                            {enviandoEmail ? '📧 Enviando...' : '🔄 Reenviar código'}
                        </button>
                        
                        <button 
                            onClick={() => {
                                setPaso2FA('verificar');
                                setCodigo2FA('');
                                setError2FA('');
                                setMensajeEmail('');
                            }}
                            style={{ 
                                width: '100%', 
                                marginTop: '8px',
                                padding: '10px',
                                background: 'none',
                                border: '1px solid var(--border)',
                                borderRadius: '8px',
                                color: 'var(--text-secondary)',
                                fontSize: '12px',
                                cursor: 'pointer'
                            }}
                        >
                            ← Volver a Authenticator
                        </button>
                        
                        <div style={{ 
                            marginTop: '16px', 
                            paddingTop: '12px', 
                            borderTop: '1px solid var(--border)',
                            textAlign: 'center'
                        }}>
                            <p style={{ fontSize: '10px', color: 'var(--text-muted)' }}>
                                Usuario: <strong>{usuarioTemp}</strong>
                            </p>
                        </div>
                    </div>
                </div>
            ) : (
            <>
            {/* Sidebar */}
            <aside className="sidebar no-print">
                <div className="sidebar-header"><div className="logo"><div className="logo-icon"><img src="data:image/png;base64,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" alt="Tehui" /></div><div><h1>Nómina Tehui</h1><span>Sistema v3.83</span></div></div></div>
                <nav className="nav">
                    <div className="nav-group"><div className="nav-label">Principal</div>
                        <div className={`nav-item ${view === 'dashboard' ? 'active' : ''}`} onClick={() => setView('dashboard')}><Icons.Dashboard /><span>Dashboard</span></div>
                        <div className={`nav-item ${view === 'empleados' ? 'active' : ''}`} onClick={() => setView('empleados')}><Icons.Users /><span>Empleados</span></div>
                        <div className={`nav-item ${view === 'nomina' ? 'active' : ''}`} onClick={() => setView('nomina')}><Icons.Dollar /><span>Nómina</span></div>
                    </div>
                    <div className="nav-group"><div className="nav-label">Gestión</div>
                        <div className={`nav-item ${view === 'prestamos' ? 'active' : ''}`} onClick={() => setView('prestamos')}><Icons.CreditCard /><span>Préstamos</span>{stats.prestamosActivos > 0 && <span className="nav-badge">{stats.prestamosActivos}</span>}</div>
                        <div className={`nav-item ${view === 'licencias' ? 'active' : ''}`} onClick={() => setView('licencias')}><Icons.Calendar /><span>Licencias</span>{stats.licenciasActivas > 0 && <span className="nav-badge">{stats.licenciasActivas}</span>}</div>
                    </div>
                    <div className="nav-group"><div className="nav-label">Reportes</div>
                        <div className={`nav-item ${view === 'historial' ? 'active' : ''}`} onClick={() => setView('historial')}><Icons.Clock /><span>Historial</span></div>
                        <div className="nav-item" onClick={() => openModal('reportes')} style={{background:'rgba(251,140,0,0.15)'}}><Icons.FileText /><span>📊 Centro de Reportes</span></div>
                        <div className={`nav-item ${view === 'auditoria' ? 'active' : ''}`} onClick={() => setView('auditoria')} style={{background:'rgba(156,39,176,0.15)'}}><span>📋</span><span>Auditoría</span></div>
                        <div className={`nav-item ${view === 'exportacion' ? 'active' : ''}`} onClick={() => setView('exportacion')} style={{background:'rgba(0,150,136,0.15)'}}><span>🏛️</span><span>TSS / DGII</span></div>
                    </div>
                    <div className="nav-group"><div className="nav-label">Sistema</div>
                        {usuarioActual?.rol === 'admin' && (
                            <div className={`nav-item ${view === 'usuarios' ? 'active' : ''}`} onClick={() => setView('usuarios')} style={{background:'rgba(233,30,99,0.15)'}}><span>👥</span><span>Usuarios</span></div>
                        )}
                        <div className={`nav-item ${view === 'mantenimiento' ? 'active' : ''}`} onClick={() => setView('mantenimiento')}><Icons.Database /><span>Mantenimiento</span></div>
                        <div className={`nav-item ${view === 'config' ? 'active' : ''}`} onClick={() => setView('config')}><Icons.Settings /><span>Configuración</span></div>
                        <div className="nav-item" onClick={() => openModal('proteccionDatos')} style={{background:'rgba(16,185,129,0.15)', color:'#10b981'}}>
                            <Icons.Shield /><span>Protección Datos</span>
                        </div>
                    </div>
                    
                    {/* Sección SharePoint */}
                    <div className="nav-group" style={{marginTop:'auto', borderTop:'1px solid rgba(255,255,255,0.1)', paddingTop:'12px'}}>
                        <div className="nav-label">SharePoint</div>
                        {!spConnected ? (
                            <div className="nav-item" onClick={handleLogin} style={{background:'rgba(0,120,212,0.2)', color:'#4fc3f7'}}>
                                <Icons.LogIn /><span>Conectar Microsoft</span>
                            </div>
                        ) : (
                            <>
                                <div style={{padding:'6px 10px', fontSize:'10px', color:'rgba(255,255,255,0.7)'}}>
                                    <div style={{display:'flex', alignItems:'center', gap:'6px', marginBottom:'4px'}}>
                                        <span style={{width:'8px', height:'8px', borderRadius:'50%', background: syncStatus.error ? '#f44336' : '#4caf50'}}></span>
                                        <span>{syncStatus.error ? 'Error sync' : 'Conectado'}</span>
                                    </div>
                                    <div style={{fontSize:'9px', color:'rgba(255,255,255,0.5)', marginLeft:'14px'}}>
                                        {msUser?.username || msUser?.name || 'Usuario'}
                                    </div>
                                    {syncStatus.error && (
                                        <div style={{fontSize:'9px', color:'#ff6b6b', marginLeft:'14px', marginTop:'2px'}}>
                                            ⚠️ {syncStatus.error}
                                        </div>
                                    )}
                                    {syncStatus.lastSync && !syncStatus.error && (
                                        <div style={{fontSize:'9px', color:'rgba(255,255,255,0.4)', marginLeft:'14px', marginTop:'2px'}}>
                                            Último sync: {syncStatus.lastSync.toLocaleTimeString()}
                                        </div>
                                    )}
                                </div>
                                <div className="nav-item" onClick={sincronizarConSharePoint} style={{color: syncStatus.syncing ? '#ffc107' : syncStatus.error ? '#ff6b6b' : 'rgba(255,255,255,0.6)'}}>
                                    <Icons.Refresh style={syncStatus.syncing ? {animation:'spin 1s linear infinite'} : {}} /><span>{syncStatus.syncing ? 'Sincronizando...' : syncStatus.error ? 'Reintentar' : 'Sincronizar'}</span>
                                </div>
                                <div className="nav-item" onClick={handleLogout} style={{color:'rgba(255,255,255,0.5)'}}>
                                    <Icons.LogOut /><span>Desconectar</span>
                                </div>
                            </>
                        )}
                    </div>
                </nav>
            </aside>

            {/* Main */}
            <main className="main">
                <header className="topbar no-print">
                    <div className="topbar-left">
                        <h2>{
                            view === 'dashboard' ? 'Dashboard' : 
                            view === 'empleados' ? 'Empleados' : 
                            view === 'nomina' ? 'Nómina' : 
                            view === 'prestamos' ? 'Préstamos' : 
                            view === 'licencias' ? 'Licencias' : 
                            view === 'historial' ? 'Historial' : 
                            view === 'mantenimiento' ? 'Mantenimiento' : 
                            view === 'usuarios' ? '👥 Gestión de Usuarios' :
                            view === 'auditoria' ? '📋 Auditoría del Sistema' :
                            view === 'exportacion' ? '🏛️ Exportación TSS / DGII' :
                            'Configuración'
                        }</h2>
                        <p style={{display:'flex', alignItems:'center', gap:'8px'}}>
                            {config.empresa.nombre}
                            {spConnected ? (
                                <span style={{display:'inline-flex', alignItems:'center', gap:'4px', background:'rgba(76,175,80,0.1)', color:'#4caf50', padding:'2px 8px', borderRadius:'10px', fontSize:'9px', fontWeight:'600'}}>
                                    <Icons.Cloud style={{width:'10px', height:'10px'}} /> SharePoint
                                </span>
                            ) : (
                                <span style={{display:'inline-flex', alignItems:'center', gap:'4px', background:'rgba(255,152,0,0.1)', color:'#ff9800', padding:'2px 8px', borderRadius:'10px', fontSize:'9px', fontWeight:'600'}}>
                                    <Icons.CloudOff style={{width:'10px', height:'10px'}} /> Local
                                </span>
                            )}
                        </p>
                    </div>
                    <div className="topbar-right" style={{display:'flex', alignItems:'center', gap:'12px'}}>
                        {spConnected && (
                            <button className="btn btn-secondary btn-sm" onClick={sincronizarConSharePoint} disabled={syncStatus.syncing}>
                                <Icons.Refresh style={syncStatus.syncing ? {animation:'spin 1s linear infinite'} : {}} /> {syncStatus.syncing ? 'Sincronizando...' : 'Sincronizar'}
                            </button>
                        )}
                        {view === 'empleados' && <button className="btn btn-primary" onClick={() => { setEmpForm(empFormInit); setEditingEmp(null); openModal('empleado'); }}><Icons.Plus /> Empleado</button>}
                        {view === 'prestamos' && <button className="btn btn-purple" onClick={() => openModal('prestamo')}><Icons.Plus /> Préstamo</button>}
                        {view === 'licencias' && <button className="btn btn-info" onClick={() => openModal('licencia')}><Icons.Plus /> Licencia</button>}
                        
                        {/* Menú de Usuario */}
                        <div style={{display:'flex', alignItems:'center', gap:'8px', paddingLeft:'12px', borderLeft:'1px solid var(--border-color)'}}>
                            <div style={{
                                display:'flex', 
                                alignItems:'center', 
                                gap:'8px',
                                background:'var(--bg-main)',
                                padding:'6px 12px',
                                borderRadius:'20px'
                            }}>
                                <div style={{
                                    width:'28px', 
                                    height:'28px', 
                                    borderRadius:'50%', 
                                    background: usuarioActual?.rol === 'admin' ? 'linear-gradient(135deg, var(--primary), var(--purple))' : 'linear-gradient(135deg, var(--info), var(--success))',
                                    display:'flex',
                                    alignItems:'center',
                                    justifyContent:'center',
                                    color:'white',
                                    fontSize:'11px',
                                    fontWeight:'700'
                                }}>
                                    {usuarioActual?.usuario?.substring(0,2).toUpperCase()}
                                </div>
                                <div>
                                    <div style={{fontSize:'11px', fontWeight:'600'}}>{usuarioActual?.nombre}</div>
                                    <div style={{fontSize:'9px', color:'var(--text-muted)'}}>
                                        {usuarioActual?.rol === 'admin' ? 
                                            <span style={{color:'var(--primary)'}}>Administrador</span> : 
                                            <span style={{color:'var(--info)'}}>Solo Consulta</span>
                                        }
                                    </div>
                                </div>
                            </div>
                            <button 
                                className="btn btn-secondary btn-sm" 
                                onClick={() => setMostrarCambioPassword(true)}
                                title="Cambiar contraseña"
                                style={{padding:'6px'}}
                            >
                                <Icons.Lock style={{width:'14px', height:'14px'}} />
                            </button>
                            <button 
                                className="btn btn-danger btn-sm" 
                                onClick={handleUserLogout}
                                title="Cerrar sesión"
                                style={{padding:'6px'}}
                            >
                                <Icons.LogOut style={{width:'14px', height:'14px'}} />
                            </button>
                        </div>
                    </div>
                </header>
                <div className="page">{renderContent()}</div>
            </main>

            {/* Modal Empleado */}
            <Modal open={modals.empleado} onClose={() => { closeModal('empleado'); setEditingEmp(null); setEmpForm(empFormInit); }} title={editingEmp ? 'Editar Empleado' : 'Nuevo Empleado'} size="lg" footer={<><button className="btn btn-secondary" onClick={() => closeModal('empleado')}>Cancelar</button><button className="btn btn-primary" onClick={guardarEmpleado}><Icons.Check /> {editingEmp ? 'Actualizar' : 'Guardar'}</button></>}>
                <div className="form-grid">
                    <div className="form-group span-2"><label className="form-label">Nombre Completo *</label><input className="form-control" value={empForm.nombre} onChange={e => setEmpForm(f => ({...f, nombre: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Tipo Documento</label><select className="form-control" value={empForm.tipoDocumento} onChange={e => setEmpForm(f => ({...f, tipoDocumento: e.target.value}))}><option value="cedula">Cédula</option><option value="pasaporte">Pasaporte</option></select></div>
                    <div className="form-group"><label className="form-label">{empForm.tipoDocumento === 'cedula' ? 'Cédula' : 'Pasaporte'} *</label><input className="form-control" value={empForm.documento} onChange={e => setEmpForm(f => ({...f, documento: e.target.value}))} placeholder={empForm.tipoDocumento === 'cedula' ? '000-0000000-0' : 'Número de pasaporte'} /></div>
                    <div className="form-group"><label className="form-label">NSS (Seg. Social)</label><input className="form-control" value={empForm.nss} onChange={e => setEmpForm(f => ({...f, nss: e.target.value}))} placeholder="00000000-0" /><div className="form-help">Número asignado por TSS</div></div>
                    <div className="form-group"><label className="form-label">Departamento *</label><select className="form-control" value={empForm.departamento} onChange={e => setEmpForm(f => ({...f, departamento: e.target.value}))}>{DEPARTAMENTOS.map(d => <option key={d} value={d}>{d}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">Cargo</label><input className="form-control" value={empForm.cargo} onChange={e => setEmpForm(f => ({...f, cargo: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Salario Mensual *</label><input className="form-control" type="number" value={empForm.salarioBase} onChange={e => setEmpForm(f => ({...f, salarioBase: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Tipo Remuneración</label><select className="form-control" value={empForm.tipoRemuneracion} onChange={e => setEmpForm(f => ({...f, tipoRemuneracion: e.target.value}))}>{TIPOS_REMUNERACION.map(t => <option key={t} value={t}>{t}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">Fecha Ingreso</label><input className="form-control" type="date" value={empForm.fechaIngreso} onChange={e => setEmpForm(f => ({...f, fechaIngreso: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Tipo Contrato</label><select className="form-control" value={empForm.tipoContrato} onChange={e => setEmpForm(f => ({...f, tipoContrato: e.target.value}))}>{TIPOS_CONTRATO.map(t => <option key={t} value={t}>{t}</option>)}</select></div>
                </div>
                <h4 style={{margin:'16px 0 12px', fontSize:'12px', color:'var(--text-secondary)'}}>📋 Datos Personales</h4>
                <div className="form-grid">
                    <div className="form-group"><label className="form-label">📱 Celular</label><input className="form-control" value={empForm.celular || ''} onChange={e => setEmpForm(f => ({...f, celular: e.target.value}))} placeholder="809-000-0000" /></div>
                    <div className="form-group"><label className="form-label">📞 Teléfono Casa</label><input className="form-control" value={empForm.telefono || ''} onChange={e => setEmpForm(f => ({...f, telefono: e.target.value}))} placeholder="809-000-0000" /></div>
                    <div className="form-group"><label className="form-label">✉️ Email</label><input type="email" className="form-control" value={empForm.email || ''} onChange={e => setEmpForm(f => ({...f, email: e.target.value}))} placeholder="correo@ejemplo.com" /></div>
                    <div className="form-group">
                        <label className="form-label">🎂 Fecha Nacimiento {empForm.fechaNacimiento && <span style={{fontWeight:'normal', color:'var(--primary)', marginLeft:'8px'}}>({calcularEdad(empForm.fechaNacimiento)} años)</span>}</label>
                        <input className="form-control" type="date" value={empForm.fechaNacimiento || ''} onChange={e => setEmpForm(f => ({...f, fechaNacimiento: e.target.value}))} />
                    </div>
                    <div className="form-group"><label className="form-label">💍 Estado Civil</label><select className="form-control" value={empForm.estadoCivil || 'Soltero/a'} onChange={e => setEmpForm(f => ({...f, estadoCivil: e.target.value}))}><option value="Soltero/a">Soltero/a</option><option value="Casado/a">Casado/a</option><option value="Unión Libre">Unión Libre</option><option value="Divorciado/a">Divorciado/a</option><option value="Viudo/a">Viudo/a</option></select></div>
                    <div className="form-group"><label className="form-label">🌍 Nacionalidad</label><select className="form-control" value={empForm.nacionalidad || 'Dominicana'} onChange={e => setEmpForm(f => ({...f, nacionalidad: e.target.value}))}><option value="Dominicana">Dominicana</option><option value="Haitiana">Haitiana</option><option value="Venezolana">Venezolana</option><option value="Colombiana">Colombiana</option><option value="Estadounidense">Estadounidense</option><option value="Española">Española</option><option value="Otra">Otra</option></select></div>
                    <div className="form-group span-2"><label className="form-label">🏠 Dirección</label><input className="form-control" value={empForm.direccion || ''} onChange={e => setEmpForm(f => ({...f, direccion: e.target.value}))} placeholder="Calle, No., Sector, Ciudad" /></div>
                </div>
                <h4 style={{margin:'16px 0 12px', fontSize:'12px', color:'var(--text-secondary)'}}>💰 Deducciones Fijas Mensuales</h4>
                <div className="form-grid">
                    <div className="form-group">
                        <label className="form-label">👨‍👩‍👧 PDSS - Dependientes Adic.</label>
                        <input className="form-control" type="number" min="0" max="10" value={empForm.dependientesSFS || 0} onChange={e => setEmpForm(f => ({...f, dependientesSFS: parseInt(e.target.value) || 0}))} placeholder="0" />
                        <div className="form-help">Dependientes adicionales en SFS</div>
                        {(empForm.dependientesSFS > 0) && (
                            <div className="alert alert-info" style={{marginTop:'6px', padding:'6px 10px', fontSize:'11px'}}>
                                <strong>Descuento mensual:</strong> {empForm.dependientesSFS} × RD$ {formatMoney(config.tss.pdssPerCapita || 1715.46)} = <strong>RD$ {formatMoney((empForm.dependientesSFS || 0) * (config.tss.pdssPerCapita || 1715.46))}</strong>
                            </div>
                        )}
                        <div style={{fontSize:'10px', color:'var(--primary)', marginTop:'4px', cursor:'pointer'}} onClick={() => { closeModal('empleado'); setView('config'); }}>
                            ⚙️ Cambiar valor Per Cápita (actual: RD$ {formatMoney(config.tss.pdssPerCapita || 1715.46)})
                        </div>
                    </div>
                    <div className="form-group"><label className="form-label">Cooperativa</label><input className="form-control" type="number" value={empForm.cooperativa} onChange={e => setEmpForm(f => ({...f, cooperativa: e.target.value}))} placeholder="0" /></div>
                    <div className="form-group"><label className="form-label">Seguro Médico</label><input className="form-control" type="number" value={empForm.seguroPrivado} onChange={e => setEmpForm(f => ({...f, seguroPrivado: e.target.value}))} placeholder="0" /><div className="form-help">Seguro privado adicional</div></div>
                    <div className="form-group"><label className="form-label">Embargo/Pensión</label><input className="form-control" type="number" value={empForm.embargo} onChange={e => setEmpForm(f => ({...f, embargo: e.target.value}))} placeholder="0" /><div className="form-help">Deducciones judiciales</div></div>
                </div>
                <h4 style={{margin:'16px 0 12px', fontSize:'12px', color:'var(--text-secondary)'}}>📤 Desvinculación (solo si aplica)</h4>
                <div className="form-grid">
                    <div className="form-group"><label className="form-label">🚪 Fecha de Salida</label><input className="form-control" type="date" value={empForm.fechaSalida || ''} onChange={e => setEmpForm(f => ({...f, fechaSalida: e.target.value, activo: e.target.value ? false : f.activo}))} /><div className="form-help">Al colocar fecha, el empleado se desvincula de nóminas futuras</div></div>
                    <div className="form-group"><label className="form-label">📝 Motivo de Salida</label><select className="form-control" value={empForm.motivoSalida || ''} onChange={e => setEmpForm(f => ({...f, motivoSalida: e.target.value}))}><option value="">Seleccionar...</option><option value="Renuncia">Renuncia voluntaria</option><option value="Despido">Despido</option><option value="Fin de contrato">Fin de contrato</option><option value="Jubilación">Jubilación</option><option value="Fallecimiento">Fallecimiento</option><option value="Abandono">Abandono de trabajo</option><option value="Mutuo acuerdo">Mutuo acuerdo</option><option value="Otro">Otro</option></select></div>
                </div>
                {empForm.fechaSalida && (
                    <div className="alert alert-warning" style={{marginTop:'8px'}}><Icons.AlertCircle /><span><strong>Empleado desvinculado:</strong> No aparecerá en nuevas nóminas pero su historial de pagos se conservará para consultas.</span></div>
                )}
                <h4 style={{margin:'16px 0 12px', fontSize:'12px', color:'var(--text-secondary)'}}>Datos Bancarios</h4>
                <div className="form-grid form-grid-3">
                    <div className="form-group"><label className="form-label">Banco</label><select className="form-control" value={empForm.banco} onChange={e => setEmpForm(f => ({...f, banco: e.target.value}))}><option value="">Seleccionar...</option>{BANCOS.map(b => <option key={b} value={b}>{b}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">No. Cuenta</label><input className="form-control" value={empForm.cuenta} onChange={e => setEmpForm(f => ({...f, cuenta: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Estado</label><select className="form-control" value={empForm.activo} onChange={e => setEmpForm(f => ({...f, activo: e.target.value === 'true'}))}><option value="true">Activo</option><option value="false">Inactivo</option></select></div>
                </div>
            </Modal>

            {/* Modal Préstamo */}
            <Modal open={modals.prestamo} onClose={() => { closeModal('prestamo'); setEditingPrestamo(null); setPrestamoForm({empleadoId:'',monto:'',cuotas:'',desc:'',fecha:''}); }} title={editingPrestamo ? 'Editar Préstamo' : 'Nuevo Préstamo'} footer={<><button className="btn btn-secondary" onClick={() => closeModal('prestamo')}>Cancelar</button><button className="btn btn-purple" onClick={guardarPrestamo}><Icons.Check /> {editingPrestamo ? 'Actualizar' : 'Registrar'}</button></>}>
                <div className="form-grid form-grid-2">
                    <div className="form-group full"><label className="form-label">Empleado *</label><select className="form-control" value={prestamoForm.empleadoId} onChange={e => setPrestamoForm(f => ({...f, empleadoId: e.target.value}))}><option value="">Seleccionar...</option>{empleados.filter(e => e.activo).map(e => <option key={e.id} value={e.id}>{e.nombre}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">Monto Total *</label><input className="form-control" type="number" value={prestamoForm.monto} onChange={e => setPrestamoForm(f => ({...f, monto: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Cuotas *</label><input className="form-control" type="number" min="1" value={prestamoForm.cuotas} onChange={e => setPrestamoForm(f => ({...f, cuotas: e.target.value}))} /></div>
                    {prestamoForm.monto && prestamoForm.cuotas && <div className="form-group full"><div className="alert alert-success"><Icons.Info /><span>Cuota mensual: <strong>RD$ {formatMoney(+prestamoForm.monto / +prestamoForm.cuotas)}</strong></span></div></div>}
                    {editingPrestamo && editingPrestamo.cuotasPagadas > 0 && <div className="form-group full"><div className="alert alert-warning"><Icons.Info /><span>Ya se han pagado <strong>{editingPrestamo.cuotasPagadas} cuotas</strong>. El saldo se recalculará automáticamente.</span></div></div>}
                    <div className="form-group"><label className="form-label">Fecha Inicio</label><input className="form-control" type="date" value={prestamoForm.fecha} onChange={e => setPrestamoForm(f => ({...f, fecha: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Descripción</label><input className="form-control" value={prestamoForm.desc} onChange={e => setPrestamoForm(f => ({...f, desc: e.target.value}))} placeholder="Préstamo personal..." /></div>
                </div>
            </Modal>

            {/* Modal Licencia */}
            <Modal open={modals.licencia} onClose={() => closeModal('licencia')} title="Nueva Licencia" footer={<><button className="btn btn-secondary" onClick={() => closeModal('licencia')}>Cancelar</button><button className="btn btn-info" onClick={guardarLicencia}><Icons.Check /> Registrar</button></>}>
                <div className="form-grid form-grid-2">
                    <div className="form-group full"><label className="form-label">Empleado *</label><select className="form-control" value={licenciaForm.empleadoId} onChange={e => setLicenciaForm(f => ({...f, empleadoId: e.target.value}))}><option value="">Seleccionar...</option>{empleados.filter(e => e.activo).map(e => <option key={e.id} value={e.id}>{e.nombre}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">Tipo</label><select className="form-control" value={licenciaForm.tipo} onChange={e => setLicenciaForm(f => ({...f, tipo: e.target.value}))}>{TIPOS_LICENCIA.map(t => <option key={t} value={t}>{t}</option>)}</select></div>
                    <div className="form-group"><label className="form-label">Con Pago</label><select className="form-control" value={licenciaForm.conPago} onChange={e => setLicenciaForm(f => ({...f, conPago: e.target.value === 'true'}))}><option value="true">Sí</option><option value="false">No</option></select></div>
                    <div className="form-group"><label className="form-label">Fecha Inicio *</label><input className="form-control" type="date" value={licenciaForm.fechaInicio} onChange={e => setLicenciaForm(f => ({...f, fechaInicio: e.target.value}))} /></div>
                    <div className="form-group"><label className="form-label">Fecha Fin</label><input className="form-control" type="date" value={licenciaForm.fechaFin} onChange={e => setLicenciaForm(f => ({...f, fechaFin: e.target.value}))} /></div>
                    <div className="form-group full"><label className="form-label">Notas</label><input className="form-control" value={licenciaForm.notas} onChange={e => setLicenciaForm(f => ({...f, notas: e.target.value}))} /></div>
                </div>
            </Modal>

            {/* Modal Liquidación */}
            <Modal open={modals.liquidacion} onClose={() => closeModal('liquidacion')} title="Cálculo de Liquidación" size="md">
                {liquidacionData && (
                    <div>
                        <div className="alert alert-info"><Icons.UserMinus /><span><strong>{liquidacionData.emp.nombre}</strong> - Antigüedad: {calcularAntiguedad(liquidacionData.emp.fechaIngreso).años} años, {calcularAntiguedad(liquidacionData.emp.fechaIngreso).meses % 12} meses</span></div>
                        <div className="config-section">
                            <div className="config-title">Desglose de Liquidación (Despido)</div>
                            <div className="config-row"><span>Preaviso ({liquidacionData.preaviso.dias} días)</span><span className="money">RD$ {formatMoney(liquidacionData.preaviso.monto)}</span></div>
                            <div className="config-row"><span>Cesantía ({round2(liquidacionData.cesantia.dias)} días)</span><span className="money">RD$ {formatMoney(liquidacionData.cesantia.monto)}</span></div>
                            <div className="config-row"><span>Vacaciones no disfrutadas</span><span className="money">RD$ {formatMoney(liquidacionData.vacaciones)}</span></div>
                            <div className="config-row"><span>Salario pendiente</span><span className="money">RD$ {formatMoney(liquidacionData.salarioPendiente)}</span></div>
                            <div className="config-row"><span>Regalía proporcional</span><span className="money">RD$ {formatMoney(liquidacionData.regalia)}</span></div>
                            <div className="config-row" style={{fontWeight:700, borderTop:'2px solid var(--border)', paddingTop:'8px', marginTop:'8px'}}><span>TOTAL LIQUIDACIÓN</span><span className="money pos" style={{fontSize:'14px'}}>RD$ {formatMoney(liquidacionData.total)}</span></div>
                        </div>
                        <button className="btn btn-primary" style={{width:'100%', marginTop:'12px'}} onClick={() => { toast('Liquidación exportada', 'success'); closeModal('liquidacion'); }}><Icons.Download /> Exportar Liquidación</button>
                    </div>
                )}
            </Modal>

            {/* Modal Volantes */}
            <Modal open={modals.volantes} onClose={() => { closeModal('volantes'); setSelectedVolante(null); }} title="Volantes de Pago" size="xl" footer={<><button className="btn btn-secondary" onClick={() => closeModal('volantes')}>Cerrar</button><button className="btn btn-info" onClick={enviarTodosVolantes} disabled={!msUser} title={msUser ? 'Enviar volantes a todos los empleados con email' : 'Inicie sesión con Microsoft para enviar correos'}><Icons.Mail /> Enviar a Todos</button><button className="btn btn-primary" onClick={imprimirVolantes}><Icons.Printer /> Imprimir</button></>}>
                {/* Panel de envío por email */}
                <div className="no-print" style={{marginBottom:'16px', padding:'12px', background:'#f0f9ff', border:'1px solid #0ea5e9', borderRadius:'8px'}}>
                    <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:'10px'}}>
                        <div>
                            <strong style={{color:'#0369a1'}}>📧 Envío de Volantes por Email (Microsoft 365)</strong>
                            <p style={{fontSize:'11px', color:'#64748b', margin:'4px 0 0'}}>Los correos se envían desde su cuenta institucional de Microsoft</p>
                        </div>
                        <div style={{fontSize:'12px'}}>
                            <span style={{background:'#22c55e', color:'white', padding:'2px 8px', borderRadius:'12px', marginRight:'8px'}}>
                                ✓ {volantesData.filter(v => isVolanteEnviado(v.emp.id)).length} enviados
                            </span>
                            <span style={{background:'#f59e0b', color:'white', padding:'2px 8px', borderRadius:'12px'}}>
                                ⏳ {volantesData.filter(v => !isVolanteEnviado(v.emp.id)).length} pendientes
                            </span>
                        </div>
                    </div>
                    <div style={{maxHeight:'200px', overflowY:'auto', border:'1px solid #e2e8f0', borderRadius:'6px', background:'white'}}>
                        <table style={{width:'100%', fontSize:'11px', borderCollapse:'collapse'}}>
                            <thead style={{position:'sticky', top:0, background:'#f8fafc'}}>
                                <tr>
                                    <th style={{padding:'8px', textAlign:'left', borderBottom:'1px solid #e2e8f0'}}>Empleado</th>
                                    <th style={{padding:'8px', textAlign:'left', borderBottom:'1px solid #e2e8f0'}}>Email</th>
                                    <th style={{padding:'8px', textAlign:'right', borderBottom:'1px solid #e2e8f0'}}>Neto</th>
                                    <th style={{padding:'8px', textAlign:'center', borderBottom:'1px solid #e2e8f0'}}>Estado</th>
                                    <th style={{padding:'8px', textAlign:'center', borderBottom:'1px solid #e2e8f0'}}>Acción</th>
                                </tr>
                            </thead>
                            <tbody>
                                {volantesData.map((v, i) => (
                                    <tr key={i} style={{background: i % 2 === 0 ? '#fff' : '#f8fafc'}}>
                                        <td style={{padding:'6px 8px', fontWeight:'500'}}>{v.emp.nombre}</td>
                                        <td style={{padding:'6px 8px', color: v.emp.email ? '#334155' : '#94a3b8'}}>
                                            {v.emp.email || <em>Sin email</em>}
                                        </td>
                                        <td style={{padding:'6px 8px', textAlign:'right', fontFamily:'JetBrains Mono', fontSize:'10px'}}>
                                            RD$ {formatMoney(v.det.neto)}
                                        </td>
                                        <td style={{padding:'6px 8px', textAlign:'center'}}>
                                            {isVolanteEnviado(v.emp.id) ? (
                                                <span style={{color:'#22c55e', fontWeight:'600'}}>✓ Enviado</span>
                                            ) : (
                                                <span style={{color:'#f59e0b'}}>Pendiente</span>
                                            )}
                                        </td>
                                        <td style={{padding:'6px 8px', textAlign:'center'}}>
                                            {v.emp.email && !isVolanteEnviado(v.emp.id) && msUser && (
                                                <button 
                                                    className="btn btn-xs btn-info" 
                                                    onClick={() => enviarVolanteEmail(v.emp, v.det)}
                                                    disabled={enviandoVolante === v.emp.id}
                                                    style={{padding:'3px 8px', fontSize:'10px'}}
                                                >
                                                    {enviandoVolante === v.emp.id ? '⏳' : '📧'} Enviar
                                                </button>
                                            )}
                                            {isVolanteEnviado(v.emp.id) && msUser && (
                                                <button 
                                                    className="btn btn-xs btn-secondary" 
                                                    onClick={() => enviarVolanteEmail(v.emp, v.det)}
                                                    disabled={enviandoVolante === v.emp.id}
                                                    style={{padding:'3px 8px', fontSize:'10px'}}
                                                >
                                                    {enviandoVolante === v.emp.id ? '⏳' : '🔄'} Reenviar
                                                </button>
                                            )}
                                            {v.emp.email && !msUser && (
                                                <span style={{fontSize:'9px', color:'#94a3b8'}}>Requiere MS</span>
                                            )}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    <div style={{marginTop:'8px', fontSize:'10px', color:'#64748b'}}>
                        {msUser ? (
                            <span>✅ Conectado como <strong>{msUser.username}</strong> - Los correos se enviarán desde esta cuenta de Microsoft 365</span>
                        ) : (
                            <span style={{color:'#dc2626'}}>⚠️ <strong>Debe iniciar sesión con Microsoft</strong> (botón ☁️ en la barra lateral) para enviar correos desde el workspace institucional</span>
                        )}
                    </div>
                </div>
                
                {/* Área de impresión */}
                <div className="print-area">
                    {volantesData.map((v, i) => <Volante key={i} emp={v.emp} det={v.det} periodo={currentNomina?.periodo} config={config} nominaCodigo={currentNomina?.codigo} />)}
                </div>
            </Modal>

            {/* Modal Checklist Pagos por Banco */}
            <Modal 
                open={modals.pagosBanco} 
                onClose={() => closeModal('pagosBanco')} 
                title="📋 Checklist de Pagos por Banco" 
                size="xl" 
                footer={
                    <>
                        <button className="btn btn-secondary" onClick={() => closeModal('pagosBanco')}>Cerrar</button>
                        <button className="btn btn-primary" onClick={imprimirChecklist}><Icons.Printer /> Imprimir Checklist</button>
                    </>
                }
            >
                {fondosPorBanco && currentNomina && (
                    <div className="print-area print-pagos-banco">
                        {/* Nota para opciones de EPSON - solo visible en pantalla */}
                        <div className="no-print" style={{background:'#fef3c7', border:'1px solid #f59e0b', padding:'10px 15px', marginBottom:'15px', borderRadius:'6px', fontSize:'12px'}}>
                            <strong>💡 Para opciones avanzadas de EPSON:</strong> En el diálogo de impresión, haz clic en <strong>"Imprimir usando el diálogo de sistema..."</strong> o presiona <strong>Ctrl+Shift+P</strong>
                        </div>
                        
                        {/* Encabezado compacto horizontal */}
                        <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', borderBottom:'2px solid #000', paddingBottom:'8px', marginBottom:'10px'}}>
                            <div>
                                <h2 style={{margin:0, fontSize:'14px'}}>CENTRO EDUCATIVO TEHUI</h2>
                                <p style={{margin:0, fontSize:'9px', color:'#666'}}>Educando en valores con calidad</p>
                            </div>
                            <div style={{textAlign:'center'}}>
                                <h3 style={{margin:0, fontSize:'12px', border:'1px solid #333', padding:'5px 15px'}}>📋 CHECKLIST DE PAGOS POR BANCO</h3>
                            </div>
                            <div style={{textAlign:'right', fontSize:'10px'}}>
                                <div><strong>Período:</strong> {MESES[currentNomina.periodo.mes]} {currentNomina.periodo.año}{currentNomina.periodo.tipo === 'quincenal' ? ` - ${currentNomina.periodo.quincena === 1 ? '1ra' : '2da'} Quinc.` : ''}</div>
                                <div><strong>Código:</strong> {currentNomina.codigo} | <strong>Fecha:</strong> {new Date().toLocaleDateString('es-DO')}</div>
                            </div>
                        </div>

                        {/* Resumen rápido */}
                        <div style={{display:'grid', gridTemplateColumns:'repeat(4, 1fr)', gap:'10px', marginBottom:'20px', padding:'10px', background:'#f5f5f5', border:'1px solid #ccc', borderRadius:'4px'}}>
                            <div style={{textAlign:'center'}}>
                                <div style={{fontSize:'9px', color:'#666'}}>TOTAL EMPLEADOS</div>
                                <div style={{fontSize:'16px', fontWeight:'bold'}}>{Object.values(fondosPorBanco).reduce((sum, b) => sum + b.empleados.length, 0)}</div>
                            </div>
                            <div style={{textAlign:'center'}}>
                                <div style={{fontSize:'9px', color:'#666'}}>BANCOS/FORMAS PAGO</div>
                                <div style={{fontSize:'16px', fontWeight:'bold'}}>{Object.keys(fondosPorBanco).length}</div>
                            </div>
                            <div style={{textAlign:'center'}}>
                                <div style={{fontSize:'9px', color:'#666'}}>TOTAL BRUTO</div>
                                <div style={{fontSize:'14px', fontWeight:'bold', fontFamily:'JetBrains Mono'}}>RD$ {formatMoney(Object.values(fondosPorBanco).reduce((sum, b) => sum + b.totalBruto, 0))}</div>
                            </div>
                            <div style={{textAlign:'center', background:'#333', color:'white', padding:'5px', borderRadius:'4px'}}>
                                <div style={{fontSize:'9px', opacity:0.8}}>TOTAL NETO A PAGAR</div>
                                <div style={{fontSize:'14px', fontWeight:'bold', fontFamily:'JetBrains Mono'}}>RD$ {formatMoney(Object.values(fondosPorBanco).reduce((sum, b) => sum + b.totalNeto, 0))}</div>
                            </div>
                        </div>

                        {/* Detalle por banco */}
                        {Object.entries(fondosPorBanco).sort((a,b) => b[1].totalNeto - a[1].totalNeto).map(([banco, data], bancoIdx) => (
                            <div key={banco} style={{marginBottom:'20px', pageBreakInside:'avoid'}}>
                                {/* Header del banco */}
                                <div style={{
                                    background: banco === 'Sin cuenta' ? '#6c757d' : 
                                                banco === 'Banreservas' ? '#00723f' :
                                                banco === 'BHD León' ? '#003366' :
                                                banco === 'Banco Popular' ? '#ff6600' :
                                                banco === 'ACAP' ? '#8b0000' : '#2c3e50',
                                    color: 'white',
                                    padding: '10px 15px',
                                    display: 'flex',
                                    justifyContent: 'space-between',
                                    alignItems: 'center'
                                }}>
                                    <div>
                                        <span style={{fontSize:'14px', fontWeight:'bold'}}>
                                            {banco === 'Sin cuenta' ? '💵 EFECTIVO / CHEQUE' : `🏦 ${banco.toUpperCase()}`}
                                        </span>
                                        <span style={{marginLeft:'15px', fontSize:'11px', opacity:0.9}}>
                                            ({data.empleados.length} empleado{data.empleados.length !== 1 ? 's' : ''})
                                        </span>
                                    </div>
                                    <div style={{textAlign:'right'}}>
                                        <div style={{fontSize:'10px', opacity:0.8}}>Total a depositar:</div>
                                        <div style={{fontSize:'16px', fontWeight:'bold', fontFamily:'JetBrains Mono'}}>RD$ {formatMoney(data.totalNeto)}</div>
                                    </div>
                                </div>

                                {/* Tabla de empleados */}
                                <table style={{width:'100%', borderCollapse:'collapse', fontSize:'9px'}}>
                                    <thead>
                                        <tr style={{background:'#e8e8e8'}}>
                                            <th style={{border:'1px solid #999', padding:'6px', width:'25px', textAlign:'center'}}>✓</th>
                                            <th style={{border:'1px solid #999', padding:'6px', textAlign:'left'}}>Empleado</th>
                                            <th style={{border:'1px solid #999', padding:'6px', textAlign:'left'}}>Cédula</th>
                                            <th style={{border:'1px solid #999', padding:'6px', textAlign:'left'}}>Depto.</th>
                                            <th style={{border:'1px solid #999', padding:'6px', textAlign:'left'}}>No. Cuenta</th>
                                            <th style={{border:'1px solid #999', padding:'6px', textAlign:'right'}}>Salario</th>
                                            <th style={{border:'1px solid #999', padding:'6px', textAlign:'right'}}>Deducciones</th>
                                            <th style={{border:'1px solid #999', padding:'6px', textAlign:'right', background:'#d0d0d0', fontWeight:'bold'}}>NETO</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {data.empleados.sort((a,b) => a.nombre.localeCompare(b.nombre)).map((emp, idx) => (
                                            <tr key={idx} style={{background: idx % 2 === 0 ? '#fff' : '#f9f9f9'}}>
                                                <td style={{border:'1px solid #ccc', padding:'5px', textAlign:'center'}}>
                                                    <div style={{width:'14px', height:'14px', border:'2px solid #333', borderRadius:'2px', margin:'0 auto'}}></div>
                                                </td>
                                                <td style={{border:'1px solid #ccc', padding:'5px', fontWeight:'600'}}>{emp.nombre}</td>
                                                <td style={{border:'1px solid #ccc', padding:'5px', fontFamily:'JetBrains Mono', fontSize:'8px'}}>{emp.cedula}</td>
                                                <td style={{border:'1px solid #ccc', padding:'5px', fontSize:'8px'}}>{emp.departamento}</td>
                                                <td style={{border:'1px solid #ccc', padding:'5px', fontFamily:'JetBrains Mono', fontSize:'8px'}}>{emp.cuenta || '-'}</td>
                                                <td style={{border:'1px solid #ccc', padding:'5px', textAlign:'right', fontFamily:'JetBrains Mono'}}>{formatMoney(emp.bruto)}</td>
                                                <td style={{border:'1px solid #ccc', padding:'5px', textAlign:'right', fontFamily:'JetBrains Mono', color:'#c00'}}>{formatMoney(emp.totalDed)}</td>
                                                <td style={{border:'1px solid #ccc', padding:'5px', textAlign:'right', fontFamily:'JetBrains Mono', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(emp.neto)}</td>
                                            </tr>
                                        ))}
                                        {/* Subtotal del banco */}
                                        <tr style={{background:'#d0d0d0', fontWeight:'bold'}}>
                                            <td colSpan="5" style={{border:'1px solid #999', padding:'6px', textAlign:'right'}}>
                                                SUBTOTAL {banco.toUpperCase()}:
                                            </td>
                                            <td style={{border:'1px solid #999', padding:'6px', textAlign:'right', fontFamily:'JetBrains Mono'}}>{formatMoney(data.totalBruto)}</td>
                                            <td style={{border:'1px solid #999', padding:'6px', textAlign:'right', fontFamily:'JetBrains Mono', color:'#c00'}}>{formatMoney(data.empleados.reduce((s,e) => s + e.totalDed, 0))}</td>
                                            <td style={{border:'1px solid #999', padding:'6px', textAlign:'right', fontFamily:'JetBrains Mono', fontSize:'11px', background:'#333', color:'white'}}>{formatMoney(data.totalNeto)}</td>
                                        </tr>
                                    </tbody>
                                </table>

                                {/* Checkbox de confirmación del banco */}
                                <div style={{marginTop:'8px', padding:'8px 12px', background:'#f0f0f0', border:'1px solid #ccc', display:'flex', alignItems:'center', gap:'10px'}}>
                                    <div style={{width:'18px', height:'18px', border:'2px solid #333', borderRadius:'2px'}}></div>
                                    <span style={{fontSize:'10px'}}>
                                        <strong>Depósito {banco === 'Sin cuenta' ? 'en efectivo/cheque' : `a ${banco}`} realizado</strong> 
                                        &nbsp;— Monto: <strong>RD$ {formatMoney(data.totalNeto)}</strong>
                                        &nbsp;— Fecha: _____________ 
                                        &nbsp;— Ref/Comprobante: _______________________
                                    </span>
                                </div>
                            </div>
                        ))}

                        {/* Resumen final y firmas */}
                        <div style={{marginTop:'20px', pageBreakInside:'avoid'}}>
                            <div style={{background:'#1a1a2e', color:'white', padding:'15px', marginBottom:'15px'}}>
                                <div style={{display:'flex', justifyContent:'space-between', alignItems:'center'}}>
                                    <div>
                                        <div style={{fontSize:'10px', opacity:0.8}}>GRAN TOTAL A PAGAR (TODOS LOS BANCOS)</div>
                                        <div style={{fontSize:'24px', fontWeight:'bold', fontFamily:'JetBrains Mono', color:'#4ade80'}}>
                                            RD$ {formatMoney(Object.values(fondosPorBanco).reduce((sum, b) => sum + b.totalNeto, 0))}
                                        </div>
                                    </div>
                                    <div style={{textAlign:'right'}}>
                                        <div style={{fontSize:'10px', opacity:0.8}}>Total Empleados: {Object.values(fondosPorBanco).reduce((sum, b) => sum + b.empleados.length, 0)}</div>
                                        <div style={{fontSize:'10px', opacity:0.8}}>Bancos/Formas: {Object.keys(fondosPorBanco).length}</div>
                                    </div>
                                </div>
                            </div>

                            {/* Firmas */}
                            <div style={{display:'grid', gridTemplateColumns:'1fr 1fr 1fr', gap:'30px', marginTop:'30px'}}>
                                <div style={{textAlign:'center'}}>
                                    <div style={{borderTop:'1px solid #333', marginTop:'40px', paddingTop:'8px', fontSize:'10px'}}>
                                        Elaborado por
                                    </div>
                                </div>
                                <div style={{textAlign:'center'}}>
                                    <div style={{borderTop:'1px solid #333', marginTop:'40px', paddingTop:'8px', fontSize:'10px'}}>
                                        Verificado por
                                    </div>
                                </div>
                                <div style={{textAlign:'center'}}>
                                    <div style={{borderTop:'1px solid #333', marginTop:'40px', paddingTop:'8px', fontSize:'10px'}}>
                                        Autorizado por
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                )}
            </Modal>

            {/* Modal Constancia */}
            <Modal open={modals.constancia} onClose={() => closeModal('constancia')} title="Constancia de Trabajo" size="md">
                {selectedEmp && (
                    <div style={{fontFamily:'serif', lineHeight:1.8}}>
                        <div style={{textAlign:'center', marginBottom:'20px'}}>
                            <h2 style={{fontSize:'16px'}}>{config.empresa.nombre}</h2>
                            <p style={{fontSize:'11px', color:'var(--text-secondary)'}}>{config.empresa.direccion}<br/>RNC: {config.empresa.rnc}</p>
                        </div>
                        <h3 style={{textAlign:'center', margin:'20px 0', textDecoration:'underline'}}>CONSTANCIA DE TRABAJO</h3>
                        <p style={{textAlign:'justify', fontSize:'12px'}}>
                            Por medio de la presente hacemos constar que el/la Sr(a). <strong>{selectedEmp.nombre}</strong>, 
                            portador(a) de la cédula de identidad No. <strong>{selectedEmp.cedula}</strong>, 
                            labora en nuestra institución desde el <strong>{formatDate(selectedEmp.fechaIngreso)}</strong>, 
                            desempeñando el cargo de <strong>{selectedEmp.cargo || selectedEmp.departamento}</strong>, 
                            devengando un salario mensual de <strong>RD$ {formatMoney(selectedEmp.salarioBase)}</strong>.
                        </p>
                        <p style={{fontSize:'12px', marginTop:'16px'}}>
                            Se expide la presente constancia a solicitud de la parte interesada, para los fines que considere pertinentes.
                        </p>
                        <p style={{fontSize:'12px', marginTop:'20px'}}>
                            Dado en Santiago de los Caballeros, República Dominicana, a los {new Date().getDate()} días del mes de {MESES[new Date().getMonth() + 1]} del {new Date().getFullYear()}.
                        </p>
                        <div style={{marginTop:'50px', textAlign:'center'}}>
                            <div style={{borderTop:'1px solid #333', width:'200px', margin:'0 auto', paddingTop:'8px', fontSize:'11px'}}>Firma y Sello</div>
                        </div>
                        <button className="btn btn-primary no-print" style={{width:'100%', marginTop:'20px'}} onClick={() => window.print()}><Icons.Printer /> Imprimir</button>
                    </div>
                )}
            </Modal>

            {/* Modal Centro de Reportes */}
            <Modal 
                open={modals.reportes} 
                onClose={() => { closeModal('reportes'); setTipoReporteActivo(null); setCategoriaReporteActiva(null); }} 
                title="📊 Centro de Reportes" 
                size="xl"
                footer={
                    tipoReporteActivo ? (
                        <>
                            <button className="btn btn-secondary" onClick={() => setTipoReporteActivo(null)}>← Volver</button>
                            <button className="btn btn-primary" onClick={imprimirReporte}><Icons.Printer /> Imprimir Reporte</button>
                        </>
                    ) : (
                        <button className="btn btn-secondary" onClick={() => closeModal('reportes')}>Cerrar</button>
                    )
                }
            >
                {!tipoReporteActivo ? (
                    /* Selector de tipo de reporte por categorías */
                    <div className="reporte-selector">
                        <div className="alert alert-info no-print" style={{marginBottom:'16px'}}>
                            <Icons.Info />
                            <span>Seleccione una categoría y luego el reporte que desea generar. Los reportes marcados con 🔒 requieren una nómina seleccionada.</span>
                        </div>
                        
                        {/* Selector de nómina si no hay una activa */}
                        {!currentNomina && nominas.filter(n => n.estado === 'procesada' || n.estado === 'guardada').length > 0 && (
                            <div style={{marginBottom:'16px', padding:'12px', background:'var(--bg-main)', borderRadius:'8px', border:'1px solid var(--border)'}}>
                                <label style={{fontSize:'11px', fontWeight:'600', marginBottom:'6px', display:'block'}}>Seleccionar Nómina para reportes:</label>
                                <select 
                                    className="form-control" 
                                    style={{maxWidth:'400px'}}
                                    onChange={e => {
                                        const nom = nominas.find(n => n.id === e.target.value);
                                        if (nom) setCurrentNomina(nom);
                                    }}
                                >
                                    <option value="">-- Seleccione una nómina --</option>
                                    {nominas.filter(n => n.estado === 'procesada' || n.estado === 'guardada').slice(0, 12).map(n => (
                                        <option key={n.id} value={n.id}>
                                            {MESES[n.periodo.mes]} {n.periodo.año} {n.periodo.tipo === 'quincenal' ? `Q${n.periodo.quincena}` : ''} - {n.codigo}
                                        </option>
                                    ))}
                                </select>
                            </div>
                        )}
                        
                        {/* Categorías de reportes */}
                        <div style={{display:'grid', gridTemplateColumns:'200px 1fr', gap:'16px', minHeight:'400px'}}>
                            {/* Lista de categorías */}
                            <div style={{borderRight:'1px solid var(--border)', paddingRight:'16px'}}>
                                <div style={{fontSize:'11px', fontWeight:'600', color:'var(--text-muted)', marginBottom:'8px'}}>CATEGORÍAS</div>
                                {CATEGORIAS_REPORTES.map(cat => (
                                    <div 
                                        key={cat.id}
                                        onClick={() => setCategoriaReporteActiva(cat.id)}
                                        style={{
                                            padding:'10px 12px',
                                            marginBottom:'4px',
                                            borderRadius:'6px',
                                            cursor:'pointer',
                                            background: categoriaReporteActiva === cat.id ? 'var(--primary)' : 'transparent',
                                            color: categoriaReporteActiva === cat.id ? 'white' : 'var(--text-primary)',
                                            fontWeight: categoriaReporteActiva === cat.id ? '600' : '400',
                                            fontSize:'12px',
                                            transition:'all 0.2s'
                                        }}
                                    >
                                        {cat.nombre}
                                    </div>
                                ))}
                            </div>
                            
                            {/* Lista de reportes de la categoría seleccionada */}
                            <div>
                                {!categoriaReporteActiva ? (
                                    <div style={{textAlign:'center', padding:'40px', color:'var(--text-muted)'}}>
                                        <Icons.FileText style={{width:'48px', height:'48px', opacity:0.3, marginBottom:'12px'}} />
                                        <p>Seleccione una categoría para ver los reportes disponibles</p>
                                    </div>
                                ) : (
                                    <>
                                        <div style={{fontSize:'14px', fontWeight:'600', marginBottom:'12px'}}>
                                            {CATEGORIAS_REPORTES.find(c => c.id === categoriaReporteActiva)?.nombre}
                                        </div>
                                        <div style={{display:'grid', gridTemplateColumns:'repeat(auto-fill, minmax(220px, 1fr))', gap:'10px'}}>
                                            {CATEGORIAS_REPORTES.find(c => c.id === categoriaReporteActiva)?.reportes.map(rep => {
                                                const disponible = !rep.requiereNomina || currentNomina;
                                                return (
                                                    <div 
                                                        key={rep.id}
                                                        onClick={() => disponible && setTipoReporteActivo(rep.id)}
                                                        style={{
                                                            padding:'14px',
                                                            border:'1px solid var(--border)',
                                                            borderRadius:'8px',
                                                            cursor: disponible ? 'pointer' : 'not-allowed',
                                                            opacity: disponible ? 1 : 0.5,
                                                            background:'var(--bg-card)',
                                                            transition:'all 0.2s'
                                                        }}
                                                        onMouseOver={e => { if(disponible) { e.currentTarget.style.borderColor='var(--primary)'; e.currentTarget.style.boxShadow='0 2px 8px rgba(21,101,192,0.15)'; }}}
                                                        onMouseOut={e => { e.currentTarget.style.borderColor='var(--border)'; e.currentTarget.style.boxShadow='none'; }}
                                                    >
                                                        <div style={{display:'flex', alignItems:'center', gap:'8px', marginBottom:'6px'}}>
                                                            <span style={{fontSize:'20px'}}>{rep.icon}</span>
                                                            <span style={{fontWeight:'600', fontSize:'12px'}}>{rep.nombre}</span>
                                                            {rep.requiereNomina && !currentNomina && <span title="Requiere nómina">🔒</span>}
                                                        </div>
                                                        <div style={{fontSize:'10px', color:'var(--text-muted)'}}>{rep.desc}</div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                ) : (
                    /* Contenido del reporte */
                    <div className="reporte-print-area" style={{background:'white', padding:'15px'}}>
                        {/* Encabezado común para todos los reportes */}
                        <div style={{textAlign:'center', marginBottom:'15px', borderBottom:'2px solid #000', paddingBottom:'8px'}}>
                            <h2 style={{margin:0, fontSize:'14px'}}>{config.empresa.nombre}</h2>
                            <p style={{margin:'3px 0', fontSize:'10px'}}>{config.empresa.direccion}</p>
                            <p style={{margin:'3px 0', fontSize:'10px'}}>RNC: {config.empresa.rnc}</p>
                            <h3 style={{margin:'8px 0 5px', fontSize:'12px', background:'#e0e0e0', padding:'4px'}}>
                                {CATEGORIAS_REPORTES.flatMap(c => c.reportes).find(r => r.id === tipoReporteActivo)?.nombre?.toUpperCase() || tipoReporteActivo?.toUpperCase()}
                            </h3>
                            {currentNomina && (
                                <div style={{display:'flex', justifyContent:'space-between', fontSize:'9px', marginTop:'5px'}}>
                                    <span>Período: {MESES[currentNomina.periodo.mes]} {currentNomina.periodo.año} {currentNomina.periodo.tipo === 'quincenal' ? `- Quincena ${currentNomina.periodo.quincena}` : ''}</span>
                                    <span>Código: {currentNomina.codigo} | Fecha: {new Date().toLocaleDateString('es-DO')}</span>
                                </div>
                            )}
                        </div>
                        
                        {/* REPORTE: Nómina por Departamento */}
                        {tipoReporteActivo === 'nomina-depto' && currentNomina && (() => {
                            const detalles = getDetallesRecalc();
                            const porDepto = detalles.reduce((acc, d) => { 
                                const depto = d.depto || 'SIN DEPARTAMENTO';
                                if (!acc[depto]) acc[depto] = []; 
                                acc[depto].push(d); 
                                return acc; 
                            }, {});
                            const deptosOrdenados = Object.keys(porDepto).sort();
                            
                            return (
                                <>
                                    <table style={{width:'100%', borderCollapse:'collapse', fontSize:'8px'}}>
                                        <thead>
                                            <tr style={{background:'#d0d0d0'}}>
                                                <th style={{border:'1px solid #000', padding:'3px', textAlign:'left'}}>Empleado</th>
                                                <th style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>Salario</th>
                                                <th style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>Otros</th>
                                                <th style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>Total Ing.</th>
                                                <th style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>AFP</th>
                                                <th style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>SFS</th>
                                                <th style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>ISR</th>
                                                <th style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>Otras Ded.</th>
                                                <th style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>Total Ded.</th>
                                                <th style={{border:'1px solid #000', padding:'3px', textAlign:'right', background:'#b0b0b0'}}>NETO</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {deptosOrdenados.map(depto => {
                                                const empsDepto = porDepto[depto];
                                                const totDepto = empsDepto.reduce((a, d) => ({
                                                    salario: a.salario + d.salarioBase,
                                                    otros: a.otros + d.horasExtra + d.bonificacion + (d.comisiones || 0) + (d.incentivos || 0),
                                                    totalIng: a.totalIng + d.totalIng,
                                                    afp: a.afp + d.afpEmp,
                                                    sfs: a.sfs + d.sfsEmp,
                                                    isr: a.isr + d.isr,
                                                    otrasDed: a.otrasDed + d.cuotaPrestamo + d.descAusencias + d.descTardanzas + d.otrasDed,
                                                    totalDed: a.totalDed + d.totalDed,
                                                    neto: a.neto + d.neto
                                                }), {salario:0, otros:0, totalIng:0, afp:0, sfs:0, isr:0, otrasDed:0, totalDed:0, neto:0});
                                                
                                                return (
                                                    <React.Fragment key={depto}>
                                                        <tr style={{background:'#f0f0f0'}}>
                                                            <td colSpan="10" style={{border:'1px solid #000', padding:'4px', fontWeight:'bold', fontSize:'9px'}}>{depto}</td>
                                                        </tr>
                                                        {empsDepto.map((d, idx) => (
                                                            <tr key={d.empId} style={{background: idx % 2 === 0 ? '#fff' : '#f8f8f8'}}>
                                                                <td style={{border:'1px solid #999', padding:'2px 3px'}}>{d.nombre}</td>
                                                                <td style={{border:'1px solid #999', padding:'2px', textAlign:'right'}}>{formatMoney(d.salarioBase)}</td>
                                                                <td style={{border:'1px solid #999', padding:'2px', textAlign:'right'}}>{(d.horasExtra + d.bonificacion + (d.comisiones||0) + (d.incentivos||0)) > 0 ? formatMoney(d.horasExtra + d.bonificacion + (d.comisiones||0) + (d.incentivos||0)) : '-'}</td>
                                                                <td style={{border:'1px solid #999', padding:'2px', textAlign:'right', fontWeight:'600'}}>{formatMoney(d.totalIng)}</td>
                                                                <td style={{border:'1px solid #999', padding:'2px', textAlign:'right'}}>{formatMoney(d.afpEmp)}</td>
                                                                <td style={{border:'1px solid #999', padding:'2px', textAlign:'right'}}>{formatMoney(d.sfsEmp)}</td>
                                                                <td style={{border:'1px solid #999', padding:'2px', textAlign:'right'}}>{d.isr > 0 ? formatMoney(d.isr) : '-'}</td>
                                                                <td style={{border:'1px solid #999', padding:'2px', textAlign:'right'}}>{(d.cuotaPrestamo + d.descAusencias + d.descTardanzas + d.otrasDed) > 0 ? formatMoney(d.cuotaPrestamo + d.descAusencias + d.descTardanzas + d.otrasDed) : '-'}</td>
                                                                <td style={{border:'1px solid #999', padding:'2px', textAlign:'right'}}>{formatMoney(d.totalDed)}</td>
                                                                <td style={{border:'1px solid #999', padding:'2px', textAlign:'right', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(d.neto)}</td>
                                                            </tr>
                                                        ))}
                                                        <tr style={{background:'#e0e0e0', fontWeight:'bold'}}>
                                                            <td style={{border:'1px solid #000', padding:'3px', fontSize:'8px'}}>SUBTOTAL {depto}</td>
                                                            <td style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>{formatMoney(totDepto.salario)}</td>
                                                            <td style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>{totDepto.otros > 0 ? formatMoney(totDepto.otros) : '-'}</td>
                                                            <td style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>{formatMoney(totDepto.totalIng)}</td>
                                                            <td style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>{formatMoney(totDepto.afp)}</td>
                                                            <td style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>{formatMoney(totDepto.sfs)}</td>
                                                            <td style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>{totDepto.isr > 0 ? formatMoney(totDepto.isr) : '-'}</td>
                                                            <td style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>{totDepto.otrasDed > 0 ? formatMoney(totDepto.otrasDed) : '-'}</td>
                                                            <td style={{border:'1px solid #000', padding:'3px', textAlign:'right'}}>{formatMoney(totDepto.totalDed)}</td>
                                                            <td style={{border:'1px solid #000', padding:'3px', textAlign:'right', background:'#c8c8c8'}}>{formatMoney(totDepto.neto)}</td>
                                                        </tr>
                                                    </React.Fragment>
                                                );
                                            })}
                                            <tr style={{background:'#b0b0b0', fontWeight:'bold'}}>
                                                <td style={{border:'2px solid #000', padding:'4px', fontSize:'9px'}}>TOTAL GENERAL ({detalles.length} empleados)</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.salarioBase, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.horasExtra + d.bonificacion + (d.comisiones||0) + (d.incentivos||0), 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.totalIng, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.afpEmp, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.sfsEmp, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.isr, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.cuotaPrestamo + d.descAusencias + d.descTardanzas + d.otrasDed, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.totalDed, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right', background:'#909090', fontSize:'10px'}}>{formatMoney(detalles.reduce((s,d) => s + d.neto, 0))}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div className="reporte-firmas" style={{marginTop:'20px', display:'grid', gridTemplateColumns:'1fr 1fr 1fr', gap:'25px', fontSize:'9px'}}>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'25px'}}>Elaborado por</div></div>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'25px'}}>Revisado por</div></div>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'25px'}}>Aprobado por</div></div>
                                    </div>
                                </>
                            );
                        })()}
                        
                        {/* REPORTE: Resumen de Nómina */}
                        {tipoReporteActivo === 'nomina-resumen' && currentNomina && (() => {
                            const detalles = getDetallesRecalc();
                            const porDepto = detalles.reduce((acc, d) => { 
                                const depto = d.depto || 'SIN DEPARTAMENTO';
                                if (!acc[depto]) acc[depto] = []; 
                                acc[depto].push(d); 
                                return acc; 
                            }, {});
                            const totales = detalles.reduce((a, d) => ({
                                salario: a.salario + d.salarioBase, otros: a.otros + d.horasExtra + d.bonificacion + (d.comisiones||0) + (d.incentivos||0),
                                totalIng: a.totalIng + d.totalIng, afpEmp: a.afpEmp + d.afpEmp, sfsEmp: a.sfsEmp + d.sfsEmp, isr: a.isr + d.isr,
                                totalDed: a.totalDed + d.totalDed, neto: a.neto + d.neto, afpPat: a.afpPat + d.afpPat, sfsPat: a.sfsPat + d.sfsPat,
                                infotep: a.infotep + d.infotep, riesgo: a.riesgo + d.riesgo
                            }), {salario:0, otros:0, totalIng:0, afpEmp:0, sfsEmp:0, isr:0, totalDed:0, neto:0, afpPat:0, sfsPat:0, infotep:0, riesgo:0});
                            
                            return (
                                <div className="reporte-seccion">
                                    <h4 style={{fontSize:'11px', marginBottom:'10px', borderBottom:'1px solid #999', paddingBottom:'5px'}}>Resumen por Departamento</h4>
                                    <table style={{width:'100%', borderCollapse:'collapse', fontSize:'9px', marginBottom:'15px'}}>
                                        <thead>
                                            <tr style={{background:'#d0d0d0'}}>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'left'}}>Departamento</th>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'center'}}>Empleados</th>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'right'}}>Salarios</th>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'right'}}>Otros Ing.</th>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'right'}}>Total Ingresos</th>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'right'}}>Total Deduc.</th>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'right', background:'#b0b0b0'}}>Neto a Pagar</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {Object.entries(porDepto).sort((a,b) => a[0].localeCompare(b[0])).map(([depto, emps]) => {
                                                const tot = emps.reduce((a,d) => ({
                                                    sal: a.sal + d.salarioBase, otros: a.otros + d.horasExtra + d.bonificacion + (d.comisiones||0) + (d.incentivos||0),
                                                    totalIng: a.totalIng + d.totalIng, totalDed: a.totalDed + d.totalDed, neto: a.neto + d.neto
                                                }), {sal:0, otros:0, totalIng:0, totalDed:0, neto:0});
                                                return (
                                                    <tr key={depto}>
                                                        <td style={{border:'1px solid #999', padding:'4px', fontWeight:'600'}}>{depto}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'center'}}>{emps.length}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'right'}}>{formatMoney(tot.sal)}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'right'}}>{tot.otros > 0 ? formatMoney(tot.otros) : '-'}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'right'}}>{formatMoney(tot.totalIng)}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'right'}}>{formatMoney(tot.totalDed)}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'right', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(tot.neto)}</td>
                                                    </tr>
                                                );
                                            })}
                                            <tr style={{background:'#b0b0b0', fontWeight:'bold'}}>
                                                <td style={{border:'2px solid #000', padding:'5px'}}>TOTALES</td>
                                                <td style={{border:'2px solid #000', padding:'5px', textAlign:'center'}}>{detalles.length}</td>
                                                <td style={{border:'2px solid #000', padding:'5px', textAlign:'right'}}>{formatMoney(totales.salario)}</td>
                                                <td style={{border:'2px solid #000', padding:'5px', textAlign:'right'}}>{formatMoney(totales.otros)}</td>
                                                <td style={{border:'2px solid #000', padding:'5px', textAlign:'right'}}>{formatMoney(totales.totalIng)}</td>
                                                <td style={{border:'2px solid #000', padding:'5px', textAlign:'right'}}>{formatMoney(totales.totalDed)}</td>
                                                <td style={{border:'2px solid #000', padding:'5px', textAlign:'right', fontSize:'11px', background:'#909090'}}>{formatMoney(totales.neto)}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    
                                    <div style={{display:'grid', gridTemplateColumns:'1fr 1fr', gap:'15px'}}>
                                        <div style={{border:'1px solid #999', padding:'10px'}}>
                                            <h4 style={{fontSize:'10px', marginBottom:'8px', borderBottom:'1px solid #ccc', paddingBottom:'4px'}}>Aportes a la Seguridad Social</h4>
                                            <table style={{width:'100%', fontSize:'9px'}}>
                                                <tbody>
                                                    <tr><td>AFP Empleado ({config.tss.afpEmpleado}%)</td><td style={{textAlign:'right'}}>{formatMoney(totales.afpEmp)}</td></tr>
                                                    <tr><td>AFP Patronal ({config.tss.afpPatronal}%)</td><td style={{textAlign:'right'}}>{formatMoney(totales.afpPat)}</td></tr>
                                                    <tr style={{fontWeight:'bold', borderTop:'1px solid #999'}}><td>Total AFP</td><td style={{textAlign:'right'}}>{formatMoney(totales.afpEmp + totales.afpPat)}</td></tr>
                                                    <tr><td colSpan="2" style={{height:'8px'}}></td></tr>
                                                    <tr><td>SFS Empleado ({config.tss.sfsEmpleado}%)</td><td style={{textAlign:'right'}}>{formatMoney(totales.sfsEmp)}</td></tr>
                                                    <tr><td>SFS Patronal ({config.tss.sfsPatronal}%)</td><td style={{textAlign:'right'}}>{formatMoney(totales.sfsPat)}</td></tr>
                                                    <tr style={{fontWeight:'bold', borderTop:'1px solid #999'}}><td>Total SFS</td><td style={{textAlign:'right'}}>{formatMoney(totales.sfsEmp + totales.sfsPat)}</td></tr>
                                                    <tr><td colSpan="2" style={{height:'8px'}}></td></tr>
                                                    <tr><td>INFOTEP ({config.tss.infotep}%)</td><td style={{textAlign:'right'}}>{formatMoney(totales.infotep)}</td></tr>
                                                    <tr><td>Riesgo Laboral ({config.tss.riesgoLaboral}%)</td><td style={{textAlign:'right'}}>{formatMoney(totales.riesgo)}</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div style={{border:'1px solid #999', padding:'10px'}}>
                                            <h4 style={{fontSize:'10px', marginBottom:'8px', borderBottom:'1px solid #ccc', paddingBottom:'4px'}}>Resumen General</h4>
                                            <div style={{fontSize:'10px'}}>
                                                <div style={{display:'flex', justifyContent:'space-between', marginBottom:'5px'}}><span>Total Empleados:</span><strong>{detalles.length}</strong></div>
                                                <div style={{display:'flex', justifyContent:'space-between', marginBottom:'5px'}}><span>Total Ingresos:</span><strong>{formatMoney(totales.totalIng)}</strong></div>
                                                <div style={{display:'flex', justifyContent:'space-between', marginBottom:'5px'}}><span>Total Deducciones:</span><strong>{formatMoney(totales.totalDed)}</strong></div>
                                                <div style={{display:'flex', justifyContent:'space-between', marginBottom:'5px'}}><span>ISR Retenido:</span><strong>{formatMoney(totales.isr)}</strong></div>
                                                <div style={{display:'flex', justifyContent:'space-between', padding:'8px', background:'#d0d0d0', marginTop:'10px', border:'2px solid #000'}}>
                                                    <span style={{fontWeight:'bold'}}>NETO A PAGAR:</span>
                                                    <span style={{fontWeight:'bold', fontSize:'12px'}}>{formatMoney(totales.neto)}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="reporte-firmas" style={{marginTop:'25px', display:'grid', gridTemplateColumns:'1fr 1fr 1fr', gap:'25px', fontSize:'9px'}}>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'30px'}}>Elaborado por</div></div>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'30px'}}>Revisado por</div></div>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'30px'}}>Aprobado por</div></div>
                                    </div>
                                </div>
                            );
                        })()}
                        
                        {/* REPORTE: TSS */}
                        {tipoReporteActivo === 'tss' && currentNomina && (() => {
                            const detalles = getDetallesRecalc();
                            return (
                                <div className="reporte-seccion">
                                    <table style={{width:'100%', borderCollapse:'collapse', fontSize:'8px'}}>
                                        <thead>
                                            <tr style={{background:'#d0d0d0'}}>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Empleado</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Cédula/NSS</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Salario Cotiz.</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>AFP Emp.</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>AFP Pat.</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>SFS Emp.</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>SFS Pat.</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>INFOTEP</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Riesgo Lab.</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right', background:'#b0b0b0'}}>Total TSS</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {detalles.map((d, idx) => {
                                                const emp = empleados.find(e => e.id === d.empId);
                                                return (
                                                    <tr key={d.empId} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5'}}>
                                                        <td style={{border:'1px solid #999', padding:'3px'}}>{d.nombre}</td>
                                                        <td style={{border:'1px solid #999', padding:'3px', fontSize:'7px'}}>{emp?.documento}<br/>{emp?.nss || '-'}</td>
                                                        <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(d.salarioBase)}</td>
                                                        <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(d.afpEmp)}</td>
                                                        <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(d.afpPat)}</td>
                                                        <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(d.sfsEmp)}</td>
                                                        <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(d.sfsPat)}</td>
                                                        <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(d.infotep)}</td>
                                                        <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(d.riesgo)}</td>
                                                        <td style={{border:'1px solid #999', padding:'3px', textAlign:'right', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(d.afpEmp + d.afpPat + d.sfsEmp + d.sfsPat + d.infotep + d.riesgo)}</td>
                                                    </tr>
                                                );
                                            })}
                                            <tr style={{background:'#b0b0b0', fontWeight:'bold'}}>
                                                <td colSpan="2" style={{border:'2px solid #000', padding:'4px'}}>TOTALES ({detalles.length})</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.salarioBase, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.afpEmp, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.afpPat, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.sfsEmp, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.sfsPat, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.infotep, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.riesgo, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right', background:'#909090', fontSize:'10px'}}>{formatMoney(detalles.reduce((s,d) => s + d.afpEmp + d.afpPat + d.sfsEmp + d.sfsPat + d.infotep + d.riesgo, 0))}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div className="reporte-firmas" style={{marginTop:'20px', display:'grid', gridTemplateColumns:'1fr 1fr 1fr', gap:'25px', fontSize:'9px'}}>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'25px'}}>Elaborado por</div></div>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'25px'}}>Revisado por</div></div>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'25px'}}>Aprobado por</div></div>
                                    </div>
                                </div>
                            );
                        })()}
                        
                        {/* REPORTE: Deducciones */}
                        {tipoReporteActivo === 'deducciones' && currentNomina && (() => {
                            const detalles = getDetallesRecalc();
                            return (
                                <div className="reporte-seccion">
                                    <table style={{width:'100%', borderCollapse:'collapse', fontSize:'8px'}}>
                                        <thead>
                                            <tr style={{background:'#d0d0d0'}}>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Empleado</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>AFP</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>SFS</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>ISR</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Préstamos</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Ausencias</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Tardanzas</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Otras Ded.</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right', background:'#b0b0b0'}}>Total Ded.</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {detalles.map((d, idx) => (
                                                <tr key={d.empId} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5'}}>
                                                    <td style={{border:'1px solid #999', padding:'3px'}}>{d.nombre}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(d.afpEmp)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(d.sfsEmp)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{d.isr > 0 ? formatMoney(d.isr) : '-'}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{d.cuotaPrestamo > 0 ? formatMoney(d.cuotaPrestamo) : '-'}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{d.descAusencias > 0 ? formatMoney(d.descAusencias) : '-'}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{d.descTardanzas > 0 ? formatMoney(d.descTardanzas) : '-'}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{d.otrasDed > 0 ? formatMoney(d.otrasDed) : '-'}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(d.totalDed)}</td>
                                                </tr>
                                            ))}
                                            <tr style={{background:'#b0b0b0', fontWeight:'bold'}}>
                                                <td style={{border:'2px solid #000', padding:'4px'}}>TOTALES</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.afpEmp, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.sfsEmp, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.isr, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.cuotaPrestamo, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.descAusencias, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.descTardanzas, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.otrasDed, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right', background:'#909090', fontSize:'10px'}}>{formatMoney(detalles.reduce((s,d) => s + d.totalDed, 0))}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div className="reporte-firmas" style={{marginTop:'20px', display:'grid', gridTemplateColumns:'1fr 1fr 1fr', gap:'25px', fontSize:'9px'}}>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'25px'}}>Elaborado por</div></div>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'25px'}}>Revisado por</div></div>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'25px'}}>Aprobado por</div></div>
                                    </div>
                                </div>
                            );
                        })()}
                        
                        {/* REPORTE: Ingresos */}
                        {tipoReporteActivo === 'ingresos' && currentNomina && (() => {
                            const detalles = getDetallesRecalc();
                            return (
                                <div className="reporte-seccion">
                                    <table style={{width:'100%', borderCollapse:'collapse', fontSize:'8px'}}>
                                        <thead>
                                            <tr style={{background:'#d0d0d0'}}>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Empleado</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Salario Base</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Horas Extra</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Bonificación</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Comisiones</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Incentivos</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Regalía</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right', background:'#b0b0b0'}}>Total Ing.</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {detalles.map((d, idx) => (
                                                <tr key={d.empId} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5'}}>
                                                    <td style={{border:'1px solid #999', padding:'3px'}}>{d.nombre}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(d.salarioBase)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{d.horasExtra > 0 ? formatMoney(d.horasExtra) : '-'}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{d.bonificacion > 0 ? formatMoney(d.bonificacion) : '-'}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{(d.comisiones||0) > 0 ? formatMoney(d.comisiones) : '-'}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{(d.incentivos||0) > 0 ? formatMoney(d.incentivos) : '-'}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{(d.regalia||0) > 0 ? formatMoney(d.regalia) : '-'}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(d.totalIng)}</td>
                                                </tr>
                                            ))}
                                            <tr style={{background:'#b0b0b0', fontWeight:'bold'}}>
                                                <td style={{border:'2px solid #000', padding:'4px'}}>TOTALES</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.salarioBase, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.horasExtra, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + d.bonificacion, 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + (d.comisiones||0), 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + (d.incentivos||0), 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(detalles.reduce((s,d) => s + (d.regalia||0), 0))}</td>
                                                <td style={{border:'2px solid #000', padding:'4px', textAlign:'right', background:'#909090', fontSize:'10px'}}>{formatMoney(detalles.reduce((s,d) => s + d.totalIng, 0))}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div className="reporte-firmas" style={{marginTop:'20px', display:'grid', gridTemplateColumns:'1fr 1fr 1fr', gap:'25px', fontSize:'9px'}}>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'25px'}}>Elaborado por</div></div>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'25px'}}>Revisado por</div></div>
                                        <div style={{textAlign:'center'}}><div style={{borderTop:'1px solid #333', paddingTop:'4px', marginTop:'25px'}}>Aprobado por</div></div>
                                    </div>
                                </div>
                            );
                        })()}
                        
                        {/* REPORTES DE EMPLEADOS */}
                        {/* Empleados Activos */}
                        {(tipoReporteActivo === 'empleados' || tipoReporteActivo === 'empleados-activos') && (
                            <div className="reporte-seccion">
                                <table style={{width:'100%', borderCollapse:'collapse', fontSize:'8px'}}>
                                    <thead>
                                        <tr style={{background:'#d0d0d0'}}>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Nombre</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Cédula</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Celular</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Departamento</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Cargo</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'center'}}>F. Ingreso</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Salario</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Banco</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Cuenta</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {empleados.filter(e => e.activo && !e.fechaSalida).sort((a,b) => a.nombre.localeCompare(b.nombre)).map((e, idx) => (
                                            <tr key={e.id} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5'}}>
                                                <td style={{border:'1px solid #999', padding:'3px', fontWeight:'600'}}>{e.nombre}</td>
                                                <td style={{border:'1px solid #999', padding:'3px', fontSize:'7px'}}>{e.documento}</td>
                                                <td style={{border:'1px solid #999', padding:'3px', fontSize:'7px'}}>{e.celular || '-'}</td>
                                                <td style={{border:'1px solid #999', padding:'3px'}}>{e.departamento}</td>
                                                <td style={{border:'1px solid #999', padding:'3px'}}>{e.cargo || '-'}</td>
                                                <td style={{border:'1px solid #999', padding:'3px', textAlign:'center', fontSize:'7px'}}>{formatDate(e.fechaIngreso)}</td>
                                                <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(e.salarioBase)}</td>
                                                <td style={{border:'1px solid #999', padding:'3px'}}>{e.banco || '-'}</td>
                                                <td style={{border:'1px solid #999', padding:'3px', fontSize:'7px'}}>{e.cuenta || '-'}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                                <div style={{marginTop:'10px', display:'flex', justifyContent:'space-between', fontSize:'9px'}}>
                                    <span>Total empleados activos: <strong>{empleados.filter(e => e.activo && !e.fechaSalida).length}</strong></span>
                                    <span>Nómina mensual: <strong>RD$ {formatMoney(empleados.filter(e => e.activo && !e.fechaSalida).reduce((s,e) => s + e.salarioBase, 0))}</strong></span>
                                </div>
                            </div>
                        )}
                        
                        {/* Empleados por Departamento */}
                        {tipoReporteActivo === 'empleados-depto' && (() => {
                            const activos = empleados.filter(e => e.activo && !e.fechaSalida);
                            const porDepto = activos.reduce((acc, e) => {
                                if (!acc[e.departamento]) acc[e.departamento] = [];
                                acc[e.departamento].push(e);
                                return acc;
                            }, {});
                            return (
                                <div className="reporte-seccion">
                                    <table style={{width:'100%', borderCollapse:'collapse', fontSize:'8px'}}>
                                        <thead>
                                            <tr style={{background:'#d0d0d0'}}>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Nombre</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Cédula</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Cargo</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'center'}}>F. Ingreso</th>
                                                <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Salario</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {Object.keys(porDepto).sort().map(depto => {
                                                const emps = porDepto[depto].sort((a,b) => a.nombre.localeCompare(b.nombre));
                                                const totalDepto = emps.reduce((s,e) => s + e.salarioBase, 0);
                                                return (
                                                    <React.Fragment key={depto}>
                                                        <tr style={{background:'#e8e8e8'}}>
                                                            <td colSpan="5" style={{border:'1px solid #000', padding:'5px', fontWeight:'bold', fontSize:'9px'}}>{depto} ({emps.length} empleados)</td>
                                                        </tr>
                                                        {emps.map((e, idx) => (
                                                            <tr key={e.id} style={{background: idx % 2 === 0 ? '#fff' : '#f8f8f8'}}>
                                                                <td style={{border:'1px solid #999', padding:'3px', paddingLeft:'15px'}}>{e.nombre}</td>
                                                                <td style={{border:'1px solid #999', padding:'3px', fontSize:'7px'}}>{e.documento}</td>
                                                                <td style={{border:'1px solid #999', padding:'3px'}}>{e.cargo || '-'}</td>
                                                                <td style={{border:'1px solid #999', padding:'3px', textAlign:'center', fontSize:'7px'}}>{formatDate(e.fechaIngreso)}</td>
                                                                <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(e.salarioBase)}</td>
                                                            </tr>
                                                        ))}
                                                        <tr style={{background:'#d8d8d8'}}>
                                                            <td colSpan="4" style={{border:'1px solid #999', padding:'3px', textAlign:'right', fontWeight:'600'}}>Subtotal {depto}:</td>
                                                            <td style={{border:'1px solid #999', padding:'3px', textAlign:'right', fontWeight:'bold'}}>{formatMoney(totalDepto)}</td>
                                                        </tr>
                                                    </React.Fragment>
                                                );
                                            })}
                                            <tr style={{background:'#b0b0b0', fontWeight:'bold'}}>
                                                <td colSpan="4" style={{border:'2px solid #000', padding:'5px'}}>TOTAL GENERAL ({activos.length} empleados)</td>
                                                <td style={{border:'2px solid #000', padding:'5px', textAlign:'right', fontSize:'10px'}}>{formatMoney(activos.reduce((s,e) => s + e.salarioBase, 0))}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            );
                        })()}
                        
                        {/* Empleados por Antigüedad */}
                        {tipoReporteActivo === 'empleados-antiguedad' && (
                            <div className="reporte-seccion">
                                <table style={{width:'100%', borderCollapse:'collapse', fontSize:'8px'}}>
                                    <thead>
                                        <tr style={{background:'#d0d0d0'}}>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Nombre</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Departamento</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'center'}}>F. Ingreso</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'center'}}>Antigüedad</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Salario</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {empleados.filter(e => e.activo && !e.fechaSalida).sort((a,b) => new Date(a.fechaIngreso) - new Date(b.fechaIngreso)).map((e, idx) => {
                                            const antiguedad = calcularAntiguedad(e.fechaIngreso);
                                            return (
                                                <tr key={e.id} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5'}}>
                                                    <td style={{border:'1px solid #999', padding:'3px', fontWeight:'600'}}>{e.nombre}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px'}}>{e.departamento}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'center', fontSize:'7px'}}>{formatDate(e.fechaIngreso)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'center', fontWeight:'600'}}>{antiguedad.años > 0 ? `${antiguedad.años}a ${antiguedad.meses % 12}m` : `${antiguedad.meses}m`}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(e.salarioBase)}</td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        )}
                        
                        {/* Escala Salarial */}
                        {tipoReporteActivo === 'empleados-salarios' && (() => {
                            const activos = empleados.filter(e => e.activo && !e.fechaSalida);
                            const porDepto = activos.reduce((acc, e) => {
                                if (!acc[e.departamento]) acc[e.departamento] = [];
                                acc[e.departamento].push(e);
                                return acc;
                            }, {});
                            return (
                                <div className="reporte-seccion">
                                    <table style={{width:'100%', borderCollapse:'collapse', fontSize:'9px'}}>
                                        <thead>
                                            <tr style={{background:'#d0d0d0'}}>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'left'}}>Departamento</th>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'center'}}>Empleados</th>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'right'}}>Salario Mínimo</th>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'right'}}>Salario Máximo</th>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'right'}}>Promedio</th>
                                                <th style={{border:'1px solid #000', padding:'5px', textAlign:'right'}}>Total Depto.</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {Object.keys(porDepto).sort().map((depto, idx) => {
                                                const emps = porDepto[depto];
                                                const salarios = emps.map(e => e.salarioBase);
                                                const min = Math.min(...salarios);
                                                const max = Math.max(...salarios);
                                                const prom = salarios.reduce((a,b) => a+b, 0) / salarios.length;
                                                const total = salarios.reduce((a,b) => a+b, 0);
                                                return (
                                                    <tr key={depto} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5'}}>
                                                        <td style={{border:'1px solid #999', padding:'4px', fontWeight:'600'}}>{depto}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'center'}}>{emps.length}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'right'}}>{formatMoney(min)}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'right'}}>{formatMoney(max)}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'right'}}>{formatMoney(prom)}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'right', fontWeight:'bold'}}>{formatMoney(total)}</td>
                                                    </tr>
                                                );
                                            })}
                                            <tr style={{background:'#b0b0b0', fontWeight:'bold'}}>
                                                <td style={{border:'2px solid #000', padding:'5px'}}>TOTALES</td>
                                                <td style={{border:'2px solid #000', padding:'5px', textAlign:'center'}}>{activos.length}</td>
                                                <td style={{border:'2px solid #000', padding:'5px', textAlign:'right'}}>{formatMoney(Math.min(...activos.map(e => e.salarioBase)))}</td>
                                                <td style={{border:'2px solid #000', padding:'5px', textAlign:'right'}}>{formatMoney(Math.max(...activos.map(e => e.salarioBase)))}</td>
                                                <td style={{border:'2px solid #000', padding:'5px', textAlign:'right'}}>{formatMoney(activos.reduce((s,e) => s + e.salarioBase, 0) / activos.length)}</td>
                                                <td style={{border:'2px solid #000', padding:'5px', textAlign:'right', fontSize:'10px'}}>{formatMoney(activos.reduce((s,e) => s + e.salarioBase, 0))}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            );
                        })()}
                        
                        {/* Cumpleañeros del Mes */}
                        {tipoReporteActivo === 'empleados-cumple' && (() => {
                            const mesActual = new Date().getMonth() + 1;
                            const cumpleaneros = empleados.filter(e => e.activo && !e.fechaSalida && e.fechaNacimiento).filter(e => {
                                const mes = new Date(e.fechaNacimiento).getMonth() + 1;
                                return mes === mesActual;
                            }).sort((a,b) => new Date(a.fechaNacimiento).getDate() - new Date(b.fechaNacimiento).getDate());
                            return (
                                <div className="reporte-seccion">
                                    <div style={{textAlign:'center', marginBottom:'15px'}}>
                                        <h4 style={{fontSize:'14px'}}>🎂 Cumpleañeros de {MESES[mesActual]}</h4>
                                    </div>
                                    {cumpleaneros.length === 0 ? (
                                        <div style={{textAlign:'center', padding:'30px', color:'var(--text-muted)'}}>
                                            No hay cumpleañeros este mes
                                        </div>
                                    ) : (
                                        <table style={{width:'100%', borderCollapse:'collapse', fontSize:'9px'}}>
                                            <thead>
                                                <tr style={{background:'#d0d0d0'}}>
                                                    <th style={{border:'1px solid #000', padding:'5px', textAlign:'center'}}>Día</th>
                                                    <th style={{border:'1px solid #000', padding:'5px', textAlign:'left'}}>Nombre</th>
                                                    <th style={{border:'1px solid #000', padding:'5px', textAlign:'left'}}>Departamento</th>
                                                    <th style={{border:'1px solid #000', padding:'5px', textAlign:'center'}}>Edad</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {cumpleaneros.map((e, idx) => {
                                                    const dia = new Date(e.fechaNacimiento).getDate();
                                                    const edad = calcularEdad(e.fechaNacimiento);
                                                    return (
                                                        <tr key={e.id} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5'}}>
                                                            <td style={{border:'1px solid #999', padding:'4px', textAlign:'center', fontWeight:'bold', fontSize:'12px'}}>{dia}</td>
                                                            <td style={{border:'1px solid #999', padding:'4px', fontWeight:'600'}}>{e.nombre}</td>
                                                            <td style={{border:'1px solid #999', padding:'4px'}}>{e.departamento}</td>
                                                            <td style={{border:'1px solid #999', padding:'4px', textAlign:'center'}}>{edad} años</td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                        </table>
                                    )}
                                    <div style={{marginTop:'10px', fontSize:'9px', textAlign:'right'}}>
                                        <strong>Total cumpleañeros: {cumpleaneros.length}</strong>
                                    </div>
                                </div>
                            );
                        })()}
                        
                        {/* Empleados Desvinculados */}
                        {tipoReporteActivo === 'empleados-desvinculados' && (
                            <div className="reporte-seccion">
                                <table style={{width:'100%', borderCollapse:'collapse', fontSize:'8px'}}>
                                    <thead>
                                        <tr style={{background:'#d0d0d0'}}>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Nombre</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Cédula</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Departamento</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'center'}}>F. Ingreso</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'center'}}>F. Salida</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Motivo</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Último Salario</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {empleados.filter(e => e.fechaSalida).sort((a,b) => new Date(b.fechaSalida) - new Date(a.fechaSalida)).map((e, idx) => (
                                            <tr key={e.id} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5'}}>
                                                <td style={{border:'1px solid #999', padding:'3px', fontWeight:'600'}}>{e.nombre}</td>
                                                <td style={{border:'1px solid #999', padding:'3px', fontSize:'7px'}}>{e.documento}</td>
                                                <td style={{border:'1px solid #999', padding:'3px'}}>{e.departamento}</td>
                                                <td style={{border:'1px solid #999', padding:'3px', textAlign:'center', fontSize:'7px'}}>{formatDate(e.fechaIngreso)}</td>
                                                <td style={{border:'1px solid #999', padding:'3px', textAlign:'center', fontSize:'7px'}}>{formatDate(e.fechaSalida)}</td>
                                                <td style={{border:'1px solid #999', padding:'3px'}}>{e.motivoSalida || '-'}</td>
                                                <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(e.salarioBase)}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                                <div style={{marginTop:'10px', fontSize:'9px', textAlign:'right'}}>
                                    <strong>Total desvinculados: {empleados.filter(e => e.fechaSalida).length}</strong>
                                </div>
                            </div>
                        )}
                        
                        {/* REPORTES DE NÓMINA POR BANCO */}
                        {tipoReporteActivo === 'nomina-banco' && currentNomina && (() => {
                            const detalles = getDetallesRecalc();
                            const porBanco = {};
                            detalles.forEach(d => {
                                const emp = empleados.find(e => e.id === d.empId);
                                const banco = emp?.banco || 'Sin cuenta';
                                if (!porBanco[banco]) porBanco[banco] = [];
                                porBanco[banco].push({...d, cuenta: emp?.cuenta});
                            });
                            return (
                                <div className="reporte-seccion">
                                    {Object.keys(porBanco).sort().map(banco => {
                                        const emps = porBanco[banco];
                                        const totalBanco = emps.reduce((s,d) => s + d.neto, 0);
                                        return (
                                            <div key={banco} style={{marginBottom:'15px'}}>
                                                <div style={{background:'#333', color:'white', padding:'8px 12px', fontWeight:'bold'}}>{banco === 'Sin cuenta' ? '💵 Efectivo/Cheque' : `🏦 ${banco}`} - {emps.length} empleados - RD$ {formatMoney(totalBanco)}</div>
                                                <table style={{width:'100%', borderCollapse:'collapse', fontSize:'8px'}}>
                                                    <thead>
                                                        <tr style={{background:'#e8e8e8'}}>
                                                            <th style={{border:'1px solid #999', padding:'3px', textAlign:'left'}}>Empleado</th>
                                                            <th style={{border:'1px solid #999', padding:'3px', textAlign:'left'}}>Cuenta</th>
                                                            <th style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>Neto</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {emps.sort((a,b) => a.nombre.localeCompare(b.nombre)).map((d, idx) => (
                                                            <tr key={d.empId} style={{background: idx % 2 === 0 ? '#fff' : '#f8f8f8'}}>
                                                                <td style={{border:'1px solid #ccc', padding:'2px 4px'}}>{d.nombre}</td>
                                                                <td style={{border:'1px solid #ccc', padding:'2px 4px', fontSize:'7px'}}>{d.cuenta || '-'}</td>
                                                                <td style={{border:'1px solid #ccc', padding:'2px 4px', textAlign:'right', fontWeight:'600'}}>{formatMoney(d.neto)}</td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        );
                                    })}
                                    <div style={{background:'#b0b0b0', padding:'10px', fontWeight:'bold', display:'flex', justifyContent:'space-between'}}>
                                        <span>TOTAL A DEPOSITAR</span>
                                        <span>RD$ {formatMoney(detalles.reduce((s,d) => s + d.neto, 0))}</span>
                                    </div>
                                </div>
                            );
                        })()}
                        
                        {/* REPORTES DE PRÉSTAMOS */}
                        {(tipoReporteActivo === 'prestamos' || tipoReporteActivo === 'prestamos-activos') && (
                            <div className="reporte-seccion">
                                <table style={{width:'100%', borderCollapse:'collapse', fontSize:'8px'}}>
                                    <thead>
                                        <tr style={{background:'#d0d0d0'}}>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Empleado</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'center'}}>Fecha</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Monto Original</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Cuota</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'center'}}>Cuotas Rest.</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Pagado</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'right', background:'#b0b0b0'}}>Saldo</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'center'}}>Estado</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {prestamos.filter(p => p.activo && p.saldo > 0).map((p, idx) => {
                                            const emp = empleados.find(e => e.id === p.empleadoId);
                                            const pagado = p.monto - p.saldo;
                                            return (
                                                <tr key={p.id} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5'}}>
                                                    <td style={{border:'1px solid #999', padding:'3px', fontWeight:'600'}}>{emp?.nombre || 'N/A'}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'center', fontSize:'7px'}}>{formatDate(p.fecha)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(p.monto)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(p.cuotaMensual)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'center'}}>{Math.ceil(p.saldo / p.cuotaMensual)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(pagado)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(p.saldo)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'center'}}>{p.saldo > 0 ? 'Pendiente' : 'Pagado'}</td>
                                                </tr>
                                            );
                                        })}
                                        <tr style={{background:'#b0b0b0', fontWeight:'bold'}}>
                                            <td colSpan="2" style={{border:'2px solid #000', padding:'4px'}}>TOTALES ({prestamos.filter(p => p.activo && p.saldo > 0).length} préstamos activos)</td>
                                            <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(prestamos.filter(p => p.activo && p.saldo > 0).reduce((s,p) => s + p.monto, 0))}</td>
                                            <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(prestamos.filter(p => p.activo && p.saldo > 0).reduce((s,p) => s + p.cuotaMensual, 0))}</td>
                                            <td style={{border:'2px solid #000', padding:'4px'}}></td>
                                            <td style={{border:'2px solid #000', padding:'4px', textAlign:'right'}}>{formatMoney(prestamos.filter(p => p.activo && p.saldo > 0).reduce((s,p) => s + (p.monto - p.saldo), 0))}</td>
                                            <td style={{border:'2px solid #000', padding:'4px', textAlign:'right', background:'#909090', fontSize:'10px'}}>{formatMoney(prestamos.filter(p => p.activo && p.saldo > 0).reduce((s,p) => s + p.saldo, 0))}</td>
                                            <td style={{border:'2px solid #000', padding:'4px'}}></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        )}
                        
                        {/* Préstamos por vencer */}
                        {tipoReporteActivo === 'prestamos-vencer' && (() => {
                            const proximosVencer = prestamos.filter(p => p.activo && p.saldo > 0).filter(p => {
                                const cuotasRest = Math.ceil(p.saldo / p.cuotaMensual);
                                return cuotasRest <= 3;
                            });
                            return (
                                <div className="reporte-seccion">
                                    <div style={{marginBottom:'10px', padding:'10px', background:'#fff3e0', border:'1px solid #ffb74d', borderRadius:'6px', fontSize:'10px'}}>
                                        ⚠️ Préstamos que se completarán en los próximos 3 meses
                                    </div>
                                    {proximosVencer.length === 0 ? (
                                        <div style={{textAlign:'center', padding:'30px', color:'var(--text-muted)'}}>
                                            No hay préstamos próximos a vencer
                                        </div>
                                    ) : (
                                        <table style={{width:'100%', borderCollapse:'collapse', fontSize:'9px'}}>
                                            <thead>
                                                <tr style={{background:'#d0d0d0'}}>
                                                    <th style={{border:'1px solid #000', padding:'5px', textAlign:'left'}}>Empleado</th>
                                                    <th style={{border:'1px solid #000', padding:'5px', textAlign:'right'}}>Cuota Mensual</th>
                                                    <th style={{border:'1px solid #000', padding:'5px', textAlign:'center'}}>Cuotas Restantes</th>
                                                    <th style={{border:'1px solid #000', padding:'5px', textAlign:'right'}}>Saldo Pendiente</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {proximosVencer.map((p, idx) => {
                                                    const emp = empleados.find(e => e.id === p.empleadoId);
                                                    const cuotasRest = Math.ceil(p.saldo / p.cuotaMensual);
                                                    return (
                                                        <tr key={p.id} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5'}}>
                                                            <td style={{border:'1px solid #999', padding:'4px', fontWeight:'600'}}>{emp?.nombre || 'N/A'}</td>
                                                            <td style={{border:'1px solid #999', padding:'4px', textAlign:'right'}}>{formatMoney(p.cuotaMensual)}</td>
                                                            <td style={{border:'1px solid #999', padding:'4px', textAlign:'center', fontWeight:'bold', color: cuotasRest === 1 ? '#e53935' : '#fb8c00'}}>{cuotasRest}</td>
                                                            <td style={{border:'1px solid #999', padding:'4px', textAlign:'right', fontWeight:'bold'}}>{formatMoney(p.saldo)}</td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            );
                        })()}
                        
                        {/* Historial de Préstamos */}
                        {tipoReporteActivo === 'prestamos-historial' && (
                            <div className="reporte-seccion">
                                <table style={{width:'100%', borderCollapse:'collapse', fontSize:'8px'}}>
                                    <thead>
                                        <tr style={{background:'#d0d0d0'}}>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Empleado</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'center'}}>Fecha</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Monto</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Pagado</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Saldo</th>
                                            <th style={{border:'1px solid #000', padding:'4px', textAlign:'center'}}>Estado</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {prestamos.sort((a,b) => new Date(b.fecha) - new Date(a.fecha)).map((p, idx) => {
                                            const emp = empleados.find(e => e.id === p.empleadoId);
                                            const pagado = p.monto - p.saldo;
                                            const completado = p.saldo <= 0;
                                            return (
                                                <tr key={p.id} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5', opacity: completado ? 0.7 : 1}}>
                                                    <td style={{border:'1px solid #999', padding:'3px', fontWeight:'600'}}>{emp?.nombre || 'N/A'}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'center', fontSize:'7px'}}>{formatDate(p.fecha)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(p.monto)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(pagado)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'right', fontWeight:'bold'}}>{formatMoney(p.saldo)}</td>
                                                    <td style={{border:'1px solid #999', padding:'3px', textAlign:'center'}}>
                                                        <span style={{padding:'2px 6px', borderRadius:'4px', fontSize:'7px', background: completado ? '#c8e6c9' : '#fff3e0', color: completado ? '#2e7d32' : '#e65100'}}>
                                                            {completado ? '✓ Pagado' : 'Activo'}
                                                        </span>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        )}
                        
                        {/* Resumen TSS */}
                        {tipoReporteActivo === 'tss-resumen' && currentNomina && (() => {
                            const detalles = getDetallesRecalc();
                            const totales = detalles.reduce((a, d) => ({
                                afpEmp: a.afpEmp + d.afpEmp, afpPat: a.afpPat + d.afpPat,
                                sfsEmp: a.sfsEmp + d.sfsEmp, sfsPat: a.sfsPat + d.sfsPat,
                                infotep: a.infotep + d.infotep, riesgo: a.riesgo + d.riesgo
                            }), {afpEmp:0, afpPat:0, sfsEmp:0, sfsPat:0, infotep:0, riesgo:0});
                            return (
                                <div className="reporte-seccion">
                                    <table style={{width:'70%', margin:'0 auto', borderCollapse:'collapse', fontSize:'10px'}}>
                                        <thead>
                                            <tr style={{background:'#d0d0d0'}}>
                                                <th style={{border:'1px solid #000', padding:'8px', textAlign:'left'}}>Concepto</th>
                                                <th style={{border:'1px solid #000', padding:'8px', textAlign:'right'}}>Empleado</th>
                                                <th style={{border:'1px solid #000', padding:'8px', textAlign:'right'}}>Patronal</th>
                                                <th style={{border:'1px solid #000', padding:'8px', textAlign:'right', background:'#b0b0b0'}}>Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr><td style={{border:'1px solid #999', padding:'6px', fontWeight:'600'}}>AFP</td>
                                                <td style={{border:'1px solid #999', padding:'6px', textAlign:'right'}}>{formatMoney(totales.afpEmp)}</td>
                                                <td style={{border:'1px solid #999', padding:'6px', textAlign:'right'}}>{formatMoney(totales.afpPat)}</td>
                                                <td style={{border:'1px solid #999', padding:'6px', textAlign:'right', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(totales.afpEmp + totales.afpPat)}</td></tr>
                                            <tr style={{background:'#f5f5f5'}}><td style={{border:'1px solid #999', padding:'6px', fontWeight:'600'}}>SFS</td>
                                                <td style={{border:'1px solid #999', padding:'6px', textAlign:'right'}}>{formatMoney(totales.sfsEmp)}</td>
                                                <td style={{border:'1px solid #999', padding:'6px', textAlign:'right'}}>{formatMoney(totales.sfsPat)}</td>
                                                <td style={{border:'1px solid #999', padding:'6px', textAlign:'right', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(totales.sfsEmp + totales.sfsPat)}</td></tr>
                                            <tr><td style={{border:'1px solid #999', padding:'6px', fontWeight:'600'}}>INFOTEP</td>
                                                <td style={{border:'1px solid #999', padding:'6px', textAlign:'center'}}>-</td>
                                                <td style={{border:'1px solid #999', padding:'6px', textAlign:'right'}}>{formatMoney(totales.infotep)}</td>
                                                <td style={{border:'1px solid #999', padding:'6px', textAlign:'right', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(totales.infotep)}</td></tr>
                                            <tr style={{background:'#f5f5f5'}}><td style={{border:'1px solid #999', padding:'6px', fontWeight:'600'}}>Riesgo Laboral</td>
                                                <td style={{border:'1px solid #999', padding:'6px', textAlign:'center'}}>-</td>
                                                <td style={{border:'1px solid #999', padding:'6px', textAlign:'right'}}>{formatMoney(totales.riesgo)}</td>
                                                <td style={{border:'1px solid #999', padding:'6px', textAlign:'right', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(totales.riesgo)}</td></tr>
                                            <tr style={{background:'#b0b0b0', fontWeight:'bold'}}>
                                                <td style={{border:'2px solid #000', padding:'8px'}}>TOTALES</td>
                                                <td style={{border:'2px solid #000', padding:'8px', textAlign:'right'}}>{formatMoney(totales.afpEmp + totales.sfsEmp)}</td>
                                                <td style={{border:'2px solid #000', padding:'8px', textAlign:'right'}}>{formatMoney(totales.afpPat + totales.sfsPat + totales.infotep + totales.riesgo)}</td>
                                                <td style={{border:'2px solid #000', padding:'8px', textAlign:'right', background:'#909090', fontSize:'12px'}}>{formatMoney(totales.afpEmp + totales.afpPat + totales.sfsEmp + totales.sfsPat + totales.infotep + totales.riesgo)}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            );
                        })()}
                        
                        {/* ISR Retenido */}
                        {tipoReporteActivo === 'isr' && currentNomina && (() => {
                            const detalles = getDetallesRecalc().filter(d => d.isr > 0);
                            return (
                                <div className="reporte-seccion">
                                    {detalles.length === 0 ? (
                                        <div style={{textAlign:'center', padding:'30px', color:'var(--text-muted)'}}>No hay retenciones de ISR en esta nómina</div>
                                    ) : (
                                        <table style={{width:'100%', borderCollapse:'collapse', fontSize:'8px'}}>
                                            <thead>
                                                <tr style={{background:'#d0d0d0'}}>
                                                    <th style={{border:'1px solid #000', padding:'4px', textAlign:'left'}}>Empleado</th>
                                                    <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Salario Bruto</th>
                                                    <th style={{border:'1px solid #000', padding:'4px', textAlign:'right'}}>Ded. TSS</th>
                                                    <th style={{border:'1px solid #000', padding:'4px', textAlign:'right', background:'#b0b0b0'}}>ISR Retenido</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {detalles.map((d, idx) => (
                                                    <tr key={d.empId} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5'}}>
                                                        <td style={{border:'1px solid #999', padding:'3px', fontWeight:'600'}}>{d.nombre}</td>
                                                        <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(d.totalIng)}</td>
                                                        <td style={{border:'1px solid #999', padding:'3px', textAlign:'right'}}>{formatMoney(d.afpEmp + d.sfsEmp)}</td>
                                                        <td style={{border:'1px solid #999', padding:'3px', textAlign:'right', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(d.isr)}</td>
                                                    </tr>
                                                ))}
                                                <tr style={{background:'#b0b0b0', fontWeight:'bold'}}>
                                                    <td colSpan="3" style={{border:'2px solid #000', padding:'4px'}}>TOTAL ISR ({detalles.length} empleados)</td>
                                                    <td style={{border:'2px solid #000', padding:'4px', textAlign:'right', background:'#909090', fontSize:'10px'}}>{formatMoney(detalles.reduce((s,d) => s + d.isr, 0))}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            );
                        })()}
                        
                        {/* Horas Extra */}
                        {tipoReporteActivo === 'horas-extra' && currentNomina && (() => {
                            const detalles = getDetallesRecalc().filter(d => d.horasExtra > 0);
                            return (
                                <div className="reporte-seccion">
                                    {detalles.length === 0 ? (
                                        <div style={{textAlign:'center', padding:'30px', color:'var(--text-muted)'}}>No hay horas extras en esta nómina</div>
                                    ) : (
                                        <table style={{width:'100%', borderCollapse:'collapse', fontSize:'9px'}}>
                                            <thead>
                                                <tr style={{background:'#d0d0d0'}}>
                                                    <th style={{border:'1px solid #000', padding:'5px', textAlign:'left'}}>Empleado</th>
                                                    <th style={{border:'1px solid #000', padding:'5px', textAlign:'left'}}>Departamento</th>
                                                    <th style={{border:'1px solid #000', padding:'5px', textAlign:'right'}}>Salario Base</th>
                                                    <th style={{border:'1px solid #000', padding:'5px', textAlign:'right', background:'#b0b0b0'}}>Monto H. Extra</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {detalles.map((d, idx) => (
                                                    <tr key={d.empId} style={{background: idx % 2 === 0 ? '#fff' : '#f5f5f5'}}>
                                                        <td style={{border:'1px solid #999', padding:'4px', fontWeight:'600'}}>{d.nombre}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px'}}>{d.depto}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'right'}}>{formatMoney(d.salarioBase)}</td>
                                                        <td style={{border:'1px solid #999', padding:'4px', textAlign:'right', fontWeight:'bold', background:'#e8e8e8'}}>{formatMoney(d.horasExtra)}</td>
                                                    </tr>
                                                ))}
                                                <tr style={{background:'#b0b0b0', fontWeight:'bold'}}>
                                                    <td colSpan="3" style={{border:'2px solid #000', padding:'5px'}}>TOTAL HORAS EXTRA ({detalles.length} empleados)</td>
                                                    <td style={{border:'2px solid #000', padding:'5px', textAlign:'right', fontSize:'11px'}}>{formatMoney(detalles.reduce((s,d) => s + d.horasExtra, 0))}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    )}
                                </div>
                            );
                        })()}
                        
                        {/* REPORTE: Comparativo y Pendientes */}
                        {(tipoReporteActivo === 'comparativo' || tipoReporteActivo === 'comparativo-nominas' || tipoReporteActivo === 'evolucion-salarios') && (
                            <div className="alert alert-info">
                                <Icons.Info />
                                <span>El reporte comparativo estará disponible próximamente. Permitirá comparar dos períodos de nómina.</span>
                            </div>
                        )}
                        
                        {/* Mensaje cuando el reporte requiere nómina pero no hay una seleccionada */}
                        {tipoReporteActivo && !currentNomina && CATEGORIAS_REPORTES.flatMap(c => c.reportes).find(r => r.id === tipoReporteActivo)?.requiereNomina && (
                            <div className="alert alert-warning">
                                <span>⚠️ <strong>Este reporte requiere una nómina seleccionada.</strong><br/>Por favor, seleccione una nómina procesada desde el selector en la parte superior o vuelva atrás y seleccione una nómina.</span>
                            </div>
                        )}
                        
                        {/* Mensaje para reportes no implementados */}
                        {tipoReporteActivo && 
                         !['nomina-depto', 'nomina-resumen', 'nomina-banco', 'tss', 'tss-resumen', 'isr', 
                           'deducciones', 'ingresos', 'horas-extra', 'empleados', 'empleados-activos', 
                           'empleados-depto', 'empleados-antiguedad', 'empleados-salarios', 'empleados-cumple', 
                           'empleados-desvinculados', 'prestamos', 'prestamos-activos', 'prestamos-vencer', 
                           'prestamos-historial', 'comparativo', 'comparativo-nominas', 'evolucion-salarios'].includes(tipoReporteActivo) && (
                            <div className="alert alert-info">
                                <Icons.Info />
                                <span>Este reporte ({tipoReporteActivo}) está en desarrollo y estará disponible próximamente.</span>
                            </div>
                        )}
                    </div>
                )}
            </Modal>

            {/* Modal de Ausencias */}
            <Modal 
                open={modals.ausencias} 
                onClose={() => { closeModal('ausencias'); setAusenciasEmpId(null); }} 
                title="Registrar Días No Laborados" 
                size="md"
                footer={
                    <>
                        <button className="btn btn-secondary" onClick={() => { closeModal('ausencias'); setAusenciasEmpId(null); }}>Cerrar</button>
                    </>
                }
            >
                {ausenciasEmpId && (
                    <div>
                        <div className="alert alert-info" style={{marginBottom:'16px'}}>
                            <Icons.Info />
                            <span>
                                <strong>{empleados.find(e => e.id === ausenciasEmpId)?.nombre}</strong><br/>
                                Seleccione los días que NO laboró en este período. El descuento se calculará automáticamente.
                            </span>
                        </div>
                        
                        <div style={{marginBottom:'16px', padding:'12px', background:'var(--bg-secondary)', borderRadius:'8px'}}>
                            <strong>Período:</strong> {MESES[periodo.mes]} {periodo.año} 
                            {periodo.tipo === 'quincenal' && ` - ${periodo.quincena === 1 ? '1ra' : '2da'} Quincena`}
                        </div>

                        <div style={{display:'grid', gridTemplateColumns:'repeat(auto-fill, minmax(100px, 1fr))', gap:'8px'}}>
                            {getFechasDelPeriodo().map(fecha => {
                                const seleccionada = (nominaEdits[ausenciasEmpId]?.fechasAus || []).includes(fecha);
                                return (
                                    <button
                                        key={fecha}
                                        className="btn btn-sm"
                                        style={{
                                            background: seleccionada ? '#dc3545' : 'var(--bg-tertiary)',
                                            color: seleccionada ? 'white' : 'var(--text-primary)',
                                            border: seleccionada ? '2px solid #dc3545' : '1px solid var(--border-color)',
                                            padding: '8px 4px',
                                            display: 'flex',
                                            flexDirection: 'column',
                                            alignItems: 'center',
                                            fontSize: '11px'
                                        }}
                                        onClick={() => toggleFechaAusencia(fecha)}
                                    >
                                        <span style={{fontWeight:'bold'}}>{getDiaSemana(fecha)}</span>
                                        <span>{formatFechaCorta(fecha)}</span>
                                    </button>
                                );
                            })}
                        </div>

                        {(nominaEdits[ausenciasEmpId]?.fechasAus?.length || 0) > 0 && (
                            <div style={{marginTop:'16px', padding:'12px', background:'#dc354520', borderRadius:'8px', border:'1px solid #dc3545'}}>
                                <strong style={{color:'#dc3545'}}>Días seleccionados ({nominaEdits[ausenciasEmpId]?.fechasAus?.length || 0}):</strong>
                                <div style={{marginTop:'8px', display:'flex', flexWrap:'wrap', gap:'4px'}}>
                                    {nominaEdits[ausenciasEmpId]?.fechasAus?.map(f => (
                                        <span key={f} className="badge" style={{background:'#dc3545', color:'white', padding:'4px 8px'}}>
                                            {getDiaSemana(f)} {formatFechaCorta(f)}
                                        </span>
                                    ))}
                                </div>
                                <div style={{marginTop:'8px', fontSize:'12px', color:'var(--text-secondary)'}}>
                                    Descuento estimado: <strong style={{color:'#dc3545'}}>RD$ {formatMoney(
                                        calcularSalarioDiario(empleados.find(e => e.id === ausenciasEmpId)?.salarioBase || 0, config) * 
                                        (nominaEdits[ausenciasEmpId]?.fechasAus?.length || 0)
                                    )}</strong>
                                </div>
                            </div>
                        )}
                    </div>
                )}
            </Modal>

            {/* Modal Cambio de Contraseña */}
            <Modal 
                open={mostrarCambioPassword} 
                onClose={() => { setMostrarCambioPassword(false); setCambioPasswordForm({ actual: '', nueva: '', confirmar: '', error: '' }); }} 
                title="Cambiar Contraseña" 
                size="sm"
                footer={
                    <>
                        <button className="btn btn-secondary" onClick={() => setMostrarCambioPassword(false)}>Cancelar</button>
                        <button className="btn btn-primary" onClick={handleCambioPassword}><Icons.Check /> Cambiar</button>
                    </>
                }
            >
                <form onSubmit={handleCambioPassword}>
                    <div className="form-group">
                        <label className="form-label">Contraseña Actual</label>
                        <input 
                            type="password" 
                            className="form-control" 
                            value={cambioPasswordForm.actual}
                            onChange={e => setCambioPasswordForm(f => ({ ...f, actual: e.target.value, error: '' }))}
                        />
                    </div>
                    <div className="form-group">
                        <label className="form-label">Nueva Contraseña</label>
                        <input 
                            type="password" 
                            className="form-control" 
                            value={cambioPasswordForm.nueva}
                            onChange={e => setCambioPasswordForm(f => ({ ...f, nueva: e.target.value, error: '' }))}
                        />
                        <div className="form-help">Mínimo 6 caracteres</div>
                    </div>
                    <div className="form-group">
                        <label className="form-label">Confirmar Nueva Contraseña</label>
                        <input 
                            type="password" 
                            className="form-control" 
                            value={cambioPasswordForm.confirmar}
                            onChange={e => setCambioPasswordForm(f => ({ ...f, confirmar: e.target.value, error: '' }))}
                        />
                    </div>
                    {cambioPasswordForm.error && (
                        <div className="alert alert-danger" style={{marginTop:'12px'}}>
                            <Icons.AlertCircle /><span>{cambioPasswordForm.error}</span>
                        </div>
                    )}
                </form>
            </Modal>

            {/* Modal Protección de Datos */}
            <Modal 
                open={modals.proteccionDatos} 
                onClose={() => closeModal('proteccionDatos')} 
                title="🛡️ Protección de Datos" 
                size="lg"
            >
                <ProteccionDatosPanel toast={toast} onClose={() => closeModal('proteccionDatos')} />
            </Modal>

            {/* ================================================ */}
            {/* BARRA DE PROTECCIÓN DE DATOS (siempre visible) */}
            {/* ================================================ */}
            {usuarioActual && datosInicializados && (
                <div className={`data-protection-bar ${!spConnected ? 'warning' : syncStatus.error ? 'danger' : 'success'}`}>
                    <div className="protection-status">
                        {/* Estado de conexión */}
                        <div className={`protection-indicator ${spConnected ? 'active' : ''}`}>
                            <span className={`protection-dot ${spConnected ? (syncStatus.syncing ? 'syncing' : '') : 'warning'}`}></span>
                            <span>{spConnected ? '☁️ SharePoint' : '💾 Solo Local'}</span>
                        </div>
                        
                        {/* Estado de sincronización */}
                        <div className="protection-indicator">
                            <span className={`protection-dot ${syncStatus.syncing ? 'syncing' : pendingChanges ? 'warning' : ''}`}></span>
                            <span>
                                {syncStatus.syncing ? '🔄 Sincronizando...' : 
                                 syncStatus.lastSync ? `✅ Sync: ${new Date(syncStatus.lastSync).toLocaleTimeString()}` :
                                 '⏳ Sin sincronizar'}
                            </span>
                        </div>
                        
                        {/* Último guardado local */}
                        <div className="protection-indicator">
                            <span className="protection-dot"></span>
                            <span>💾 Local: {lastLocalSave ? new Date(lastLocalSave).toLocaleTimeString() : 'N/A'}</span>
                        </div>
                        
                        {/* Datos */}
                        <div className="protection-indicator">
                            <span>👥 {empleados.length} emp</span>
                            <span style={{marginLeft: '8px'}}>📋 {nominas.length} nóm</span>
                        </div>
                    </div>
                    
                    <div className="protection-actions">
                        {!spConnected && (
                            <button className="protection-btn primary" onClick={conectarMicrosoft}>
                                🔗 Conectar SharePoint
                            </button>
                        )}
                        <button className="protection-btn" onClick={crearBackupManual}>
                            💾 Backup
                        </button>
                        <button className="protection-btn" onClick={() => setShowRecoveryModal(true)}>
                            🔧 Recuperar
                        </button>
                        <button className="protection-btn" onClick={exportarBackupArchivo}>
                            📥 Exportar
                        </button>
                    </div>
                </div>
            )}

            {/* ================================================ */}
            {/* MODAL DE RECUPERACIÓN DE DATOS */}
            {/* ================================================ */}
            {showRecoveryModal && (
                <div className="recovery-modal" onClick={(e) => e.target === e.currentTarget && setShowRecoveryModal(false)}>
                    <div className="recovery-content">
                        <div className="recovery-header">
                            <h3>🛡️ Centro de Recuperación de Datos</h3>
                            <button 
                                onClick={() => setShowRecoveryModal(false)}
                                style={{background: 'transparent', border: 'none', color: 'white', fontSize: '20px', cursor: 'pointer'}}
                            >
                                ✕
                            </button>
                        </div>
                        <div className="recovery-body">
                            {/* Verificación de Integridad */}
                            <h4 style={{marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '8px'}}>
                                🔍 Verificación de Integridad
                                <button 
                                    className="btn btn-sm btn-secondary" 
                                    onClick={verificarIntegridadDatos}
                                    style={{marginLeft: 'auto'}}
                                >
                                    Verificar Ahora
                                </button>
                            </h4>
                            <div className="integrity-check">
                                {Object.entries(dataIntegrity.results).map(([key, value]) => (
                                    <div className="integrity-item" key={key}>
                                        <span style={{textTransform: 'capitalize'}}>{key}</span>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                                            <span style={{fontSize: '10px', color: 'var(--text-muted)'}}>{value.message}</span>
                                            <span className={`integrity-status ${value.status}`}>
                                                {value.status === 'ok' ? '✓ OK' : value.status === 'warning' ? '⚠️' : '❌'}
                                            </span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                            
                            {/* Lista de Backups */}
                            <h4 style={{marginBottom: '12px', marginTop: '20px', display: 'flex', alignItems: 'center', gap: '8px'}}>
                                📦 Backups Disponibles ({backupsList.length})
                                <button 
                                    className="btn btn-sm btn-success" 
                                    onClick={crearBackupManual}
                                    style={{marginLeft: 'auto'}}
                                >
                                    + Crear Backup
                                </button>
                            </h4>
                            
                            {backupsList.length === 0 ? (
                                <p style={{textAlign: 'center', color: 'var(--text-muted)', padding: '20px'}}>
                                    No hay backups disponibles
                                </p>
                            ) : (
                                <div style={{maxHeight: '200px', overflowY: 'auto'}}>
                                    {backupsList.slice(0, 10).map((backup, idx) => (
                                        <div className="backup-item" key={backup.key}>
                                            <div className="backup-info">
                                                <h4>
                                                    {backup.tipo === 'Pre-cambio' ? '🔄' : '📦'} 
                                                    {' '}{backup.tipo} - {new Date(backup.fecha).toLocaleString()}
                                                </h4>
                                                <p>{backup.razon} • {backup.tamaño}</p>
                                            </div>
                                            <div className="backup-actions">
                                                <button 
                                                    className="btn btn-xs btn-warning"
                                                    onClick={() => restaurarBackup(backup.key)}
                                                >
                                                    Restaurar
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                            
                            {/* Acciones adicionales */}
                            <div style={{marginTop: '20px', paddingTop: '16px', borderTop: '1px solid var(--border)', display: 'flex', gap: '8px', flexWrap: 'wrap'}}>
                                <button className="btn btn-info" onClick={exportarBackupArchivo}>
                                    📥 Descargar Backup Completo
                                </button>
                                <button className="btn btn-secondary" onClick={() => {
                                    const input = document.createElement('input');
                                    input.type = 'file';
                                    input.accept = '.json';
                                    input.onchange = (e) => {
                                        const file = e.target.files[0];
                                        if (file && window.ProteccionNomina) {
                                            window.ProteccionNomina.ExportImport.importarDesdeArchivo(file)
                                                .then(r => {
                                                    if (r.exito) {
                                                        toast('✅ Datos importados. Recargando...', 'success');
                                                        setTimeout(() => window.location.reload(), 1500);
                                                    } else {
                                                        toast('❌ Error: ' + r.error, 'error');
                                                    }
                                                });
                                        }
                                    };
                                    input.click();
                                }}>
                                    📤 Importar desde Archivo
                                </button>
                                {spConnected && (
                                    <button className="btn btn-purple" onClick={sincronizarConSharePoint}>
                                        ☁️ Forzar Sync SharePoint
                                    </button>
                                )}
                            </div>
                            
                            {/* Advertencia */}
                            <div style={{marginTop: '16px', padding: '12px', background: 'rgba(255,193,7,0.1)', borderRadius: '8px', fontSize: '11px', color: '#856404'}}>
                                <strong>⚠️ Importante:</strong> Los datos se guardan automáticamente en este navegador. 
                                Para acceder desde otro dispositivo, conecte con SharePoint o exporte un backup.
                            </div>
                        </div>
                    </div>
                </div>
            )}

            {/* Toasts */}
            <div className="toasts">{toasts.map(t => <Toast key={t.id} msg={t.msg} type={t.type} onClose={() => removeToast(t.id)} />)}</div>
            
            {/* Loading */}
            {loading && <div className="loading"><div className="spinner"></div></div>}
            
            {/* Área de Impresión de Nómina - Agrupada por Departamento */}
            {modoImpresionNomina && currentNomina && (() => {
                const detalles = getDetallesRecalc();
                const porDepto = detalles.reduce((acc, d) => { 
                    const depto = d.depto || 'SIN DEPARTAMENTO';
                    if (!acc[depto]) acc[depto] = []; 
                    acc[depto].push(d); 
                    return acc; 
                }, {});
                const deptosOrdenados = Object.keys(porDepto).sort();
                const totalesGral = detalles.reduce((a, d) => ({
                    salario: a.salario + d.salarioBase,
                    horasExtra: a.horasExtra + d.horasExtra,
                    bonificacion: a.bonificacion + d.bonificacion,
                    comisiones: a.comisiones + (d.comisiones || 0),
                    incentivos: a.incentivos + (d.incentivos || 0),
                    totalIng: a.totalIng + d.totalIng,
                    afpEmp: a.afpEmp + d.afpEmp,
                    sfsEmp: a.sfsEmp + d.sfsEmp,
                    isr: a.isr + d.isr,
                    prestamo: a.prestamo + d.cuotaPrestamo,
                    otras: a.otras + d.descAusencias + d.descTardanzas + d.otrasDed,
                    totalDed: a.totalDed + d.totalDed,
                    neto: a.neto + d.neto,
                    afpPat: a.afpPat + d.afpPat,
                    sfsPat: a.sfsPat + d.sfsPat,
                    infotep: a.infotep + d.infotep,
                    riesgo: a.riesgo + d.riesgo
                }), { salario: 0, horasExtra: 0, bonificacion: 0, comisiones: 0, incentivos: 0, totalIng: 0, afpEmp: 0, sfsEmp: 0, isr: 0, prestamo: 0, otras: 0, totalDed: 0, neto: 0, afpPat: 0, sfsPat: 0, infotep: 0, riesgo: 0 });
                
                return (
                <div className="print-area" style={{padding: '15px', background: 'white'}}>
                    {/* Encabezado del reporte */}
                    <div style={{textAlign: 'center', marginBottom: '15px', borderBottom: '2px solid #000', paddingBottom: '8px'}}>
                        <h2 style={{margin: 0, fontSize: '14px'}}>CENTRO EDUCATIVO DE FORMACIÓN INTEGRAL TEHUI</h2>
                        <p style={{margin: '3px 0', fontSize: '10px'}}>Carretera Don Pedro no. 140, esquina Las Orquídeas</p>
                        <p style={{margin: '3px 0', fontSize: '10px'}}>GRUPO PAIDOS, SRL - RNC: 133-03246-5</p>
                        <h3 style={{margin: '8px 0 5px', fontSize: '12px', background: '#e0e0e0', padding: '4px'}}>
                            NÓMINA DESDE {currentNomina.periodo.quincena === 1 ? '01' : '16'}/{String(currentNomina.periodo.mes).padStart(2,'0')}/{currentNomina.periodo.año} HASTA {currentNomina.periodo.quincena === 1 ? '15' : new Date(currentNomina.periodo.año, currentNomina.periodo.mes, 0).getDate()}/{String(currentNomina.periodo.mes).padStart(2,'0')}/{currentNomina.periodo.año}
                        </h3>
                        <div style={{display: 'flex', justifyContent: 'space-between', fontSize: '9px', marginTop: '5px'}}>
                            <span>Nómina No. {currentNomina.codigo}</span>
                            <span>Fecha: {new Date().toLocaleDateString('es-DO')} {new Date().toLocaleTimeString('es-DO')}</span>
                        </div>
                    </div>
                    
                    {/* Tabla agrupada por departamento */}
                    <table style={{width: '100%', borderCollapse: 'collapse', fontSize: '8px'}}>
                        <thead>
                            <tr style={{background: '#d0d0d0'}}>
                                <th style={{border: '1px solid #000', padding: '3px', textAlign: 'left', width: '20%'}}>Empleado</th>
                                <th style={{border: '1px solid #000', padding: '3px', textAlign: 'right', width: '7%'}}>Salario</th>
                                <th style={{border: '1px solid #000', padding: '3px', textAlign: 'right', width: '5%'}}>Otros</th>
                                <th style={{border: '1px solid #000', padding: '3px', textAlign: 'right', width: '6%'}}>Seg. Soc.</th>
                                <th style={{border: '1px solid #000', padding: '3px', textAlign: 'right', width: '6%'}}>Imp/Renta</th>
                                <th style={{border: '1px solid #000', padding: '3px', textAlign: 'right', width: '7%'}}>Total Ing.</th>
                                <th style={{border: '1px solid #000', padding: '3px', textAlign: 'right', width: '7%'}}>Total Ded.</th>
                                <th style={{border: '1px solid #000', padding: '3px', textAlign: 'right', width: '8%', background: '#b0b0b0', fontWeight: 'bold'}}>NETO</th>
                                <th style={{border: '1px solid #000', padding: '3px', textAlign: 'right', width: '6%'}}>AFP</th>
                                <th style={{border: '1px solid #000', padding: '3px', textAlign: 'right', width: '6%'}}>S.F. Salud</th>
                            </tr>
                        </thead>
                        <tbody>
                            {deptosOrdenados.map(depto => {
                                const empsDepto = porDepto[depto];
                                const totDepto = empsDepto.reduce((a, d) => ({
                                    salario: a.salario + d.salarioBase,
                                    otros: a.otros + d.horasExtra + d.bonificacion + (d.comisiones || 0) + (d.incentivos || 0),
                                    segSoc: a.segSoc + d.afpEmp + d.sfsEmp,
                                    isr: a.isr + d.isr,
                                    totalIng: a.totalIng + d.totalIng,
                                    totalDed: a.totalDed + d.totalDed,
                                    neto: a.neto + d.neto,
                                    afpEmp: a.afpEmp + d.afpEmp,
                                    sfsEmp: a.sfsEmp + d.sfsEmp
                                }), { salario: 0, otros: 0, segSoc: 0, isr: 0, totalIng: 0, totalDed: 0, neto: 0, afpEmp: 0, sfsEmp: 0 });
                                
                                return (
                                    <React.Fragment key={depto}>
                                        {/* Encabezado del departamento */}
                                        <tr style={{background: '#f0f0f0'}}>
                                            <td colSpan="10" style={{border: '1px solid #000', padding: '4px', fontWeight: 'bold', fontSize: '9px'}}>{depto}</td>
                                        </tr>
                                        {/* Empleados del departamento */}
                                        {empsDepto.map((d, idx) => {
                                            const otros = d.horasExtra + d.bonificacion + (d.comisiones || 0) + (d.incentivos || 0);
                                            const segSoc = d.afpEmp + d.sfsEmp;
                                            return (
                                                <tr key={d.empId} style={{background: idx % 2 === 0 ? '#fff' : '#f8f8f8'}}>
                                                    <td style={{border: '1px solid #999', padding: '2px 3px'}}>{d.empId} - {d.nombre}</td>
                                                    <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>{formatMoney(d.salarioBase)}</td>
                                                    <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>{otros > 0 ? formatMoney(otros) : ''}</td>
                                                    <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>{formatMoney(segSoc)}</td>
                                                    <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>{d.isr > 0 ? formatMoney(d.isr) : ''}</td>
                                                    <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right', fontWeight: '600'}}>{formatMoney(d.totalIng)}</td>
                                                    <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>{formatMoney(d.totalDed)}</td>
                                                    <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right', fontWeight: 'bold', background: '#e8e8e8'}}>{formatMoney(d.neto)}</td>
                                                    <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right', fontSize: '7px'}}>{formatMoney(d.afpEmp)}</td>
                                                    <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right', fontSize: '7px'}}>{formatMoney(d.sfsEmp)}</td>
                                                </tr>
                                            );
                                        })}
                                        {/* Subtotal del departamento */}
                                        <tr style={{background: '#e0e0e0', fontWeight: 'bold'}}>
                                            <td style={{border: '1px solid #000', padding: '3px', fontSize: '8px'}}>TOTAL DE {depto}</td>
                                            <td style={{border: '1px solid #000', padding: '3px', textAlign: 'right'}}>{formatMoney(totDepto.salario)}</td>
                                            <td style={{border: '1px solid #000', padding: '3px', textAlign: 'right'}}>{totDepto.otros > 0 ? formatMoney(totDepto.otros) : ''}</td>
                                            <td style={{border: '1px solid #000', padding: '3px', textAlign: 'right'}}>{formatMoney(totDepto.segSoc)}</td>
                                            <td style={{border: '1px solid #000', padding: '3px', textAlign: 'right'}}>{totDepto.isr > 0 ? formatMoney(totDepto.isr) : ''}</td>
                                            <td style={{border: '1px solid #000', padding: '3px', textAlign: 'right'}}>{formatMoney(totDepto.totalIng)}</td>
                                            <td style={{border: '1px solid #000', padding: '3px', textAlign: 'right'}}>{formatMoney(totDepto.totalDed)}</td>
                                            <td style={{border: '1px solid #000', padding: '3px', textAlign: 'right', background: '#c8c8c8'}}>{formatMoney(totDepto.neto)}</td>
                                            <td style={{border: '1px solid #000', padding: '3px', textAlign: 'right', fontSize: '7px'}}>{formatMoney(totDepto.afpEmp)}</td>
                                            <td style={{border: '1px solid #000', padding: '3px', textAlign: 'right', fontSize: '7px'}}>{formatMoney(totDepto.sfsEmp)}</td>
                                        </tr>
                                        {/* Espacio entre departamentos */}
                                        <tr><td colSpan="10" style={{height: '5px', border: 'none'}}></td></tr>
                                    </React.Fragment>
                                );
                            })}
                            {/* Total General */}
                            <tr style={{background: '#b0b0b0', fontWeight: 'bold'}}>
                                <td style={{border: '2px solid #000', padding: '4px', fontSize: '9px'}}>TOTAL GENERAL ({detalles.length} empleados)</td>
                                <td style={{border: '2px solid #000', padding: '4px', textAlign: 'right'}}>{formatMoney(totalesGral.salario)}</td>
                                <td style={{border: '2px solid #000', padding: '4px', textAlign: 'right'}}>{formatMoney(totalesGral.horasExtra + totalesGral.bonificacion + totalesGral.comisiones + totalesGral.incentivos)}</td>
                                <td style={{border: '2px solid #000', padding: '4px', textAlign: 'right'}}>{formatMoney(totalesGral.afpEmp + totalesGral.sfsEmp)}</td>
                                <td style={{border: '2px solid #000', padding: '4px', textAlign: 'right'}}>{formatMoney(totalesGral.isr)}</td>
                                <td style={{border: '2px solid #000', padding: '4px', textAlign: 'right'}}>{formatMoney(totalesGral.totalIng)}</td>
                                <td style={{border: '2px solid #000', padding: '4px', textAlign: 'right'}}>{formatMoney(totalesGral.totalDed)}</td>
                                <td style={{border: '2px solid #000', padding: '4px', textAlign: 'right', background: '#909090', fontSize: '10px'}}>{formatMoney(totalesGral.neto)}</td>
                                <td style={{border: '2px solid #000', padding: '4px', textAlign: 'right'}}>{formatMoney(totalesGral.afpEmp)}</td>
                                <td style={{border: '2px solid #000', padding: '4px', textAlign: 'right'}}>{formatMoney(totalesGral.sfsEmp)}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    {/* Resumen de Aportes - Formato similar al PDF */}
                    <div style={{marginTop: '12px', display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px', fontSize: '9px', pageBreakInside: 'avoid'}}>
                        <div style={{background: '#f5f5f5', padding: '8px', border: '1px solid #999'}}>
                            <h4 style={{margin: '0 0 8px 0', borderBottom: '1px solid #999', paddingBottom: '4px', fontSize: '10px'}}>Aportes a la Seguridad Social</h4>
                            <table style={{width: '100%', fontSize: '8px', borderCollapse: 'collapse'}}>
                                <thead>
                                    <tr style={{background: '#e0e0e0'}}>
                                        <th style={{border: '1px solid #999', padding: '3px', textAlign: 'left'}}>Concepto</th>
                                        <th style={{border: '1px solid #999', padding: '3px', textAlign: 'right'}}>Empleado</th>
                                        <th style={{border: '1px solid #999', padding: '3px', textAlign: 'right'}}>Empleador</th>
                                        <th style={{border: '1px solid #999', padding: '3px', textAlign: 'right'}}>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style={{border: '1px solid #999', padding: '2px'}}>AFP</td>
                                        <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>{formatMoney(totalesGral.afpEmp)}</td>
                                        <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>{formatMoney(totalesGral.afpPat)}</td>
                                        <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right', fontWeight: 'bold'}}>{formatMoney(totalesGral.afpEmp + totalesGral.afpPat)}</td>
                                    </tr>
                                    <tr>
                                        <td style={{border: '1px solid #999', padding: '2px'}}>SFS</td>
                                        <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>{formatMoney(totalesGral.sfsEmp)}</td>
                                        <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>{formatMoney(totalesGral.sfsPat)}</td>
                                        <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right', fontWeight: 'bold'}}>{formatMoney(totalesGral.sfsEmp + totalesGral.sfsPat)}</td>
                                    </tr>
                                    <tr>
                                        <td style={{border: '1px solid #999', padding: '2px'}}>INFOTEP</td>
                                        <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>-</td>
                                        <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>{formatMoney(totalesGral.infotep)}</td>
                                        <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right', fontWeight: 'bold'}}>{formatMoney(totalesGral.infotep)}</td>
                                    </tr>
                                    <tr>
                                        <td style={{border: '1px solid #999', padding: '2px'}}>Riesgo Laboral</td>
                                        <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>-</td>
                                        <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right'}}>{formatMoney(totalesGral.riesgo)}</td>
                                        <td style={{border: '1px solid #999', padding: '2px', textAlign: 'right', fontWeight: 'bold'}}>{formatMoney(totalesGral.riesgo)}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div style={{background: '#f5f5f5', padding: '8px', border: '1px solid #999'}}>
                            <h4 style={{margin: '0 0 8px 0', borderBottom: '1px solid #999', paddingBottom: '4px', fontSize: '10px'}}>Resumen de Nómina</h4>
                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '3px'}}><span>Total Ingresos:</span><span style={{fontWeight: 'bold'}}>RD$ {formatMoney(totalesGral.totalIng)}</span></div>
                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '3px'}}><span>Total Deducciones:</span><span style={{fontWeight: 'bold'}}>RD$ {formatMoney(totalesGral.totalDed)}</span></div>
                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '3px'}}><span>Total Empleados:</span><span style={{fontWeight: 'bold'}}>{detalles.length}</span></div>
                            <div style={{display: 'flex', justifyContent: 'space-between', padding: '6px', background: '#d0d0d0', border: '2px solid #000', marginTop: '8px'}}>
                                <span><strong>TOTAL NETO A PAGAR:</strong></span>
                                <span style={{fontWeight: 'bold', fontSize: '11px'}}>RD$ {formatMoney(totalesGral.neto)}</span>
                            </div>
                        </div>
                    </div>
                    
                    {/* Firmas */}
                    <div style={{marginTop: '20px', display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '25px', fontSize: '9px', pageBreakInside: 'avoid'}}>
                        <div style={{textAlign: 'center'}}>
                            <div style={{borderTop: '1px solid #333', paddingTop: '4px', marginTop: '25px'}}>Elaborado por</div>
                        </div>
                        <div style={{textAlign: 'center'}}>
                            <div style={{borderTop: '1px solid #333', paddingTop: '4px', marginTop: '25px'}}>Revisado por</div>
                        </div>
                        <div style={{textAlign: 'center'}}>
                            <div style={{borderTop: '1px solid #333', paddingTop: '4px', marginTop: '25px'}}>Aprobado por</div>
                        </div>
                    </div>
                </div>
                );
            })()}
            </>
            )}
        </div>
    );
};

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
